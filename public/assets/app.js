function S($){let L=document.createElement("div");return L.innerHTML=$,L.firstElementChild}function V($){return[$?.closest("tr")?.rowIndex??0,$?.cellIndex??0]}function R($){return globalThis.getComputedStyle($)}function u($){let{x:L,y:H,height:M,width:h}=$.getBoundingClientRect(),T=L+globalThis.scrollX,E=H+globalThis.scrollY;return{x:T,y:E,yh:E+M,xw:T+h,w:h,h:M}}function Q(){return Array.from(document.querySelectorAll("*")).reduce((H,M)=>{if(M.style.zIndex&&Number(M.style.zIndex)>H)return Number(M.style.zIndex);return H},0)+1}var X$,W="",V$="";function q$(){if(W)document.title=W;W="",clearInterval(X$)}function Y$($){if(document.hasFocus())return;if(q$(),!W)W=document.title;V$=$,X$=setInterval(()=>{document.title=document.title===W?V$:W},1000)}var k=new Map;class q{element;constructor($){this.element=$}}function G($,L,H){if(!k.has($))k.set($,new WeakMap);L.forEach(function(h){if(k.get($)?.has(h))return;k.get($)?.set(h,new H(h))})}var Z$="valid",R$="invalid";class g extends q{method;outputElement;indicatorElement;static hydrate($){G("AutoComplete",$.querySelectorAll("input[data-autocomplete-action]"),this)}constructor($){super($);$.autocomplete="off",this.method=$.dataset.autocompleteAction;let L=$.dataset.autocompleteOutput,H=$.dataset.autocompleteIndicator,M=L?document.querySelector(L):void 0;if(!M)throw Error("Expected element to have data-autocomplete-output");this.outputElement=M||document.createElement("input"),this.indicatorElement=H?document.querySelector(H):void 0,$.addEventListener("keyup",(h)=>this.keyUp(h)),$.addEventListener("keydown",(h)=>{if(h.key==="Enter")h.preventDefault()})}getResultsContainer(){let $=u(this.element),L=document.querySelector("#autocomplete");if(!L)L=Object.assign(document.createElement("div"),{id:"autocomplete"}),Object.assign(L.style,{zIndex:Q()}),document.body.appendChild(L);return Object.assign(L.style,{top:`${$.yh}px`,left:`${$.x}px`,width:`${$.w}px`}),L}keyUp($){let L=this.getResultsContainer(),H=Array.from(L.querySelectorAll("div")),M=H.findIndex((h)=>h.classList.contains("selected"));switch($.key){case"ArrowUp":case"ArrowDown":H.at(M)?.classList.remove("selected"),H.at((M+($.key==="ArrowDown"?1:-1))%H.length)?.classList.add("selected");return;case"Enter":if(M>=0)H.at(M)?.dispatchEvent(new Event("click"));return;default:if(this.indicatorElement)this.indicatorElement.classList.remove(Z$),this.indicatorElement.classList.add(R$);if(this.clearResults(),this.element.value)this.doSearch();break}}clearResults(){let $=this.getResultsContainer();$.style.display="none",$.innerHTML=""}async doSearch(){let $=this.getResultsContainer(),L=/ACP/.test(document.location.toString())?"../":"",M=`term=${encodeURIComponent(this.element.value)}`,h=await fetch(`${L}/api/${this.method}?${M}`);if(!h.ok)return;let T=await h.json();if($.innerHTML="",T.length){$.style.display="";let[E,A]=T;E.forEach((F,j)=>{let B=A[j],x=document.createElement("div");x.innerHTML=B,x.addEventListener("click",()=>{if($.style.display="none",this.indicatorElement)this.indicatorElement.classList.add(Z$),this.indicatorElement.classList.remove(R$);this.outputElement.value=`${F}`,this.outputElement.dispatchEvent(new Event("change")),this.element.value=B}),$.appendChild(x)});return}$.style.display="none"}}var{userAgent:f}=navigator;function U(){return"ontouchstart"in window}var C={chrome:/chrome/i.test(f),ie:/msie/i.test(f),iphone:/iphone/i.test(f),mobile:/mobile/i.test(f),n3ds:/nintendo 3ds/.test(f),firefox:/firefox/i.test(f),safari:/safari/i.test(f)};class W${sess;boundEvents;droppables;noChild=!1;bounds;onstart;ondragover;ondrag;ondragout;ondrop;autoZIndex=!0;constructor(){this.droppables=[],this.sess={el:document.body,mx:0,my:0,reset:()=>{return}},this.boundEvents={drag:($)=>this.drag($),drop:()=>this.drop()}}start($,L,H){let M=L||$.target;if(this.noChild&&$.target!==(H||M))return;$.preventDefault(),$.stopPropagation();let h=R(M),T=Q();if(M.getAttribute("draggable")==="false")return;if(this.sess={el:M,mx:$ instanceof MouseEvent?$.pageX:$.targetTouches[0].pageX,my:$ instanceof MouseEvent?$.pageY:$.targetTouches[0].pageY,ex:Number.parseInt(h.left,10)||0,ey:Number.parseInt(h.top,10)||0,info:{el:M,mx:0,my:0,reset:()=>{return}},reset:()=>this.reset(),zIndex:M.style.zIndex},!this.sess.zIndex||Number(this.sess.zIndex)<T-1)M.style.zIndex=`${T}`;this.onstart?.({...this.sess,droptarget:this.testDrops(this.sess.mx,this.sess.my)}),document.addEventListener(U()?"touchmove":"mousemove",this.boundEvents.drag),document.addEventListener(U()?"touchend":"mouseup",this.boundEvents.drop),this.drag($)}drag($){$.stopPropagation();let L=this.sess.el.style,H=$ instanceof MouseEvent?$.pageX:$.targetTouches[0].pageX,M=$ instanceof MouseEvent?$.pageY:$.targetTouches[0].pageY,h=H,T=M,E,A=(this.sess.ex??0)+h-this.sess.mx,F=(this.sess.ey??0)+T-this.sess.my,j=this.bounds;if(j){if(A<j[0])h=h-A+j[0],[A]=j;else if(A>j[0]+j[2])A=j[0]+j[2];if(F<j[1])T=T-F+j[1],[F]=j;else if(F>j[1]+j[3])F=j[1]+j[3]}L.left=`${A}px`,L.top=`${F}px`;let B=this.sess.info,x=B?.droptarget,K={...this.sess,left:A,top:F,mx:h,my:T,dx:h-(B?.mx||h),dy:T-(B?.my||T),droptarget:this.testDrops(H,M)};if(this.sess.info=K,this.ondrag?.(K),K.droptarget&&x!==K.droptarget)this.ondragover?.(K);if(x&&K.droptarget!==x)E=K.droptarget,K.droptarget=x,this.ondragout?.(K),K.droptarget=E}boundingBox($,L,H,M){return this.bounds=[$,L,H,M],this}drop(){if(this.boundEvents)document.removeEventListener(U()?"touchend":"mouseup",this.boundEvents.drop),document.removeEventListener(U()?"touchmove":"mousemove",this.boundEvents.drag);if(this.ondrop?.(this.sess.info??{}),this.autoZIndex)this.sess.el.style.zIndex=this.sess.zIndex??"";return!0}testDrops($,L){let{droppables:H}=this,M,h=[9999,9999];if(!H.length)return;return H.findLast((T)=>{if(T===this.sess.el||this.sess.el.contains(T))return;if(M=u(T),h[0]>M.w&&h[1]>M.h&&$>=M.x&&L>=M.y&&$<=M.xw&&L<=M.yh)return h=[M.w,M.h],T;return})}drops($){return this.droppables=$,this}addDrops($){if(!this.droppables)return this.drops($);return this.droppables=this.droppables.concat($),this}addListener($){return Object.assign(this,$),this}apply($,L){if(Array.isArray($))return $.forEach((h)=>this.apply(h)),this;let M=R($)?.position;if(!M||M==="static")$.style.position="relative";return(L||$).addEventListener(U()?"touchstart":"mousedown",L?(h)=>this.start(h,$,L):(h)=>this.start(h,$)),this}autoZ(){return this.autoZIndex=!1,this}noChildActivation(){return this.noChild=!0,this}reset($=this.sess.el){return $.style.top="0",$.style.left="0",this}}var N=W$;class f${soundCache={};getFilePath($){return`/assets/sounds/${$}.mp3`}load($,L=!1){let H=this.soundCache[$];if(H){if(L)this.play($);return}H=new Audio,this.soundCache[$]=H,H.autoplay=!!L,H.src=this.getFilePath($)}loadAndPlay($){this.load($,!0)}play($){this.soundCache[$].play()}}var _=new f$;async function X($,L,H=600,M="linear"){return new Promise((h)=>{$.animate(L,{duration:H,easing:M}).addEventListener("finish",()=>{Object.assign($.style,L.at(-1)),h($)},{once:!0})})}function G$($){return X($,[{backgroundColor:"#FF0"},{backgroundColor:""}],1000)}var K$="50px";class N${success($,L=3000){this.showToast($,"success",L)}error($,L=0){this.showToast($,"error",L)}async showToast($,L,H=0){let M=document.createElement("div"),h=async()=>{await X(M,[{top:K$},{top:`-${K$}`}]),M.remove()};M.classList.add(L),Object.assign(M.style,{position:"fixed",left:"50%",transform:"translateX(-50%)",boxShadow:"black 5px 5px 10px",zIndex:Q()}),M.addEventListener("click",h,{once:!0}),M.innerHTML=$;let T=document.createElement("a");if(T.href="javascript:void(0)",T.innerHTML=" [X]",T.title="close notification",T.addEventListener("click",h,{once:!0}),M.append(T),document.body.appendChild(M),await X(M,[{top:"0"},{top:K$}],600,"ease-in-out"),H)await new Promise((E)=>setTimeout(E,H)),h()}}var J=new N$;class v extends q{static hydrate($){G("Checkers",$.querySelectorAll(".checkers"),this)}constructor($){super($);_.load("chessdrop");let L=new N;L.addListener({ondrop:(H)=>{if(H.reset(),!H.droptarget)return;let{droptarget:M,el:h}=H,T=V(h.closest("td")),E=V(M);if(!this.isValidMove(T,E))return;if([1,8].includes(E[0]))this.promote(h);this.getCapturedPiece(T,E)?.remove(),M.append(h),_.play("chessdrop"),this.moveNumber++,navigator.clipboard.writeText("[checkers]"+this.gameState+"[/checkers]"),J.success("BBCode copied to clipboard")}}),L.drops(Array.from($.querySelectorAll("td"))),L.apply(Array.from($.querySelectorAll(".piece")))}getCapturedPiece($,L){let H=[L[0]-$[0],L[1]-$[1]];if(H.map(Math.abs).join(",")!=="2,2")return;return this.element.rows[$[0]+H[0]/2].cells[$[1]+H[1]/2].querySelector(".piece")??void 0}promote($){$.dataset.piece=$.dataset.piece?.toUpperCase(),$.innerHTML="♛"}isValidMove($,L){let H=this.element,M=[L[0]-$[0],L[1]-$[1]].map(Math.abs),h=H.rows[$[0]].cells[$[1]].querySelector(".piece")?.dataset.piece??"",T=this.getCapturedPiece($,L)?.dataset.piece??"";if(L[0]%2===L[1]%2)return!1;if(M[0]!=M[1])return!1;if(h==="b"&&L[0]<=$[0])return!1;if(h==="r"&&L[0]>=$[0])return!1;if(T.toLowerCase()===h.toLowerCase())return!1;if(H.rows[L[0]].cells[L[1]].querySelector(".piece"))return!1;return M[0]===(T?2:1)}get moveNumber(){return Number(this.element.dataset.moveNumber??"1")}set moveNumber($){this.element.dataset.moveNumber=`${$}`}get gameState(){let $=Array.from(this.element.querySelectorAll("td")),L=[];for(let H=0;H<8;H++){L.push([]);for(let M=0;M<4;M++){let h=H%2?0:1;L[H].push($[H*8+M*2+h].querySelector(".piece")?.dataset.piece||" ")}}return L.map((H)=>H.join("")).join("/").replaceAll(/ +/g,(H)=>`${H.length}`)+` ${this.moveNumber}`}}var U$=["#F00","#FF7F00","#FF0","#0F0","#00F","#4B0082","#9400D3"];function s$($=200){let L=document.querySelector("#snow");if(L===null)L=document.createElement("div"),L.id="snow",Object.assign(L.style,{position:"fixed",top:0,left:0,zIndex:1}),document.body.prepend(L);L.innerHTML="";for(let H=1;H<=$;H+=1){let M=document.createElement("div");M.className="snowflake",L.appendChild(M)}}function a$(){let $=document.getElementById("snow-css");if($)return $;return $=document.createElement("style"),$.id="snow-css",document.head.appendChild($),$}function m$($){let L=a$();L.innerHTML=$,document.head.appendChild(L)}function n$($=100){return Math.floor(Math.random()*$)+1}function o$($,L){let H=Math.ceil($),M=Math.floor(L);return Math.floor(Math.random()*(M-H+1))+H}function e$($,L){return Math.random()*(L-$)+$}function $L($=200,L=!1){let M=100*document.body.offsetHeight/window.innerHeight,h=`
    .snowflake {
        position: absolute;
        width: 10px;
        height: 10px;
        /* Workaround for Chromium's selective color inversion */
        border-radius: 50%;
    }
  `;for(let T=1;T<=$;T+=1){let E=Math.random()*100,A=Math.random()*10,F=E+A,j=E+A/2,B=e$(0.3,0.8),x=B*M,K=Math.random(),F$=o$(10,M/10*3),I=n$(M/10*3)*-1,l$=Math.random(),j$=L?U$[Math.floor(Math.random()*U$.length)]:"white";h+=`
      .snowflake:nth-child(${T}) {
        opacity: ${l$};
        background: linear-gradient(${j$}, ${j$});
        filter: drop-shadow(0 0 10px ${j$});
        transform: translate(${E}vw, -10px) scale(${K});
        animation: fall-${T} ${F$}s ${I}s linear infinite;
      }
      @keyframes fall-${T} {
        ${B*100}% {
          transform: translate(${F}vw, ${x}vh) scale(${K});
        }
        to {
          transform: translate(${j}vw, ${M}vh) scale(${K});
        }
      }
    `}m$(h)}function Y($=200,L=!1){$L($,L),s$($)}var LL={R:"♜",N:"♞",B:"♝",Q:"♛",K:"♚",P:"♟",r:"♜",n:"♞",b:"♝",q:"♛",k:"♚",p:"♟"};class p extends q{static hydrate($){G("Chess",$.querySelectorAll(".chess"),this)}constructor($){super($);_.load("chessdrop");let L=new N;L.addListener({ondrop:(H)=>{if(H.reset(),!H.droptarget)return;let M=H.el,h=M.dataset.piece??"",T=H.droptarget.querySelector(".piece"),E=T?.dataset.piece?.trim()??"",A=V(M.closest("td")),F=V(H.droptarget),j=h.toLowerCase()===h;if(this.moveNumber%2===0!==j){J.error(`It's ${j?"white":"black"}'s turn!`,3000);return}if(!this.isValidMove(A,F))return;if(h?.toLowerCase()==="p"&&[1,8].includes(F[0]))this.promotePawn(M);if(E?.toLowerCase()==="k")_.loadAndPlay("malo-mart"),Y(2000,!0);if(T?.remove(),H.droptarget.append(M),_.play("chessdrop"),this.moveNumber++,this.computeDanger(),this.element.querySelector('.piece.danger[data-piece="k" i]'))_.loadAndPlay("metal-gear-alert");navigator.clipboard.writeText("[chess]"+this.getFENNotation()+"[/chess]"),J.success("BBCode copied to clipboard")}}),L.drops(Array.from($.querySelectorAll("td"))),L.apply(Array.from($.querySelectorAll(".piece"))),this.computeDanger()}get moveNumber(){return Number(this.element.dataset.moveNumber??"1")}set moveNumber($){this.element.dataset.moveNumber=`${$}`}didJumpAPiece($,L){let H=[L[0]-$[0],L[1]-$[1]],M=H.map(Math.sign),h=Math.max(...H.map(Math.abs));for(let T=1;T<h;T++)if(this.getPieceAt([$[0]+M[0]*T,$[1]+M[1]*T]))return!0;return!1}isValidMove($,L){let H=this.getPieceAt($)?.dataset.piece??"",M=this.getPieceAt(L)?.dataset.piece??"",T=[$[0]-L[0],$[1]-L[1]].map(Math.abs),E=Math.min(...T)===0,A=T[0]===T[1];if(M!==""&&H.toLowerCase()===H===(M.toLowerCase()===M))return!1;switch(H){case"p":return $[0]<L[0]&&(M?A&&Math.max(...T)==1:E&&Math.max(...T)<=($[0]===2?2:1));case"P":return $[0]>L[0]&&(M?A&&Math.max(...T)==1:E&&Math.max(...T)<=($[0]===7?2:1));case"r":case"R":return E&&!this.didJumpAPiece($,L);case"b":case"B":return A&&!this.didJumpAPiece($,L);case"n":case"N":return T.toSorted((F,j)=>F-j).join(",")==="1,2";case"q":case"Q":return(E||A)&&!this.didJumpAPiece($,L);case"k":case"K":if(!(A||E))return!1;if(Math.max(...T)===2)return this.doCastle($,L);return Math.max(...T)===1}return!0}doCastle($,L){let H=([M,h],T)=>{let E=this.getPieceAt([M,h]);if(E?.dataset.piece!==T)return!1;if(this.didJumpAPiece($,[M,h]))return!1;return this.element.rows[M].cells[h===1?4:6].append(E),!0};if($[0]===1&&$[1]===5){if(L[1]==7)return H([$[0],8],"r");if(L[1]===3)return H([$[0],1],"r")}if($[0]===8&&$[1]===5){if(L[1]==7)return H([$[0],8],"R");if(L[1]===3)return H([$[0],1],"R")}return!1}promotePawn($){while(!0){let L=(prompt("Congrats on your promotion, sir pawn! What rank would you like? (q: Queen, r: Rook, b: Bishop, n: Knight)","q")??"").toLowerCase();if(["q","r","b","n"].includes(L)){L=$.dataset.piece==="p"?L.toLowerCase():L.toUpperCase(),$.dataset.piece=L,$.innerHTML=LL[L],_.loadAndPlay("zelda-item-get");break}}}getFENNotation(){return Array.from(this.element.querySelectorAll("td")).map((L,H)=>(H&&H%8===0?"/":"")+(L.querySelector(".piece")?.dataset.piece||" ")).join("").replaceAll(/ +/g,(L)=>`${L.length}`)+` ${this.moveNumber}`}getPieceAt([$,L]){return this.element.rows[$].cells[L].querySelector(".piece")}computeDanger(){this.element.querySelectorAll(".piece.danger").forEach((H)=>H.classList.remove("danger"));let $=this.element.querySelectorAll(".piece.white"),L=this.element.querySelectorAll(".piece.black");$.forEach((H)=>{L.forEach((M)=>{if(this.isPieceInDanger(H,M))H.classList.add("danger");if(this.isPieceInDanger(M,H))M.classList.add("danger")})})}isPieceInDanger($,L){let H=V($.closest("td")),M=V(L.closest("td"));return this.isValidMove(M,H)}}function P$($){if(!globalThis.getSelection)return;let L=document.createRange();L.selectNode($);let H=globalThis.getSelection();if(!H)return;if(H.rangeCount)H.removeAllRanges();H.addRange(L)}function O$($,L){let H=$.scrollTop,M=$.selectionStart??0,h=$.selectionEnd??0;$.value=$.value.substring(0,M)+L+$.value.slice(h),$.selectionStart=M+L.length,$.selectionEnd=M+L.length,$.focus(),$.scrollTop=H}class w extends q{static hydrate($){G("CodeBlock",$.querySelectorAll(".bbcode.code"),this)}constructor($){super($);$.addEventListener("click",()=>P$($))}}class c extends q{fullHeight=0;animationLengthInMs=200;static hydrate($){G("CollapseBox",$.querySelectorAll(".collapse-box"),this)}constructor($){super($);let{collapseContent:L}=this;if(L)Object.assign(L.style,{transition:`height ${this.animationLengthInMs}ms ease-in-out`});this.toggle(),this.element.addEventListener("click",(H)=>{if(H.target instanceof HTMLElement&&H.target.matches(".collapse-button"))this.isOpen=!this.isOpen,this.toggle()})}get boxID(){return this.element.getAttribute("id")||""}get collapseContent(){return this.element.querySelector(".collapse-content")}get isOpen(){return this.boxID?!(globalThis.sessionStorage.getItem("collapsed")??"").split(",").includes(this.boxID):!0}set isOpen($){let L=(globalThis.sessionStorage.getItem("collapsed")??"").split(",").filter(Boolean);if($)L=L.filter((H)=>H!==this.boxID);else L.push(this.boxID);globalThis.sessionStorage.setItem("collapsed",L.join(",")??"")}toggle(){let{collapseContent:$}=this;if(!$)return;let{style:L}=$;if(this.isOpen){if(!this.fullHeight)return;L.height=`${this.fullHeight}px`,this.element.classList.remove("collapsed"),setTimeout(()=>{L.removeProperty("height"),L.removeProperty("overflow")},this.animationLengthInMs)}else this.fullHeight=$.clientHeight||$.offsetHeight,L.height=`${this.fullHeight}px`,L.overflow="hidden",this.element.classList.add("collapsed"),requestAnimationFrame(()=>{L.height="0px"})}}function HL($){let L=$.getHours()||12,H=`${$.getMinutes()}`.padStart(2,"0");return`${L%12||12}:${H}${L>12?"pm":"am"}`}function d($){return new Date($*1000)}var I$=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],b$=["January","February","March","April","May","June","July","August","September","October","November","December"];function ML($){return $[0].toUpperCase()+$.slice(1)}function i($){let L=new Date,H=new Intl.RelativeTimeFormat(void 0,{numeric:"auto",style:"long"}),M=new Date;M.setTime(+M-86400000),M.setHours(0),M.setMinutes(0),M.setSeconds(0);let h=d($),T=Math.round((+h-+L)/1000);if(T>-60)return H.format(T,"second");if(T>-3600)return H.format(Math.round(T/60),"minute");if(h>M){let E=new Date;return E.setHours(0),E.setMinutes(0),E.setSeconds(0),`${ML(H.format(h>E?0:-1,"day"))} @ ${HL(h)}`}return Intl.DateTimeFormat(void 0,{month:"short",year:"numeric",day:"numeric",hour:"numeric",hour12:!0,minute:"numeric"}).format(h)}function B$($){let L=d($),H=L.getHours(),M=H>=12?"pm":"am";H%=12,H=H||12;let h=`${L.getMinutes()}`.padStart(2,"0"),T=L.getMonth()+1,E=`${L.getDate()}`.padStart(2,"0"),A=L.getFullYear();return`${H}:${h}${M}, ${T}/${E}/${A}`}function P($,L=1000){return new Promise((H)=>{let M=new Set,h=Array.from($).filter((E)=>!E.complete);if(!h.length){H();return}function T(){if(M.delete(this.src),M.size===0)H()}if(h.forEach((E)=>{if(!M.has(E.src))M.add(E.src),E.addEventListener("error",T),E.addEventListener("load",T)}),L)setTimeout(H,L)})}function b(){let $=document.querySelectorAll(".autodate"),L=Array.from(document.querySelectorAll("[data-timestamp]"));if(!$)return;$.forEach((H)=>{let M=Number.parseInt(H.getAttribute("title")??"",10),h=H.classList.contains("smalldate")?B$(M):i(M);if(h!==H.innerHTML)H.innerHTML=h}),L.forEach((H)=>{if(!H.title)H.title=B$(Number.parseInt(H.dataset.timestamp??"",10))})}function D($){if(document.readyState==="complete")$();else document.addEventListener("DOMContentLoaded",$)}function D$(){let $=document.createElement("input");return $.setAttribute("type","date"),$.type==="date"}function y$(){let $=[String.fromCodePoint(9757,127999),String.fromCodePoint(9757)].map((L)=>{let H=document.body.appendChild(document.createElement("span"));H.appendChild(document.createTextNode(L));let M=H.offsetWidth;return H.remove(),M});return $[0]===$[1]}class r extends q{picker;selectedDate;lastDate;static hydrate($){if(D$())return;G("DatePicker",$.querySelectorAll("input[type=date]"),this)}constructor($){super($);this.picker=this.getPicker(),$.autocomplete="off",$.addEventListener("focus",()=>this.openPicker()),$.addEventListener("keydown",()=>this.closePicker())}getPicker(){if(this.picker)return this.picker;let $=document.querySelector("#datepicker");if(!$)$=Object.assign(document.createElement("table"),{id:"datepicker"}),document.body.appendChild($),$.style.display="none";return $}openPicker(){let $=u(this.element);Object.assign(this.picker.style,{display:"",zIndex:Q(),position:"absolute",top:`${$.yh}px`,left:`${$.x}px`});let[L,H,M]=this.element.value.split("/").map((h)=>Number.parseInt(h,10));if(L&&H&&M)this.selectedDate=[M,L-1,H];else this.selectedDate=void 0;this.generate(M,L,H)}closePicker(){this.picker.style.display="none"}generate($,L,H){let M=new Date,h=this.getPicker(),T,E,[A,F,j]=[$,L,H];if(A===void 0)A=M.getFullYear(),F=M.getMonth(),j=M.getDate(),this.selectedDate=[A,F,j];if(F===-1)A-=1,F=11;if(F===12)A+=1,F=0;this.lastDate=[A,F,j];let B=new Date(A,F+1,0).getDate(),x=new Date(A,F,1).getDay();h.innerHTML="",T=h.insertRow(0),E=T.insertCell(0),E.innerHTML="&lt;",E.className="control",E.addEventListener("click",()=>this.lastYear()),E=T.insertCell(1),E.colSpan=5,E.className="year",E.innerHTML=`${A}`,E=T.insertCell(2),E.innerHTML=">",E.className="control",E.addEventListener("click",()=>this.nextYear()),T=h.insertRow(1),E=T.insertCell(0),E.innerHTML="<",E.className="control",E.addEventListener("click",()=>this.lastMonth()),E=T.insertCell(1),E.colSpan=5,E.innerHTML=b$[F],E.className="month",E=T.insertCell(2),E.innerHTML=">",E.className="control",E.addEventListener("click",()=>this.nextMonth()),T=h.insertRow(2),T.className="weekdays";for(let K=0;K<7;K+=1)T.insertCell(K).innerHTML=I$[K];T=h.insertRow(3);for(let K=0;K<B;K+=1){if(!K)for(let I=0;I<x;I+=1)T.insertCell(I);if((x+K)%7===0)T=h.insertRow(h.rows.length);E=T.insertCell((x+K)%7),E.addEventListener("click",this.insert.bind(this,E));let F$=!!this.selectedDate&&A===this.selectedDate[0]&&F===this.selectedDate[1]&&K+1===this.selectedDate[2];E.className=`day${F$?" selected":""}`,E.innerHTML=`${K+1}`}}lastYear(){let $=this.lastDate;if($)this.generate($[0]-1,$[1],$[2])}nextYear(){let $=this.lastDate;if($)this.generate($[0]+1,$[1],$[2])}lastMonth(){let $=this.lastDate;if($)this.generate($[0],$[1]-1,$[2])}nextMonth(){let $=this.lastDate;if($)this.generate($[0],$[1]+1,$[2])}insert($){let L=this.lastDate;if(L)this.element.value=`${L[1]+1}/${$.innerHTML}/${L[0]}`;this.closePicker()}}class k${rgb;constructor($){let L=/^rgb\((\d+),\s?(\d+),\s?(\d+)\)/i.exec($),H=/#?([\da-fA-F]+)/.exec($);if(L){this.rgb=[Number.parseFloat(L[1]),Number.parseFloat(L[2]),Number.parseFloat(L[3])];return}if(H){let M=H[1];if(M.length===3)M=M.charAt(0)+M.charAt(0)+M.charAt(1)+M.charAt(1)+M.charAt(2)+M.charAt(2);if(M.length!==6){this.rgb=[0,0,0];return}this.rgb=[];for(let h=0;h<3;h+=1)this.rgb[h]=Number.parseInt(M.slice(h*2,(h+1)*2),16)}}invert(){if(this.rgb)this.rgb=[255-this.rgb[0],255-this.rgb[1],255-this.rgb[2]];return this}toRGB(){return this.rgb}toHex(){return"#"+this.rgb?.map(($)=>$.toString(16).padStart(2,"0")).join("")}}var _$=k$;var g$={a:($,L)=>`[url=${L?.getAttribute("href")}]${$}[/url]`,b(...$){return this.strong(...$)},br:()=>`
`,del:($)=>`[del]${$}[/del]`,div:($)=>$.trim()?`
${$}`:`${$}`,em:($)=>`[i]${$}[/i]`,font:($,L)=>{let H=L.style.fontFamily||L.getAttribute("face");return H?`[font=${H}]${$}[/font]`:$},h1:($)=>`[h1]${$}[/h1]`,h2:($)=>`[h2]${$}[/h2]`,h3:($)=>`[h3]${$}[/h3]`,h4:($)=>`[h4]${$}[/h4]`,h5:($)=>`[h5]${$}[/h5]`,h6:($)=>`[h6]${$}[/h6]`,hr:()=>`
`,i(...$){return this.em(...$)},img:($,L)=>{let H=L.getAttribute("alt")??"",M=L.getAttribute("src");if(L.dataset.emoji)return` ${L.dataset.emoji}`;if(M&&H)return`[img=${H}]${M}[/img]`;if(M)return`[img]${M}[/img]`;return H},li:($)=>`* ${$.replace(/[\n\r]+/,"")}
`,meta:()=>`
`,ol:($)=>`[ol]${$}[/ol]`,p:($)=>`
${$==="&nbsp"?"":$}
`,s(...$){return this.del(...$)},strike(...$){return this.del(...$)},strong:($)=>`[b]${$}[/b]`,u:($)=>`[u]${$}[/u]`,ul:($)=>`[ul]${$}[/ul]`},t={"background-color":($,L)=>{let H=$&&new _$($).toHex(),M=H?`${H}`:$;if(["ffffff","white","transparent"].includes(M))return L;return`[bgcolor=${M}]${L}[/bgcolor]`},color($,L){let H=$&&new _$($).toHex();return`[color=${H?`${H}`:$}]${L}[/color]`},"font-family":($,L)=>`[font=${$.replaceAll(/['"]/g,"")}]${L}[/font]`,"font-style":($,L)=>`[i]${L}[/i]`,"font-size":($,L)=>`[size=${$}]${L}[/size]`,"font-weight":($,L)=>`[b]${L}[/b]`,"text-align":($,L)=>`[align=${$}]${L}[/align]`,"text-decoration":function(L,H){return L==="line-through"?`[s]${H}[/s]`:`[u]${H}[/u]`}};function hL($){return $.replaceAll(/[\r\n]+/g,"").replaceAll("&amp;","&").replaceAll("&gt;",">").replaceAll("&lt;","<").replaceAll("&nbsp;"," ")}function Q$($){let L=$.tagName.toLowerCase(),H="";for(let T of $.childNodes)H+=T.nodeType===Node.ELEMENT_NODE?Q$(T):hL(T.textContent??"");if(L==="body")return H;if($.style){for(let T of $.style)if(T in t)H=t[T]($.style.getPropertyValue(T),H)}let M=$.getAttribute("size");if(M)H=t.fontSize(M,H);let h=$.getAttribute("color");if(h)H=t.color(h,H);if(L in g$)H=g$[L](H,$);return H}function J$($){return $.replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll(/(\s) /g,"$1&nbsp;").replaceAll(/\[b\]([^]*?)\[\/b\]/gi,"<b>$1</b>").replaceAll(/\[i\]([^]*?)\[\/i\]/gi,"<i>$1</i>").replaceAll(/\[u\]([^]*?)\[\/u\]/gi,"<u>$1</u>").replaceAll(/\[(s|strike|del)\]([^]*?)\[\/\1\]/gi,"<del>$2</del>").replaceAll(/\[img\]([^'"[]+)\[\/img\]/gi,'<img src="$1">').replaceAll(/\[color=([^\]]+)\]([^]*?)\[\/color\]/gi,'<span style="color:$1">$2</span>').replaceAll(/\[size=([^\]]+)\]([^]*?)\[\/size\]/gi,'<span style="font-size:$1">$2</span>').replaceAll(/\[font=['"]?([^\]]+?)['"]?\]([^]*?)\[\/font\]/gi,'<span style="font-family:$1">$2</span>').replaceAll(/\[url=([^\]]+)\]([^]*?)\[\/url\]/gi,'<a href="$1">$2</a>').replaceAll(/\[bgcolor=([^\]]+)\]([^]*?)\[\/bgcolor\]/gi,'<span style="background-color:$1">$2</span>').replaceAll(/\[h(\d)\]([^]*?)\[\/h\1\]/g,"<h$1>$2</h$1>").replaceAll(/\[align=(left|right|center)\]([^]*?)\[\/align\]/g,'<div style="text-align:$1">$2</div>').replaceAll(/\[(ul|ol)\]([^]*?)\[\/\1\]/gi,(L,H,M)=>{let T=M.split(/(^|[\r\n]+)\* ?/).filter((E)=>E.trim()).map((E)=>`<li>${E}</li>`).join("");return`<${H}>${T}</${H}>`}).replaceAll(`
`,"<br>")}var TL=/^(ht|f)tps?:\/\/[\w.\-%&?=/]+$/,EL=($)=>TL.test($),C$={"Sans Serif":["Arial","Arial Black","Arial Narrow","Arial Rounded MT Bold","Avant Garde","Calibri","Candara","Century Gothic","Comic Sans MS","Franklin Gothic Medium","Futura","Geneva","Gill Sans","Helvetica","Impact","Lucida Grande","Optima","Segoe UI","Tahoma","Trebuchet MS","Verdana"],Serif:["Big Caslon","Bodoni MT","Book Antiqua","Calisto MT","Cambria","Didot","Garamond","Georgia","Goudy Old Style","Hoefler Text","Lucida Bright","Palatino","Perpetua","Rockwell","Rockwell Extra Bold","Baskerville","Times New Roman"],Monospaced:["Consolas","Courier New","Lucida Console","Lucida Sans Typewriter","Monaco","Andale Mono"],Fantasy:["Copperplate","Papyrus"],Script:["Brush Script MT"]};class l extends q{iframe;colorWindow;container;htmlMode=!0;editbar;emoteWindow;static hydrate($){G("Editor",$.querySelectorAll("textarea.bbcode-editor"),this)}constructor($){super($);this.container=Object.assign(document.createElement("div"),{className:"editor"}),this.iframe=document.createElement("iframe"),this.iframe.style.display="none",this.iframe.addEventListener("load",()=>this.iframeLoaded(),{once:!0}),$.before(this.container),this.container.appendChild($),this.container.appendChild(this.iframe)}get doc(){return this.window?.document}get window(){return this.iframe.contentWindow}iframeLoaded(){let{iframe:$,element:L}=this;if($.className="editorframe",this.htmlMode=globalSettings.wysiwyg,L.addEventListener("input",()=>{this.setSource(J$(L.value))}),this.doc?.addEventListener("input",()=>{if(!this.doc)return;this.element.value=Q$(this.doc.body)}),this.doc?.addEventListener("paste",(h)=>{h.preventDefault();let T=h.clipboardData?.getData("text/plain");this.doc?.execCommand("insertText",!1,T)}),this.doc?.addEventListener("drop",(h)=>{if(!h.dataTransfer?.files.length)return;this.upload(h.dataTransfer.files[0])}),this.doc?.addEventListener("dragleave",()=>{this.getAttachmentStatus().remove()}),this.doc?.addEventListener("dragover",()=>{this.getAttachmentStatus()}),!this.doc)return;let H=R(L),M=this.doc.getElementsByTagName("body")[0];if(M&&H)M.style.backgroundColor=H.backgroundColor,M.style.color=H.color,M.style.borderColor="#FFF";this.doc.designMode="on",this.editbar=this.buildEditBar(),$.style.height=`${L.clientHeight}px`,L.before(this.editbar),this.setSource("<div></div>"),setTimeout(()=>{if(this.setSource(J$(L.value)),this.switchMode(this.htmlMode),L.hasAttribute("autofocus"))this.window?.focus()},100)}getAttachmentStatus(){let $=this.doc?.querySelector("#attachmentStatus");if($)return $;return $=document.createElement("div"),Object.assign($,{id:"attachmentStatus",innerHTML:"Drop file here",contentEditable:"false"}),Object.assign($.style,{position:"fixed",padding:"20px",top:"50%",left:"50%",translate:"-50% -50%",border:"2px dashed #ccc"}),this.doc?.body.appendChild($),$}upload($){let L=new FormData;L.append("Filedata",$);let H=new XMLHttpRequest;this.getAttachmentStatus().innerHTML='Uploading: <progress id="attachmentProgress"></div>';let M=this.getAttachmentStatus().querySelector("#attachmentProgress");H.upload.addEventListener("progress",(h)=>{if(M&&h.lengthComputable){let T=Math.round(h.loaded/h.total*100);M.value=h.loaded,M.max=h.total,M.textContent=`${T}%`}}),H.addEventListener("load",()=>{this.window?.focus(),this.getAttachmentStatus().remove();let h=H.responseText;if(/\D/.test(h)){alert("Error: "+h);return}this.cmd("inserthtml",`[attachment]${H.responseText}[/attachment]`)}),H.upload.addEventListener("error",()=>{this.getAttachmentStatus().remove()}),H.open("POST","/api/upload",!0),H.send(L)}buildEditBar(){let $=document.createElement("div");$.className="editbar",$.innerHTML=[`<select class="fontface">
        <option value="">Default Font</option>
        <optgroup label="Headings">
          <option value="heading_1" style="font-weight:bold;font-size: 2em">Heading 1</option>
          <option value="heading_2" style="font-weight:bold;font-size: 1.5em">Heading 2</option>
          <option value="heading_3" style="font-weight:bold;font-size: 1.17em">Heading 3</option>
          <option value="heading_4" style="font-weight:bold;font-size: 1em">Heading 4</option>
          <option value="heading_5" style="font-weight:bold;font-size: 0.83em">Heading 5</option>
          <option value="heading_6" style="font-weight:bold;font-size: 0.67em">Heading 6</option>
        </optgroup>
      </select>`,'<a class="bold" title="Bold"></a>','<a class="italic" title="Italic"></a>','<a class="underline" title="Underline"></a>','<a class="strikethrough" title="Strike-Through"></a>','<a class="forecolor" title="Foreground Color"></a>','<a class="backcolor" title="Background Color"></a>','<a class="c_smileys" title="Insert Emoticon"></a>','<a class="insertimage" title="Insert Image"></a>','<a class="createlink" title="Insert Link"></a>','<a class="c_email" title="Insert Email"></a>','<a class="justifyleft" title="Align Left"></a>','<a class="justifycenter" title="Center"></a>','<a class="justifyright" title="Align Right"></a>','<a class="c_youtube" title="Insert video from any of your favorite video services!"></a>','<a class="c_code" title="Insert code"></a>','<a class="c_quote" title="Insert Quote"></a>','<a class="c_spoiler" title="Insert Spoiler"></a>','<a class="insertorderedlist" title="Create Ordered List"></a>','<a class="insertunorderedlist" title="Create Unordered List"></a>','<a class="c_switcheditmode" title="Switch editor mode"></a>'].join(""),$.addEventListener("click",(H)=>{if(H.target instanceof HTMLElement&&H.target.matches(".editbar a"))this.editbarCommand(H,H.target.className)});let L=$.querySelector("select.fontface");if(L){L.addEventListener("input",(H)=>{let M=L.value;if(M.startsWith("heading_"))this.editbarCommand(H,"heading",M.replace("heading_","h"));else if(M)this.editbarCommand(H,"fontname",M)});for(let H of Object.keys(C$)){let M=C$[H].map((h)=>`<option style="font-family: ${h}">${h}</option>`);L.innerHTML+=`<optgroup label="${H}">${M}</optgroup>`}}return $}editbarCommand($,L,H){$.preventDefault();let M=$.target;if(!(M instanceof HTMLElement))return;switch(L){case"forecolor":case"backcolor":this.showColors(M.offsetLeft,M.offsetTop+M.offsetHeight,L);break;case"c_smileys":this.showEmotes(M.offsetLeft,M.offsetTop+M.offsetHeight);break;case"c_switcheditmode":this.switchMode(!this.htmlMode);break;default:this.cmd(L,H);break}}async showEmotes($,L){let H=this.emoteWindow;if(!H){let M=await fetch("/api/emotes"),h=await M.json();if(M.ok)this.createEmoteWindow(h,{x:$,y:L});return}if(H.style.display==="none")H.style.display="",H.style.left=`${$}px`,H.style.top=`${L}px`;else this.hideEmotes()}hideEmotes(){if(this.emoteWindow)this.emoteWindow.style.display="none"}createEmoteWindow([$,L],H){let M=document.createElement("div");M.className="emotewin",M.addEventListener("click",(h)=>{if(!(h.target instanceof HTMLElement))return;let T=h.target.closest("button");if(!T)return;let E=T.querySelector("img");if(!E)return;this.cmd("inserthtml",this.htmlMode?E.outerHTML:E.dataset.emoji),this.hideEmotes()}),$.forEach((h,T)=>{let E=L[T],A=Object.assign(document.createElement("button"),{type:"button",innerHTML:`${E} ${h}`});M.append(A)}),Object.assign(M.style,{position:"absolute",display:"none",zIndex:Q()}),this.emoteWindow=M,this.container.append(M),this.showEmotes(H.x,H.y)}colorHandler($,L){this.cmd($,L),this.hideColors()}showColors($,L,H){this.hideColors();let h=S(`
      <div>
        ${["#FFFFFF","#AAAAAA","#000000","#FF0000","#00FF00","#0000FF","#FFFF00","#00FFFF","#FF00FF"].map((T)=>`<button style="background-color:${T}" data-color="${T}"></button>`).join("")}
      </div>
    `);return Object.assign(h.style,{display:"grid",gridTemplateColumns:"20px 20px 20px",gridTemplateRows:"20px 20px 20px",position:"absolute",top:`${L}px`,left:`${$}px`,cursor:"pointer",zIndex:Q()}),h.addEventListener("click",(T)=>{if(T.target instanceof HTMLButtonElement&&T.target.dataset.color)this.colorHandler(H,T.target.dataset.color)}),this.colorWindow=h,this.container.append(h),null}hideColors(){if(this.colorWindow)this.colorWindow.remove(),this.colorWindow=void 0}cmd($,L){let H=this.getSelection(),M="",h=[$,!1,L];switch($.toLowerCase()){case"bold":{M=`[b]${H}[/b]`;break}case"italic":{M=`[i]${H}[/i]`;break}case"underline":{M=`[u]${H}[/u]`;break}case"strikethrough":{M=`[s]${H}[/s]`;break}case"justifyright":{M=`[align=right]${H}[/align]`;break}case"justifycenter":{M=`[align=center]${H}[/align]`;break}case"justifyleft":{M=`[align=left]${H}[/align]`;break}case"insertimage":{let T=prompt("Image URL:")||"";if(!T)return;if(!EL(T)){alert("Please enter a valid URL.");return}let E=prompt("How would you describe this image?")||"";if(!E){alert("Please enter description for image.");return}let A=new Image;A.alt=E,A.src=T,M=`[img=${E}]${T}[/img]`,h[0]="insertHTML",h[2]=A.outerHTML;break}case"insertorderedlist":if(!this.htmlMode)M=`[ol]${H.replaceAll(/(.+([\r\n]+|$))/i,"* $1")}[/ol]`;break;case"insertunorderedlist":if(!this.htmlMode)M=`[ul]${H.replaceAll(/(.+([\r\n]+|$))/i,"* $1")}[/ul]`;break;case"createlink":{let T=prompt("Link:")||"";if(!T)return;if(!/^(https?|ftp|mailto):/.test(T))T=`https://${L}`;M=`[url=${T}]${H}[/url]`,h[2]=T;break}case"c_email":{let T=prompt("Email:")||"";if(!T)return;T=`mailto:${T}`,M=`[url=${T}]${H}[/url]`,h[0]="createlink",h[2]=T;break}case"backcolor":{if(C.firefox||C.safari)h[0]="hilitecolor";M=`[bgcolor=${L}]${H}[/bgcolor]`;break}case"forecolor":{M=`[color=${L}]${H}[/color]`;break}case"fontname":{M=`[font=${L}]${H}[/font]`;break}case"c_code":{M=`[code]${H}[/code]`,h[0]="inserthtml",h[2]=M;break}case"c_quote":{let T=prompt("Who said this?")||"";M=`[quote${T?`=${T}`:""}]${H}[/quote]`,h[0]="inserthtml",h[2]=M;break}case"c_spoiler":{M=`[spoiler]${H}[/spoiler]`,h[0]="inserthtml",h[2]=M;break}case"c_youtube":{let T=prompt("Video URL?")||"";if(!T)return;M=`[video]${T}[/video]`,h[0]="inserthtml",h[2]=M;break}case"inserthtml":{M=L||"";break}case"heading":{if(M=`[${L}]${H}[/${L}]`,C.chrome)h[0]="formatBlock",h[2]=`<${L}>`;break}default:throw Error(`Unsupported editor command ${$}`)}if(this.htmlMode)this.doc?.execCommand(...h),this.doc?.dispatchEvent(new Event("input")),this.window?.focus();else O$(this.element,M),this.element.dispatchEvent(new Event("input"))}getSelection(){if(this.htmlMode)return this.window?.getSelection()?.toString()||"";return this.element.value.substring(this.element.selectionStart,this.element.selectionEnd)}getSource(){return this.doc?.body.innerHTML}setSource($){if(this.doc)this.doc.body.innerHTML=$}switchMode($){let{element:L,iframe:H}=this;if($)L.style.display="none",H.style.display="";else L.style.display="",H.style.display="none";this.htmlMode=$}}class s extends q{resetOnSubmit;static hydrate($){G("Form",$.querySelectorAll("form[data-ajax-form]"),this)}constructor($){super($);this.resetOnSubmit=$.dataset.ajaxForm==="resetOnSubmit",$.addEventListener("click",(L)=>{let{target:H}=L;if(!(H instanceof HTMLInputElement||H instanceof HTMLButtonElement)||H.type!=="submit")return;$.submitButton=H}),$.addEventListener("submit",(L)=>{L.preventDefault(),this.submitForm()})}submitForm(){let{element:$,resetOnSubmit:L}=this,{submitButton:H}=$,M=new FormData($,H),h=Array.from(M.entries()).filter((T)=>typeof T[1]==="string");if(RUN.stream.load($.action||globalThis.location.toString(),{body:new URLSearchParams(h)}),L)$.reset();RUN.stream.pollData()}}function x$($){let L=d($);return String.fromCodePoint(55357,56656+((L.getHours()%12||12)-1)+(L.getMinutes()>29?12:0))}function z$($){let L=Array.from($.classList).find((H)=>H.startsWith("lastAction"));if(L===void 0)return;$.prepend(x$(Number.parseInt(L.slice(10),10))),$.classList.remove(L)}class a extends q{static hydrate($){$.querySelectorAll(".idle").forEach((L)=>z$(L))}}class m extends q{index;images;max;static hydrate($){G("ImageGallery",$.querySelectorAll(".image_gallery"),this)}constructor($){super($);let L=document.createElement("div"),H=document.createElement("button"),M=document.createElement("button");this.index=0,this.images=$.querySelectorAll("img"),this.max=Math.max(this.images.length,1),H.innerHTML="Next &raquo;",H.addEventListener("click",()=>{this.showNext()}),M.innerHTML="Prev &laquo;",M.addEventListener("click",()=>{this.showPrev()}),this.update(),L.appendChild(M),L.appendChild(document.createTextNode(" ")),L.appendChild(H),$.appendChild(L)}showNext(){if(this.index<this.max-1)this.index+=1;this.update()}showPrev(){if(this.index>0)this.index-=1;this.update()}update(){this.images.forEach(($,L)=>{let H=$.dataset.madeResized?$.parentNode:$;if(H)H.style.display=L===this.index?"block":"none"})}}var v$="999999px";class n extends q{static async hydrate($){let L=$.querySelectorAll(".bbcodeimg");await P(Array.from(L)),G("ImageResizer",L,this)}constructor($){super($);let L=1,H=1,{naturalWidth:M,naturalHeight:h}=$,T=R($),E=Number.parseInt(T.width,10)||Number.parseInt(T.maxWidth,10),A=Number.parseInt(T.height,10)||Number.parseInt(T.maxHeight,10);if(E&&M>E)L=E/h;if(A&&h>A)H=A/h;if(L=L&&H?Math.min(L,H):H||L,L<1)this.makeResizer(M*L,h*L)}makeResizer($,L){let{element:H}=this;H.style.maxWidth=v$,H.style.maxHeight=v$,H.dataset.madeResized="true";let M=Object.assign(document.createElement("a"),{target:"_blank",href:H.src});Object.assign(M.style,{display:"block",overflow:"hidden",width:`${$}px`,height:`${L}px`}),M.dataset.nw=`${H.naturalWidth}`,M.dataset.nh=`${H.naturalHeight}`,M.addEventListener("mousemove",(T)=>{let{x:E,y:A,w:F,h:j}=u(M);M.scrollLeft=(T.pageX-E)/F*(+(M.dataset.nw||0)-F)||0,M.scrollTop=(T.pageY-A)/j*(+(M.dataset.nh||0)-j)||0}),M.addEventListener("mouseover",()=>{H.style.width=`${M.dataset.nw}px`,H.style.height=`${M.dataset.nh}px`});let h=()=>{if(M.scrollLeft)M.scrollLeft=0,M.scrollTop=0;H.style.width=`${$}px`,H.style.height=`${L}px`};M.addEventListener("mouseout",h),h(),H.before(M),M.appendChild(H)}}function y($){let L=u($),H=$.getAttribute("title");if($.dataset.lastOnline){let h=Number.parseInt($.dataset.lastOnline??"",10);H=`Last Online: ${i(h)} ${x$(h)}`}if(!H)return;let M=document.querySelector("#tooltip");if(!M)M=S('<div id="tooltip" class="tooltip">Default text</div>'),document.querySelector("#page")?.appendChild(M);$.title="",$.addEventListener("mouseout",()=>{$.title=H,M.style.display="none"}),M.innerText=H,M.style.display="",Object.assign(M.style,{top:`${L.y-M.offsetHeight}px`,left:`${L.x}px`,zIndex:`${Q()}`})}class o extends q{static hydrate($){G("Link",$.querySelectorAll("a"),this)}constructor($){super($);if($.dataset.useTooltip)$.addEventListener("mouseover",()=>y($));if(!$.href)return;let L=$.getAttribute("href"),H=!$.target&&L&&(L.startsWith("/")||L.startsWith("?"));if(L?.startsWith("javascript"))return;if(H){let h=$.onclick;$.onclick=null,$.addEventListener("click",(T)=>{if(T.preventDefault(),!h||h.call($,T)!==!1)RUN.stream.location($.getAttribute("href")??"")});return}$.target="_blank"}}class p${title="Title";wait=!0;content="Content";open=!1;minimizable=!0;resize;className="";pos="center";zIndex;windowContainer;id;onclose;animate=!0;oldpos="";constructor($={}){this.zIndex=Q(),Object.assign(this,$)}render(){let $=S(`
      <div id="${this.id||""}" class="window ${this.className}">
        <div class="title">
          <span class="titletext">${this.title}</span>
          <div class="controls">
            ${this.minimizable?'<button data-action="minimize">-</button>':""}
            <button data-action="close" data-shortcut="Escape">X</button>
          </div>
        </div>
        <div class="content">${this.content}</div>
      </div>`);this.windowContainer=$,$.addEventListener("click",(h)=>{if(h.target instanceof HTMLElement){let T=h.target.dataset.action;if(T&&T in this)this[T]()}});let L=document.querySelector(".windows");if(!L)L=S('<div class="windows" style="z-index: 1"></div>'),document.body.appendChild(L);if(L.appendChild($),this.resize)this.renderResizeHandle(this.resize);let H=$.style;H.zIndex=`${this.zIndex+5}`;let{pos:M}=this;if(this.wait)P(Array.from($.querySelectorAll("img"))).then(()=>{this.setPosition(M)});else this.setPosition(M);return new N().autoZ().boundingBox(0,0,document.documentElement.clientWidth-50,document.documentElement.clientHeight-50).apply($,$.querySelector(".title")||void 0),$}renderResizeHandle($){let{windowContainer:L}=this;if(!L)return;let H=L.querySelector($);if(!H)throw Error("Resize target not found");H.style.width=`${H.clientWidth}px`,H.style.height=`${H.clientHeight}px`;let M=S('<div class="resize"></div>');L.appendChild(M),M.style.left=`${L.clientWidth-16}px`,M.style.top=`${L.clientHeight-16}px`,new N().boundingBox(100,100,1/0,1/0).addListener({ondrag(h){let T=Number.parseFloat(H.style.width)+(h.dx??0),E=Number.parseFloat(H.style.height)+(h.dy??0);if(H.style.width=`${T}px`,T<L.clientWidth-20)H.style.width=`${L.clientWidth}px`;else M.style.left=`${L.clientWidth-16}px`;H.style.height=`${E}px`},ondrop(){M.style.left=`${L.clientWidth-16}px`}}).apply(M),H.style.width=`${L.clientWidth}px`,M.style.left=`${L.clientWidth-16}px`}close(){if(!this.windowContainer)return;if(this.windowContainer.remove(),this.windowContainer=void 0,this.onclose)this.onclose()}minimize(){let{windowContainer:$}=this;if(!$)return;let L=!$.classList.toggle("minimized");if($.querySelector(".controls [data-action=minimize]").innerHTML=L?"-":"\uD83D\uDDD6",L)$.removeAttribute("draggable");else $.setAttribute("draggable","false"),this.oldpos=this.getPosition();this.setPosition(L?this.oldpos:"",!1)}setPosition($,L=!0){let H=this.windowContainer;if(!H)return;let M=0,h=0,T=document.documentElement.clientHeight,E=document.documentElement.clientWidth;if($==="center")h=Math.floor((T-H.clientHeight)/2),M=Math.floor((E-H.clientWidth)/2);else{let A=/(\d+) (\d+)/.exec($);if(A)M=Number(A[1]),h=Number(A[2])}if(H.style.left=`${M}px`,this.animate&&L)X(H,[{top:`${h-100}px`},{top:`${h}px`}],300,"ease-out");else H.style.top=`${h}px`;this.pos=$}getPosition(){if(!this.windowContainer)return"";let $=this.windowContainer.style;return`${Number.parseFloat($.left)} ${Number.parseFloat($.top)}`}}var Z=p$;class e extends q{static hydrate($){G("MediaPlayer",$.querySelectorAll(".media"),this)}constructor($){super($);let L=$.querySelector("a.popout"),H=$.querySelector("a.inline"),M=$.querySelector(".movie");if(!M)return;L?.addEventListener("click",(h)=>{h.preventDefault(),new Z({title:L.href,content:M.innerHTML}).render()}),H?.addEventListener("click",(h)=>{h.preventDefault(),M.style.display="block"})}}var w$=[[-1,0],[1,0],[0,1],[0,-1],[-1,1],[-1,-1],[1,-1],[1,1]];class $$ extends q{static hydrate($){G("Othello",$.querySelectorAll(".othello"),this)}constructor($){super($);$.addEventListener("click",(L)=>{if(!(L.target instanceof HTMLTableCellElement)||L.target.querySelector(".piece"))return;if(!this.placePiece(L.target))return;this.updateScore(),this.moveNumber++,_.play("chessdrop"),navigator.clipboard.writeText(`[othello]${this.getGameState()}[/othello]`),J.success("BBCode copied to clipboard")}),this.updateScore(),_.load("chessdrop")}placePiece($){let L=this.moveNumber%2?"black":"white",H=this.moveNumber%2?"white":"black",M=Array.from({length:8},()=>[]),h=Array.from({length:8},()=>!1),[T,E]=V($);if(T<0||E<0||T>=8||E>=8)return!1;for(let F=1;F<=8;F++){let j;for(let B=0;B<8;B++){if(h[B])continue;if(j=this.getPieceAt([T+F*w$[B][0],E+F*w$[B][1]]),!j){h[B]=!0,M[B]=[];continue}if(j.classList.contains(H)){M[B].push(j);continue}if(j.classList.contains(L))h[B]=!0}}let A=M.flat();if(!A.length)return J.error("Invalid move! You must capture opposing pieces.",3000),!1;return A.forEach((F)=>{F.classList.add(L),F.classList.remove(H)}),$.append(S(`<div class="piece ${L}"></div>`)),!0}get moveNumber(){return Number(this.element.dataset.moveNumber??"1")}set moveNumber($){this.element.dataset.moveNumber=`${$}`}getPieceAt([$,L]){if($<0||L<0||$>=8||L>=8)return;return this.element.rows[$].cells[L].querySelector(".piece")??void 0}updateScore(){let $=this.element.querySelector(".score-white"),L=this.element.querySelector(".score-black");if($&&L)$.innerHTML=this.element.querySelectorAll(".piece.white").length+"",L.innerHTML=this.element.querySelectorAll(".piece.black").length+""}getGameState(){let $=[];for(let L=0;L<8;L++){$.push("");for(let H=0;H<8;H++){let M=this.getPieceAt([L,H]);if(!M)$[L]+=" ";else if(M.classList.contains("white"))$[L]+="w";else if(M.classList.contains("black"))$[L]+="b"}}return[$.join("/").replaceAll(/ +/g,(L)=>`${L.length}`),this.moveNumber].join(" ")}}class L$ extends q{static hydrate($){G("PageList",$.querySelectorAll(".pages"),this)}constructor($){super($);$.addEventListener("wheel",(L)=>this.wheel(L))}wheel($){$.preventDefault();let L=Math.sign($.deltaY),H=Array.from(this.element.querySelectorAll("a")),M=Number.parseInt(H[1].innerHTML,10),h=Number.parseInt(H.at(-1)?.innerHTML||"",10),T=H.length-2;if(L>0&&M+T<h||L<0&&M>2)for(let E=0;E<T;E+=1)H[E+1].href=H[E+1].href.replace(/\d+$/,`${E+M+L}`),H[E+1].innerHTML=`${M+E+L}`}}class H$ extends q{static hydrate($){G("Spoiler",$.querySelectorAll(".spoilertext"),this)}constructor($){super($);$.addEventListener("click",function(){this.classList.toggle("spoiled")})}}class M$ extends q{static hydrate($){G("Switch",$.querySelectorAll("input.switch"),this)}constructor($){super($);$.style.display="none";let L=Object.assign(document.createElement("button"),{type:"button",title:$.className,className:$.className}),H=()=>{L.style.backgroundPosition=$.checked?"top":"bottom"};H(),L.addEventListener("click",()=>{$.checked=!$.checked,H(),$.dispatchEvent(new Event("change"))}),$.after(L)}}var u$="active";class h$ extends q{static hydrate($){G("Tabs",$.querySelectorAll(".tabs"),this)}constructor($){super($);$.addEventListener("click",(L)=>this.click(L))}click($){let{tabSelector:L}=this.element.dataset,{target:H}=$;if(!H||!(H instanceof HTMLElement)||H.tagName.toLowerCase()!=="a")return;let M=H;if(L){let T=H.closest(L);if(T)M=T}let h=this.element.querySelector(`.${u$}`);if(h)h.classList.remove(u$);M.className=u$,M.blur()}}var c$=[g,v,p,w,c,r,l,s,a,m,n,o,e,$$,L$,H$,M$,h$];function z($){b(),c$.forEach((L)=>{L.hydrate($)})}var O={loadscript($){document.body.appendChild(Object.assign(document.createElement("script"),{src:$}))},script($){(0,eval)($)},error($){J.error($)},success($){J.success($)},reload($=0){setTimeout(()=>globalThis.location.reload(),$)},refreshdata(){RUN.stream.pollData(!0)},addclass($,L){let H=document.querySelector($);if(H)H.classList.add(L)},title($){document.title=$},update($,L,H){let M=$,h=Array.from(document.querySelectorAll(".path"));if(M==="path"&&h.length>1){h.forEach((A)=>{A.innerHTML=L,z(A)});return}if(!/^\W/.test(M))M=`#${M}`;let T=document.querySelector(M);if(!T)return;T.innerHTML=L;let E=T.querySelector("[autofocus]");if(E)E.focus();if(H)G$(T);z(T)},removeel($){let L=document.querySelector($);if(L)L.remove()},back(){globalThis.history.back()},setstatus($){let L=document.querySelector("#status");if(L)L.className=$},appendrows($,L){let H=document.querySelector($);if(!H)return;let M=document.createElement("span");M.innerHTML=`<table>${L}</table>`;let h=M.getElementsByTagName("tbody")[0];z(h),H.appendChild(h)},location($){if(["?","/"].includes($.charAt(0))){RUN.stream.location($);return}document.location=$},enable($){let L=document.querySelector(`#${$}`);if(L)L.disabled=!1},addshout($){let L=Array.from(document.querySelectorAll("#shoutbox .shout")),H=document.createElement("span");H.innerHTML=$;let M=H.firstElementChild;if(!M)return;L[0].parentNode?.insertBefore(M,L[0]);while(L.length>globalSettings.shoutLimit-1)L.pop()?.remove();if(G$(M),globalSettings.soundShout)_.play("blip");z(M)},tick($){let L=document.querySelector("#ticker");if(!L)return;let H=document.createElement("div");H.innerHTML=$,H=H.firstElementChild,L.insertBefore(H,L.firstChild);let M=Array.from(L.querySelectorAll(".tick"));for(let h=100;h<M.length;h+=100)M[h].remove()},im($,L,H,M,h){d$({fromId:$,fromName:L,message:H,fromMe:M,timestamp:h})},imtoggleoffline($){document.querySelector(`#im_${$}`)?.classList.add("offline")},window($){let L=$.id?document.querySelector(`#${$.id} .content`):void 0;if(L){L.innerHTML=$.content+"";return}let H=new Z($);z(H.render())},closewindow($){let L=document.querySelector($+" [data-action=close]");if(L)L.click()},onlinelist($){let L=document.querySelector("#statusers");if(!L)return;$.forEach((H)=>{let M=document.querySelector(`#statusers .user${H.uid}`);if(!M)M=document.createElement("a"),M.addEventListener("click",function(){if(this.href)RUN.stream.location(this.href)}),M.addEventListener("mouseover",function(){y(this)});if(H.profileURL)M.href=H.profileURL;if(M.innerHTML=H.name,M.className=[`user${H.uid}`,`mgroup${H.groupID}`,H.status,`lastAction${H.lastAction}`].join(" "),H.locationVerbose)M.title=H.locationVerbose;if(H.status==="idle"){z$(M);return}if(L.firstChild)L.insertBefore(M,L.firstChild);else L.appendChild(M)})},snow($){Y($)},confetti($){Y($,!0)},setoffline($){let L=document.querySelector("#statusers");$.split(",").forEach((M)=>{let h=document.querySelector(`#statusers .user${M}`);if(h&&L)h.remove()})},async scrollToPost($){let L=document.getElementById(`pid_${$}`);if(!L)return!1;await P(Array.from(document.querySelectorAll("#page img")));let H=u(L);return globalThis.scrollTo({top:H.y}),!0},updateqreply($){let H=document.querySelector("#qreply")?.querySelector("textarea");if(H)H.focus(),H.value+=$,H.dispatchEvent(new Event("input"))},newmessage($,L){let H=document.querySelector("#notification"),M=document.querySelector("#num-messages");if(M)M.innerHTML=`${Number.parseInt(M.innerHTML,10)+1}`;if(!H)H=document.createElement("div"),H.id="notification",document.body.appendChild(H);H.style.display="",H.className="newmessage",H.addEventListener("click",()=>{H.style.display="none",RUN.stream.location(`/ucp/inbox?view=${L}`,3)}),H.innerHTML=$},playsound($){_.loadAndPlay($)},listrating($,L){let H=document.querySelector(`#postrating_${$}`),M;if(H){if(H.style.display!=="none"){X(H,[{height:"200px"},{height:"0px"}],300).then((h)=>h.style.display="none");return}H.style.display="block"}else{H=document.createElement("div"),H.className="postrating_list",H.id=`postrating_${$}`;let h=document.querySelector(`#pid_${$} .postrating`);if(!h)return;M=u(h),H.style.top=`${M.yh}px`,H.style.left=`${M.x}px`,document.querySelector("#page")?.appendChild(H)}H.innerHTML=L,X(H,[{height:"0px"},{height:"200px"}],300)}};function AL($,L){if(Y$(`New message from ${$}!`),!document.hasFocus()&&globalThis.Notification&&Notification.permission==="granted"){let H=new Notification(`${$} says:`,{body:L});H.onclick=()=>{globalThis.focus(),H.close()}}}function FL({fromId:$,fromName:L,message:H}){let M=document.querySelector(`#im_${$} .ims`);if(M)return M;let T=new Z({title:`${L}`,content:`
        <div class='ims'></div>
        <div class='offline'>This user may be offline</div>
        <div>
            <form data-ajax-form='resetOnSubmit' method='post'>
                <input type='hidden' name='im_uid' value='${$}'>
                <input type='text' name='im_im' autocomplete='off'>
            </form>
        </div>
    `,className:"im",resize:".ims",animate:!0,id:`im_${$}`}).render();z(T);let E=()=>{T.querySelector('form input[name="im_im"]')?.focus()};T.addEventListener("click",E),E(),M=T.querySelector(".ims");let A=getComputedStyle(M);if(M.style.width=A.width,M.style.height=A.height,H&&globalSettings.soundIM)_.play("receive");return M}function S$($,L){if(!globalSettings.canIM){alert("You do not have permission to use this feature.");return}O.im($,L,"",1,Date.now())}function d$({fromId:$,fromName:L,message:H,fromMe:M,timestamp:h}){AL(L,H);let T=FL({fromId:$,fromName:L,message:H});if(!H)return;let E=H.startsWith("/me");if(!M)document.querySelector(`#im_${$}`)?.classList.remove("offline");let A=S(`
    <div class="${E?"action":""} ${M?"you":"them"}" data-timestamp="${h}">
      <a href="/profile/${M||$}" class="name">${E?"***"+L:L}</a>
      ${E?H.substring(3):": "+H}
    </div>
  `);if(T.appendChild(A),z(A),T.scrollTop>T.scrollHeight-T.clientHeight-50)T.scrollTop=T.scrollHeight;if(globalSettings.soundIM)_.play("receive")}function jL($){let L=$?$.split(","):[],H=L.length===1?"":"s",M=L.length?" and <br>":"";return[L,H,M]}function qL($){let L=$?$.split(","):[],M=(L?L.length:0)===1?"":"s";return[L,M]}class T${whichone=0;boundCheckLocation;pids=[];tids=[];modb;constructor(){this.boundCheckLocation=()=>this.checkLocation(),Object.assign(O,{modcontrols_clearbox:this.destroyModControls.bind(this),modcontrols_move:this.showMoveControls.bind(this),modcontrols_postsync:this.postSync.bind(this)})}checkLocation(){let{whichone:$}=this,H=($?/topic\/(\d+)/:/forum\/(\d+)/).exec(document.location.toString());if(H)this.moveTo(Number(H[1]));else this.showMoveControls($)}moveTo($){let{whichone:L}=this;this.renderModControls(`<form method="post" action="/modcontrols" data-ajax-form="true">
                move ${L?"posts":"topics"} here?
            <input type="hidden"
                name="${L?"dop":"dot"}"
                value="moveto">
            <input type="hidden" name="id" value="${$}">
            <input type="submit" value="Yes">
            <input type="submit" name="cancel" value="Cancel">
            </form>`)}renderModControls($){if(this.modb=this.modb||document.querySelector("#modbox")||void 0,!this.modb)this.modb=document.createElement("div"),this.modb.id="modbox",document.body.appendChild(this.modb);this.modb.style.display="block",this.modb.innerHTML=$,z(this.modb)}destroyModControls(){if(globalThis.removeEventListener("pushstate",this.boundCheckLocation),this.modb)this.modb.innerHTML="",this.modb.style.display="none"}togbutton($){$.classList.toggle("selected")}postSync($,L){let[H,M,h]=jL($),[T,E]=qL(L);if(this.tids=T,this.pids=H,!T.length&&!H.length){this.destroyModControls();return}let A=T.length?`
            <select name="dot">
                <option value="delete">Delete</option>
                <option value="merge">Merge</option>
                <option value="move">Move</option>
                <option value="pin">Pin</option>
                <option value="unpin">Unpin</option>
                <option value="lock">Lock</option>
                <option value="unlock">Unlock</option>
            </select> &nbsp; &nbsp;
            <strong>${T.length}</strong> topic${E}${h}`:"",F=H.length?`
            <select name="dop">
                <option value="delete">Delete</option>
                <option value="move">Move</option>
            </select> &nbsp; &nbsp;
            <strong>${H.length}</strong> post${M}`:"",j=H.length&&T.length?"<br>":" &nbsp; &nbsp; ",B=`
        <form method="post" action="/modcontrols" data-ajax-form="true">
            ${A}
            ${F}
            ${j}
            <input type="submit" value="Go">
            <input name="cancel" type="submit" value="Cancel">
        </form>`;this.renderModControls(B)}showMoveControls($){this.whichone=$,globalThis.addEventListener("pushstate",this.boundCheckLocation),this.renderModControls(`Ok, now browse to the ${this.whichone?"topic":"forum"} you want to move the ${this.whichone?`${this.pids.length} posts`:`${this.tids.length} topics`} to...`)}}function GL(){new Z({title:"Keyboard Shortcuts",id:"shortcuts",content:`
      <style>
        #shortcuts { width: 300px; }
        #shortcuts dt { float: left;margin-left: 5px;}
      </style>
      <h3>Navigation</h3>
      <dl>
        <dt>?</dt><dd>This help window</dd>
        <dt>h</dt><dd>Home / Board Index</dd>
        <dt>i</dt><dd>Inbox</dd>
        <dt>s</dt><dd>Settings</dd>
        `+(globalSettings.isAdmin?"<dt>a</dt><dd>Admin CP</dd>":"")+(globalSettings.isMod?"<dt>m</dt><dd>Moderator CP</dd>":"")+`</dl>

      <h3>Inbox</h3>
      <dl>
        <dt>c</dt><dd>Compose</dd>
        <dt>i</dt><dd>Inbox</dd>
        <dt>f</dt><dd>Flagged Messages</dd>
        <dt>r</dt><dd>Reply to Message</dd>
      </dl>

      <h3>Forum/Topic</h3>
      <dl>
        <dt>t</dt><dd>New Topic</dd>
        <dt>r</dt><dd>Reply</dd>
      </dl>
      `}).render()}function i$($){if($.target instanceof HTMLInputElement||$.target instanceof HTMLTextAreaElement||$.target instanceof HTMLSelectElement)return;if($.key==="?"){GL();return}document.documentElement.querySelector(`[data-shortcut="${$.key}"]`)?.click()}var KL=5000;class E${commands;timeout;constructor(){this.commands=O}get currentURL(){return`${document.location.pathname}${document.location.search}`}handleRequestData($,L,H=1){let M=!1;if(L.forEach(([h,...T])=>{if(h==="preventNavigation")M=!0;else if(h in this.commands)this.commands[h].apply(null,T)}),H>=2){if(!M&&$!==this.currentURL)globalThis.history.pushState({lastURL:$},"",$),globalThis.dispatchEvent(new Event("pushstate"))}this.pollData()}location($,L=2){this.load($,{requestType:L})}async load($,{body:L,method:H="POST",requestType:M=1}={}){try{let h=await fetch($,{method:H,body:L,headers:{"X-JSACCESS":`${M}`,"Content-Type":"application/x-www-form-urlencoded"}});if(h.ok){let T=await h.json();this.handleRequestData($,T,M);return}J.error("An unrecoverable error has occurred.<br>Please try again later.")}catch(h){if(!navigator.onLine)J.error("You appear to be offline.");else J.error("Network fetch failed: timeout")}}pollData($=!1){if($)this.load(this.currentURL);if(clearTimeout(this.timeout),document.cookie.includes(`actw=${window.name}`))this.timeout=setTimeout(()=>this.load(this.currentURL),KL)}updatePage(){this.location(this.currentURL,3)}}var BL=2;class r${stream=new E$;onAppReady(){if(BL)z(document.documentElement);let $=new Date;if($.getMonth()===11&&[23,24,25].includes($.getDate()))Y();b(),setInterval(b,30000),this.stream.pollData(),globalThis.addEventListener("popstate",()=>{this.stream.updatePage()}),_.load("blip"),_.load("receive")}handleQuoting($){let L=new URLSearchParams($.search),H=L.get("quote");if(H){let M=document.querySelector(`#pid_${H} .post_content`),h=window.getSelection();if(M&&h&&M.contains(h.anchorNode)&&M.contains(h.focusNode))L.set("quotedText",h.toString())}L.set("qreply",document.querySelector("#qreply")?"1":"0"),this.stream.load(`${$.pathname}?${L.toString()}`)}setWindowActive(){document.cookie=`actw=${window.name}; SameSite:Lax`,q$(),this.stream.pollData()}}var A$=new r$;D(()=>{A$.onAppReady()});D(()=>{window.name=`${Math.random()}`,A$.setWindowActive(),globalThis.addEventListener("focus",()=>{A$.setWindowActive()})});D(function(){if(!y$())document.documentElement.classList.add("no-emoji");document.documentElement.classList.add("js-enabled")});D(()=>{globalThis.addEventListener("keyup",i$)});var t$=A$;Object.assign(globalThis,{RUN:t$,IMWindow:S$,ModControls:new T$});

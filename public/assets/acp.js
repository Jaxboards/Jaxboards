var M=new Map;class X{element;constructor(E){this.element=E}}function Y(E,q,j){if(!M.has(E))M.set(E,new WeakMap);q.forEach(function(K){if(M.get(E)?.has(K))return;M.get(E)?.set(K,new j(K))})}function p(E){let q=document.createElement("div");return q.innerHTML=E,q.firstElementChild}function d(E){return[E?.closest("tr")?.rowIndex??0,E?.cellIndex??0]}function z(E){return globalThis.getComputedStyle(E)}function V(E){let{x:q,y:j,height:G,width:K}=E.getBoundingClientRect(),Q=q+globalThis.scrollX,J=j+globalThis.scrollY;return{x:Q,y:J,yh:J+G,xw:Q+K,w:K,h:G}}function U(){return Array.from(document.querySelectorAll("*")).reduce((j,G)=>{if(G.style.zIndex&&Number(G.style.zIndex)>j)return Number(G.style.zIndex);return j},0)+1}var S="valid",A="invalid";class N extends X{method;outputElement;indicatorElement;static hydrate(E){Y("AutoComplete",E.querySelectorAll("input[data-autocomplete-action]"),this)}constructor(E){super(E);E.autocomplete="off",this.method=E.dataset.autocompleteAction;let q=E.dataset.autocompleteOutput,j=E.dataset.autocompleteIndicator,G=q?document.querySelector(q):void 0;if(!G)throw Error("Expected element to have data-autocomplete-output");this.outputElement=G||document.createElement("input"),this.indicatorElement=j?document.querySelector(j):void 0,E.addEventListener("keyup",(K)=>this.keyUp(K)),E.addEventListener("keydown",(K)=>{if(K.key==="Enter")K.preventDefault()})}getResultsContainer(){let E=V(this.element),q=document.querySelector("#autocomplete");if(!q)q=Object.assign(document.createElement("div"),{id:"autocomplete"}),Object.assign(q.style,{zIndex:U()}),document.body.appendChild(q);return Object.assign(q.style,{top:`${E.yh}px`,left:`${E.x}px`,width:`${E.w}px`}),q}keyUp(E){let q=this.getResultsContainer(),j=Array.from(q.querySelectorAll("div")),G=j.findIndex((K)=>K.classList.contains("selected"));switch(E.key){case"ArrowUp":case"ArrowDown":j.at(G)?.classList.remove("selected"),j.at((G+(E.key==="ArrowDown"?1:-1))%j.length)?.classList.add("selected");return;case"Enter":if(G>=0)j.at(G)?.dispatchEvent(new Event("click"));return;default:if(this.indicatorElement)this.indicatorElement.classList.remove(S),this.indicatorElement.classList.add(A);if(this.clearResults(),this.element.value)this.doSearch();break}}clearResults(){let E=this.getResultsContainer();E.style.display="none",E.innerHTML=""}async doSearch(){let E=this.getResultsContainer(),q=/ACP/.test(document.location.toString())?"../":"",G=`term=${encodeURIComponent(this.element.value)}`,K=await fetch(`${q}/api/${this.method}?${G}`);if(!K.ok)return;let Q=await K.json();if(E.innerHTML="",Q.length){E.style.display="";let[J,$]=Q;J.forEach((F,W)=>{let R=$[W],H=document.createElement("div");H.innerHTML=R,H.addEventListener("click",()=>{if(E.style.display="none",this.indicatorElement)this.indicatorElement.classList.add(S),this.indicatorElement.classList.remove(A);this.outputElement.value=`${F}`,this.outputElement.dispatchEvent(new Event("change")),this.element.value=R}),E.appendChild(H)});return}E.style.display="none"}}class Z extends HTMLElement{static formAssociated=!0;shadow;internals;results;search;leaveHandler;optionKeyboardHandler;hiddenFormField;value;static hydrate(){customElements.define("better-select",Z),customElements.define("better-option",class extends HTMLElement{})}constructor(){super();this.value=this.getAttribute("value")??"",this.shadow=this.attachShadow({mode:"open"}),this.internals=this.attachInternals(),this.search=document.createElement("input"),this.results=document.createElement("div"),this.hiddenFormField=Object.assign(document.createElement("input"),{type:"hidden",name:this.getAttribute("name")}),this.leaveHandler=(E)=>{this.results.classList.toggle("open",E.relatedTarget instanceof HTMLElement&&this.results.contains(E.relatedTarget))},this.optionKeyboardHandler=function(q){switch(q.key){case"ArrowUp":this.previousElementSibling?.focus();break;case"ArrowDown":this.nextElementSibling.focus();break;default:break}}}connectedCallback(){let{shadow:E,results:q,search:j}=this;q.className="results",j.autocomplete="off",j.addEventListener("focus",()=>q.classList.toggle("open",!0)),j.addEventListener("input",()=>{this.renderOptions(j.value)}),j.addEventListener("keydown",(K)=>{switch(K.key){case"ArrowUp":this.shadow.querySelector(".results button:last-child")?.focus();break;case"ArrowDown":this.shadow.querySelector(".results button:first-child")?.focus();break;default:break}}),j.addEventListener("blur",this.leaveHandler),E.appendChild(j),E.appendChild(this.hiddenFormField),E.appendChild(q),this.renderOptions(),E.adoptedStyleSheets=[this.stylesheet()],j.setAttribute("role","combobox"),j.setAttribute("aria-activedescendant",""),q.setAttribute("role","listbox");let G=`id-${Math.random()}`;q.setAttribute("id",G),j.setAttribute("aria-controls",G)}close(){this.results.classList.remove("open")}clear(){[...Array.from(this.querySelectorAll("better-option[selected]")),...Array.from(this.results.querySelectorAll(".selected"))].forEach((E)=>{E.removeAttribute("selected"),E.classList.remove("selected")})}renderOptions(E=""){this.results.innerHTML="",this.getOptions(E).forEach((q)=>this.results.appendChild(q))}getOptions(E=""){return Array.from(this.querySelectorAll("better-option")).filter((q)=>q.innerText.toLowerCase().includes(E.toLowerCase())).map((q)=>{let j=document.createElement("button");j.addEventListener("click",()=>{if(!this.hasAttribute("multiple"))this.clear(),this.close();j.classList.toggle("selected"),q.toggleAttribute("selected",j.classList.contains("selected")),this.updateValue()}),j.addEventListener("keydown",this.optionKeyboardHandler),j.classList.toggle("selected",q.hasAttribute("selected"));let G=q.getAttribute("image");if(G){let Q=new Image;Q.src=G,j.appendChild(Q)}let K=document.createTextNode(` ${q.innerText}`);return j.appendChild(K),j.addEventListener("blur",this.leaveHandler),j}).filter(Boolean)}updateValue(){let E=Array.from(this.querySelectorAll("better-option[selected]"));this.value=E.map((q)=>q.getAttribute("value")).join(","),this.search.value=E.at(-1)?.innerText??"",this.internals.setFormValue(this.value),this.dispatchEvent(new Event("change"))}stylesheet(){let E=new CSSStyleSheet;return E.replaceSync(`
            button { display: block; width: 100%; text-align: left; }
            button.selected { background: #1f1f83; color: #FFF; }
            button:hover { background: #9cdcfe; }
            button img { vertical-align: middle; }
            .results { position: absolute; display: none; max-height: 400px; overflow: auto; }
            .results.open { display: block; }
        `),E}}class k extends X{static hydrate(E){Y("Switch",E.querySelectorAll("input.switch"),this)}constructor(E){super(E);E.style.display="none";let q=Object.assign(document.createElement("button"),{type:"button",title:E.className,className:E.className}),j=()=>{q.style.backgroundPosition=E.checked?"top":"bottom"};j(),q.addEventListener("click",()=>{E.checked=!E.checked,j(),E.dispatchEvent(new Event("change"))}),E.after(q)}}function t(E){if(!globalThis.getSelection)return;let q=document.createRange();q.selectNode(E);let j=globalThis.getSelection();if(!j)return;if(j.rangeCount)j.removeAllRanges();j.addRange(q)}function L(E,q){let j=E.scrollTop,G=E.selectionStart??0,K=E.selectionEnd??0;E.value=E.value.substring(0,G)+q+E.value.slice(K),E.selectionStart=G+q.length,E.selectionEnd=G+q.length,E.focus(),E.scrollTop=j}var{userAgent:P}=navigator;function _(){return"ontouchstart"in window}var e={chrome:/chrome/i.test(P),ie:/msie/i.test(P),iphone:/iphone/i.test(P),mobile:/mobile/i.test(P),n3ds:/nintendo 3ds/.test(P),firefox:/firefox/i.test(P),safari:/safari/i.test(P)};class D{sess;boundEvents;droppables;noChild=!1;bounds;onstart;ondragover;ondrag;ondragout;ondrop;autoZIndex=!0;constructor(){this.droppables=[],this.sess={el:document.body,mx:0,my:0,reset:()=>{return}},this.boundEvents={drag:(E)=>this.drag(E),drop:()=>this.drop()}}start(E,q,j){let G=q||E.target;if(this.noChild&&E.target!==(j||G))return;E.preventDefault(),E.stopPropagation();let K=z(G),Q=U();if(G.getAttribute("draggable")==="false")return;if(this.sess={el:G,mx:E instanceof MouseEvent?E.pageX:E.targetTouches[0].pageX,my:E instanceof MouseEvent?E.pageY:E.targetTouches[0].pageY,ex:Number.parseInt(K.left,10)||0,ey:Number.parseInt(K.top,10)||0,info:{el:G,mx:0,my:0,reset:()=>{return}},reset:()=>this.reset(),zIndex:G.style.zIndex},!this.sess.zIndex||Number(this.sess.zIndex)<Q-1)G.style.zIndex=`${Q}`;this.onstart?.({...this.sess,droptarget:this.testDrops(this.sess.mx,this.sess.my)}),document.addEventListener(_()?"touchmove":"mousemove",this.boundEvents.drag),document.addEventListener(_()?"touchend":"mouseup",this.boundEvents.drop),this.drag(E)}drag(E){E.stopPropagation();let q=this.sess.el.style,j=E instanceof MouseEvent?E.pageX:E.targetTouches[0].pageX,G=E instanceof MouseEvent?E.pageY:E.targetTouches[0].pageY,K=j,Q=G,J,$=(this.sess.ex??0)+K-this.sess.mx,F=(this.sess.ey??0)+Q-this.sess.my,W=this.bounds;if(W){if($<W[0])K=K-$+W[0],[$]=W;else if($>W[0]+W[2])$=W[0]+W[2];if(F<W[1])Q=Q-F+W[1],[F]=W;else if(F>W[1]+W[3])F=W[1]+W[3]}q.left=`${$}px`,q.top=`${F}px`;let R=this.sess.info,H=R?.droptarget,B={...this.sess,left:$,top:F,mx:K,my:Q,dx:K-(R?.mx||K),dy:Q-(R?.my||Q),droptarget:this.testDrops(j,G)};if(this.sess.info=B,this.ondrag?.(B),B.droptarget&&H!==B.droptarget)this.ondragover?.(B);if(H&&B.droptarget!==H)J=B.droptarget,B.droptarget=H,this.ondragout?.(B),B.droptarget=J}boundingBox(E,q,j,G){return this.bounds=[E,q,j,G],this}drop(){if(this.boundEvents)document.removeEventListener(_()?"touchend":"mouseup",this.boundEvents.drop),document.removeEventListener(_()?"touchmove":"mousemove",this.boundEvents.drag);if(this.ondrop?.(this.sess.info??{}),this.autoZIndex)this.sess.el.style.zIndex=this.sess.zIndex??"";return!0}testDrops(E,q){let{droppables:j}=this,G,K=[9999,9999];if(!j.length)return;return j.findLast((Q)=>{if(Q===this.sess.el||this.sess.el.contains(Q))return;if(G=V(Q),K[0]>G.w&&K[1]>G.h&&E>=G.x&&q>=G.y&&E<=G.xw&&q<=G.yh)return K=[G.w,G.h],Q;return})}drops(E){return this.droppables=E,this}addDrops(E){if(!this.droppables)return this.drops(E);return this.droppables=this.droppables.concat(E),this}addListener(E){return Object.assign(this,E),this}apply(E,q){if(Array.isArray(E))return E.forEach((K)=>this.apply(K)),this;let G=z(E)?.position;if(!G||G==="static")E.style.position="relative";return(q||E).addEventListener(_()?"touchstart":"mousedown",q?(K)=>this.start(K,E,q):(K)=>this.start(K,E)),this}autoZ(){return this.autoZIndex=!1,this}noChildActivation(){return this.noChild=!0,this}reset(E=this.sess.el){return E.style.top="0",E.style.left="0",this}}var I=D;function T(E,q){let j=Array.from(E.querySelectorAll("li")),G={},K=0;return j.forEach((Q)=>{if(Q.className!=="seperator"&&Q.parentNode===E){K=1;let[J]=Q.getElementsByTagName("ul");G[`_${Q.id.slice(q.length)}`]=J?T(J,q):1}}),K?G:1}function y(E){if(!E.droptarget)return;let q=E.el.classList.contains("parentlock"),j=E.el.classList.contains("nofirstlevel");if(q&&E.droptarget.parentNode!==E.el.parentNode){E.reset();return}if(j&&E.droptarget.parentNode?.className==="tree"){E.reset();return}if(E.el.contains(E.droptarget)||E.el===E.droptarget.nextSibling){E.reset();return}let G=E.droptarget.nextElementSibling;if(G?.className==="spacer")G.remove();if(G?.className==="spacer")E.el.previousSibling?.remove();else if(E.el.previousElementSibling)E.droptarget.after(E.el.previousElementSibling);E.droptarget.after(E.el)}function O(E,q,j){let G=Array.from(E.querySelectorAll("li")),K=[],Q=[];K.push(...G.filter(($)=>$.className!=="title")),K.forEach(($)=>{let F=document.createElement("li");F.className="seperator",Q.push(F),$.before(F)});let J=new I().noChildActivation();J.drops([...K,...Q]).addListener({ondragover($){if($.droptarget)$.droptarget.style.border="1px solid #000"},ondragout($){if($.droptarget)$.droptarget.style.border="none"},ondrop($){let F,W=$.el.classList.contains("parentlock");if(J.reset($.el),!$.droptarget)return;if($.droptarget.style.border="none",$.droptarget.className==="seperator")y($);else if(!W&&$.droptarget.tagName==="LI"){if([F]=$.droptarget.getElementsByTagName("ul"),!F)F=document.createElement("ul"),$.droptarget.appendChild(F);F.appendChild($.el.previousSibling),F.appendChild($.el),$.droptarget.appendChild(F)}if(j)j.value=JSON.stringify(T(E,q))}}),J.apply(K)}function b(E){let q=E.getHours()||12,j=`${E.getMinutes()}`.padStart(2,"0");return`${q%12||12}:${j}${q>12?"pm":"am"}`}function C(E){return new Date(E*1000)}var JE=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],FE=["January","February","March","April","May","June","July","August","September","October","November","December"];function h(E){return E[0].toUpperCase()+E.slice(1)}function x(E){let q=new Date,j=new Intl.RelativeTimeFormat(void 0,{numeric:"auto",style:"long"}),G=new Date;G.setTime(+G-86400000),G.setHours(0),G.setMinutes(0),G.setSeconds(0);let K=C(E),Q=Math.round((+K-+q)/1000);if(Q>-60)return j.format(Q,"second");if(Q>-3600)return j.format(Math.round(Q/60),"minute");if(K>G){let J=new Date;return J.setHours(0),J.setMinutes(0),J.setSeconds(0),`${h(j.format(K>J?0:-1,"day"))} @ ${b(K)}`}return Intl.DateTimeFormat(void 0,{month:"short",year:"numeric",day:"numeric",hour:"numeric",hour12:!0,minute:"numeric"}).format(K)}function w(E){let q=C(E),j=q.getHours(),G=j>=12?"pm":"am";j%=12,j=j||12;let K=`${q.getMinutes()}`.padStart(2,"0"),Q=q.getMonth()+1,J=`${q.getDate()}`.padStart(2,"0"),$=q.getFullYear();return`${j}:${K}${G}, ${Q}/${J}/${$}`}function HE(E,q=1000){return new Promise((j)=>{let G=new Set,K=Array.from(E).filter((J)=>!J.complete);if(!K.length){j();return}function Q(){if(G.delete(this.src),G.size===0)j()}if(K.forEach((J)=>{if(!G.has(J.src))G.add(J.src),J.addEventListener("error",Q),J.addEventListener("load",Q)}),q)setTimeout(j,q)})}function PE(){let E=document.querySelectorAll(".autodate"),q=Array.from(document.querySelectorAll("[data-timestamp]"));if(!E)return;E.forEach((j)=>{let G=Number.parseInt(j.getAttribute("title")??"",10),K=j.classList.contains("smalldate")?w(G):x(G);if(K!==j.innerHTML)j.innerHTML=K}),q.forEach((j)=>{if(!j.title)j.title=w(Number.parseInt(j.dataset.timestamp??"",10))})}function f(E){if(document.readyState==="complete")E();else document.addEventListener("DOMContentLoaded",E)}function RE(){let E=document.createElement("input");return E.setAttribute("type","date"),E.type==="date"}function VE(){let E=[String.fromCodePoint(9757,127999),String.fromCodePoint(9757)].map((q)=>{let j=document.body.appendChild(document.createElement("span"));j.appendChild(document.createTextNode(q));let G=j.offsetWidth;return j.remove(),G});return E[0]===E[1]}function g(E){let q=E.target;if(!(q instanceof HTMLAnchorElement))return;let j=document.querySelector(`#menu_${q.classList[0]}`);if(!j)return;q.classList.add("active");let G=V(q);Object.assign(j.style,{display:"block",top:`${G.y+q.clientHeight}px`,left:`${G.x}px`}),q.addEventListener("mouseout",(K)=>{if(K.relatedTarget instanceof HTMLElement&&K.relatedTarget!==j&&K.relatedTarget.offsetParent!==j)q.classList.remove("active"),j.style.display="none"}),j.addEventListener("mouseout",(K)=>{if(K.relatedTarget instanceof HTMLElement&&K.relatedTarget!==q&&K.relatedTarget.offsetParent!==j&&K.relatedTarget!==j)q.classList.remove("active"),j.style.display="none"})}async function c(E){let q=new FormData(E,E.submitButton),j=Array.from(q.entries()).filter((G)=>typeof G[1]==="string");await fetch(document.location.search,{method:"POST",body:new URLSearchParams(j),headers:{"X-JSACCESS":"1","Content-Type":"application/x-www-form-urlencoded"}}),alert("Saved. Ajax-submitted so you don't lose your place")}function u(){document.querySelector("#nav")?.addEventListener("mouseover",g),Array.from(document.querySelectorAll("form")).forEach((G)=>{if(!G.dataset.useAjaxSubmit)return;G.addEventListener("submit",(K)=>{K.preventDefault(),c(G)})}),N.hydrate(document.body),k.hydrate(document.body),Z.hydrate();let E=document.querySelector(".editor");if(E)E.addEventListener("keydown",(G)=>{if(G.key==="Tab")L(E,"    "),G.preventDefault()});let q=document.querySelector(".tree"),j=document.querySelector("#ordered");if(q&&j)O(q,"forum_",j)}f(u);

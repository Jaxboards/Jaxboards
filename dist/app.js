var I=new Map;class b{element;constructor(h){this.element=h}}function q(h,$,L){if(!I.has(h))I.set(h,new WeakMap);$.forEach(function(u){if(I.get(h)?.has(u))return;I.get(h)?.set(u,new L(u))})}function vh(h){let $=h.getHours()||12,L=`${h.getMinutes()}`.padStart(2,"0");return`${$%12||12}:${L}${$>12?"pm":"am"}`}function J(h){return new Date(h*1000)}var Nh=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],Gh=["January","February","March","April","May","June","July","August","September","October","November","December"];function wh(h){return h[0].toUpperCase()+h.slice(1)}function g(h){let $=new Date,L=new Intl.RelativeTimeFormat(void 0,{numeric:"auto",style:"long"}),H=new Date;H.setTime(+H-86400000),H.setHours(0),H.setMinutes(0),H.setSeconds(0);let u=J(h),M=Math.round((+u-+$)/1000);if(M>-60)return L.format(M,"second");if(M>-3600)return L.format(Math.round(M/60),"minute");if(u>H){let E=new Date;return E.setHours(0),E.setMinutes(0),E.setSeconds(0),`${wh(L.format(u>E?0:-1,"day"))} @ ${vh(u)}`}return Intl.DateTimeFormat(void 0,{month:"short",year:"numeric",day:"numeric",hour:"numeric",hour12:!0,minute:"numeric"}).format(u)}function fh(h){let $=J(h),L=$.getHours(),H=L>=12?"pm":"am";L%=12,L=L||12;let u=`${$.getMinutes()}`.padStart(2,"0"),M=$.getMonth()+1,E=`${$.getDate()}`.padStart(2,"0"),T=$.getFullYear();return`${L}:${u}${H}, ${M}/${E}/${T}`}function bh(h){let $=J(h);return String.fromCodePoint(55357,56656+(($.getHours()%12||12)-1)+($.getMinutes()>29?12:0))}function qh(h){let $=Array.from(h.classList).find((L)=>L.startsWith("lastAction"));if($===void 0)return;h.prepend(bh(Number.parseInt($.slice(10),10))),h.classList.remove($)}class X extends b{static hydrate(h){h.querySelectorAll(".idle").forEach(($)=>qh($))}}var Qh=["#F00","#FF7F00","#FF0","#0F0","#00F","#4B0082","#9400D3"];function dh(h=200){let $=document.querySelector("#snow");if($===null)$=document.createElement("div"),$.id="snow",Object.assign($.style,{position:"fixed",top:0,left:0,zIndex:1}),document.body.prepend($);$.innerHTML="";for(let L=1;L<=h;L+=1){let H=document.createElement("div");H.className="snowflake",$.appendChild(H)}}function sh(){let h=document.getElementById("snow-css");if(h)return h;return h=document.createElement("style"),h.id="snow-css",document.head.appendChild(h),h}function lh(h){let $=sh();$.innerHTML=h,document.head.appendChild($)}function oh(h=100){return Math.floor(Math.random()*h)+1}function ah(h,$){let L=Math.ceil(h),H=Math.floor($);return Math.floor(Math.random()*(H-L+1))+L}function mh(h,$){return Math.random()*($-h)+h}function nh(h=200,$=!1){let H=100*document.body.offsetHeight/window.innerHeight,u=`
    .snowflake {
        position: absolute;
        width: 10px;
        height: 10px;
        /* Workaround for Chromium's selective color inversion */
        border-radius: 50%;
    }
  `;for(let M=1;M<=h;M+=1){let E=Math.random()*100,T=Math.random()*10,f=E+T,F=E+T/2,A=mh(0.3,0.8),j=A*H,x=Math.random(),Eh=ah(10,H/10*3),O=oh(H/10*3)*-1,Ch=Math.random(),Th=$?Qh[Math.floor(Math.random()*Qh.length)]:"white";u+=`
      .snowflake:nth-child(${M}) {
        opacity: ${Ch};
        background: linear-gradient(${Th}, ${Th});
        filter: drop-shadow(0 0 10px ${Th});
        transform: translate(${E}vw, -10px) scale(${x});
        animation: fall-${M} ${Eh}s ${O}s linear infinite;
      }
      @keyframes fall-${M} {
        ${A*100}% {
          transform: translate(${f}vw, ${j}vh) scale(${x});
        }
        to {
          transform: translate(${F}vw, ${H}vh) scale(${x});
        }
      }
    `}lh(u)}function V(h=200,$=!1){nh(h,$),dh(h)}async function Q(h,$,L=600,H="linear"){return new Promise((u)=>{h.animate($,{duration:L,easing:H}).addEventListener("finish",()=>{Object.assign(h.style,$.at(-1)),u(h)},{once:!0})})}function Fh(h){return Q(h,[{backgroundColor:"#FF0"},{backgroundColor:""}],1000)}function G(h){let $=document.createElement("div");return $.innerHTML=h,$.firstElementChild}function Y(h){return[h?.closest("tr")?.rowIndex??0,h?.cellIndex??0]}function W(h){return globalThis.getComputedStyle(h)}function K(h){let{x:$,y:L,height:H,width:u}=h.getBoundingClientRect(),M=$+globalThis.scrollX,E=L+globalThis.scrollY;return{x:M,y:E,yh:E+H,xw:M+u,w:u,h:H}}function B(){return Array.from(document.querySelectorAll("*")).reduce((L,H)=>{if(H.style.zIndex&&Number(H.style.zIndex)>L)return Number(H.style.zIndex);return L},0)+1}var _h="valid",Wh="invalid";class i extends b{method;outputElement;indicatorElement;static hydrate(h){q("AutoComplete",h.querySelectorAll("input[data-autocomplete-action]"),this)}constructor(h){super(h);h.autocomplete="off",this.method=h.dataset.autocompleteAction;let $=h.dataset.autocompleteOutput,L=h.dataset.autocompleteIndicator,H=$?document.querySelector($):void 0;if(!H)throw Error("Expected element to have data-autocomplete-output");this.outputElement=H||document.createElement("input"),this.indicatorElement=L?document.querySelector(L):void 0,h.addEventListener("keyup",(u)=>this.keyUp(u)),h.addEventListener("keydown",(u)=>{if(u.key==="Enter")u.preventDefault()})}getResultsContainer(){let h=K(this.element),$=document.querySelector("#autocomplete");if(!$)$=Object.assign(document.createElement("div"),{id:"autocomplete"}),Object.assign($.style,{zIndex:B()}),document.body.appendChild($);return Object.assign($.style,{top:`${h.yh}px`,left:`${h.x}px`,width:`${h.w}px`}),$}keyUp(h){let $=this.getResultsContainer(),L=Array.from($.querySelectorAll("div")),H=L.findIndex((u)=>u.classList.contains("selected"));switch(h.key){case"ArrowUp":case"ArrowDown":L.at(H)?.classList.remove("selected"),L.at((H+(h.key==="ArrowDown"?1:-1))%L.length)?.classList.add("selected");return;case"Enter":if(H>=0)L.at(H)?.dispatchEvent(new Event("click"));return;default:if(this.indicatorElement)this.indicatorElement.classList.remove(_h),this.indicatorElement.classList.add(Wh);if(this.clearResults(),this.element.value)this.doSearch();break}}clearResults(){let h=this.getResultsContainer();h.style.display="none",h.innerHTML=""}async doSearch(){let h=this.getResultsContainer(),$=/ACP/.test(document.location.toString())?"../":"",H=`term=${encodeURIComponent(this.element.value)}`,u=await fetch(`${$}/api/${this.method}?${H}`);if(!u.ok)return;let M=await u.json();if(h.innerHTML="",M.length){h.style.display="";let[E,T]=M;E.forEach((f,F)=>{let A=T[F],j=document.createElement("div");j.innerHTML=A,j.addEventListener("click",()=>{if(h.style.display="none",this.indicatorElement)this.indicatorElement.classList.add(_h),this.indicatorElement.classList.remove(Wh);this.outputElement.value=`${f}`,this.outputElement.dispatchEvent(new Event("change")),this.element.value=A}),h.appendChild(j)});return}h.style.display="none"}}var{userAgent:c}=navigator;function Z(){return"ontouchstart"in window}var t={chrome:/chrome/i.test(c),ie:/msie/i.test(c),iphone:/iphone/i.test(c),mobile:/mobile/i.test(c),n3ds:/nintendo 3ds/.test(c),firefox:/firefox/i.test(c),safari:/safari/i.test(c)};class ch{sess;boundEvents;droppables;noChild=!1;bounds;onstart;ondragover;ondrag;ondragout;ondrop;autoZIndex=!0;constructor(){this.droppables=[],this.sess={el:document.body,mx:0,my:0,reset:()=>{return}},this.boundEvents={drag:(h)=>this.drag(h),drop:()=>this.drop()}}start(h,$,L){h.preventDefault(),h.stopPropagation();let H=$||h.target,u=W(H),M=B();if(this.noChild&&h.target!==(L||H))return;if(H.getAttribute("draggable")==="false")return;if(this.sess={el:H,mx:h instanceof MouseEvent?h.pageX:h.targetTouches[0].pageX,my:h instanceof MouseEvent?h.pageY:h.targetTouches[0].pageY,ex:Number.parseInt(u.left,10)||0,ey:Number.parseInt(u.top,10)||0,info:{el:H,mx:0,my:0,reset:()=>{return}},reset:()=>this.reset(),zIndex:H.style.zIndex},!this.sess.zIndex||Number(this.sess.zIndex)<M-1)H.style.zIndex=`${M}`;this.onstart?.({...this.sess,droptarget:this.testDrops(this.sess.mx,this.sess.my)}),document.addEventListener(Z()?"touchmove":"mousemove",this.boundEvents.drag),document.addEventListener(Z()?"touchend":"mouseup",this.boundEvents.drop),this.drag(h)}drag(h){h.stopPropagation();let $=this.sess.el.style,L=h instanceof MouseEvent?h.pageX:h.targetTouches[0].pageX,H=h instanceof MouseEvent?h.pageY:h.targetTouches[0].pageY,u=L,M=H,E,T=(this.sess.ex??0)+u-this.sess.mx,f=(this.sess.ey??0)+M-this.sess.my,F=this.bounds;if(F){if(T<F[0])u=u-T+F[0],[T]=F;else if(T>F[0]+F[2])T=F[0]+F[2];if(f<F[1])M=M-f+F[1],[f]=F;else if(f>F[1]+F[3])f=F[1]+F[3]}$.left=`${T}px`,$.top=`${f}px`;let A=this.sess.info,j=A?.droptarget,x={...this.sess,left:T,top:f,mx:u,my:M,dx:u-(A?.mx||u),dy:M-(A?.my||M),droptarget:this.testDrops(L,H)};if(this.sess.info=x,this.ondrag?.(x),x.droptarget&&j!==x.droptarget)this.ondragover?.(x);if(j&&x.droptarget!==j)E=x.droptarget,x.droptarget=j,this.ondragout?.(x),x.droptarget=E}boundingBox(h,$,L,H){return this.bounds=[h,$,L,H],this}drop(){if(this.boundEvents)document.removeEventListener(Z()?"touchend":"mouseup",this.boundEvents.drop),document.removeEventListener(Z()?"touchmove":"mousemove",this.boundEvents.drag);if(this.ondrop?.(this.sess.info??{}),this.autoZIndex)this.sess.el.style.zIndex=this.sess.zIndex??"";return!0}testDrops(h,$){let{droppables:L}=this,H,u=[9999,9999];if(!L.length)return;return L.findLast((M)=>{if(M===this.sess.el||this.sess.el.contains(M))return;if(H=K(M),u[0]>H.w&&u[1]>H.h&&h>=H.x&&$>=H.y&&h<=H.xw&&$<=H.yh)return u=[H.w,H.h],M;return})}drops(h){return this.droppables=h,this}addDrops(h){if(!this.droppables)return this.drops(h);return this.droppables=this.droppables.concat(h),this}addListener(h){return Object.assign(this,h),this}apply(h,$){if(Array.isArray(h))return h.forEach((u)=>this.apply(u)),this;let H=W(h)?.position;if(!H||H==="static")h.style.position="relative";return($||h).addEventListener(Z()?"touchstart":"mousedown",$?(u)=>this.start(u,h,$):(u)=>this.start(u,h)),this}autoZ(){return this.autoZIndex=!1,this}noChildActivation(){return this.noChild=!0,this}reset(h=this.sess.el){return h.style.top="0",h.style.left="0",this}}var z=ch;var xh="50px";class zh{success(h,$=3000){this.showToast(h,"success",$)}error(h,$=0){this.showToast(h,"error",$)}async showToast(h,$,L=0){let H=document.createElement("div"),u=async()=>{await Q(H,[{top:xh},{top:`-${xh}`}]),H.remove()};H.classList.add($),Object.assign(H.style,{position:"fixed",left:"50%",transform:"translateX(-50%)",boxShadow:"black 5px 5px 10px",zIndex:B()}),H.addEventListener("click",u,{once:!0}),H.innerHTML=h;let M=document.createElement("a");if(M.href="javascript:void(0)",M.innerHTML=" [X]",M.title="close notification",M.addEventListener("click",u,{once:!0}),H.append(M),document.body.appendChild(H),await Q(H,[{top:"0"},{top:xh}],600,"ease-in-out"),L)await new Promise((E)=>setTimeout(E,L)),u()}}var N=new zh;class Rh{soundCache={};getFilePath(h){return`/Sounds/${h}.mp3`}load(h,$=!1){let L=this.soundCache[h];if(L){if($)this.play(h);return}L=new Audio,this.soundCache[h]=L,L.autoplay=!!$,L.src=this.getFilePath(h)}loadAndPlay(h){this.load(h,!0)}play(h){this.soundCache[h].play()}}var P=new Rh;class k extends b{static hydrate(h){q("Checkers",h.querySelectorAll(".checkers"),this)}constructor(h){super(h);P.load("chessdrop");let $=new z;$.addListener({ondrop:(L)=>{if(L.reset(),!L.droptarget)return;let{droptarget:H,el:u}=L,M=Y(u.closest("td")),E=Y(H);if(!this.isValidMove(M,E))return;if([1,8].includes(E[0]))this.promote(u);this.getCapturedPiece(M,E)?.remove(),H.append(u),P.play("chessdrop"),this.moveNumber++,navigator.clipboard.writeText("[checkers]"+this.gameState+"[/checkers]"),N.success("BBCode copied to clipboard")}}),$.drops(Array.from(h.querySelectorAll("td"))),$.apply(Array.from(h.querySelectorAll(".piece")))}getCapturedPiece(h,$){let L=[$[0]-h[0],$[1]-h[1]];if(L.map(Math.abs).join(",")!=="2,2")return;return this.element.rows[h[0]+L[0]/2].cells[h[1]+L[1]/2].querySelector(".piece")??void 0}promote(h){h.dataset.piece=h.dataset.piece?.toUpperCase(),h.innerHTML="♛"}isValidMove(h,$){let L=this.element,H=[$[0]-h[0],$[1]-h[1]].map(Math.abs),u=L.rows[h[0]].cells[h[1]].querySelector(".piece")?.dataset.piece??"",M=this.getCapturedPiece(h,$)?.dataset.piece??"";if($[0]%2===$[1]%2)return!1;if(H[0]!=H[1])return!1;if(u==="b"&&$[0]<=h[0])return!1;if(u==="r"&&$[0]>=h[0])return!1;if(M.toLowerCase()===u.toLowerCase())return!1;if(L.rows[$[0]].cells[$[1]].querySelector(".piece"))return!1;return H[0]===(M?2:1)}get moveNumber(){return Number(this.element.dataset.moveNumber??"1")}set moveNumber(h){this.element.dataset.moveNumber=`${h}`}get gameState(){let h=Array.from(this.element.querySelectorAll("td")),$=[];for(let L=0;L<8;L++){$.push([]);for(let H=0;H<4;H++){let u=L%2?0:1;$[L].push(h[L*8+H*2+u].querySelector(".piece")?.dataset.piece||" ")}}return $.map((L)=>L.join("")).join("/").replaceAll(/ +/g,(L)=>`${L.length}`)+` ${this.moveNumber}`}}var eh={R:"♜",N:"♞",B:"♝",Q:"♛",K:"♚",P:"♟",r:"♜",n:"♞",b:"♝",q:"♛",k:"♚",p:"♟"};class C extends b{static hydrate(h){q("Chess",h.querySelectorAll(".chess"),this)}constructor(h){super(h);P.load("chessdrop");let $=new z;$.addListener({ondrop:(L)=>{if(L.reset(),!L.droptarget)return;let H=L.el,u=H.dataset.piece,M=L.droptarget.querySelector(".piece"),E=M?.dataset.piece?.trim()??"",T=Y(H.closest("td")),f=Y(L.droptarget);if(!this.isValidMove(u,E,T,f))return;if(u?.toLowerCase()==="p"&&[1,8].includes(f[0]))this.promotePawn(H);if(E?.toLowerCase()==="k")P.loadAndPlay("malo-mart");M?.remove(),L.droptarget.append(H),P.play("chessdrop"),this.moveNumber++,navigator.clipboard.writeText("[chess]"+this.getFENNotation()+"[/chess]"),N.success("BBCode copied to clipboard")}}),$.drops(Array.from(h.querySelectorAll("td"))),$.apply(Array.from(h.querySelectorAll(".piece")))}get moveNumber(){return Number(this.element.dataset.moveNumber??"1")}set moveNumber(h){this.element.dataset.moveNumber=`${h}`}didJumpAPiece(h,$){let L=[$[0]-h[0],$[1]-h[1]],H=L.map(Math.sign),u=Math.max(...L.map(Math.abs));for(let M=1;M<u;M++)if(this.element.rows[h[0]+H[0]*M].cells[h[1]+H[1]*M].querySelector(".piece"))return!0;return!1}isValidMove(h="",$="",L,H){let M=[L[0]-H[0],L[1]-H[1]].map(Math.abs),E=Math.min(...M)===0,T=M[0]===M[1],f=h.toLowerCase()===h;if(this.moveNumber%2===0!==f)return N.error(`It's ${f?"white":"black"}'s turn!`,3000),!1;if($!==""&&h.toLowerCase()===h===($.toLowerCase()===$))return!1;switch(h){case"p":return L[0]<H[0]&&Math.max(...M)<=(L[0]===2?2:1)&&($?T:E);case"P":return L[0]>H[0]&&Math.max(...M)<=(L[0]===7?2:1)&&($?T:E);case"r":case"R":return E&&!this.didJumpAPiece(L,H);case"b":case"B":return T&&!this.didJumpAPiece(L,H);case"n":case"N":return M.toSorted((F,A)=>F-A).join(",")==="1,2";case"q":case"Q":return(E||T)&&!this.didJumpAPiece(L,H);case"k":case"K":return Math.max(...M)<=2&&(T||E)}return!0}promotePawn(h){while(!0){let $=(prompt("Congrats on your promotion, sir pawn! What rank would you like? (q: Queen, r: Rook, b: Bishop, n: Knight)","q")??"").toLowerCase();if(["q","r","b","n"].includes($)){$=h.dataset.piece==="p"?$.toLowerCase():$.toUpperCase(),h.dataset.piece=$,h.innerHTML=eh[$],P.loadAndPlay("zelda-item-get");break}}}getFENNotation(){return Array.from(this.element.querySelectorAll("td")).map(($,L)=>(L&&L%8===0?"/":"")+($.querySelector(".piece")?.dataset.piece||" ")).join("").replaceAll(/ +/g,($)=>`${$.length}`)+` ${this.moveNumber}`}}function Vh(h){if(!globalThis.getSelection)return;let $=document.createRange();$.selectNode(h);let L=globalThis.getSelection();if(!L)return;if(L.rangeCount)L.removeAllRanges();L.addRange($)}function Yh(h,$){let L=h.scrollTop,H=h.selectionStart??0,u=h.selectionEnd??0;h.value=h.value.substring(0,H)+$+h.value.slice(u),h.selectionStart=H+$.length,h.selectionEnd=H+$.length,h.focus(),h.scrollTop=L}class v extends b{static hydrate(h){q("CodeBlock",h.querySelectorAll(".bbcode.code"),this)}constructor(h){super(h);h.addEventListener("click",()=>Vh(h))}}class w extends b{fullHeight=0;animationLengthInMs=200;static hydrate(h){q("CollapseBox",h.querySelectorAll(".collapse-box"),this)}constructor(h){super(h);let{collapseContent:$}=this;if($)Object.assign($.style,{transition:`height ${this.animationLengthInMs}ms ease-in-out`});this.toggle(),this.element.addEventListener("click",(L)=>{if(L.target instanceof HTMLElement&&L.target.matches(".collapse-button"))this.isOpen=!this.isOpen,this.toggle()})}get boxID(){return this.element.getAttribute("id")||""}get collapseContent(){return this.element.querySelector(".collapse-content")}get isOpen(){return!(globalThis.sessionStorage.getItem("collapsed")??"").split(",").includes(this.boxID)}set isOpen(h){let $=(globalThis.sessionStorage.getItem("collapsed")??"").split(",").filter(Boolean);if(h)$=$.filter((L)=>L!==this.boxID);else $.push(this.boxID);globalThis.sessionStorage.setItem("collapsed",$.join(",")??"")}toggle(){let{collapseContent:h}=this;if(!h)return;let{style:$}=h;if(this.isOpen){if(!this.fullHeight)return;$.height=`${this.fullHeight}px`,this.element.classList.remove("collapsed"),setTimeout(()=>{$.removeProperty("height"),$.removeProperty("overflow")},this.animationLengthInMs)}else this.fullHeight=h.clientHeight||h.offsetHeight,$.height=`${this.fullHeight}px`,$.overflow="hidden",this.element.classList.add("collapsed"),requestAnimationFrame(()=>{$.height="0px"})}}function U(h,$=1000){return new Promise((L)=>{let H=new Set,u=Array.from(h).filter((E)=>!E.complete);if(!u.length){L();return}function M(){if(H.delete(this.src),H.size===0)L()}if(u.forEach((E)=>{if(!H.has(E.src))H.add(E.src),E.addEventListener("error",M),E.addEventListener("load",M)}),$)setTimeout(L,$)})}function p(){let h=document.querySelectorAll(".autodate"),$=Array.from(document.querySelectorAll("[data-timestamp]"));if(!h)return;h.forEach((L)=>{let H=Number.parseInt(L.getAttribute("title")??"",10),u=L.classList.contains("smalldate")?fh(H):g(H);if(u!==L.innerHTML)L.innerHTML=u}),$.forEach((L)=>{if(!L.title)L.title=fh(Number.parseInt(L.dataset.timestamp??"",10))})}function r(h){if(document.readyState==="complete")h();else document.addEventListener("DOMContentLoaded",h)}function Zh(){let h=document.createElement("input");return h.setAttribute("type","date"),h.type==="date"}function Uh(){let h=[String.fromCodePoint(9757,127999),String.fromCodePoint(9757)].map(($)=>{let L=document.body.appendChild(document.createElement("span"));L.appendChild(document.createTextNode($));let H=L.offsetWidth;return L.remove(),H});return h[0]===h[1]}class d extends b{picker;selectedDate;lastDate;static hydrate(h){if(Zh())return;q("DatePicker",h.querySelectorAll("input[type=date]"),this)}constructor(h){super(h);this.picker=this.getPicker(),h.autocomplete="off",h.addEventListener("focus",()=>this.openPicker()),h.addEventListener("keydown",()=>this.closePicker())}getPicker(){if(this.picker)return this.picker;let h=document.querySelector("#datepicker");if(!h)h=Object.assign(document.createElement("table"),{id:"datepicker"}),document.body.appendChild(h),h.style.display="none";return h}openPicker(){let h=K(this.element);Object.assign(this.picker.style,{display:"",zIndex:B(),position:"absolute",top:`${h.yh}px`,left:`${h.x}px`});let[$,L,H]=this.element.value.split("/").map((u)=>Number.parseInt(u,10));if($&&L&&H)this.selectedDate=[H,$-1,L];else this.selectedDate=void 0;this.generate(H,$,L)}closePicker(){this.picker.style.display="none"}generate(h,$,L){let H=new Date,u=this.getPicker(),M,E,[T,f,F]=[h,$,L];if(T===void 0)T=H.getFullYear(),f=H.getMonth(),F=H.getDate(),this.selectedDate=[T,f,F];if(f===-1)T-=1,f=11;if(f===12)T+=1,f=0;this.lastDate=[T,f,F];let A=new Date(T,f+1,0).getDate(),j=new Date(T,f,1).getDay();u.innerHTML="",M=u.insertRow(0),E=M.insertCell(0),E.innerHTML="&lt;",E.className="control",E.addEventListener("click",()=>this.lastYear()),E=M.insertCell(1),E.colSpan=5,E.className="year",E.innerHTML=`${T}`,E=M.insertCell(2),E.innerHTML=">",E.className="control",E.addEventListener("click",()=>this.nextYear()),M=u.insertRow(1),E=M.insertCell(0),E.innerHTML="<",E.className="control",E.addEventListener("click",()=>this.lastMonth()),E=M.insertCell(1),E.colSpan=5,E.innerHTML=Gh[f],E.className="month",E=M.insertCell(2),E.innerHTML=">",E.className="control",E.addEventListener("click",()=>this.nextMonth()),M=u.insertRow(2),M.className="weekdays";for(let x=0;x<7;x+=1)M.insertCell(x).innerHTML=Nh[x];M=u.insertRow(3);for(let x=0;x<A;x+=1){if(!x)for(let O=0;O<j;O+=1)M.insertCell(O);if((j+x)%7===0)M=u.insertRow(u.rows.length);E=M.insertCell((j+x)%7),E.addEventListener("click",this.insert.bind(this,E));let Eh=!!this.selectedDate&&T===this.selectedDate[0]&&f===this.selectedDate[1]&&x+1===this.selectedDate[2];E.className=`day${Eh?" selected":""}`,E.innerHTML=`${x+1}`}}lastYear(){let h=this.lastDate;if(h)this.generate(h[0]-1,h[1],h[2])}nextYear(){let h=this.lastDate;if(h)this.generate(h[0]+1,h[1],h[2])}lastMonth(){let h=this.lastDate;if(h)this.generate(h[0],h[1]-1,h[2])}nextMonth(){let h=this.lastDate;if(h)this.generate(h[0],h[1]+1,h[2])}insert(h){let $=this.lastDate;if($)this.element.value=`${$[1]+1}/${h.innerHTML}/${$[0]}`;this.closePicker()}}class Dh{rgb;constructor(h){let $=/^rgb\((\d+),\s?(\d+),\s?(\d+)\)/i.exec(h),L=/#?([\da-fA-F]+)/.exec(h);if($){this.rgb=[Number.parseFloat($[1]),Number.parseFloat($[2]),Number.parseFloat($[3])];return}if(L){let H=L[1];if(H.length===3)H=H.charAt(0)+H.charAt(0)+H.charAt(1)+H.charAt(1)+H.charAt(2)+H.charAt(2);if(H.length!==6){this.rgb=[0,0,0];return}this.rgb=[];for(let u=0;u<3;u+=1)this.rgb[u]=Number.parseInt(H.slice(u*2,(u+1)*2),16)}}invert(){if(this.rgb)this.rgb=[255-this.rgb[0],255-this.rgb[1],255-this.rgb[2]];return this}toRGB(){return this.rgb}toHex(){return"#"+this.rgb?.map((h)=>h.toString(16).padStart(2,"0")).join("")}}var Ph=Dh;var Oh={a:(h,$)=>`[url=${$?.getAttribute("href")}]${h}[/url]`,b(...h){return this.strong(...h)},br:()=>`
`,div:(h)=>`
${h}`,em:(h)=>`[i]${h}[/i]`,font:(h,$)=>{let L=$.style.fontFamily||$.getAttribute("face");return L?`[font=${L}]${h}[/font]`:h},h1:(h)=>`[h1]${h}[/h1]`,h2:(h)=>`[h2]${h}[/h2]`,h3:(h)=>`[h3]${h}[/h3]`,h4:(h)=>`[h4]${h}[/h4]`,h5:(h)=>`[h5]${h}[/h5]`,h6:(h)=>`[h6]${h}[/h6]`,hr:()=>`
`,i(...h){return this.em(...h)},img:(h,$)=>{let L=$.getAttribute("alt")??"",H=$.getAttribute("src");if($.dataset.emoji)return` ${$.dataset.emoji}`;if(H)return`[img]${H}[/img]`;return L},li:(h)=>`* ${h.replace(/[\n\r]+/,"")}
`,meta:()=>`
`,ol:(h)=>`[ol]${h}[/ol]`,p:(h)=>`
${h==="&nbsp"?"":h}
`,strike:(h)=>`[s]${h}[/s]`,strong:(h)=>`[b]${h}[/b]`,u:(h)=>`[u]${h}[/u]`,ul:(h)=>`[ul]${h}[/ul]`},s={"background-color":(h,$)=>{let L=h&&new Ph(h).toHex(),H=L?`${L}`:h;if(["ffffff","white","transparent"].includes(H))return $;return`[bgcolor=${H}]${$}[/bgcolor]`},color(h,$){let L=h&&new Ph(h).toHex();return`[color=${L?`${L}`:h}]${$}[/color]`},"font-family":(h,$)=>`[font=${h.replaceAll(/['"]/g,"")}]${$}[/font]`,"font-style":(h,$)=>`[i]${$}[/i]`,"font-size":(h,$)=>`[size=${h}]${$}[/size]`,"font-weight":(h,$)=>`[b]${$}[/b]`,"text-align":(h,$)=>`[align=${h}]${$}[/align]`,"text-decoration":function($,L){return $==="line-through"?`[strike]${L}[/strike]`:`[u]${L}[/u]`}};function h$(h){return h.replaceAll(/[\r\n]+/g,"").replaceAll("&amp;","&").replaceAll("&gt;",">").replaceAll("&lt;","<").replaceAll("&nbsp;"," ")}function Ah(h){let $=h.tagName.toLowerCase(),L="";for(let M of h.childNodes)L+=M.nodeType===Node.ELEMENT_NODE?Ah(M):h$(M.textContent??"");if($==="body")return L;if(h.style){for(let M of h.style)if(M in s)L=s[M](h.style.getPropertyValue(M),L)}let H=h.getAttribute("size");if(H)L=s.fontSize(H,L);let u=h.getAttribute("color");if(u)L=s.color(u,L);if($ in Oh)L=Oh[$](L,h);return L}function jh(h){return h.replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll(/(\s) /g,"$1&nbsp;").replaceAll(/\[b\]([^]*?)\[\/b\]/gi,"<b>$1</b>").replaceAll(/\[i\]([^]*?)\[\/i\]/gi,"<i>$1</i>").replaceAll(/\[u\]([^]*?)\[\/u\]/gi,"<u>$1</u>").replaceAll(/\[s\]([^]*?)\[\/s\]/gi,"<s>$1</s>").replaceAll(/\[img\]([^'"[]+)\[\/img\]/gi,'<img src="$1">').replaceAll(/\[color=([^\]]+)\]([^]*?)\[\/color\]/gi,'<span style="color:$1">$2</span>').replaceAll(/\[size=([^\]]+)\]([^]*?)\[\/size\]/gi,'<span style="font-size:$1">$2</span>').replaceAll(/\[font=['"]?([^\]]+?)['"]?\]([^]*?)\[\/font\]/gi,'<span style="font-family:$1">$2</span>').replaceAll(/\[url=([^\]]+)\]([^]*?)\[\/url\]/gi,'<a href="$1">$2</a>').replaceAll(/\[bgcolor=([^\]]+)\]([^]*?)\[\/bgcolor\]/gi,'<span style="background-color:$1">$2</span>').replaceAll(/\[h(\d)\]([^]*?)\[\/h\1\]/g,"<h$1>$2</h$1>").replaceAll(/\[align=(left|right|center)\]([^]*?)\[\/align\]/g,'<div style="text-align:$1">$2</div>').replaceAll(/\[(ul|ol)\]([^]*?)\[\/\1\]/gi,($,L,H)=>{let M=H.split(/(^|[\r\n]+)\* ?/).filter((E)=>E.trim()).map((E)=>`<li>${E}</li>`).join("");return`<${L}>${M}</${L}>`}).replaceAll(`
`,"<br>")}var $$=/^(ht|f)tps?:\/\/[\w.\-%&?=/]+$/,L$=(h)=>$$.test(h),ph={"Sans Serif":["Arial","Arial Black","Arial Narrow","Arial Rounded MT Bold","Avant Garde","Calibri","Candara","Century Gothic","Comic Sans MS","Franklin Gothic Medium","Futura","Geneva","Gill Sans","Helvetica","Impact","Lucida Grande","Optima","Segoe UI","Tahoma","Trebuchet MS","Verdana"],Serif:["Big Caslon","Bodoni MT","Book Antiqua","Calisto MT","Cambria","Didot","Garamond","Georgia","Goudy Old Style","Hoefler Text","Lucida Bright","Palatino","Perpetua","Rockwell","Rockwell Extra Bold","Baskerville","Times New Roman"],Monospaced:["Consolas","Courier New","Lucida Console","Lucida Sans Typewriter","Monaco","Andale Mono"],Fantasy:["Copperplate","Papyrus"],Script:["Brush Script MT"]};class l extends b{iframe;colorWindow;container;htmlMode=!0;editbar;emoteWindow;static hydrate(h){q("Editor",h.querySelectorAll("textarea.bbcode-editor"),this)}constructor(h){super(h);this.container=Object.assign(document.createElement("div"),{className:"editor"}),this.iframe=document.createElement("iframe"),this.iframe.style.display="none",this.iframe.addEventListener("load",()=>this.iframeLoaded(),{once:!0}),h.before(this.container),this.container.appendChild(h),this.container.appendChild(this.iframe)}get doc(){return this.window?.document}get window(){return this.iframe.contentWindow}iframeLoaded(){let{iframe:h,element:$}=this;if(h.className="editorframe",this.htmlMode=globalSettings.wysiwyg,$.addEventListener("input",()=>{this.setSource(jh($.value))}),this.doc?.addEventListener("input",()=>{if(!this.doc)return;this.element.value=Ah(this.doc.body)}),this.doc?.addEventListener("paste",(u)=>{u.preventDefault();let M=u.clipboardData?.getData("text/plain");this.doc?.execCommand("insertText",!1,M)}),this.doc?.addEventListener("drop",(u)=>{if(!u.dataTransfer?.files.length)return;this.upload(u.dataTransfer.files[0])}),this.doc?.addEventListener("dragleave",()=>{this.getAttachmentStatus().remove()}),this.doc?.addEventListener("dragover",()=>{this.getAttachmentStatus()}),!this.doc)return;let L=W($),H=this.doc.getElementsByTagName("body")[0];if(H&&L)H.style.backgroundColor=L.backgroundColor,H.style.color=L.color,H.style.borderColor="#FFF";this.doc.designMode="on",this.editbar=this.buildEditBar(),h.style.height=`${$.clientHeight}px`,$.before(this.editbar),this.setSource("<div></div>"),setTimeout(()=>{if(this.setSource(jh($.value)),this.switchMode(this.htmlMode),$.hasAttribute("autofocus"))this.window?.focus()},100)}getAttachmentStatus(){let h=this.doc?.querySelector("#attachmentStatus");if(h)return h;return h=document.createElement("div"),Object.assign(h,{id:"attachmentStatus",innerHTML:"Drop file here",contentEditable:"false"}),Object.assign(h.style,{position:"fixed",padding:"20px",top:"50%",left:"50%",translate:"-50% -50%",border:"2px dashed #ccc"}),this.doc?.body.appendChild(h),h}upload(h){let $=new FormData;$.append("Filedata",h);let L=new XMLHttpRequest;this.getAttachmentStatus().innerHTML='Uploading: <progress id="attachmentProgress"></div>';let H=this.getAttachmentStatus().querySelector("#attachmentProgress");L.upload.addEventListener("progress",(u)=>{if(H&&u.lengthComputable){let M=Math.round(u.loaded/u.total*100);H.value=u.loaded,H.max=u.total,H.textContent=`${M}%`}}),L.addEventListener("load",()=>{this.window?.focus(),this.getAttachmentStatus().remove();let u=L.responseText;if(/\D/.test(u)){alert("Error: "+u);return}this.cmd("inserthtml",`[attachment]${L.responseText}[/attachment]`)}),L.upload.addEventListener("error",()=>{this.getAttachmentStatus().remove()}),L.open("POST","/api/upload",!0),L.send($)}buildEditBar(){let h=document.createElement("div");h.className="editbar",h.innerHTML=[`<select class="fontface">
        <option value="">Default Font</option>
        <optgroup label="Headings">
          <option value="heading_1" style="font-weight:bold;font-size: 2em">Heading 1</option>
          <option value="heading_2" style="font-weight:bold;font-size: 1.5em">Heading 2</option>
          <option value="heading_3" style="font-weight:bold;font-size: 1.17em">Heading 3</option>
          <option value="heading_4" style="font-weight:bold;font-size: 1em">Heading 4</option>
          <option value="heading_5" style="font-weight:bold;font-size: 0.83em">Heading 5</option>
          <option value="heading_6" style="font-weight:bold;font-size: 0.67em">Heading 6</option>
        </optgroup>
      </select>`,'<a class="bold" title="Bold"></a>','<a class="italic" title="Italic"></a>','<a class="underline" title="Underline"></a>','<a class="strikethrough" title="Strike-Through"></a>','<a class="forecolor" title="Foreground Color"></a>','<a class="backcolor" title="Background Color"></a>','<a class="insertimage" title="Insert Image"></a>','<a class="createlink" title="Insert Link"></a>','<a class="c_email" title="Insert Email"></a>','<a class="justifyleft" title="Align Left"></a>','<a class="justifycenter" title="Center"></a>','<a class="justifyright" title="Align Right"></a>','<a class="c_youtube" title="Insert video from any of your favorite video services!"></a>','<a class="c_code" title="Insert code"></a>','<a class="c_quote" title="Insert Quote"></a>','<a class="c_spoiler" title="Insert Spoiler"></a>','<a class="insertorderedlist" title="Create Ordered List"></a>','<a class="insertunorderedlist" title="Create Unordered List"></a>','<a class="c_smileys" title="Insert Emoticon"></a>','<a class="c_switcheditmode" title="Switch editor mode"></a>'].join(""),h.addEventListener("click",(L)=>{if(L.target instanceof HTMLElement&&L.target.matches(".editbar a"))this.editbarCommand(L,L.target.className)});let $=h.querySelector("select.fontface");if($){$.addEventListener("input",(L)=>{let H=$.value;if(H.startsWith("heading_"))this.editbarCommand(L,"heading",H.replace("heading_","h"));else if(H)this.editbarCommand(L,"fontname",H)});for(let L of Object.keys(ph)){let H=ph[L].map((u)=>`<option style="font-family: ${u}">${u}</option>`);$.innerHTML+=`<optgroup label="${L}">${H}</optgroup>`}}return h}editbarCommand(h,$,L){switch(h.preventDefault(),$){case"forecolor":case"backcolor":this.showColors(h.pageX,h.pageY,$);break;case"c_smileys":this.showEmotes(h.pageX,h.pageY);break;case"c_switcheditmode":this.switchMode(!this.htmlMode);break;default:this.cmd($,L);break}}async showEmotes(h,$){let L=this.emoteWindow;if(!L){let H=await fetch("/api/emotes"),u=await H.json();if(H.ok)this.createEmoteWindow(u,{x:h,y:$});return}if(L.style.display==="none")L.style.display="",L.style.left=`${h}px`,L.style.top=`${$}px`;else this.hideEmotes()}hideEmotes(){if(this.emoteWindow)this.emoteWindow.style.display="none"}createEmoteWindow([h,$],L){let H=document.createElement("div");H.className="emotewin",h.forEach((u,M)=>{let E=$[M],T=document.createElement("a");T.href="javascript:void(0)",T.addEventListener("click",()=>{this.cmd("inserthtml",E),this.hideEmotes()}),T.innerHTML=`${E} ${u}`,H.appendChild(T)}),H.style.position="absolute",H.style.display="none",this.emoteWindow=H,document.querySelector("#page")?.appendChild(H),this.showEmotes(L.x,L.y)}colorHandler(h,$){this.cmd(h,$),this.hideColors()}showColors(h,$,L){this.hideColors();let u=G(`
      <div>
        ${["#FFFFFF","#AAAAAA","#000000","#FF0000","#00FF00","#0000FF","#FFFF00","#00FFFF","#FF00FF"].map((M)=>`<button style="background-color:${M}" data-color="${M}"></button>`).join("")}
      </div>
    `);return Object.assign(u.style,{display:"grid",gridTemplateColumns:"20px 20px 20px",gridTemplateRows:"20px 20px 20px",position:"absolute",top:`${$}px`,left:`${h}px`,cursor:"pointer",zIndex:B()}),u.addEventListener("click",(M)=>{if(M.target instanceof HTMLButtonElement&&M.target.dataset.color)this.colorHandler(L,M.target.dataset.color)}),this.colorWindow=u,document.querySelector("#page")?.appendChild(u),null}hideColors(){if(this.colorWindow)this.colorWindow.remove(),this.colorWindow=void 0}cmd(h,$){let L=this.getSelection(),H="",u=h,M=$;switch(h.toLowerCase()){case"bold":H=`[b]${L}[/b]`;break;case"italic":H=`[i]${L}[/i]`;break;case"underline":H=`[u]${L}[/u]`;break;case"strikethrough":H=`[s]${L}[/s]`;break;case"justifyright":H=`[align=right]${L}[/align]`;break;case"justifycenter":H=`[align=center]${L}[/align]`;break;case"justifyleft":H=`[align=left]${L}[/align]`;break;case"insertimage":if(M=prompt("Image URL:")||"",!M)return;if(!L$(M)){alert("Please enter a valid URL.");return}H=`[img]${M}[/img]`;break;case"insertorderedlist":if(!this.htmlMode)H=`[ol]${L.replaceAll(/(.+([\r\n]+|$))/i,"* $1")}[/ol]`;break;case"insertunorderedlist":if(!this.htmlMode)H=`[ul]${L.replaceAll(/(.+([\r\n]+|$))/i,"* $1")}[/ul]`;break;case"createlink":if(M=prompt("Link:")||"",!M)return;if(!/^(https?|ftp|mailto):/.test(M))M=`https://${M}`;H=`[url=${M}]${L}[/url]`;break;case"c_email":if(M=prompt("Email:")||"",!M)return;u="createlink",M=`mailto:${M}`,H=`[url=${M}]${L}[/url]`;break;case"backcolor":if(t.firefox||t.safari)u="hilitecolor";H=`[bgcolor=${M}]${L}[/bgcolor]`;break;case"forecolor":H=`[color=${M}]${L}[/color]`;break;case"fontname":H=`[font=${M}]${L}[/font]`;break;case"c_code":u="inserthtml",M=`[code]${L}[/code]`,H=M;break;case"c_quote":u="inserthtml",M=prompt("Who said this?")||"",M=M?`=${M}`:"",M=`[quote${M}]${L}[/quote]`,H=M;break;case"c_spoiler":u="inserthtml",M=`[spoiler]${L}[/spoiler]`,H=M;break;case"c_youtube":if(u="inserthtml",M=prompt("Video URL?")||"",!M)return;M=`[video]${M}[/video]`,H=M;break;case"inserthtml":H=M||"";break;case"heading":if(H=`[${M}]${L}[/${M}]`,t.chrome)u="formatBlock",M=`<${M}>`;break;default:throw Error(`Unsupported editor command ${h}`)}if(this.htmlMode)this.doc?.execCommand(u,!1,M),this.doc?.dispatchEvent(new Event("input")),this.window?.focus();else Yh(this.element,H),this.element.dispatchEvent(new Event("input"))}getSelection(){if(this.htmlMode)return this.window?.getSelection()?.toString()||"";return this.element.value.substring(this.element.selectionStart,this.element.selectionEnd)}getSource(){return this.doc?.body.innerHTML}setSource(h){if(this.doc)this.doc.body.innerHTML=h}switchMode(h){let{element:$,iframe:L}=this;if(h)$.style.display="none",L.style.display="";else $.style.display="",L.style.display="none";this.htmlMode=h}}class o extends b{resetOnSubmit;static hydrate(h){q("Form",h.querySelectorAll("form[data-ajax-form]"),this)}constructor(h){super(h);this.resetOnSubmit=h.dataset.ajaxForm==="resetOnSubmit",h.addEventListener("submit",($)=>{$.preventDefault(),this.submitForm()})}submitForm(){let{element:h,resetOnSubmit:$}=this,{submitButton:L}=h,H=new FormData(h,L),u=Array.from(H.entries()).filter((M)=>typeof M[1]==="string");if(RUN.stream.load(h.action||globalThis.location.toString(),{body:new URLSearchParams(u)}),$)h.reset();RUN.stream.pollData()}}class a extends b{index;images;max;static hydrate(h){q("ImageGallery",h.querySelectorAll(".image_gallery"),this)}constructor(h){super(h);let $=document.createElement("div"),L=document.createElement("button"),H=document.createElement("button");this.index=0,this.images=h.querySelectorAll("img"),this.max=Math.max(this.images.length,1),L.innerHTML="Next &raquo;",L.addEventListener("click",()=>{this.showNext()}),H.innerHTML="Prev &laquo;",H.addEventListener("click",()=>{this.showPrev()}),this.update(),$.appendChild(H),$.appendChild(document.createTextNode(" ")),$.appendChild(L),h.appendChild($)}showNext(){if(this.index<this.max-1)this.index+=1;this.update()}showPrev(){if(this.index>0)this.index-=1;this.update()}update(){this.images.forEach((h,$)=>{let L=h.dataset.madeResized?h.parentNode:h;if(L)L.style.display=$===this.index?"block":"none"})}}var rh="999999px";class m extends b{static async hydrate(h){let $=h.querySelectorAll(".bbcodeimg");await U(Array.from($)),q("ImageResizer",$,this)}constructor(h){super(h);let $=1,L=1,{naturalWidth:H,naturalHeight:u}=h,M=W(h),E=Number.parseInt(M.width,10)||Number.parseInt(M.maxWidth,10),T=Number.parseInt(M.height,10)||Number.parseInt(M.maxHeight,10);if(E&&H>E)$=E/u;if(T&&u>T)L=T/u;if($=$&&L?Math.min($,L):L||$,$<1)this.makeResizer(H*$,u*$)}makeResizer(h,$){let{element:L}=this;L.style.maxWidth=rh,L.style.maxHeight=rh,L.dataset.madeResized="true";let H=Object.assign(document.createElement("a"),{target:"_blank",href:L.src});Object.assign(H.style,{display:"block",overflow:"hidden",width:`${h}px`,height:`${$}px`}),H.dataset.nw=`${L.naturalWidth}`,H.dataset.nh=`${L.naturalHeight}`,H.addEventListener("mousemove",(M)=>{let{x:E,y:T,w:f,h:F}=K(H);H.scrollLeft=(M.pageX-E)/f*(+(H.dataset.nw||0)-f)||0,H.scrollTop=(M.pageY-T)/F*(+(H.dataset.nh||0)-F)||0}),H.addEventListener("mouseover",()=>{L.style.width=`${H.dataset.nw}px`,L.style.height=`${H.dataset.nh}px`});let u=()=>{if(H.scrollLeft)H.scrollLeft=0,H.scrollTop=0;L.style.width=`${h}px`,L.style.height=`${$}px`};H.addEventListener("mouseout",u),u(),L.before(H),H.appendChild(L)}}function y(h){let $=K(h),L=h.getAttribute("title");if(h.dataset.lastOnline){let u=Number.parseInt(h.dataset.lastOnline??"",10);L=`Last Online: ${g(u)} ${bh(u)}`}if(!L)return;let H=document.querySelector("#tooltip");if(!H)H=G('<div id="tooltip" class="tooltip">Default text</div>'),document.querySelector("#page")?.appendChild(H);h.title="",h.addEventListener("mouseout",()=>{h.title=L,H.style.display="none"}),H.innerText=L,H.style.display="",Object.assign(H.style,{top:`${$.y-H.offsetHeight}px`,left:`${$.x}px`,zIndex:`${B()}`})}class n extends b{static hydrate(h){q("Link",h.querySelectorAll("a"),this)}constructor(h){super(h);if(h.dataset.useTooltip)h.addEventListener("mouseover",()=>y(h));if(!h.href)return;let $=h.getAttribute("href"),L=!h.target&&$&&($.startsWith("/")||$.startsWith("?"));if($?.startsWith("javascript"))return;if(L){let u=h.onclick;h.onclick=null,h.addEventListener("click",(M)=>{if(M.preventDefault(),!u||u.call(h,M)!==!1)RUN.stream.location($)});return}h.target="_blank"}}class yh{title="Title";wait=!0;content="Content";open=!1;minimizable=!0;resize;className="";pos="center";zIndex;windowContainer;id;onclose;animate=!0;oldpos="";constructor(h={}){this.zIndex=B(),Object.assign(this,h)}render(){let h=G(`
      <div id="${this.id||""}" class="window ${this.className}">
        <div class="title">
          ${this.title}
          <div class="controls">
            ${this.minimizable?'<button data-action="minimize">-</button>':""}
            <button data-action="close" data-shortcut="Escape">X</button>
          </div>
        </div>
        <div class="content">${this.content}</div>
      </div>`);this.windowContainer=h,h.addEventListener("click",(u)=>{if(u.target instanceof HTMLElement){let M=u.target.dataset.action;if(M&&M in this)this[M]()}});let $=document.querySelector(".windows");if(!$)$=G('<div class="windows" style="z-index: 1"></div>'),document.body.appendChild($);if($.appendChild(h),this.resize)this.renderResizeHandle(this.resize);let L=h.style;L.zIndex=`${this.zIndex+5}`;let{pos:H}=this;if(this.wait)U(Array.from(h.querySelectorAll("img"))).then(()=>{this.setPosition(H)});else this.setPosition(H);return new z().autoZ().noChildActivation().boundingBox(0,0,document.documentElement.clientWidth-50,document.documentElement.clientHeight-50).apply(h,h.querySelector(".title")||void 0),h}renderResizeHandle(h){let{windowContainer:$}=this;if(!$)return;let L=$.querySelector(h);if(!L)throw Error("Resize target not found");L.style.width=`${L.clientWidth}px`,L.style.height=`${L.clientHeight}px`;let H=G('<div class="resize"></div>');$.appendChild(H),H.style.left=`${$.clientWidth-16}px`,H.style.top=`${$.clientHeight-16}px`,new z().boundingBox(100,100,1/0,1/0).addListener({ondrag(u){let M=Number.parseFloat(L.style.width)+(u.dx??0),E=Number.parseFloat(L.style.height)+(u.dy??0);if(L.style.width=`${M}px`,M<$.clientWidth-20)L.style.width=`${$.clientWidth}px`;else H.style.left=`${$.clientWidth-16}px`;L.style.height=`${E}px`},ondrop(){H.style.left=`${$.clientWidth-16}px`}}).apply(H),L.style.width=`${$.clientWidth}px`,H.style.left=`${$.clientWidth-16}px`}close(){if(!this.windowContainer)return;if(this.windowContainer.remove(),this.windowContainer=void 0,this.onclose)this.onclose()}minimize(){let{windowContainer:h}=this;if(!h)return;let $=!h.classList.toggle("minimized");if(h.querySelector(".controls [data-action=minimize]").innerHTML=$?"-":"\uD83D\uDDD6",$)h.removeAttribute("draggable");else h.setAttribute("draggable","false"),this.oldpos=this.getPosition();this.setPosition($?this.oldpos:"",!1)}setPosition(h,$=!0){let L=this.windowContainer;if(!L)return;let H=0,u=0,M=document.documentElement.clientHeight,E=document.documentElement.clientWidth;if(h==="center")u=Math.floor((M-L.clientHeight)/2),H=Math.floor((E-L.clientWidth)/2);else{let T=/(\d+) (\d+)/.exec(h);if(T)H=Number(T[1]),u=Number(T[2])}if(L.style.left=`${H}px`,this.animate&&$)Q(L,[{top:`${u-100}px`},{top:`${u}px`}],300,"ease-out");else L.style.top=`${u}px`;this.pos=h}getPosition(){if(!this.windowContainer)return"";let h=this.windowContainer.style;return`${Number.parseFloat(h.left)} ${Number.parseFloat(h.top)}`}}var _=yh;class e extends b{static hydrate(h){q("MediaPlayer",h.querySelectorAll(".media"),this)}constructor(h){super(h);let $=h.querySelector("a.popout"),L=h.querySelector("a.inline"),H=h.querySelector(".movie");if(!H)return;$?.addEventListener("click",(u)=>{u.preventDefault(),new _({title:$.href,content:H.innerHTML}).render()}),L?.addEventListener("click",(u)=>{u.preventDefault(),H.style.display="block"})}}class hh extends b{static hydrate(h){q("PageList",h.querySelectorAll(".pages"),this)}constructor(h){super(h);h.addEventListener("wheel",($)=>this.wheel($))}wheel(h){h.preventDefault();let $=Math.sign(h.deltaY),L=Array.from(this.element.querySelectorAll("a")),H=Number.parseInt(L[1].innerHTML,10),u=Number.parseInt(L.at(-1)?.innerHTML||"",10),M=L.length-2;if($>0&&H+M<u||$<0&&H>2)for(let E=0;E<M;E+=1)L[E+1].href=L[E+1].href.replace(/\d+$/,`${E+H+$}`),L[E+1].innerHTML=`${H+E+$}`}}class $h extends b{static hydrate(h){q("Switch",h.querySelectorAll("input.switch"),this)}constructor(h){super(h);h.style.display="none";let $=Object.assign(document.createElement("button"),{type:"button",title:h.className,className:h.className}),L=()=>{$.style.backgroundPosition=h.checked?"top":"bottom"};L(),$.addEventListener("click",()=>{h.checked=!h.checked,L(),h.dispatchEvent(new Event("change"))}),h.after($)}}var Bh="active";class Lh extends b{static hydrate(h){q("Tabs",h.querySelectorAll(".tabs"),this)}constructor(h){super(h);h.addEventListener("click",($)=>this.click($))}click(h){let{tabSelector:$}=this.element.dataset,{target:L}=h;if(!L||!(L instanceof HTMLElement)||L.tagName.toLowerCase()!=="a")return;let H=L;if($){let M=L.closest($);if(M)H=M}let u=this.element.querySelector(`.${Bh}`);if(u)u.classList.remove(Bh);H.className=Bh,H.blur()}}function S(h){p(),[i,C,k,v,w,d,l,o,X,a,m,n,e,hh,$h,Lh].forEach(($)=>{$.hydrate(h)})}var D={loadscript(h){document.body.appendChild(Object.assign(document.createElement("script"),{src:h}))},script(h){(0,eval)(h)},error(h){N.error(h)},success(h){N.success(h)},reload(h=0){setTimeout(()=>globalThis.location.reload(),h)},refreshdata(){RUN.stream.pollData(!0)},addclass(h,$){let L=document.querySelector(h);if(L)L.classList.add($)},title(h){document.title=h},update(h,$,L){let H=h,u=Array.from(document.querySelectorAll(".path"));if(H==="path"&&u.length>1){u.forEach((T)=>{T.innerHTML=$,S(T)});return}if(!/^\W/.test(H))H=`#${H}`;let M=document.querySelector(H);if(!M)return;M.innerHTML=$;let E=M.querySelector("[autofocus]");if(E)E.focus();if(L)Fh(M);S(M)},removeel(h){let $=document.querySelector(h);if($)$.remove()},back(){globalThis.history.back()},setstatus(h){let $=document.querySelector("#status");if($)$.className=h},appendrows(h,$){let L=document.querySelector(h);if(!L)return;let H=document.createElement("span");H.innerHTML=`<table>${$}</table>`;let u=H.getElementsByTagName("tbody")[0];S(u),L.appendChild(u)},location(h){if(["?","/"].includes(h.charAt(0))){RUN.stream.location(h);return}document.location=h},enable(h){let $=document.querySelector(`#${h}`);if($)$.disabled=!1},addshout(h){let $=Array.from(document.querySelectorAll("#shoutbox .shout")),L=document.createElement("span");L.innerHTML=h;let H=L.firstElementChild;if(!H)return;$[0].parentNode?.insertBefore(H,$[0]);while($.length>globalSettings.shoutLimit-1)$.pop()?.remove();if(Fh(H),globalSettings.soundShout)P.play("blip");S(H)},tick(h){let $=document.querySelector("#ticker");if(!$)return;let L=document.createElement("div");L.innerHTML=h,L=L.firstElementChild,$.insertBefore(L,$.firstChild);let H=Array.from($.querySelectorAll(".tick"));for(let u=100;u<H.length;u+=100)H[u].remove()},im(h,$,L,H,u){Ih({fromId:h,fromName:$,message:L,fromMe:H,timestamp:u})},imtoggleoffline(h){document.querySelector(`#im_${h}`)?.classList.add("offline")},window(h){if(h.id&&document.getElementById(h.id))return;let L=new _(h);S(L.render())},closewindow(h){let $=document.querySelector(h+" [data-action=close]");if($)$.click()},onlinelist(h){let $=document.querySelector("#statusers");if(!$)return;h.forEach((L)=>{let H=document.querySelector(`#statusers .user${L.uid}`);if(!H)H=document.createElement("a"),H.addEventListener("click",function(){if(this.href)RUN.stream.location(this.href)}),H.addEventListener("mouseover",function(){y(this)});if(L.profileURL)H.href=L.profileURL;if(H.innerHTML=L.name,H.className=[`user${L.uid}`,`mgroup${L.groupID}`,L.status,`lastAction${L.lastAction}`].join(" "),L.locationVerbose)H.title=L.locationVerbose;if(L.status==="idle"){qh(H);return}if($.firstChild)$.insertBefore(H,$.firstChild);else $.appendChild(H)})},snow(h){V(h)},confetti(h){V(h,!0)},setoffline(h){let $=document.querySelector("#statusers");h.split(",").forEach((H)=>{let u=document.querySelector(`#statusers .user${H}`);if(u&&$)u.remove()})},async scrollToPost(h){let $=document.getElementById(`pid_${h}`);if(!$)return!1;await U(Array.from(document.querySelectorAll("#page img")));let L=K($);return globalThis.scrollTo({top:L.y}),!0},updateqreply(h){let L=document.querySelector("#qreply")?.querySelector("textarea");if(L)L.focus(),L.value+=h,L.dispatchEvent(new Event("input"))},newmessage(h,$){let L=document.querySelector("#notification"),H=document.querySelector("#num-messages");if(H)H.innerHTML=`${Number.parseInt(H.innerHTML,10)+1}`;if(!L)L=document.createElement("div"),L.id="notification",document.body.appendChild(L);L.style.display="",L.className="newmessage",L.addEventListener("click",()=>{L.style.display="none",RUN.stream.location(`/ucp/inbox?view=${$}`,3)}),L.innerHTML=h},playsound(h,$){P.loadAndPlay(h,$)},listrating(h,$){let L=document.querySelector(`#postrating_${h}`),H;if(L){if(L.style.display!=="none"){Q(L,[{height:"200px"},{height:"0px"}],300).then((u)=>u.style.display="none");return}L.style.display="block"}else{L=document.createElement("div"),L.className="postrating_list",L.id=`postrating_${h}`;let u=document.querySelector(`#pid_${h} .postrating`);if(!u)return;H=K(u),L.style.top=`${H.yh}px`,L.style.left=`${H.x}px`,document.querySelector("#page")?.appendChild(L)}L.innerHTML=$,Q(L,[{height:"0px"},{height:"200px"}],300)}};var gh,R="",Jh="";function Sh(){if(R)document.title=R;R="",clearInterval(gh)}function Xh(h){if(document.hasFocus())return;if(Sh(),!R)R=document.title;Jh=h,gh=setInterval(()=>{document.title=document.title===R?Jh:R},1000)}function H$(h,$){if(Xh(`New message from ${h}!`),!document.hasFocus()&&globalThis.Notification&&Notification.permission==="granted"){let L=new Notification(`${h} says:`,{body:$});L.onclick=()=>{globalThis.focus(),L.close()}}}function u$({fromId:h,fromName:$,message:L}){let H=document.querySelector(`#im_${h} .ims`);if(H)return H;let M=new _({title:`${$}`,content:`
        <div class='ims'></div>
        <div class='offline'>This user may be offline</div>
        <div>
            <form data-ajax-form='resetOnSubmit' method='post'>
                <input type='hidden' name='im_uid' value='${h}'>
                <input type='text' name='im_im' autocomplete='off'>
            </form>
        </div>
    `,className:"im",resize:".ims",animate:!0,id:`im_${h}`}).render();S(M);let E=()=>{M.querySelector('form input[name="im_im"]')?.focus()};M.addEventListener("click",E),E(),H=M.querySelector(".ims");let T=getComputedStyle(H);if(H.style.width=T.width,H.style.height=T.height,L&&globalSettings.soundIM)P.play("receive");return H}function Kh(h,$){if(!globalSettings.canIM){alert("You do not have permission to use this feature.");return}D.im(h,$,"",1,Date.now())}function Ih({fromId:h,fromName:$,message:L,fromMe:H,timestamp:u}){H$($,L);let M=u$({fromId:h,fromName:$,message:L});if(!L)return;let E=L.startsWith("/me");if(!H)document.querySelector(`#im_${h}`)?.classList.remove("offline");let T=G(`
    <div class="${E?"action":""} ${H?"you":"them"}" data-timestamp="${u}">
      <a href="/profile/${H||h}" class="name">${E?"***"+$:$}</a>
      ${E?L.substring(3):": "+L}
    </div>
  `);if(M.appendChild(T),S(T),M.scrollTop>M.scrollHeight-M.clientHeight-50)M.scrollTop=M.scrollHeight;if(globalSettings.soundIM)P.play("receive")}function M$(h){let $=h?h.split(","):[],L=$.length===1?"":"s",H=$.length?" and <br>":"";return[$,L,H]}function E$(h){let $=h?h.split(","):[],H=($?$.length:0)===1?"":"s";return[$,H]}class Hh{whichone=0;boundCheckLocation;pids=[];tids=[];modb;constructor(){this.boundCheckLocation=()=>this.checkLocation(),Object.assign(D,{modcontrols_clearbox:this.destroyModControls.bind(this),modcontrols_move:this.showMoveControls.bind(this),modcontrols_postsync:this.postSync.bind(this)})}checkLocation(){let{whichone:h}=this,L=(h?/topic\/(\d+)/:/forum\/(\d+)/).exec(document.location.toString());if(L)this.moveTo(Number(L[1]));else this.showMoveControls(h)}moveTo(h){let{whichone:$}=this;this.renderModControls(`<form method="post" action="/modcontrols" data-ajax-form="true">
                move ${$?"posts":"topics"} here?
            <input type="hidden"
                name="${$?"dop":"dot"}"
                value="moveto">
            <input type="hidden" name="id" value="${h}">
            <input type="submit" value="Yes">
            <input type="submit" name="cancel" value="Cancel" onclick="this.form.submitButton=this">
            </form>`)}renderModControls(h){if(this.modb=this.modb||document.querySelector("#modbox")||void 0,!this.modb)this.modb=document.createElement("div"),this.modb.id="modbox",document.body.appendChild(this.modb);this.modb.style.display="block",this.modb.innerHTML=h,S(this.modb)}destroyModControls(){if(globalThis.removeEventListener("pushstate",this.boundCheckLocation),this.modb)this.modb.innerHTML="",this.modb.style.display="none"}togbutton(h){h.classList.toggle("selected")}postSync(h,$){let[L,H,u]=M$(h),[M,E]=E$($);if(this.tids=M,this.pids=L,!M.length&&!L.length){this.destroyModControls();return}let T=M.length?`
            <select name="dot">
                <option value="delete">Delete</option>
                <option value="merge">Merge</option>
                <option value="move">Move</option>
                <option value="pin">Pin</option>
                <option value="unpin">Unpin</option>
                <option value="lock">Lock</option>
                <option value="unlock">Unlock</option>
            </select> &nbsp; &nbsp;
            <strong>${M.length}</strong> topic${E}${u}`:"",f=L.length?`
            <select name="dop">
                <option value="delete">Delete</option>
                <option value="move">Move</option>
            </select> &nbsp; &nbsp;
            <strong>${L.length}</strong> post${H}`:"",F=L.length&&M.length?"<br>":" &nbsp; &nbsp; ",A=`
        <form method="post" action="/modcontrols" data-ajax-form="true">
            ${T}
            ${f}
            ${F}
            <input type="submit" value="Go">
            <input
                name="cancel" type="submit"
                onclick="this.form.submitButton=this;" value="Cancel">
        </form>`;this.renderModControls(A)}showMoveControls(h){this.whichone=h,globalThis.addEventListener("pushstate",this.boundCheckLocation),this.renderModControls(`Ok, now browse to the ${this.whichone?"topic":"forum"} you want to move the ${this.whichone?`${this.pids.length} posts`:`${this.tids.length} topics`} to...`)}}function T$(){new _({title:"Keyboard Shortcuts",id:"shortcuts",content:`
      <style>
        #shortcuts { width: 300px; }
        #shortcuts dt { float: left;margin-left: 5px;}
      </style>
      <h3>Navigation</h3>
      <dl>
        <dt>?</dt><dd>This help window</dd>
        <dt>h</dt><dd>Home / Board Index</dd>
        <dt>i</dt><dd>Inbox</dd>
        <dt>s</dt><dd>Settings</dd>
        `+(globalSettings.isAdmin?"<dt>a</dt><dd>Admin CP</dd>":"")+(globalSettings.isMod?"<dt>m</dt><dd>Moderator CP</dd>":"")+`</dl>

      <h3>Inbox</h3>
      <dl>
        <dt>c</dt><dd>Compose</dd>
        <dt>i</dt><dd>Inbox</dd>
        <dt>f</dt><dd>Flagged Messages</dd>
        <dt>r</dt><dd>Reply to Message</dd>
      </dl>

      <h3>Forum/Topic</h3>
      <dl>
        <dt>t</dt><dd>New Topic</dd>
        <dt>r</dt><dd>Reply</dd>
      </dl>
      `}).render()}function ih(h){if(h.target instanceof HTMLInputElement||h.target instanceof HTMLTextAreaElement||h.target instanceof HTMLSelectElement)return;if(h.key==="?"){T$();return}document.documentElement.querySelector(`[data-shortcut="${h.key}"]`)?.click()}var f$=5000;class uh{commands;lastURL;timeout;constructor(){this.lastURL=`${document.location.pathname}${document.location.search}`,this.commands=D}handleRequestData(h,$,L=1){let H=!1;if($.forEach(([u,...M])=>{if(u==="preventNavigation")H=!0;else if(u in this.commands)this.commands[u].apply(null,M)}),L>=2){if(!H)globalThis.history.pushState({lastURL:h},"",h),globalThis.dispatchEvent(new Event("pushstate")),this.lastURL=h}this.pollData()}location(h,$=2){this.load(h,{requestType:$})}async load(h,{body:$,method:L="POST",requestType:H=1}={}){try{let u=await fetch(h,{method:L,body:$,headers:{"X-JSACCESS":`${H}`,"Content-Type":"application/x-www-form-urlencoded"}});if(u.ok){let M=await u.json();this.handleRequestData(h,M,H);return}N.error("An unrecoverable error has occurred.<br>Please try again later.")}catch(u){if(!navigator.onLine)N.error("You appear to be offline.");else N.error("Network fetch failed: timeout")}}pollData(h=!1){if(h)this.load(this.lastURL);if(clearTimeout(this.timeout),document.cookie.includes(`actw=${window.name}`))this.timeout=setTimeout(()=>this.load(this.lastURL),f$)}updatePage(h){if(h!==this.lastURL)this.location(h,3)}}var b$=2;class th{stream=new uh;onAppReady(){if(b$)S(document.body);let h=new Date;if(h.getMonth()===11&&[23,24,25].includes(h.getDate()))V();p(),setInterval(p,30000),this.stream.pollData(),globalThis.addEventListener("popstate",({state:L})=>{if(L){let{lastURL:H}=L;this.stream.updatePage(H)}else this.stream.updatePage(document.location.toString())}),P.load("blip"),P.load("receive")}handleQuoting(h){let $=new URLSearchParams(h.search),L=$.get("quote");if(L){let H=document.querySelector(`#pid_${L} .post_content`),u=window.getSelection();if(H&&u&&H.contains(u.anchorNode)&&H.contains(u.focusNode))$.set("quotedText",u.toString())}$.set("qreply",document.querySelector("#qreply")?"1":"0"),this.stream.load(`${h.pathname}?${$.toString()}`)}setWindowActive(){document.cookie=`actw=${window.name}; SameSite:Lax`,Sh(),this.stream.pollData()}}var Mh=new th;r(()=>{Mh.onAppReady()});r(()=>{window.name=`${Math.random()}`,Mh.setWindowActive(),globalThis.addEventListener("focus",()=>{Mh.setWindowActive()})});r(function(){if(!Uh())document.documentElement.classList.add("no-emoji");document.documentElement.classList.add("js-enabled")});r(()=>{globalThis.addEventListener("keyup",ih)});var kh=Mh;Object.assign(globalThis,{RUN:kh,IMWindow:Kh,ModControls:new Hh});

var I=new Map;class b{element;constructor(h){this.element=h}}function q(h,L,$){if(!I.has(h))I.set(h,new WeakMap);L.forEach(function(H){if(I.get(h)?.has(H))return;I.get(h)?.set(H,new $(H))})}function Ch(h){let L=h.getHours()||12,$=`${h.getMinutes()}`.padStart(2,"0");return`${L%12||12}:${$}${L>12?"pm":"am"}`}function J(h){return new Date(h*1000)}var Kh=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],Gh=["January","February","March","April","May","June","July","August","September","October","November","December"];function kh(h){return h[0].toUpperCase()+h.slice(1)}function g(h){let L=new Date,$=new Intl.RelativeTimeFormat(void 0,{numeric:"auto",style:"long"}),u=new Date;u.setTime(+u-86400000),u.setHours(0),u.setMinutes(0),u.setSeconds(0);let H=J(h),M=Math.round((+H-+L)/1000);if(M>-60)return $.format(M,"second");if(M>-3600)return $.format(Math.round(M/60),"minute");if(H>u){let E=new Date;return E.setHours(0),E.setMinutes(0),E.setSeconds(0),`${kh($.format(H>E?0:-1,"day"))} @ ${Ch(H)}`}return Intl.DateTimeFormat(void 0,{month:"short",year:"numeric",day:"numeric",hour:"numeric",hour12:!0,minute:"numeric"}).format(H)}function Th(h){let L=J(h),$=L.getHours(),u=$>=12?"pm":"am";$%=12,$=$||12;let H=`${L.getMinutes()}`.padStart(2,"0"),M=L.getMonth()+1,E=`${L.getDate()}`.padStart(2,"0"),T=L.getFullYear();return`${$}:${H}${u}, ${M}/${E}/${T}`}function fh(h){let L=J(h);return String.fromCodePoint(55357,56656+((L.getHours()%12||12)-1)+(L.getMinutes()>29?12:0))}function bh(h){let L=Array.from(h.classList).find(($)=>$.startsWith("lastAction"));if(L===void 0)return;h.prepend(fh(Number.parseInt(L.slice(10),10))),h.classList.remove(L)}class X extends b{static hydrate(h){h.querySelectorAll(".idle").forEach((L)=>bh(L))}}function vh(h=200){let L=document.querySelector("#snow");if(L===null){L=document.createElement("div"),L.id="snow",Object.assign(L.style,{position:"fixed",top:0,left:0,zIndex:1});let $=document.createElement("style");$.appendChild(document.createTextNode(`
            .snowflake {
                position: absolute;
                width: 10px;
                height: 10px;
                background: linear-gradient(white, white);
                /* Workaround for Chromium's selective color inversion */
                border-radius: 50%;
                filter: drop-shadow(0 0 10px white);
            }`)),document.body.prepend($),document.body.prepend(L)}L.innerHTML="";for(let $=1;$<=h;$+=1){let u=document.createElement("div");u.className="snowflake",L.appendChild(u)}}function wh(){let h=document.getElementById("snow-css");if(h)return h;return h=document.createElement("style"),h.id="snow-css",document.head.appendChild(h),h}function dh(h){let L=wh();L.innerHTML=h,document.head.appendChild(L)}function sh(h=100){return Math.floor(Math.random()*h)+1}function lh(h,L){let $=Math.ceil(h),u=Math.floor(L);return Math.floor(Math.random()*(u-$+1))+$}function oh(h,L){return Math.random()*(L-h)+h}function ah(h=200){let $=100*document.body.offsetHeight/window.innerHeight,u="snowflake",H="";for(let M=1;M<=h;M+=1){let E=Math.random()*100,T=Math.random()*10,f=E+T,x=E+T/2,B=oh(0.3,0.8),S=B*$,F=Math.random(),Eh=lh(10,$/10*3),p=sh($/10*3)*-1,th=Math.random();H+=`
      .snowflake:nth-child(${M}) {
        opacity: ${th};
        transform: translate(${E}vw, -10px) scale(${F});
        animation: fall-${M} ${Eh}s ${p}s linear infinite;
      }
      @keyframes fall-${M} {
        ${B*100}% {
          transform: translate(${f}vw, ${S}vh) scale(${F});
        }
        to {
          transform: translate(${x}vw, ${$}vh) scale(${F});
        }
      }
    `}dh(H)}function D(h=200){ah(h),vh(h)}async function Q(h,L,$=600,u="linear"){return new Promise((H)=>{h.animate(L,{duration:$,easing:u}).addEventListener("finish",()=>{Object.assign(h.style,L.at(-1)),H(h)},{once:!0})})}function qh(h){return Q(h,[{backgroundColor:"#FF0"},{backgroundColor:""}],1000)}function N(h){let L=document.createElement("div");return L.innerHTML=h,L.firstElementChild}function V(h){return[h?.closest("tr")?.rowIndex??0,h?.cellIndex??0]}function c(h){return globalThis.getComputedStyle(h)}function K(h){let{x:L,y:$,height:u,width:H}=h.getBoundingClientRect(),M=L+globalThis.scrollX,E=$+globalThis.scrollY;return{x:M,y:E,yh:E+u,xw:M+H,w:H,h:u}}function j(){return Array.from(document.querySelectorAll("*")).reduce(($,u)=>{if(u.style.zIndex&&Number(u.style.zIndex)>$)return Number(u.style.zIndex);return $},0)+1}var Nh="valid",Qh="invalid";class i extends b{method;outputElement;indicatorElement;static hydrate(h){q("AutoComplete",h.querySelectorAll("input[data-autocomplete-action]"),this)}constructor(h){super(h);h.autocomplete="off",this.method=h.dataset.autocompleteAction;let L=h.dataset.autocompleteOutput,$=h.dataset.autocompleteIndicator,u=L?document.querySelector(L):void 0;if(!u)throw Error("Expected element to have data-autocomplete-output");this.outputElement=u||document.createElement("input"),this.indicatorElement=$?document.querySelector($):void 0,h.addEventListener("keyup",(H)=>this.keyUp(H)),h.addEventListener("keydown",(H)=>{if(H.key==="Enter")H.preventDefault()})}getResultsContainer(){let h=K(this.element),L=document.querySelector("#autocomplete");if(!L)L=Object.assign(document.createElement("div"),{id:"autocomplete"}),Object.assign(L.style,{zIndex:j()}),document.body.appendChild(L);return Object.assign(L.style,{top:`${h.yh}px`,left:`${h.x}px`,width:`${h.w}px`}),L}keyUp(h){let L=this.getResultsContainer(),$=Array.from(L.querySelectorAll("div")),u=$.findIndex((H)=>H.classList.contains("selected"));switch(h.key){case"ArrowUp":case"ArrowDown":$.at(u)?.classList.remove("selected"),$.at((u+(h.key==="ArrowDown"?1:-1))%$.length)?.classList.add("selected");return;case"Enter":if(u>=0)$.at(u)?.dispatchEvent(new Event("click"));return;default:if(this.indicatorElement)this.indicatorElement.classList.remove(Nh),this.indicatorElement.classList.add(Qh);if(this.clearResults(),this.element.value)this.doSearch();break}}clearResults(){let h=this.getResultsContainer();h.style.display="none",h.innerHTML=""}async doSearch(){let h=this.getResultsContainer(),L=/ACP/.test(document.location.toString())?"../":"",u=`term=${encodeURIComponent(this.element.value)}`,H=await fetch(`${L}/api/${this.method}?${u}`);if(!H.ok)return;let M=await H.json();if(h.innerHTML="",M.length){h.style.display="";let[E,T]=M;E.forEach((f,x)=>{let B=T[x],S=document.createElement("div");S.innerHTML=B,S.addEventListener("click",()=>{if(h.style.display="none",this.indicatorElement)this.indicatorElement.classList.add(Nh),this.indicatorElement.classList.remove(Qh);this.outputElement.value=`${f}`,this.outputElement.dispatchEvent(new Event("change")),this.element.value=B}),h.appendChild(S)});return}h.style.display="none"}}var{userAgent:W}=navigator;function Y(){return"ontouchstart"in window}var t={chrome:/chrome/i.test(W),ie:/msie/i.test(W),iphone:/iphone/i.test(W),mobile:/mobile/i.test(W),n3ds:/nintendo 3ds/.test(W),firefox:/firefox/i.test(W),safari:/safari/i.test(W)};class _h{sess;boundEvents;droppables;noChild=!1;bounds;onstart;ondragover;ondrag;ondragout;ondrop;autoZIndex=!0;constructor(){this.droppables=[],this.sess={el:document.body,mx:0,my:0,reset:()=>{return}},this.boundEvents={drag:(h)=>this.drag(h),drop:()=>this.drop()}}start(h,L,$){h.preventDefault(),h.stopPropagation();let u=L||h.target,H=c(u),M=j();if(this.noChild&&h.target!==($||u))return;if(u.getAttribute("draggable")==="false")return;if(this.sess={el:u,mx:h instanceof MouseEvent?h.pageX:h.targetTouches[0].pageX,my:h instanceof MouseEvent?h.pageY:h.targetTouches[0].pageY,ex:Number.parseInt(H.left,10)||0,ey:Number.parseInt(H.top,10)||0,info:{el:u,mx:0,my:0,reset:()=>{return}},reset:()=>this.reset(),zIndex:u.style.zIndex},!this.sess.zIndex||Number(this.sess.zIndex)<M-1)u.style.zIndex=`${M}`;this.onstart?.({...this.sess,droptarget:this.testDrops(this.sess.mx,this.sess.my)}),document.addEventListener(Y()?"touchmove":"mousemove",this.boundEvents.drag),document.addEventListener(Y()?"touchend":"mouseup",this.boundEvents.drop),this.drag(h)}drag(h){h.stopPropagation();let L=this.sess.el.style,$=h instanceof MouseEvent?h.pageX:h.targetTouches[0].pageX,u=h instanceof MouseEvent?h.pageY:h.targetTouches[0].pageY,H=$,M=u,E,T=(this.sess.ex??0)+H-this.sess.mx,f=(this.sess.ey??0)+M-this.sess.my,x=this.bounds;if(x){if(T<x[0])H=H-T+x[0],[T]=x;else if(T>x[0]+x[2])T=x[0]+x[2];if(f<x[1])M=M-f+x[1],[f]=x;else if(f>x[1]+x[3])f=x[1]+x[3]}L.left=`${T}px`,L.top=`${f}px`;let B=this.sess.info,S=B?.droptarget,F={...this.sess,left:T,top:f,mx:H,my:M,dx:H-(B?.mx||H),dy:M-(B?.my||M),droptarget:this.testDrops($,u)};if(this.sess.info=F,this.ondrag?.(F),F.droptarget&&S!==F.droptarget)this.ondragover?.(F);if(S&&F.droptarget!==S)E=F.droptarget,F.droptarget=S,this.ondragout?.(F),F.droptarget=E}boundingBox(h,L,$,u){return this.bounds=[h,L,$,u],this}drop(){if(this.boundEvents)document.removeEventListener(Y()?"touchend":"mouseup",this.boundEvents.drop),document.removeEventListener(Y()?"touchmove":"mousemove",this.boundEvents.drag);if(this.ondrop?.(this.sess.info??{}),this.autoZIndex)this.sess.el.style.zIndex=this.sess.zIndex??"";return!0}testDrops(h,L){let{droppables:$}=this,u,H=[9999,9999];if(!$.length)return;return $.findLast((M)=>{if(M===this.sess.el||this.sess.el.contains(M))return;if(u=K(M),H[0]>u.w&&H[1]>u.h&&h>=u.x&&L>=u.y&&h<=u.xw&&L<=u.yh)return H=[u.w,u.h],M;return})}drops(h){return this.droppables=h,this}addDrops(h){if(!this.droppables)return this.drops(h);return this.droppables=this.droppables.concat(h),this}addListener(h){return Object.assign(this,h),this}apply(h,L){if(Array.isArray(h))return h.forEach((H)=>this.apply(H)),this;let u=c(h)?.position;if(!u||u==="static")h.style.position="relative";return(L||h).addEventListener(Y()?"touchstart":"mousedown",L?(H)=>this.start(H,h,L):(H)=>this.start(H,h)),this}autoZ(){return this.autoZIndex=!1,this}noChildActivation(){return this.noChild=!0,this}reset(h=this.sess.el){return h.style.top="0",h.style.left="0",this}}var z=_h;var xh="50px";class ch{success(h){this.showToast(h,"success",3000)}error(h){this.showToast(h,"error")}async showToast(h,L,$=0){let u=document.createElement("div"),H=async()=>{await Q(u,[{top:xh},{top:`-${xh}`}]),u.remove()};u.classList.add(L),Object.assign(u.style,{position:"fixed",left:"50%",transform:"translateX(-50%)",boxShadow:"black 5px 5px 10px",zIndex:j()}),u.addEventListener("click",H,{once:!0}),u.innerHTML=h;let M=document.createElement("a");if(M.href="javascript:void(0)",M.innerHTML=" [X]",M.title="close notification",M.addEventListener("click",H,{once:!0}),u.append(M),document.body.appendChild(u),await Q(u,[{top:"0"},{top:xh}],600,"ease-in-out"),$)await new Promise((E)=>setTimeout(E,$)),H()}}var G=new ch;class Wh{soundCache={};getFilePath(h){return`/Sounds/${h}.mp3`}load(h,L=!1){let $=this.soundCache[h];if($){if(L)this.play(h);return}$=new Audio,this.soundCache[h]=$,$.autoplay=!!L,$.src=this.getFilePath(h)}loadAndPlay(h){this.load(h,!0)}play(h){this.soundCache[h].play()}}var P=new Wh;class C extends b{static hydrate(h){q("Checkers",h.querySelectorAll(".checkers"),this)}constructor(h){super(h);P.load("chessdrop");let L=new z;L.addListener({ondrop:($)=>{if($.reset(),!$.droptarget)return;let{droptarget:u,el:H}=$,M=V(H.closest("td")),E=V(u);if(!this.isValidMove(M,E))return;if([1,8].includes(E[0]))this.promote(H);this.getCapturedPiece(M,E)?.remove(),u.append(H),P.play("chessdrop"),this.moveNumber++,navigator.clipboard.writeText("[checkers]"+this.gameState+"[/checkers]"),G.success("BBCode copied to clipboard")}}),L.drops(Array.from(h.querySelectorAll("td"))),L.apply(Array.from(h.querySelectorAll(".piece")))}getCapturedPiece(h,L){let $=[L[0]-h[0],L[1]-h[1]];if($.map(Math.abs).join(",")!=="2,2")return;return this.element.rows[h[0]+$[0]/2].cells[h[1]+$[1]/2].querySelector(".piece")??void 0}promote(h){h.dataset.piece=h.dataset.piece?.toUpperCase(),h.innerHTML="♛"}isValidMove(h,L){let $=this.element,u=[L[0]-h[0],L[1]-h[1]].map(Math.abs),H=$.rows[h[0]].cells[h[1]].querySelector(".piece")?.dataset.piece??"",M=this.getCapturedPiece(h,L)?.dataset.piece??"";if(L[0]%2===L[1]%2)return!1;if(u[0]!=u[1])return!1;if(H==="b"&&L[0]<=h[0])return!1;if(H==="r"&&L[0]>=h[0])return!1;if(M.toLowerCase()===H.toLowerCase())return!1;if($.rows[L[0]].cells[L[1]].querySelector(".piece"))return!1;return u[0]===(M?2:1)}get moveNumber(){return Number(this.element.dataset.moveNumber??"1")}set moveNumber(h){this.element.dataset.moveNumber=`${h}`}get gameState(){let h=Array.from(this.element.querySelectorAll("td")),L=[];for(let $=0;$<8;$++){L.push([]);for(let u=0;u<4;u++){let H=$%2?0:1;L[$].push(h[$*8+u*2+H].querySelector(".piece")?.dataset.piece||" ")}}return L.map(($)=>$.join("")).join("/").replaceAll(/ +/g,($)=>`${$.length}`)+` ${this.moveNumber}`}}var mh={R:"♜",N:"♞",B:"♝",Q:"♛",K:"♚",P:"♟",r:"♜",n:"♞",b:"♝",q:"♛",k:"♚",p:"♟"};class k extends b{static hydrate(h){q("Chess",h.querySelectorAll(".chess"),this)}constructor(h){super(h);P.load("chessdrop");let L=new z;L.addListener({ondrop:($)=>{if($.reset(),!$.droptarget)return;let u=$.el,H=u.dataset.piece,M=$.droptarget.querySelector(".piece"),E=M?.dataset.piece?.trim()??"",T=V(u.closest("td")),f=V($.droptarget);if(!this.isValidMove(H,E,T,f))return;if(H?.toLowerCase()==="p"&&[1,8].includes(f[0]))this.promotePawn(u);M?.remove(),$.droptarget.append(u),P.play("chessdrop"),this.moveNumber++,navigator.clipboard.writeText("[chess]"+this.getFENNotation()+"[/chess]"),G.success("BBCode copied to clipboard")}}),L.drops(Array.from(h.querySelectorAll("td"))),L.apply(Array.from(h.querySelectorAll(".piece")))}get moveNumber(){return Number(this.element.dataset.moveNumber??"1")}set moveNumber(h){this.element.dataset.moveNumber=`${h}`}didJumpAPiece(h,L){let $=[L[0]-h[0],L[1]-h[1]],u=$.map(Math.sign),H=Math.max(...$.map(Math.abs));for(let M=1;M<H;M++)if(this.element.rows[h[0]+u[0]*M].cells[h[1]+u[1]*M].querySelector(".piece"))return!0;return!1}isValidMove(h="",L="",$,u){let M=[$[0]-u[0],$[1]-u[1]].map(Math.abs),E=Math.min(...M)===0,T=M[0]===M[1];if(L!==""&&h.toLowerCase()===h===(L.toLowerCase()===L))return!1;switch(h){case"p":return $[0]<u[0]&&Math.max(...M)<=($[0]===2?2:1)&&(L?T:E);case"P":return $[0]>u[0]&&Math.max(...M)<=($[0]===7?2:1)&&(L?T:E);case"r":case"R":return E&&!this.didJumpAPiece($,u);case"b":case"B":return T&&!this.didJumpAPiece($,u);case"n":case"N":return M.toSorted((f,x)=>f-x).join(",")==="1,2";case"q":case"Q":return(E||T)&&!this.didJumpAPiece($,u);case"k":case"K":return Math.max(...M)<=2&&(T||E)}return!0}promotePawn(h){while(!0){let L=(prompt("Congrats on your promotion, sir pawn! What rank would you like? (q: Queen, r: Rook, b: Bishop, n: Knight)","q")??"").toLowerCase();if(["q","r","b","n"].includes(L)){L=h.dataset.piece==="p"?L.toLowerCase():L.toUpperCase(),h.dataset.piece=L,h.innerHTML=mh[L],P.loadAndPlay("zelda-item-get");break}}}getFENNotation(){return Array.from(this.element.querySelectorAll("td")).map((L,$)=>($&&$%8===0?"/":"")+(L.querySelector(".piece")?.dataset.piece||" ")).join("").replaceAll(/ +/g,(L)=>`${L.length}`)+` ${this.moveNumber}`}}function zh(h){if(!globalThis.getSelection)return;let L=document.createRange();L.selectNode(h);let $=globalThis.getSelection();if(!$)return;if($.rangeCount)$.removeAllRanges();$.addRange(L)}function Rh(h,L){let $=h.scrollTop,u=h.selectionStart??0,H=h.selectionEnd??0;h.value=h.value.substring(0,u)+L+h.value.slice(H),h.selectionStart=u+L.length,h.selectionEnd=u+L.length,h.focus(),h.scrollTop=$}class v extends b{static hydrate(h){q("CodeBlock",h.querySelectorAll(".bbcode.code"),this)}constructor(h){super(h);h.addEventListener("click",()=>zh(h))}}class w extends b{fullHeight=0;animationLengthInMs=200;static hydrate(h){q("CollapseBox",h.querySelectorAll(".collapse-box"),this)}constructor(h){super(h);let{collapseContent:L}=this;if(L)Object.assign(L.style,{transition:`height ${this.animationLengthInMs}ms ease-in-out`});this.toggle(),this.element.addEventListener("click",($)=>{if($.target instanceof HTMLElement&&$.target.matches(".collapse-button"))this.isOpen=!this.isOpen,this.toggle()})}get boxID(){return this.element.getAttribute("id")||""}get collapseContent(){return this.element.querySelector(".collapse-content")}get isOpen(){return!(globalThis.sessionStorage.getItem("collapsed")??"").split(",").includes(this.boxID)}set isOpen(h){let L=(globalThis.sessionStorage.getItem("collapsed")??"").split(",").filter(Boolean);if(h)L=L.filter(($)=>$!==this.boxID);else L.push(this.boxID);globalThis.sessionStorage.setItem("collapsed",L.join(",")??"")}toggle(){let{collapseContent:h}=this;if(!h)return;let{style:L}=h;if(this.isOpen){if(!this.fullHeight)return;L.height=`${this.fullHeight}px`,this.element.classList.remove("collapsed"),setTimeout(()=>{L.removeProperty("height"),L.removeProperty("overflow")},this.animationLengthInMs)}else this.fullHeight=h.clientHeight||h.offsetHeight,L.height=`${this.fullHeight}px`,L.overflow="hidden",this.element.classList.add("collapsed"),requestAnimationFrame(()=>{L.height="0px"})}}function Z(h,L=1000){return new Promise(($)=>{let u=new Set,H=Array.from(h).filter((E)=>!E.complete);if(!H.length){$();return}function M(){if(u.delete(this.src),u.size===0)$()}if(H.forEach((E)=>{if(!u.has(E.src))u.add(E.src),E.addEventListener("error",M),E.addEventListener("load",M)}),L)setTimeout($,L)})}function O(){let h=document.querySelectorAll(".autodate"),L=Array.from(document.querySelectorAll("[data-timestamp]"));if(!h)return;h.forEach(($)=>{let u=Number.parseInt($.getAttribute("title")??"",10),H=$.classList.contains("smalldate")?Th(u):g(u);if(H!==$.innerHTML)$.innerHTML=H}),L.forEach(($)=>{if(!$.title)$.title=Th(Number.parseInt($.dataset.timestamp??"",10))})}function r(h){if(document.readyState==="complete")h();else document.addEventListener("DOMContentLoaded",h)}function Vh(){let h=document.createElement("input");return h.setAttribute("type","date"),h.type==="date"}function Yh(){let h=[String.fromCodePoint(9757,127999),String.fromCodePoint(9757)].map((L)=>{let $=document.body.appendChild(document.createElement("span"));$.appendChild(document.createTextNode(L));let u=$.offsetWidth;return $.remove(),u});return h[0]===h[1]}class d extends b{picker;selectedDate;lastDate;static hydrate(h){if(Vh())return;q("DatePicker",h.querySelectorAll("input[type=date]"),this)}constructor(h){super(h);this.picker=this.getPicker(),h.autocomplete="off",h.addEventListener("focus",()=>this.openPicker()),h.addEventListener("keydown",()=>this.closePicker())}getPicker(){if(this.picker)return this.picker;let h=document.querySelector("#datepicker");if(!h)h=Object.assign(document.createElement("table"),{id:"datepicker"}),document.body.appendChild(h),h.style.display="none";return h}openPicker(){let h=K(this.element);Object.assign(this.picker.style,{display:"",zIndex:j(),position:"absolute",top:`${h.yh}px`,left:`${h.x}px`});let[L,$,u]=this.element.value.split("/").map((H)=>Number.parseInt(H,10));if(L&&$&&u)this.selectedDate=[u,L-1,$];else this.selectedDate=void 0;this.generate(u,L,$)}closePicker(){this.picker.style.display="none"}generate(h,L,$){let u=new Date,H=this.getPicker(),M,E,[T,f,x]=[h,L,$];if(T===void 0)T=u.getFullYear(),f=u.getMonth(),x=u.getDate(),this.selectedDate=[T,f,x];if(f===-1)T-=1,f=11;if(f===12)T+=1,f=0;this.lastDate=[T,f,x];let B=new Date(T,f+1,0).getDate(),S=new Date(T,f,1).getDay();H.innerHTML="",M=H.insertRow(0),E=M.insertCell(0),E.innerHTML="&lt;",E.className="control",E.addEventListener("click",()=>this.lastYear()),E=M.insertCell(1),E.colSpan=5,E.className="year",E.innerHTML=`${T}`,E=M.insertCell(2),E.innerHTML=">",E.className="control",E.addEventListener("click",()=>this.nextYear()),M=H.insertRow(1),E=M.insertCell(0),E.innerHTML="<",E.className="control",E.addEventListener("click",()=>this.lastMonth()),E=M.insertCell(1),E.colSpan=5,E.innerHTML=Gh[f],E.className="month",E=M.insertCell(2),E.innerHTML=">",E.className="control",E.addEventListener("click",()=>this.nextMonth()),M=H.insertRow(2),M.className="weekdays";for(let F=0;F<7;F+=1)M.insertCell(F).innerHTML=Kh[F];M=H.insertRow(3);for(let F=0;F<B;F+=1){if(!F)for(let p=0;p<S;p+=1)M.insertCell(p);if((S+F)%7===0)M=H.insertRow(H.rows.length);E=M.insertCell((S+F)%7),E.addEventListener("click",this.insert.bind(this,E));let Eh=!!this.selectedDate&&T===this.selectedDate[0]&&f===this.selectedDate[1]&&F+1===this.selectedDate[2];E.className=`day${Eh?" selected":""}`,E.innerHTML=`${F+1}`}}lastYear(){let h=this.lastDate;if(h)this.generate(h[0]-1,h[1],h[2])}nextYear(){let h=this.lastDate;if(h)this.generate(h[0]+1,h[1],h[2])}lastMonth(){let h=this.lastDate;if(h)this.generate(h[0],h[1]-1,h[2])}nextMonth(){let h=this.lastDate;if(h)this.generate(h[0],h[1]+1,h[2])}insert(h){let L=this.lastDate;if(L)this.element.value=`${L[1]+1}/${h.innerHTML}/${L[0]}`;this.closePicker()}}class Zh{rgb;constructor(h){let L=/^rgb\((\d+),\s?(\d+),\s?(\d+)\)/i.exec(h),$=/#?([\da-fA-F]+)/.exec(h);if(L){this.rgb=[Number.parseFloat(L[1]),Number.parseFloat(L[2]),Number.parseFloat(L[3])];return}if($){let u=$[1];if(u.length===3)u=u.charAt(0)+u.charAt(0)+u.charAt(1)+u.charAt(1)+u.charAt(2)+u.charAt(2);if(u.length!==6){this.rgb=[0,0,0];return}this.rgb=[];for(let H=0;H<3;H+=1)this.rgb[H]=Number.parseInt(u.slice(H*2,(H+1)*2),16)}}invert(){if(this.rgb)this.rgb=[255-this.rgb[0],255-this.rgb[1],255-this.rgb[2]];return this}toRGB(){return this.rgb}toHex(){return"#"+this.rgb?.map((h)=>h.toString(16).padStart(2,"0")).join("")}}var Fh=Zh;var Uh={a:(h,L)=>`[url=${L?.getAttribute("href")}]${h}[/url]`,b(...h){return this.strong(...h)},br:()=>`
`,div:(h)=>`
${h}`,em:(h)=>`[i]${h}[/i]`,font:(h,L)=>{let $=L.style.fontFamily||L.getAttribute("face");return $?`[font=${$}]${h}[/font]`:h},h1:(h)=>`[h1]${h}[/h1]`,h2:(h)=>`[h2]${h}[/h2]`,h3:(h)=>`[h3]${h}[/h3]`,h4:(h)=>`[h4]${h}[/h4]`,h5:(h)=>`[h5]${h}[/h5]`,h6:(h)=>`[h6]${h}[/h6]`,hr:()=>`
`,i(...h){return this.em(...h)},img:(h,L)=>{let $=L.getAttribute("alt")??"",u=L.getAttribute("src");if(L.dataset.emoji)return` ${L.dataset.emoji}`;if(u)return`[img]${u}[/img]`;return $},li:(h)=>`* ${h.replace(/[\n\r]+/,"")}
`,meta:()=>`
`,ol:(h)=>`[ol]${h}[/ol]`,p:(h)=>`
${h==="&nbsp"?"":h}
`,strike:(h)=>`[s]${h}[/s]`,strong:(h)=>`[b]${h}[/b]`,u:(h)=>`[u]${h}[/u]`,ul:(h)=>`[ul]${h}[/ul]`},s={"background-color":(h,L)=>{let $=h&&new Fh(h).toHex(),u=$?`${$}`:h;if(["ffffff","white","transparent"].includes(u))return L;return`[bgcolor=${u}]${L}[/bgcolor]`},color(h,L){let $=h&&new Fh(h).toHex();return`[color=${$?`${$}`:h}]${L}[/color]`},"font-family":(h,L)=>`[font=${h.replaceAll(/['"]/g,"")}]${L}[/font]`,"font-style":(h,L)=>`[i]${L}[/i]`,"font-size":(h,L)=>`[size=${h}]${L}[/size]`,"font-weight":(h,L)=>`[b]${L}[/b]`,"text-align":(h,L)=>`[align=${h}]${L}[/align]`,"text-decoration":function(L,$){return L==="line-through"?`[strike]${$}[/strike]`:`[u]${$}[/u]`}};function nh(h){return h.replaceAll(/[\r\n]+/g,"").replaceAll("&amp;","&").replaceAll("&gt;",">").replaceAll("&lt;","<").replaceAll("&nbsp;"," ")}function Ph(h){let L=h.tagName.toLowerCase(),$="";for(let M of h.childNodes)$+=M.nodeType===Node.ELEMENT_NODE?Ph(M):nh(M.textContent??"");if(L==="body")return $;if(h.style){for(let M of h.style)if(M in s)$=s[M](h.style.getPropertyValue(M),$)}let u=h.getAttribute("size");if(u)$=s.fontSize(u,$);let H=h.getAttribute("color");if(H)$=s.color(H,$);if(L in Uh)$=Uh[L]($,h);return $}function Sh(h){return h.replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll(/(\s) /g,"$1&nbsp;").replaceAll(/\[b\]([^]*?)\[\/b\]/gi,"<b>$1</b>").replaceAll(/\[i\]([^]*?)\[\/i\]/gi,"<i>$1</i>").replaceAll(/\[u\]([^]*?)\[\/u\]/gi,"<u>$1</u>").replaceAll(/\[s\]([^]*?)\[\/s\]/gi,"<s>$1</s>").replaceAll(/\[img\]([^'"[]+)\[\/img\]/gi,'<img src="$1">').replaceAll(/\[color=([^\]]+)\]([^]*?)\[\/color\]/gi,'<span style="color:$1">$2</span>').replaceAll(/\[size=([^\]]+)\]([^]*?)\[\/size\]/gi,'<span style="font-size:$1">$2</span>').replaceAll(/\[font=['"]?([^\]]+?)['"]?\]([^]*?)\[\/font\]/gi,'<span style="font-family:$1">$2</span>').replaceAll(/\[url=([^\]]+)\]([^]*?)\[\/url\]/gi,'<a href="$1">$2</a>').replaceAll(/\[bgcolor=([^\]]+)\]([^]*?)\[\/bgcolor\]/gi,'<span style="background-color:$1">$2</span>').replaceAll(/\[h(\d)\]([^]*?)\[\/h\1\]/g,"<h$1>$2</h$1>").replaceAll(/\[align=(left|right|center)\]([^]*?)\[\/align\]/g,'<div style="text-align:$1">$2</div>').replaceAll(/\[(ul|ol)\]([^]*?)\[\/\1\]/gi,(L,$,u)=>{let M=u.split(/(^|[\r\n]+)\* ?/).filter((E)=>E.trim()).map((E)=>`<li>${E}</li>`).join("");return`<${$}>${M}</${$}>`}).replaceAll(`
`,"<br>")}var eh=/^(ht|f)tps?:\/\/[\w.\-%&?=/]+$/,h$=(h)=>eh.test(h),ph={"Sans Serif":["Arial","Arial Black","Arial Narrow","Arial Rounded MT Bold","Avant Garde","Calibri","Candara","Century Gothic","Comic Sans MS","Franklin Gothic Medium","Futura","Geneva","Gill Sans","Helvetica","Impact","Lucida Grande","Optima","Segoe UI","Tahoma","Trebuchet MS","Verdana"],Serif:["Big Caslon","Bodoni MT","Book Antiqua","Calisto MT","Cambria","Didot","Garamond","Georgia","Goudy Old Style","Hoefler Text","Lucida Bright","Palatino","Perpetua","Rockwell","Rockwell Extra Bold","Baskerville","Times New Roman"],Monospaced:["Consolas","Courier New","Lucida Console","Lucida Sans Typewriter","Monaco","Andale Mono"],Fantasy:["Copperplate","Papyrus"],Script:["Brush Script MT"]};class l extends b{iframe;colorWindow;container;htmlMode=!0;editbar;emoteWindow;static hydrate(h){q("Editor",h.querySelectorAll("textarea.bbcode-editor"),this)}constructor(h){super(h);this.container=Object.assign(document.createElement("div"),{className:"editor"}),this.iframe=document.createElement("iframe"),this.iframe.style.display="none",this.iframe.addEventListener("load",()=>this.iframeLoaded(),{once:!0}),h.before(this.container),this.container.appendChild(h),this.container.appendChild(this.iframe)}get doc(){return this.window?.document}get window(){return this.iframe.contentWindow}iframeLoaded(){let{iframe:h,element:L}=this;if(h.className="editorframe",this.htmlMode=globalSettings.wysiwyg,L.addEventListener("input",()=>{this.setSource(Sh(L.value))}),this.doc?.addEventListener("input",()=>{if(!this.doc)return;this.element.value=Ph(this.doc.body)}),this.doc?.addEventListener("paste",(H)=>{H.preventDefault();let M=H.clipboardData?.getData("text/plain");this.doc?.execCommand("insertText",!1,M)}),this.doc?.addEventListener("drop",(H)=>{if(!H.dataTransfer?.files.length)return;this.upload(H.dataTransfer.files[0])}),this.doc?.addEventListener("dragleave",()=>{this.getAttachmentStatus().remove()}),this.doc?.addEventListener("dragover",()=>{this.getAttachmentStatus()}),!this.doc)return;let $=c(L),u=this.doc.getElementsByTagName("body")[0];if(u&&$)u.style.backgroundColor=$.backgroundColor,u.style.color=$.color,u.style.borderColor="#FFF";this.doc.designMode="on",this.editbar=this.buildEditBar(),h.style.height=`${L.clientHeight}px`,L.before(this.editbar),this.setSource("<div></div>"),setTimeout(()=>{if(this.setSource(Sh(L.value)),this.switchMode(this.htmlMode),L.hasAttribute("autofocus"))this.window?.focus()},100)}getAttachmentStatus(){let h=this.doc?.querySelector("#attachmentStatus");if(h)return h;return h=document.createElement("div"),Object.assign(h,{id:"attachmentStatus",innerHTML:"Drop file here",contentEditable:"false"}),Object.assign(h.style,{position:"fixed",padding:"20px",top:"50%",left:"50%",translate:"-50% -50%",border:"2px dashed #ccc"}),this.doc?.body.appendChild(h),h}upload(h){let L=new FormData;L.append("Filedata",h);let $=new XMLHttpRequest;this.getAttachmentStatus().innerHTML='Uploading: <progress id="attachmentProgress"></div>';let u=this.getAttachmentStatus().querySelector("#attachmentProgress");$.upload.addEventListener("progress",(H)=>{if(u&&H.lengthComputable){let M=Math.round(H.loaded/H.total*100);u.value=H.loaded,u.max=H.total,u.textContent=`${M}%`}}),$.addEventListener("load",()=>{this.window?.focus(),this.getAttachmentStatus().remove();let H=$.responseText;if(/\D/.test(H)){alert("Error: "+H);return}this.cmd("inserthtml",`[attachment]${$.responseText}[/attachment]`)}),$.upload.addEventListener("error",()=>{this.getAttachmentStatus().remove()}),$.open("POST","/api/upload",!0),$.send(L)}buildEditBar(){let h=document.createElement("div");h.className="editbar",h.innerHTML=[`<select class="fontface">
        <option value="">Default Font</option>
        <optgroup label="Headings">
          <option value="heading_1" style="font-weight:bold;font-size: 2em">Heading 1</option>
          <option value="heading_2" style="font-weight:bold;font-size: 1.5em">Heading 2</option>
          <option value="heading_3" style="font-weight:bold;font-size: 1.17em">Heading 3</option>
          <option value="heading_4" style="font-weight:bold;font-size: 1em">Heading 4</option>
          <option value="heading_5" style="font-weight:bold;font-size: 0.83em">Heading 5</option>
          <option value="heading_6" style="font-weight:bold;font-size: 0.67em">Heading 6</option>
        </optgroup>
      </select>`,'<a class="bold" title="Bold"></a>','<a class="italic" title="Italic"></a>','<a class="underline" title="Underline"></a>','<a class="strikethrough" title="Strike-Through"></a>','<a class="forecolor" title="Foreground Color"></a>','<a class="backcolor" title="Background Color"></a>','<a class="insertimage" title="Insert Image"></a>','<a class="createlink" title="Insert Link"></a>','<a class="c_email" title="Insert Email"></a>','<a class="justifyleft" title="Align Left"></a>','<a class="justifycenter" title="Center"></a>','<a class="justifyright" title="Align Right"></a>','<a class="c_youtube" title="Insert video from any of your favorite video services!"></a>','<a class="c_code" title="Insert code"></a>','<a class="c_quote" title="Insert Quote"></a>','<a class="c_spoiler" title="Insert Spoiler"></a>','<a class="insertorderedlist" title="Create Ordered List"></a>','<a class="insertunorderedlist" title="Create Unordered List"></a>','<a class="c_smileys" title="Insert Emoticon"></a>','<a class="c_switcheditmode" title="Switch editor mode"></a>'].join(""),h.addEventListener("click",($)=>{if($.target instanceof HTMLElement&&$.target.matches(".editbar a"))this.editbarCommand($,$.target.className)});let L=h.querySelector("select.fontface");if(L){L.addEventListener("input",($)=>{let u=L.value;if(u.startsWith("heading_"))this.editbarCommand($,"heading",u.replace("heading_","h"));else if(u)this.editbarCommand($,"fontname",u)});for(let $ of Object.keys(ph)){let u=ph[$].map((H)=>`<option style="font-family: ${H}">${H}</option>`);L.innerHTML+=`<optgroup label="${$}">${u}</optgroup>`}}return h}editbarCommand(h,L,$){switch(h.preventDefault(),L){case"forecolor":case"backcolor":this.showColors(h.pageX,h.pageY,L);break;case"c_smileys":this.showEmotes(h.pageX,h.pageY);break;case"c_switcheditmode":this.switchMode(!this.htmlMode);break;default:this.cmd(L,$);break}}async showEmotes(h,L){let $=this.emoteWindow;if(!$){let u=await fetch("/api/emotes"),H=await u.json();if(u.ok)this.createEmoteWindow(H,{x:h,y:L});return}if($.style.display==="none")$.style.display="",$.style.left=`${h}px`,$.style.top=`${L}px`;else this.hideEmotes()}hideEmotes(){if(this.emoteWindow)this.emoteWindow.style.display="none"}createEmoteWindow([h,L],$){let u=document.createElement("div");u.className="emotewin",h.forEach((H,M)=>{let E=L[M],T=document.createElement("a");T.href="javascript:void(0)",T.addEventListener("click",()=>{this.cmd("inserthtml",E),this.hideEmotes()}),T.innerHTML=`${E} ${H}`,u.appendChild(T)}),u.style.position="absolute",u.style.display="none",this.emoteWindow=u,document.querySelector("#page")?.appendChild(u),this.showEmotes($.x,$.y)}colorHandler(h,L){this.cmd(h,L),this.hideColors()}showColors(h,L,$){this.hideColors();let H=N(`
      <div>
        ${["#FFFFFF","#AAAAAA","#000000","#FF0000","#00FF00","#0000FF","#FFFF00","#00FFFF","#FF00FF"].map((M)=>`<button style="background-color:${M}" data-color="${M}"></button>`).join("")}
      </div>
    `);return Object.assign(H.style,{display:"grid",gridTemplateColumns:"20px 20px 20px",gridTemplateRows:"20px 20px 20px",position:"absolute",top:`${L}px`,left:`${h}px`,cursor:"pointer",zIndex:j()}),H.addEventListener("click",(M)=>{if(M.target instanceof HTMLButtonElement&&M.target.dataset.color)this.colorHandler($,M.target.dataset.color)}),this.colorWindow=H,document.querySelector("#page")?.appendChild(H),null}hideColors(){if(this.colorWindow)this.colorWindow.remove(),this.colorWindow=void 0}cmd(h,L){let $=this.getSelection(),u="",H=h,M=L;switch(h.toLowerCase()){case"bold":u=`[b]${$}[/b]`;break;case"italic":u=`[i]${$}[/i]`;break;case"underline":u=`[u]${$}[/u]`;break;case"strikethrough":u=`[s]${$}[/s]`;break;case"justifyright":u=`[align=right]${$}[/align]`;break;case"justifycenter":u=`[align=center]${$}[/align]`;break;case"justifyleft":u=`[align=left]${$}[/align]`;break;case"insertimage":if(M=prompt("Image URL:")||"",!M)return;if(!h$(M)){alert("Please enter a valid URL.");return}u=`[img]${M}[/img]`;break;case"insertorderedlist":if(!this.htmlMode)u=`[ol]${$.replaceAll(/(.+([\r\n]+|$))/i,"* $1")}[/ol]`;break;case"insertunorderedlist":if(!this.htmlMode)u=`[ul]${$.replaceAll(/(.+([\r\n]+|$))/i,"* $1")}[/ul]`;break;case"createlink":if(M=prompt("Link:")||"",!M)return;if(!/^(https?|ftp|mailto):/.test(M))M=`https://${M}`;u=`[url=${M}]${$}[/url]`;break;case"c_email":if(M=prompt("Email:")||"",!M)return;H="createlink",M=`mailto:${M}`,u=`[url=${M}]${$}[/url]`;break;case"backcolor":if(t.firefox||t.safari)H="hilitecolor";u=`[bgcolor=${M}]${$}[/bgcolor]`;break;case"forecolor":u=`[color=${M}]${$}[/color]`;break;case"fontname":u=`[font=${M}]${$}[/font]`;break;case"c_code":H="inserthtml",M=`[code]${$}[/code]`,u=M;break;case"c_quote":H="inserthtml",M=prompt("Who said this?")||"",M=M?`=${M}`:"",M=`[quote${M}]${$}[/quote]`,u=M;break;case"c_spoiler":H="inserthtml",M=`[spoiler]${$}[/spoiler]`,u=M;break;case"c_youtube":if(H="inserthtml",M=prompt("Video URL?")||"",!M)return;M=`[video]${M}[/video]`,u=M;break;case"inserthtml":u=M||"";break;case"heading":if(u=`[${M}]${$}[/${M}]`,t.chrome)H="formatBlock",M=`<${M}>`;break;default:throw Error(`Unsupported editor command ${h}`)}if(this.htmlMode)this.doc?.execCommand(H,!1,M),this.doc?.dispatchEvent(new Event("input")),this.window?.focus();else Rh(this.element,u),this.element.dispatchEvent(new Event("input"))}getSelection(){if(this.htmlMode)return this.window?.getSelection()?.toString()||"";return this.element.value.substring(this.element.selectionStart,this.element.selectionEnd)}getSource(){return this.doc?.body.innerHTML}setSource(h){if(this.doc)this.doc.body.innerHTML=h}switchMode(h){let{element:L,iframe:$}=this;if(h)L.style.display="none",$.style.display="";else L.style.display="",$.style.display="none";this.htmlMode=h}}class o extends b{resetOnSubmit;static hydrate(h){q("Form",h.querySelectorAll("form[data-ajax-form]"),this)}constructor(h){super(h);this.resetOnSubmit=h.dataset.ajaxForm==="resetOnSubmit",h.addEventListener("submit",(L)=>{L.preventDefault(),this.submitForm()})}submitForm(){let{element:h,resetOnSubmit:L}=this,{submitButton:$}=h,u=new FormData(h,$),H=Array.from(u.entries()).filter((M)=>typeof M[1]==="string");if(RUN.stream.load(h.action||globalThis.location.toString(),{body:new URLSearchParams(H)}),L)h.reset();RUN.stream.pollData()}}class a extends b{index;images;max;static hydrate(h){q("ImageGallery",h.querySelectorAll(".image_gallery"),this)}constructor(h){super(h);let L=document.createElement("div"),$=document.createElement("button"),u=document.createElement("button");this.index=0,this.images=h.querySelectorAll("img"),this.max=Math.max(this.images.length,1),$.innerHTML="Next &raquo;",$.addEventListener("click",()=>{this.showNext()}),u.innerHTML="Prev &laquo;",u.addEventListener("click",()=>{this.showPrev()}),this.update(),L.appendChild(u),L.appendChild(document.createTextNode(" ")),L.appendChild($),h.appendChild(L)}showNext(){if(this.index<this.max-1)this.index+=1;this.update()}showPrev(){if(this.index>0)this.index-=1;this.update()}update(){this.images.forEach((h,L)=>{let $=h.dataset.madeResized?h.parentNode:h;if($)$.style.display=L===this.index?"block":"none"})}}var Dh="999999px";class m extends b{static async hydrate(h){let L=h.querySelectorAll(".bbcodeimg");await Z(Array.from(L)),q("ImageResizer",L,this)}constructor(h){super(h);let L=1,$=1,{naturalWidth:u,naturalHeight:H}=h,M=c(h),E=Number.parseInt(M.width,10)||Number.parseInt(M.maxWidth,10),T=Number.parseInt(M.height,10)||Number.parseInt(M.maxHeight,10);if(E&&u>E)L=E/H;if(T&&H>T)$=T/H;if(L=L&&$?Math.min(L,$):$||L,L<1)this.makeResizer(u*L,H*L)}makeResizer(h,L){let{element:$}=this;$.style.maxWidth=Dh,$.style.maxHeight=Dh,$.dataset.madeResized="true";let u=Object.assign(document.createElement("a"),{target:"_blank",href:$.src});Object.assign(u.style,{display:"block",overflow:"hidden",width:`${h}px`,height:`${L}px`}),u.dataset.nw=`${$.naturalWidth}`,u.dataset.nh=`${$.naturalHeight}`,u.addEventListener("mousemove",(M)=>{let{x:E,y:T,w:f,h:x}=K(u);u.scrollLeft=(M.pageX-E)/f*(+(u.dataset.nw||0)-f)||0,u.scrollTop=(M.pageY-T)/x*(+(u.dataset.nh||0)-x)||0}),u.addEventListener("mouseover",()=>{$.style.width=`${u.dataset.nw}px`,$.style.height=`${u.dataset.nh}px`});let H=()=>{if(u.scrollLeft)u.scrollLeft=0,u.scrollTop=0;$.style.width=`${h}px`,$.style.height=`${L}px`};u.addEventListener("mouseout",H),H(),$.before(u),u.appendChild($)}}function y(h){let L=K(h),$=h.getAttribute("title");if(h.dataset.lastOnline){let H=Number.parseInt(h.dataset.lastOnline??"",10);$=`Last Online: ${g(H)} ${fh(H)}`}if(!$)return;let u=document.querySelector("#tooltip");if(!u)u=N('<div id="tooltip" class="tooltip">Default text</div>'),document.querySelector("#page")?.appendChild(u);h.title="",h.addEventListener("mouseout",()=>{h.title=$,u.style.display="none"}),u.innerText=$,u.style.display="",Object.assign(u.style,{top:`${L.y-u.offsetHeight}px`,left:`${L.x}px`,zIndex:`${j()}`})}class n extends b{static hydrate(h){q("Link",h.querySelectorAll("a"),this)}constructor(h){super(h);if(h.dataset.useTooltip)h.addEventListener("mouseover",()=>y(h));if(!h.href)return;let L=h.getAttribute("href"),$=!h.target&&L&&(L.startsWith("/")||L.startsWith("?"));if(L?.startsWith("javascript"))return;if($){let H=h.onclick;h.onclick=null,h.addEventListener("click",(M)=>{if(M.preventDefault(),!H||H.call(h,M)!==!1)RUN.stream.location(L)});return}h.target="_blank"}}class Oh{title="Title";wait=!0;content="Content";open=!1;minimizable=!0;resize;className="";pos="center";zIndex;windowContainer;id;onclose;animate=!0;oldpos="";constructor(h={}){this.zIndex=j(),Object.assign(this,h)}render(){let h=N(`
      <div id="${this.id||""}" class="window ${this.className}">
        <div class="title">
          ${this.title}
          <div class="controls">
            ${this.minimizable?'<button data-action="minimize">-</button>':""}
            <button data-action="close" data-shortcut="Escape">X</button>
          </div>
        </div>
        <div class="content">${this.content}</div>
      </div>`);this.windowContainer=h,h.addEventListener("click",(H)=>{if(H.target instanceof HTMLElement){let M=H.target.dataset.action;if(M&&M in this)this[M]()}});let L=document.querySelector(".windows");if(!L)L=N('<div class="windows" style="z-index: 1"></div>'),document.body.appendChild(L);if(L.appendChild(h),this.resize)this.renderResizeHandle(this.resize);let $=h.style;$.zIndex=`${this.zIndex+5}`;let{pos:u}=this;if(this.wait)Z(Array.from(h.querySelectorAll("img"))).then(()=>{this.setPosition(u)});else this.setPosition(u);return new z().autoZ().noChildActivation().boundingBox(0,0,document.documentElement.clientWidth-50,document.documentElement.clientHeight-50).apply(h,h.querySelector(".title")||void 0),h}renderResizeHandle(h){let{windowContainer:L}=this;if(!L)return;let $=L.querySelector(h);if(!$)throw Error("Resize target not found");$.style.width=`${$.clientWidth}px`,$.style.height=`${$.clientHeight}px`;let u=N('<div class="resize"></div>');L.appendChild(u),u.style.left=`${L.clientWidth-16}px`,u.style.top=`${L.clientHeight-16}px`,new z().boundingBox(100,100,1/0,1/0).addListener({ondrag(H){let M=Number.parseFloat($.style.width)+(H.dx??0),E=Number.parseFloat($.style.height)+(H.dy??0);if($.style.width=`${M}px`,M<L.clientWidth-20)$.style.width=`${L.clientWidth}px`;else u.style.left=`${L.clientWidth-16}px`;$.style.height=`${E}px`},ondrop(){u.style.left=`${L.clientWidth-16}px`}}).apply(u),$.style.width=`${L.clientWidth}px`,u.style.left=`${L.clientWidth-16}px`}close(){if(!this.windowContainer)return;if(this.windowContainer.remove(),this.windowContainer=void 0,this.onclose)this.onclose()}minimize(){let{windowContainer:h}=this;if(!h)return;let L=!h.classList.toggle("minimized");if(h.querySelector(".controls [data-action=minimize]").innerHTML=L?"-":"\uD83D\uDDD6",L)h.removeAttribute("draggable");else h.setAttribute("draggable","false"),this.oldpos=this.getPosition();this.setPosition(L?this.oldpos:"",!1)}setPosition(h,L=!0){let $=this.windowContainer;if(!$)return;let u=0,H=0,M=document.documentElement.clientHeight,E=document.documentElement.clientWidth;if(h==="center")H=Math.floor((M-$.clientHeight)/2),u=Math.floor((E-$.clientWidth)/2);else{let T=/(\d+) (\d+)/.exec(h);if(T)u=Number(T[1]),H=Number(T[2])}if($.style.left=`${u}px`,this.animate&&L)Q($,[{top:`${H-100}px`},{top:`${H}px`}],300,"ease-out");else $.style.top=`${H}px`;this.pos=h}getPosition(){if(!this.windowContainer)return"";let h=this.windowContainer.style;return`${Number.parseFloat(h.left)} ${Number.parseFloat(h.top)}`}}var _=Oh;class e extends b{static hydrate(h){q("MediaPlayer",h.querySelectorAll(".media"),this)}constructor(h){super(h);let L=h.querySelector("a.popout"),$=h.querySelector("a.inline"),u=h.querySelector(".movie");if(!u)return;L?.addEventListener("click",(H)=>{H.preventDefault(),new _({title:L.href,content:u.innerHTML}).render()}),$?.addEventListener("click",(H)=>{H.preventDefault(),u.style.display="block"})}}class hh extends b{static hydrate(h){q("PageList",h.querySelectorAll(".pages"),this)}constructor(h){super(h);h.addEventListener("wheel",(L)=>this.wheel(L))}wheel(h){h.preventDefault();let L=Math.sign(h.deltaY),$=Array.from(this.element.querySelectorAll("a")),u=Number.parseInt($[1].innerHTML,10),H=Number.parseInt($.at(-1)?.innerHTML||"",10),M=$.length-2;if(L>0&&u+M<H||L<0&&u>2)for(let E=0;E<M;E+=1)$[E+1].href=$[E+1].href.replace(/\d+$/,`${E+u+L}`),$[E+1].innerHTML=`${u+E+L}`}}class $h extends b{static hydrate(h){q("Switch",h.querySelectorAll("input.switch"),this)}constructor(h){super(h);h.style.display="none";let L=Object.assign(document.createElement("button"),{type:"button",title:h.className,className:h.className}),$=()=>{L.style.backgroundPosition=h.checked?"top":"bottom"};$(),L.addEventListener("click",()=>{h.checked=!h.checked,$(),h.dispatchEvent(new Event("change"))}),h.after(L)}}var jh="active";class Lh extends b{static hydrate(h){q("Tabs",h.querySelectorAll(".tabs"),this)}constructor(h){super(h);h.addEventListener("click",(L)=>this.click(L))}click(h){let{tabSelector:L}=this.element.dataset,{target:$}=h;if(!$||!($ instanceof HTMLElement)||$.tagName.toLowerCase()!=="a")return;let u=$;if(L){let M=$.closest(L);if(M)u=M}let H=this.element.querySelector(`.${jh}`);if(H)H.classList.remove(jh);u.className=jh,u.blur()}}function A(h){O(),[i,k,C,v,w,d,l,o,X,a,m,n,e,hh,$h,Lh].forEach((L)=>{L.hydrate(h)})}var U={loadscript(h){document.body.appendChild(Object.assign(document.createElement("script"),{src:h}))},script(h){(0,eval)(h)},error(h){G.error(h)},success(h){G.success(h)},reload(h=0){setTimeout(()=>globalThis.location.reload(),h)},refreshdata(){RUN.stream.pollData(!0)},addclass(h,L){let $=document.querySelector(h);if($)$.classList.add(L)},title(h){document.title=h},update(h,L,$){let u=h,H=Array.from(document.querySelectorAll(".path"));if(u==="path"&&H.length>1){H.forEach((T)=>{T.innerHTML=L,A(T)});return}if(!/^\W/.test(u))u=`#${u}`;let M=document.querySelector(u);if(!M)return;M.innerHTML=L;let E=M.querySelector("[autofocus]");if(E)E.focus();if($)qh(M);A(M)},removeel(h){let L=document.querySelector(h);if(L)L.remove()},back(){globalThis.history.back()},setstatus(h){let L=document.querySelector("#status");if(L)L.className=h},appendrows(h,L){let $=document.querySelector(h);if(!$)return;let u=document.createElement("span");u.innerHTML=`<table>${L}</table>`;let H=u.getElementsByTagName("tbody")[0];A(H),$.appendChild(H)},location(h){if(["?","/"].includes(h.charAt(0))){RUN.stream.location(h);return}document.location=h},enable(h){let L=document.querySelector(`#${h}`);if(L)L.disabled=!1},addshout(h){let L=Array.from(document.querySelectorAll("#shoutbox .shout")),$=document.createElement("span");$.innerHTML=h;let u=$.firstElementChild;if(!u)return;L[0].parentNode?.insertBefore(u,L[0]);while(L.length>globalSettings.shoutLimit-1)L.pop()?.remove();if(qh(u),globalSettings.soundShout)P.play("blip");A(u)},tick(h){let L=document.querySelector("#ticker");if(!L)return;let $=document.createElement("div");$.innerHTML=h,$=$.firstElementChild,L.insertBefore($,L.firstChild);let u=Array.from(L.querySelectorAll(".tick"));for(let H=100;H<u.length;H+=100)u[H].remove()},im(h,L,$,u,H){rh({fromId:h,fromName:L,message:$,fromMe:u,timestamp:H})},imtoggleoffline(h){document.querySelector(`#im_${h}`)?.classList.add("offline")},window(h){if(h.id&&document.getElementById(h.id))return;let $=new _(h);A($.render())},closewindow(h){let L=document.querySelector(h+" [data-action=close]");if(L)L.click()},onlinelist(h){let L=document.querySelector("#statusers");if(!L)return;h.forEach(($)=>{let u=document.querySelector(`#statusers .user${$.uid}`);if(!u)u=document.createElement("a"),u.addEventListener("click",function(){if(this.href)RUN.stream.location(this.href)}),u.addEventListener("mouseover",function(){y(this)});if($.profileURL)u.href=$.profileURL;if(u.innerHTML=$.name,u.className=[`user${$.uid}`,`mgroup${$.groupID}`,$.status,`lastAction${$.lastAction}`].join(" "),$.locationVerbose)u.title=$.locationVerbose;if($.status==="idle"){bh(u);return}if(L.firstChild)L.insertBefore(u,L.firstChild);else L.appendChild(u)})},snow(h){D(h)},setoffline(h){let L=document.querySelector("#statusers");h.split(",").forEach((u)=>{let H=document.querySelector(`#statusers .user${u}`);if(H&&L)H.remove()})},async scrollToPost(h){let L=document.getElementById(`pid_${h}`);if(!L)return!1;await Z(Array.from(document.querySelectorAll("#page img")));let $=K(L);return globalThis.scrollTo({top:$.y}),!0},updateqreply(h){let $=document.querySelector("#qreply")?.querySelector("textarea");if($)$.focus(),$.value+=h,$.dispatchEvent(new Event("input"))},newmessage(h,L){let $=document.querySelector("#notification"),u=document.querySelector("#num-messages");if(u)u.innerHTML=`${Number.parseInt(u.innerHTML,10)+1}`;if(!$)$=document.createElement("div"),$.id="notification",document.body.appendChild($);$.style.display="",$.className="newmessage",$.addEventListener("click",()=>{$.style.display="none",RUN.stream.location(`/ucp/inbox?view=${L}`,3)}),$.innerHTML=h},playsound(h,L){P.loadAndPlay(h,L)},listrating(h,L){let $=document.querySelector(`#postrating_${h}`),u;if($){if($.style.display!=="none"){Q($,[{height:"200px"},{height:"0px"}],300).then((H)=>H.style.display="none");return}$.style.display="block"}else{$=document.createElement("div"),$.className="postrating_list",$.id=`postrating_${h}`;let H=document.querySelector(`#pid_${h} .postrating`);if(!H)return;u=K(H),$.style.top=`${u.yh}px`,$.style.left=`${u.x}px`,document.querySelector("#page")?.appendChild($)}$.innerHTML=L,Q($,[{height:"0px"},{height:"200px"}],300)}};var Ih,R="",yh="";function Ah(){if(R)document.title=R;R="",clearInterval(Ih)}function Jh(h){if(document.hasFocus())return;if(Ah(),!R)R=document.title;yh=h,Ih=setInterval(()=>{document.title=document.title===R?yh:R},1000)}function $$(h,L){if(Jh(`New message from ${h}!`),!document.hasFocus()&&globalThis.Notification&&Notification.permission==="granted"){let $=new Notification(`${h} says:`,{body:L});$.onclick=()=>{globalThis.focus(),$.close()}}}function L$({fromId:h,fromName:L,message:$}){let u=document.querySelector(`#im_${h} .ims`);if(u)return u;let M=new _({title:`${L}`,content:`
        <div class='ims'></div>
        <div class='offline'>This user may be offline</div>
        <div>
            <form data-ajax-form='resetOnSubmit' method='post'>
                <input type='hidden' name='im_uid' value='${h}'>
                <input type='text' name='im_im' autocomplete='off'>
            </form>
        </div>
    `,className:"im",resize:".ims",animate:!0,id:`im_${h}`}).render();A(M);let E=()=>{M.querySelector('form input[name="im_im"]')?.focus()};M.addEventListener("click",E),E(),u=M.querySelector(".ims");let T=getComputedStyle(u);if(u.style.width=T.width,u.style.height=T.height,$&&globalSettings.soundIM)P.play("receive");return u}function Bh(h,L){if(!globalSettings.canIM){alert("You do not have permission to use this feature.");return}U.im(h,L,"",1,Date.now())}function rh({fromId:h,fromName:L,message:$,fromMe:u,timestamp:H}){$$(L,$);let M=L$({fromId:h,fromName:L,message:$});if(!$)return;let E=$.startsWith("/me");if(!u)document.querySelector(`#im_${h}`)?.classList.remove("offline");let T=N(`
    <div class="${E?"action":""} ${u?"you":"them"}" data-timestamp="${H}">
      <a href="/profile/${u||h}" class="name">${E?"***"+L:L}</a>
      ${E?$.substring(3):": "+$}
    </div>
  `);if(M.appendChild(T),A(T),M.scrollTop>M.scrollHeight-M.clientHeight-50)M.scrollTop=M.scrollHeight;if(globalSettings.soundIM)P.play("receive")}function u$(h){let L=h?h.split(","):[],$=L.length===1?"":"s",u=L.length?" and <br>":"";return[L,$,u]}function H$(h){let L=h?h.split(","):[],u=(L?L.length:0)===1?"":"s";return[L,u]}class uh{whichone=0;boundCheckLocation;pids=[];tids=[];modb;constructor(){this.boundCheckLocation=()=>this.checkLocation(),Object.assign(U,{modcontrols_clearbox:this.destroyModControls.bind(this),modcontrols_move:this.showMoveControls.bind(this),modcontrols_postsync:this.postSync.bind(this)})}checkLocation(){let{whichone:h}=this,$=(h?/topic\/(\d+)/:/forum\/(\d+)/).exec(document.location.toString());if($)this.moveTo(Number($[1]));else this.showMoveControls(h)}moveTo(h){let{whichone:L}=this;this.renderModControls(`<form method="post" action="/modcontrols" data-ajax-form="true">
                move ${L?"posts":"topics"} here?
            <input type="hidden"
                name="${L?"dop":"dot"}"
                value="moveto">
            <input type="hidden" name="id" value="${h}">
            <input type="submit" value="Yes">
            <input type="submit" name="cancel" value="Cancel" onclick="this.form.submitButton=this">
            </form>`)}renderModControls(h){if(this.modb=this.modb||document.querySelector("#modbox")||void 0,!this.modb)this.modb=document.createElement("div"),this.modb.id="modbox",document.body.appendChild(this.modb);this.modb.style.display="block",this.modb.innerHTML=h,A(this.modb)}destroyModControls(){if(globalThis.removeEventListener("pushstate",this.boundCheckLocation),this.modb)this.modb.innerHTML="",this.modb.style.display="none"}togbutton(h){h.classList.toggle("selected")}postSync(h,L){let[$,u,H]=u$(h),[M,E]=H$(L);if(this.tids=M,this.pids=$,!M.length&&!$.length){this.destroyModControls();return}let T=M.length?`
            <select name="dot">
                <option value="delete">Delete</option>
                <option value="merge">Merge</option>
                <option value="move">Move</option>
                <option value="pin">Pin</option>
                <option value="unpin">Unpin</option>
                <option value="lock">Lock</option>
                <option value="unlock">Unlock</option>
            </select> &nbsp; &nbsp;
            <strong>${M.length}</strong> topic${E}${H}`:"",f=$.length?`
            <select name="dop">
                <option value="delete">Delete</option>
                <option value="move">Move</option>
            </select> &nbsp; &nbsp;
            <strong>${$.length}</strong> post${u}`:"",x=$.length&&M.length?"<br>":" &nbsp; &nbsp; ",B=`
        <form method="post" action="/modcontrols" data-ajax-form="true">
            ${T}
            ${f}
            ${x}
            <input type="submit" value="Go">
            <input
                name="cancel" type="submit"
                onclick="this.form.submitButton=this;" value="Cancel">
        </form>`;this.renderModControls(B)}showMoveControls(h){this.whichone=h,globalThis.addEventListener("pushstate",this.boundCheckLocation),this.renderModControls(`Ok, now browse to the ${this.whichone?"topic":"forum"} you want to move the ${this.whichone?`${this.pids.length} posts`:`${this.tids.length} topics`} to...`)}}function M$(){new _({title:"Keyboard Shortcuts",id:"shortcuts",content:`
      <style>
        #shortcuts { width: 300px; }
        #shortcuts dt { float: left;margin-left: 5px;}
      </style>
      <h3>Navigation</h3>
      <dl>
        <dt>?</dt><dd>This help window</dd>
        <dt>h</dt><dd>Home / Board Index</dd>
        <dt>i</dt><dd>Inbox</dd>
        <dt>s</dt><dd>Settings</dd>
        `+(globalSettings.isAdmin?"<dt>a</dt><dd>Admin CP</dd>":"")+(globalSettings.isMod?"<dt>m</dt><dd>Moderator CP</dd>":"")+`</dl>

      <h3>Inbox</h3>
      <dl>
        <dt>c</dt><dd>Compose</dd>
        <dt>i</dt><dd>Inbox</dd>
        <dt>f</dt><dd>Flagged Messages</dd>
        <dt>r</dt><dd>Reply to Message</dd>
      </dl>

      <h3>Forum/Topic</h3>
      <dl>
        <dt>t</dt><dd>New Topic</dd>
        <dt>r</dt><dd>Reply</dd>
      </dl>
      `}).render()}function gh(h){if(h.target instanceof HTMLInputElement||h.target instanceof HTMLTextAreaElement||h.target instanceof HTMLSelectElement)return;if(h.key==="?"){M$();return}document.documentElement.querySelector(`[data-shortcut="${h.key}"]`)?.click()}var E$=5000;class Hh{commands;lastURL;timeout;constructor(){this.lastURL=`${document.location.pathname}${document.location.search}`,this.commands=U}handleRequestData(h,L,$=1){let u=!1;if(L.forEach(([H,...M])=>{if(H==="preventNavigation")u=!0;else if(H in this.commands)this.commands[H].apply(null,M)}),$>=2){if(!u)globalThis.history.pushState({lastURL:h},"",h),globalThis.dispatchEvent(new Event("pushstate")),this.lastURL=h}this.pollData()}location(h,L=2){this.load(h,{requestType:L})}async load(h,{body:L,method:$="POST",requestType:u=1}={}){try{let H=await fetch(h,{method:$,body:L,headers:{"X-JSACCESS":`${u}`,"Content-Type":"application/x-www-form-urlencoded"}});if(H.ok){let M=await H.json();this.handleRequestData(h,M,u);return}G.error("An unrecoverable error has occurred.<br>Please try again later.")}catch(H){if(!navigator.onLine)G.error("You appear to be offline.");else G.error("Network fetch failed: timeout")}}pollData(h=!1){if(h)this.load(this.lastURL);if(clearTimeout(this.timeout),document.cookie.includes(`actw=${window.name}`))this.timeout=setTimeout(()=>this.load(this.lastURL),E$)}updatePage(h){if(h!==this.lastURL)this.location(h,3)}}var T$=2;class Xh{stream=new Hh;onAppReady(){if(T$)A(document.body);let h=new Date;if(h.getMonth()===11&&[23,24,25].includes(h.getDate()))D();O(),setInterval(O,30000),this.stream.pollData(),globalThis.addEventListener("popstate",({state:$})=>{if($){let{lastURL:u}=$;this.stream.updatePage(u)}else this.stream.updatePage(document.location.toString())}),P.load("blip"),P.load("receive")}handleQuoting(h){let L=new URLSearchParams(h.search),$=L.get("quote");if($){let u=document.querySelector(`#pid_${$} .post_content`),H=window.getSelection();if(u&&H&&u.contains(H.anchorNode)&&u.contains(H.focusNode))L.set("quotedText",H.toString())}L.set("qreply",document.querySelector("#qreply")?"1":"0"),this.stream.load(`${h.pathname}?${L.toString()}`)}setWindowActive(){document.cookie=`actw=${window.name}; SameSite:Lax`,Ah(),this.stream.pollData()}}var Mh=new Xh;r(()=>{Mh.onAppReady()});r(()=>{window.name=`${Math.random()}`,Mh.setWindowActive(),globalThis.addEventListener("focus",()=>{Mh.setWindowActive()})});r(function(){if(!Yh())document.documentElement.classList.add("no-emoji");document.documentElement.classList.add("js-enabled")});r(()=>{globalThis.addEventListener("keyup",gh)});var ih=Mh;Object.assign(globalThis,{RUN:ih,IMWindow:Bh,ModControls:new uh});

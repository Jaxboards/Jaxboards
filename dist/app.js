var k=new Map;class j{element;constructor($){this.element=$}}function G($,H,L){if(!k.has($))k.set($,new WeakMap);H.forEach(function(M){if(k.get($)?.has(M))return;k.get($)?.set(M,new L(M))})}function l$($){let H=$.getHours()||12,L=`${$.getMinutes()}`.padStart(2,"0");return`${H%12||12}:${L}${H>12?"pm":"am"}`}function g($){return new Date($*1000)}var A$=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],Y$=["January","February","March","April","May","June","July","August","September","October","November","December"];function m$($){return $[0].toUpperCase()+$.slice(1)}function C($){let H=new Date,L=new Intl.RelativeTimeFormat(void 0,{numeric:"auto",style:"long"}),h=new Date;h.setTime(+h-86400000),h.setHours(0),h.setMinutes(0),h.setSeconds(0);let M=g($),T=Math.round((+M-+H)/1000);if(T>-60)return L.format(T,"second");if(T>-3600)return L.format(Math.round(T/60),"minute");if(M>h){let E=new Date;return E.setHours(0),E.setMinutes(0),E.setSeconds(0),`${m$(L.format(M>E?0:-1,"day"))} @ ${l$(M)}`}return Intl.DateTimeFormat(void 0,{month:"short",year:"numeric",day:"numeric",hour:"numeric",hour12:!0,minute:"numeric"}).format(M)}function j$($){let H=g($),L=H.getHours(),h=L>=12?"pm":"am";L%=12,L=L||12;let M=`${H.getMinutes()}`.padStart(2,"0"),T=H.getMonth()+1,E=`${H.getDate()}`.padStart(2,"0"),F=H.getFullYear();return`${L}:${M}${h}, ${T}/${E}/${F}`}function G$($){let H=g($);return String.fromCodePoint(55357,56656+((H.getHours()%12||12)-1)+(H.getMinutes()>29?12:0))}function _$($){let H=Array.from($.classList).find((L)=>L.startsWith("lastAction"));if(H===void 0)return;$.prepend(G$(Number.parseInt(H.slice(10),10))),$.classList.remove(H)}class v extends j{static hydrate($){$.querySelectorAll(".idle").forEach((H)=>_$(H))}}var Z$=["#F00","#FF7F00","#FF0","#0F0","#00F","#4B0082","#9400D3"];function a$($=200){let H=document.querySelector("#snow");if(H===null)H=document.createElement("div"),H.id="snow",Object.assign(H.style,{position:"fixed",top:0,left:0,zIndex:1}),document.body.prepend(H);H.innerHTML="";for(let L=1;L<=$;L+=1){let h=document.createElement("div");h.className="snowflake",H.appendChild(h)}}function n$(){let $=document.getElementById("snow-css");if($)return $;return $=document.createElement("style"),$.id="snow-css",document.head.appendChild($),$}function o$($){let H=n$();H.innerHTML=$,document.head.appendChild(H)}function e$($=100){return Math.floor(Math.random()*$)+1}function $H($,H){let L=Math.ceil($),h=Math.floor(H);return Math.floor(Math.random()*(h-L+1))+L}function HH($,H){return Math.random()*(H-$)+$}function LH($=200,H=!1){let h=100*document.body.offsetHeight/window.innerHeight,M=`
    .snowflake {
        position: absolute;
        width: 10px;
        height: 10px;
        /* Workaround for Chromium's selective color inversion */
        border-radius: 50%;
    }
  `;for(let T=1;T<=$;T+=1){let E=Math.random()*100,F=Math.random()*10,x=E+F,q=E+F/2,K=HH(0.3,0.8),P=K*h,_=Math.random(),x$=$H(10,h/10*3),D=e$(h/10*3)*-1,t$=Math.random(),q$=H?Z$[Math.floor(Math.random()*Z$.length)]:"white";M+=`
      .snowflake:nth-child(${T}) {
        opacity: ${t$};
        background: linear-gradient(${q$}, ${q$});
        filter: drop-shadow(0 0 10px ${q$});
        transform: translate(${E}vw, -10px) scale(${_});
        animation: fall-${T} ${x$}s ${D}s linear infinite;
      }
      @keyframes fall-${T} {
        ${K*100}% {
          transform: translate(${x}vw, ${P}vh) scale(${_});
        }
        to {
          transform: translate(${q}vw, ${h}vh) scale(${_});
        }
      }
    `}o$(M)}function Y($=200,H=!1){LH($,H),a$($)}async function A($,H,L=600,h="linear"){return new Promise((M)=>{$.animate(H,{duration:L,easing:h}).addEventListener("finish",()=>{Object.assign($.style,H.at(-1)),M($)},{once:!0})})}function B$($){return A($,[{backgroundColor:"#FF0"},{backgroundColor:""}],1000)}function V($){let H=document.createElement("div");return H.innerHTML=$,H.firstElementChild}function Z($){return[$?.closest("tr")?.rowIndex??0,$?.cellIndex??0]}function R($){return globalThis.getComputedStyle($)}function W($){let{x:H,y:L,height:h,width:M}=$.getBoundingClientRect(),T=H+globalThis.scrollX,E=L+globalThis.scrollY;return{x:T,y:E,yh:E+h,xw:T+M,w:M,h}}function z(){return Array.from(document.querySelectorAll("*")).reduce((L,h)=>{if(h.style.zIndex&&Number(h.style.zIndex)>L)return Number(h.style.zIndex);return L},0)+1}var N$="valid",R$="invalid";class w extends j{method;outputElement;indicatorElement;static hydrate($){G("AutoComplete",$.querySelectorAll("input[data-autocomplete-action]"),this)}constructor($){super($);$.autocomplete="off",this.method=$.dataset.autocompleteAction;let H=$.dataset.autocompleteOutput,L=$.dataset.autocompleteIndicator,h=H?document.querySelector(H):void 0;if(!h)throw Error("Expected element to have data-autocomplete-output");this.outputElement=h||document.createElement("input"),this.indicatorElement=L?document.querySelector(L):void 0,$.addEventListener("keyup",(M)=>this.keyUp(M)),$.addEventListener("keydown",(M)=>{if(M.key==="Enter")M.preventDefault()})}getResultsContainer(){let $=W(this.element),H=document.querySelector("#autocomplete");if(!H)H=Object.assign(document.createElement("div"),{id:"autocomplete"}),Object.assign(H.style,{zIndex:z()}),document.body.appendChild(H);return Object.assign(H.style,{top:`${$.yh}px`,left:`${$.x}px`,width:`${$.w}px`}),H}keyUp($){let H=this.getResultsContainer(),L=Array.from(H.querySelectorAll("div")),h=L.findIndex((M)=>M.classList.contains("selected"));switch($.key){case"ArrowUp":case"ArrowDown":L.at(h)?.classList.remove("selected"),L.at((h+($.key==="ArrowDown"?1:-1))%L.length)?.classList.add("selected");return;case"Enter":if(h>=0)L.at(h)?.dispatchEvent(new Event("click"));return;default:if(this.indicatorElement)this.indicatorElement.classList.remove(N$),this.indicatorElement.classList.add(R$);if(this.clearResults(),this.element.value)this.doSearch();break}}clearResults(){let $=this.getResultsContainer();$.style.display="none",$.innerHTML=""}async doSearch(){let $=this.getResultsContainer(),H=/ACP/.test(document.location.toString())?"../":"",h=`term=${encodeURIComponent(this.element.value)}`,M=await fetch(`${H}/api/${this.method}?${h}`);if(!M.ok)return;let T=await M.json();if($.innerHTML="",T.length){$.style.display="";let[E,F]=T;E.forEach((x,q)=>{let K=F[q],P=document.createElement("div");P.innerHTML=K,P.addEventListener("click",()=>{if($.style.display="none",this.indicatorElement)this.indicatorElement.classList.add(N$),this.indicatorElement.classList.remove(R$);this.outputElement.value=`${x}`,this.outputElement.dispatchEvent(new Event("change")),this.element.value=K}),$.appendChild(P)});return}$.style.display="none"}}var{userAgent:b}=navigator;function u(){return"ontouchstart"in window}var p={chrome:/chrome/i.test(b),ie:/msie/i.test(b),iphone:/iphone/i.test(b),mobile:/mobile/i.test(b),n3ds:/nintendo 3ds/.test(b),firefox:/firefox/i.test(b),safari:/safari/i.test(b)};class b${sess;boundEvents;droppables;noChild=!1;bounds;onstart;ondragover;ondrag;ondragout;ondrop;autoZIndex=!0;constructor(){this.droppables=[],this.sess={el:document.body,mx:0,my:0,reset:()=>{return}},this.boundEvents={drag:($)=>this.drag($),drop:()=>this.drop()}}start($,H,L){$.preventDefault(),$.stopPropagation();let h=H||$.target,M=R(h),T=z();if(this.noChild&&$.target!==(L||h))return;if(h.getAttribute("draggable")==="false")return;if(this.sess={el:h,mx:$ instanceof MouseEvent?$.pageX:$.targetTouches[0].pageX,my:$ instanceof MouseEvent?$.pageY:$.targetTouches[0].pageY,ex:Number.parseInt(M.left,10)||0,ey:Number.parseInt(M.top,10)||0,info:{el:h,mx:0,my:0,reset:()=>{return}},reset:()=>this.reset(),zIndex:h.style.zIndex},!this.sess.zIndex||Number(this.sess.zIndex)<T-1)h.style.zIndex=`${T}`;this.onstart?.({...this.sess,droptarget:this.testDrops(this.sess.mx,this.sess.my)}),document.addEventListener(u()?"touchmove":"mousemove",this.boundEvents.drag),document.addEventListener(u()?"touchend":"mouseup",this.boundEvents.drop),this.drag($)}drag($){$.stopPropagation();let H=this.sess.el.style,L=$ instanceof MouseEvent?$.pageX:$.targetTouches[0].pageX,h=$ instanceof MouseEvent?$.pageY:$.targetTouches[0].pageY,M=L,T=h,E,F=(this.sess.ex??0)+M-this.sess.mx,x=(this.sess.ey??0)+T-this.sess.my,q=this.bounds;if(q){if(F<q[0])M=M-F+q[0],[F]=q;else if(F>q[0]+q[2])F=q[0]+q[2];if(x<q[1])T=T-x+q[1],[x]=q;else if(x>q[1]+q[3])x=q[1]+q[3]}H.left=`${F}px`,H.top=`${x}px`;let K=this.sess.info,P=K?.droptarget,_={...this.sess,left:F,top:x,mx:M,my:T,dx:M-(K?.mx||M),dy:T-(K?.my||T),droptarget:this.testDrops(L,h)};if(this.sess.info=_,this.ondrag?.(_),_.droptarget&&P!==_.droptarget)this.ondragover?.(_);if(P&&_.droptarget!==P)E=_.droptarget,_.droptarget=P,this.ondragout?.(_),_.droptarget=E}boundingBox($,H,L,h){return this.bounds=[$,H,L,h],this}drop(){if(this.boundEvents)document.removeEventListener(u()?"touchend":"mouseup",this.boundEvents.drop),document.removeEventListener(u()?"touchmove":"mousemove",this.boundEvents.drag);if(this.ondrop?.(this.sess.info??{}),this.autoZIndex)this.sess.el.style.zIndex=this.sess.zIndex??"";return!0}testDrops($,H){let{droppables:L}=this,h,M=[9999,9999];if(!L.length)return;return L.findLast((T)=>{if(T===this.sess.el||this.sess.el.contains(T))return;if(h=W(T),M[0]>h.w&&M[1]>h.h&&$>=h.x&&H>=h.y&&$<=h.xw&&H<=h.yh)return M=[h.w,h.h],T;return})}drops($){return this.droppables=$,this}addDrops($){if(!this.droppables)return this.drops($);return this.droppables=this.droppables.concat($),this}addListener($){return Object.assign(this,$),this}apply($,H){if(Array.isArray($))return $.forEach((M)=>this.apply(M)),this;let h=R($)?.position;if(!h||h==="static")$.style.position="relative";return(H||$).addEventListener(u()?"touchstart":"mousedown",H?(M)=>this.start(M,$,H):(M)=>this.start(M,$)),this}autoZ(){return this.autoZIndex=!1,this}noChildActivation(){return this.noChild=!0,this}reset($=this.sess.el){return $.style.top="0",$.style.left="0",this}}var f=b$;var K$="50px";class f${success($,H=3000){this.showToast($,"success",H)}error($,H=0){this.showToast($,"error",H)}async showToast($,H,L=0){let h=document.createElement("div"),M=async()=>{await A(h,[{top:K$},{top:`-${K$}`}]),h.remove()};h.classList.add(H),Object.assign(h.style,{position:"fixed",left:"50%",transform:"translateX(-50%)",boxShadow:"black 5px 5px 10px",zIndex:z()}),h.addEventListener("click",M,{once:!0}),h.innerHTML=$;let T=document.createElement("a");if(T.href="javascript:void(0)",T.innerHTML=" [X]",T.title="close notification",T.addEventListener("click",M,{once:!0}),h.append(T),document.body.appendChild(h),await A(h,[{top:"0"},{top:K$}],600,"ease-in-out"),L)await new Promise((E)=>setTimeout(E,L)),M()}}var Q=new f$;class U${soundCache={};getFilePath($){return`/Sounds/${$}.mp3`}load($,H=!1){let L=this.soundCache[$];if(L){if(H)this.play($);return}L=new Audio,this.soundCache[$]=L,L.autoplay=!!H,L.src=this.getFilePath($)}loadAndPlay($){this.load($,!0)}play($){this.soundCache[$].play()}}var B=new U$;class c extends j{static hydrate($){G("Checkers",$.querySelectorAll(".checkers"),this)}constructor($){super($);B.load("chessdrop");let H=new f;H.addListener({ondrop:(L)=>{if(L.reset(),!L.droptarget)return;let{droptarget:h,el:M}=L,T=Z(M.closest("td")),E=Z(h);if(!this.isValidMove(T,E))return;if([1,8].includes(E[0]))this.promote(M);this.getCapturedPiece(T,E)?.remove(),h.append(M),B.play("chessdrop"),this.moveNumber++,navigator.clipboard.writeText("[checkers]"+this.gameState+"[/checkers]"),Q.success("BBCode copied to clipboard")}}),H.drops(Array.from($.querySelectorAll("td"))),H.apply(Array.from($.querySelectorAll(".piece")))}getCapturedPiece($,H){let L=[H[0]-$[0],H[1]-$[1]];if(L.map(Math.abs).join(",")!=="2,2")return;return this.element.rows[$[0]+L[0]/2].cells[$[1]+L[1]/2].querySelector(".piece")??void 0}promote($){$.dataset.piece=$.dataset.piece?.toUpperCase(),$.innerHTML="♛"}isValidMove($,H){let L=this.element,h=[H[0]-$[0],H[1]-$[1]].map(Math.abs),M=L.rows[$[0]].cells[$[1]].querySelector(".piece")?.dataset.piece??"",T=this.getCapturedPiece($,H)?.dataset.piece??"";if(H[0]%2===H[1]%2)return!1;if(h[0]!=h[1])return!1;if(M==="b"&&H[0]<=$[0])return!1;if(M==="r"&&H[0]>=$[0])return!1;if(T.toLowerCase()===M.toLowerCase())return!1;if(L.rows[H[0]].cells[H[1]].querySelector(".piece"))return!1;return h[0]===(T?2:1)}get moveNumber(){return Number(this.element.dataset.moveNumber??"1")}set moveNumber($){this.element.dataset.moveNumber=`${$}`}get gameState(){let $=Array.from(this.element.querySelectorAll("td")),H=[];for(let L=0;L<8;L++){H.push([]);for(let h=0;h<4;h++){let M=L%2?0:1;H[L].push($[L*8+h*2+M].querySelector(".piece")?.dataset.piece||" ")}}return H.map((L)=>L.join("")).join("/").replaceAll(/ +/g,(L)=>`${L.length}`)+` ${this.moveNumber}`}}var hH={R:"♜",N:"♞",B:"♝",Q:"♛",K:"♚",P:"♟",r:"♜",n:"♞",b:"♝",q:"♛",k:"♚",p:"♟"};class d extends j{static hydrate($){G("Chess",$.querySelectorAll(".chess"),this)}constructor($){super($);B.load("chessdrop");let H=new f;H.addListener({ondrop:(L)=>{if(L.reset(),!L.droptarget)return;let h=L.el,M=h.dataset.piece,T=L.droptarget.querySelector(".piece"),E=T?.dataset.piece?.trim()??"",F=Z(h.closest("td")),x=Z(L.droptarget);if(!this.isValidMove(M,E,F,x))return;if(M?.toLowerCase()==="p"&&[1,8].includes(x[0]))this.promotePawn(h);if(E?.toLowerCase()==="k")B.loadAndPlay("malo-mart"),Y(2000,!0);T?.remove(),L.droptarget.append(h),B.play("chessdrop"),this.moveNumber++,navigator.clipboard.writeText("[chess]"+this.getFENNotation()+"[/chess]"),Q.success("BBCode copied to clipboard")}}),H.drops(Array.from($.querySelectorAll("td"))),H.apply(Array.from($.querySelectorAll(".piece")))}get moveNumber(){return Number(this.element.dataset.moveNumber??"1")}set moveNumber($){this.element.dataset.moveNumber=`${$}`}didJumpAPiece($,H){let L=[H[0]-$[0],H[1]-$[1]],h=L.map(Math.sign),M=Math.max(...L.map(Math.abs));for(let T=1;T<M;T++)if(this.getPieceAt($[0]+h[0]*T,$[1]+h[1]*T))return!0;return!1}isValidMove($="",H="",L,h){let T=[L[0]-h[0],L[1]-h[1]].map(Math.abs),E=Math.min(...T)===0,F=T[0]===T[1],x=$.toLowerCase()===$;if(this.moveNumber%2===0!==x)return Q.error(`It's ${x?"white":"black"}'s turn!`,3000),!1;if(H!==""&&$.toLowerCase()===$===(H.toLowerCase()===H))return!1;switch($){case"p":return L[0]<h[0]&&Math.max(...T)<=(L[0]===2?2:1)&&(H?F:E);case"P":return L[0]>h[0]&&Math.max(...T)<=(L[0]===7?2:1)&&(H?F:E);case"r":case"R":return E&&!this.didJumpAPiece(L,h);case"b":case"B":return F&&!this.didJumpAPiece(L,h);case"n":case"N":return T.toSorted((q,K)=>q-K).join(",")==="1,2";case"q":case"Q":return(E||F)&&!this.didJumpAPiece(L,h);case"k":case"K":if(!(F||E))return!1;if(Math.max(...T)===2)return this.doCastle(L,h);return Math.max(...T)===1}return!0}doCastle($,H){let L=(h,M,T)=>{let E=this.getPieceAt(h,M);if(E?.dataset.piece!==T)return!1;if(this.didJumpAPiece($,[h,M]))return!1;return this.element.rows[h].cells[M===1?4:6].append(E),!0};if($[0]===1&&$[1]===5){if(H[1]==7)return L($[0],8,"r");if(H[1]===3)return L($[0],1,"r")}if($[0]===8&&$[1]===5){if(H[1]==7)return L($[0],8,"R");if(H[1]===3)return L($[0],1,"R")}return!0}promotePawn($){while(!0){let H=(prompt("Congrats on your promotion, sir pawn! What rank would you like? (q: Queen, r: Rook, b: Bishop, n: Knight)","q")??"").toLowerCase();if(["q","r","b","n"].includes(H)){H=$.dataset.piece==="p"?H.toLowerCase():H.toUpperCase(),$.dataset.piece=H,$.innerHTML=hH[H],B.loadAndPlay("zelda-item-get");break}}}getFENNotation(){return Array.from(this.element.querySelectorAll("td")).map((H,L)=>(L&&L%8===0?"/":"")+(H.querySelector(".piece")?.dataset.piece||" ")).join("").replaceAll(/ +/g,(H)=>`${H.length}`)+` ${this.moveNumber}`}getPieceAt($,H){return this.element.rows[$].cells[H].querySelector(".piece")}}function u$($){if(!globalThis.getSelection)return;let H=document.createRange();H.selectNode($);let L=globalThis.getSelection();if(!L)return;if(L.rangeCount)L.removeAllRanges();L.addRange(H)}function O$($,H){let L=$.scrollTop,h=$.selectionStart??0,M=$.selectionEnd??0;$.value=$.value.substring(0,h)+H+$.value.slice(M),$.selectionStart=h+H.length,$.selectionEnd=h+H.length,$.focus(),$.scrollTop=L}class i extends j{static hydrate($){G("CodeBlock",$.querySelectorAll(".bbcode.code"),this)}constructor($){super($);$.addEventListener("click",()=>u$($))}}class r extends j{fullHeight=0;animationLengthInMs=200;static hydrate($){G("CollapseBox",$.querySelectorAll(".collapse-box"),this)}constructor($){super($);let{collapseContent:H}=this;if(H)Object.assign(H.style,{transition:`height ${this.animationLengthInMs}ms ease-in-out`});this.toggle(),this.element.addEventListener("click",(L)=>{if(L.target instanceof HTMLElement&&L.target.matches(".collapse-button"))this.isOpen=!this.isOpen,this.toggle()})}get boxID(){return this.element.getAttribute("id")||""}get collapseContent(){return this.element.querySelector(".collapse-content")}get isOpen(){return!(globalThis.sessionStorage.getItem("collapsed")??"").split(",").includes(this.boxID)}set isOpen($){let H=(globalThis.sessionStorage.getItem("collapsed")??"").split(",").filter(Boolean);if($)H=H.filter((L)=>L!==this.boxID);else H.push(this.boxID);globalThis.sessionStorage.setItem("collapsed",H.join(",")??"")}toggle(){let{collapseContent:$}=this;if(!$)return;let{style:H}=$;if(this.isOpen){if(!this.fullHeight)return;H.height=`${this.fullHeight}px`,this.element.classList.remove("collapsed"),setTimeout(()=>{H.removeProperty("height"),H.removeProperty("overflow")},this.animationLengthInMs)}else this.fullHeight=$.clientHeight||$.offsetHeight,H.height=`${this.fullHeight}px`,H.overflow="hidden",this.element.classList.add("collapsed"),requestAnimationFrame(()=>{H.height="0px"})}}function O($,H=1000){return new Promise((L)=>{let h=new Set,M=Array.from($).filter((E)=>!E.complete);if(!M.length){L();return}function T(){if(h.delete(this.src),h.size===0)L()}if(M.forEach((E)=>{if(!h.has(E.src))h.add(E.src),E.addEventListener("error",T),E.addEventListener("load",T)}),H)setTimeout(L,H)})}function J(){let $=document.querySelectorAll(".autodate"),H=Array.from(document.querySelectorAll("[data-timestamp]"));if(!$)return;$.forEach((L)=>{let h=Number.parseInt(L.getAttribute("title")??"",10),M=L.classList.contains("smalldate")?j$(h):C(h);if(M!==L.innerHTML)L.innerHTML=M}),H.forEach((L)=>{if(!L.title)L.title=j$(Number.parseInt(L.dataset.timestamp??"",10))})}function X($){if(document.readyState==="complete")$();else document.addEventListener("DOMContentLoaded",$)}function I$(){let $=document.createElement("input");return $.setAttribute("type","date"),$.type==="date"}function D$(){let $=[String.fromCodePoint(9757,127999),String.fromCodePoint(9757)].map((H)=>{let L=document.body.appendChild(document.createElement("span"));L.appendChild(document.createTextNode(H));let h=L.offsetWidth;return L.remove(),h});return $[0]===$[1]}class s extends j{picker;selectedDate;lastDate;static hydrate($){if(I$())return;G("DatePicker",$.querySelectorAll("input[type=date]"),this)}constructor($){super($);this.picker=this.getPicker(),$.autocomplete="off",$.addEventListener("focus",()=>this.openPicker()),$.addEventListener("keydown",()=>this.closePicker())}getPicker(){if(this.picker)return this.picker;let $=document.querySelector("#datepicker");if(!$)$=Object.assign(document.createElement("table"),{id:"datepicker"}),document.body.appendChild($),$.style.display="none";return $}openPicker(){let $=W(this.element);Object.assign(this.picker.style,{display:"",zIndex:z(),position:"absolute",top:`${$.yh}px`,left:`${$.x}px`});let[H,L,h]=this.element.value.split("/").map((M)=>Number.parseInt(M,10));if(H&&L&&h)this.selectedDate=[h,H-1,L];else this.selectedDate=void 0;this.generate(h,H,L)}closePicker(){this.picker.style.display="none"}generate($,H,L){let h=new Date,M=this.getPicker(),T,E,[F,x,q]=[$,H,L];if(F===void 0)F=h.getFullYear(),x=h.getMonth(),q=h.getDate(),this.selectedDate=[F,x,q];if(x===-1)F-=1,x=11;if(x===12)F+=1,x=0;this.lastDate=[F,x,q];let K=new Date(F,x+1,0).getDate(),P=new Date(F,x,1).getDay();M.innerHTML="",T=M.insertRow(0),E=T.insertCell(0),E.innerHTML="&lt;",E.className="control",E.addEventListener("click",()=>this.lastYear()),E=T.insertCell(1),E.colSpan=5,E.className="year",E.innerHTML=`${F}`,E=T.insertCell(2),E.innerHTML=">",E.className="control",E.addEventListener("click",()=>this.nextYear()),T=M.insertRow(1),E=T.insertCell(0),E.innerHTML="<",E.className="control",E.addEventListener("click",()=>this.lastMonth()),E=T.insertCell(1),E.colSpan=5,E.innerHTML=Y$[x],E.className="month",E=T.insertCell(2),E.innerHTML=">",E.className="control",E.addEventListener("click",()=>this.nextMonth()),T=M.insertRow(2),T.className="weekdays";for(let _=0;_<7;_+=1)T.insertCell(_).innerHTML=A$[_];T=M.insertRow(3);for(let _=0;_<K;_+=1){if(!_)for(let D=0;D<P;D+=1)T.insertCell(D);if((P+_)%7===0)T=M.insertRow(M.rows.length);E=T.insertCell((P+_)%7),E.addEventListener("click",this.insert.bind(this,E));let x$=!!this.selectedDate&&F===this.selectedDate[0]&&x===this.selectedDate[1]&&_+1===this.selectedDate[2];E.className=`day${x$?" selected":""}`,E.innerHTML=`${_+1}`}}lastYear(){let $=this.lastDate;if($)this.generate($[0]-1,$[1],$[2])}nextYear(){let $=this.lastDate;if($)this.generate($[0]+1,$[1],$[2])}lastMonth(){let $=this.lastDate;if($)this.generate($[0],$[1]-1,$[2])}nextMonth(){let $=this.lastDate;if($)this.generate($[0],$[1]+1,$[2])}insert($){let H=this.lastDate;if(H)this.element.value=`${H[1]+1}/${$.innerHTML}/${H[0]}`;this.closePicker()}}class J${rgb;constructor($){let H=/^rgb\((\d+),\s?(\d+),\s?(\d+)\)/i.exec($),L=/#?([\da-fA-F]+)/.exec($);if(H){this.rgb=[Number.parseFloat(H[1]),Number.parseFloat(H[2]),Number.parseFloat(H[3])];return}if(L){let h=L[1];if(h.length===3)h=h.charAt(0)+h.charAt(0)+h.charAt(1)+h.charAt(1)+h.charAt(2)+h.charAt(2);if(h.length!==6){this.rgb=[0,0,0];return}this.rgb=[];for(let M=0;M<3;M+=1)this.rgb[M]=Number.parseInt(h.slice(M*2,(M+1)*2),16)}}invert(){if(this.rgb)this.rgb=[255-this.rgb[0],255-this.rgb[1],255-this.rgb[2]];return this}toRGB(){return this.rgb}toHex(){return"#"+this.rgb?.map(($)=>$.toString(16).padStart(2,"0")).join("")}}var Q$=J$;var X$={a:($,H)=>`[url=${H?.getAttribute("href")}]${$}[/url]`,b(...$){return this.strong(...$)},br:()=>`
`,div:($)=>`
${$}`,em:($)=>`[i]${$}[/i]`,font:($,H)=>{let L=H.style.fontFamily||H.getAttribute("face");return L?`[font=${L}]${$}[/font]`:$},h1:($)=>`[h1]${$}[/h1]`,h2:($)=>`[h2]${$}[/h2]`,h3:($)=>`[h3]${$}[/h3]`,h4:($)=>`[h4]${$}[/h4]`,h5:($)=>`[h5]${$}[/h5]`,h6:($)=>`[h6]${$}[/h6]`,hr:()=>`
`,i(...$){return this.em(...$)},img:($,H)=>{let L=H.getAttribute("alt")??"",h=H.getAttribute("src");if(H.dataset.emoji)return` ${H.dataset.emoji}`;if(h)return`[img]${h}[/img]`;return L},li:($)=>`* ${$.replace(/[\n\r]+/,"")}
`,meta:()=>`
`,ol:($)=>`[ol]${$}[/ol]`,p:($)=>`
${$==="&nbsp"?"":$}
`,strike:($)=>`[s]${$}[/s]`,strong:($)=>`[b]${$}[/b]`,u:($)=>`[u]${$}[/u]`,ul:($)=>`[ul]${$}[/ul]`},t={"background-color":($,H)=>{let L=$&&new Q$($).toHex(),h=L?`${L}`:$;if(["ffffff","white","transparent"].includes(h))return H;return`[bgcolor=${h}]${H}[/bgcolor]`},color($,H){let L=$&&new Q$($).toHex();return`[color=${L?`${L}`:$}]${H}[/color]`},"font-family":($,H)=>`[font=${$.replaceAll(/['"]/g,"")}]${H}[/font]`,"font-style":($,H)=>`[i]${H}[/i]`,"font-size":($,H)=>`[size=${$}]${H}[/size]`,"font-weight":($,H)=>`[b]${H}[/b]`,"text-align":($,H)=>`[align=${$}]${H}[/align]`,"text-decoration":function(H,L){return H==="line-through"?`[strike]${L}[/strike]`:`[u]${L}[/u]`}};function MH($){return $.replaceAll(/[\r\n]+/g,"").replaceAll("&amp;","&").replaceAll("&gt;",">").replaceAll("&lt;","<").replaceAll("&nbsp;"," ")}function P$($){let H=$.tagName.toLowerCase(),L="";for(let T of $.childNodes)L+=T.nodeType===Node.ELEMENT_NODE?P$(T):MH(T.textContent??"");if(H==="body")return L;if($.style){for(let T of $.style)if(T in t)L=t[T]($.style.getPropertyValue(T),L)}let h=$.getAttribute("size");if(h)L=t.fontSize(h,L);let M=$.getAttribute("color");if(M)L=t.color(M,L);if(H in X$)L=X$[H](L,$);return L}function z$($){return $.replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll(/(\s) /g,"$1&nbsp;").replaceAll(/\[b\]([^]*?)\[\/b\]/gi,"<b>$1</b>").replaceAll(/\[i\]([^]*?)\[\/i\]/gi,"<i>$1</i>").replaceAll(/\[u\]([^]*?)\[\/u\]/gi,"<u>$1</u>").replaceAll(/\[s\]([^]*?)\[\/s\]/gi,"<s>$1</s>").replaceAll(/\[img\]([^'"[]+)\[\/img\]/gi,'<img src="$1">').replaceAll(/\[color=([^\]]+)\]([^]*?)\[\/color\]/gi,'<span style="color:$1">$2</span>').replaceAll(/\[size=([^\]]+)\]([^]*?)\[\/size\]/gi,'<span style="font-size:$1">$2</span>').replaceAll(/\[font=['"]?([^\]]+?)['"]?\]([^]*?)\[\/font\]/gi,'<span style="font-family:$1">$2</span>').replaceAll(/\[url=([^\]]+)\]([^]*?)\[\/url\]/gi,'<a href="$1">$2</a>').replaceAll(/\[bgcolor=([^\]]+)\]([^]*?)\[\/bgcolor\]/gi,'<span style="background-color:$1">$2</span>').replaceAll(/\[h(\d)\]([^]*?)\[\/h\1\]/g,"<h$1>$2</h$1>").replaceAll(/\[align=(left|right|center)\]([^]*?)\[\/align\]/g,'<div style="text-align:$1">$2</div>').replaceAll(/\[(ul|ol)\]([^]*?)\[\/\1\]/gi,(H,L,h)=>{let T=h.split(/(^|[\r\n]+)\* ?/).filter((E)=>E.trim()).map((E)=>`<li>${E}</li>`).join("");return`<${L}>${T}</${L}>`}).replaceAll(`
`,"<br>")}var TH=/^(ht|f)tps?:\/\/[\w.\-%&?=/]+$/,EH=($)=>TH.test($),y$={"Sans Serif":["Arial","Arial Black","Arial Narrow","Arial Rounded MT Bold","Avant Garde","Calibri","Candara","Century Gothic","Comic Sans MS","Franklin Gothic Medium","Futura","Geneva","Gill Sans","Helvetica","Impact","Lucida Grande","Optima","Segoe UI","Tahoma","Trebuchet MS","Verdana"],Serif:["Big Caslon","Bodoni MT","Book Antiqua","Calisto MT","Cambria","Didot","Garamond","Georgia","Goudy Old Style","Hoefler Text","Lucida Bright","Palatino","Perpetua","Rockwell","Rockwell Extra Bold","Baskerville","Times New Roman"],Monospaced:["Consolas","Courier New","Lucida Console","Lucida Sans Typewriter","Monaco","Andale Mono"],Fantasy:["Copperplate","Papyrus"],Script:["Brush Script MT"]};class l extends j{iframe;colorWindow;container;htmlMode=!0;editbar;emoteWindow;static hydrate($){G("Editor",$.querySelectorAll("textarea.bbcode-editor"),this)}constructor($){super($);this.container=Object.assign(document.createElement("div"),{className:"editor"}),this.iframe=document.createElement("iframe"),this.iframe.style.display="none",this.iframe.addEventListener("load",()=>this.iframeLoaded(),{once:!0}),$.before(this.container),this.container.appendChild($),this.container.appendChild(this.iframe)}get doc(){return this.window?.document}get window(){return this.iframe.contentWindow}iframeLoaded(){let{iframe:$,element:H}=this;if($.className="editorframe",this.htmlMode=globalSettings.wysiwyg,H.addEventListener("input",()=>{this.setSource(z$(H.value))}),this.doc?.addEventListener("input",()=>{if(!this.doc)return;this.element.value=P$(this.doc.body)}),this.doc?.addEventListener("paste",(M)=>{M.preventDefault();let T=M.clipboardData?.getData("text/plain");this.doc?.execCommand("insertText",!1,T)}),this.doc?.addEventListener("drop",(M)=>{if(!M.dataTransfer?.files.length)return;this.upload(M.dataTransfer.files[0])}),this.doc?.addEventListener("dragleave",()=>{this.getAttachmentStatus().remove()}),this.doc?.addEventListener("dragover",()=>{this.getAttachmentStatus()}),!this.doc)return;let L=R(H),h=this.doc.getElementsByTagName("body")[0];if(h&&L)h.style.backgroundColor=L.backgroundColor,h.style.color=L.color,h.style.borderColor="#FFF";this.doc.designMode="on",this.editbar=this.buildEditBar(),$.style.height=`${H.clientHeight}px`,H.before(this.editbar),this.setSource("<div></div>"),setTimeout(()=>{if(this.setSource(z$(H.value)),this.switchMode(this.htmlMode),H.hasAttribute("autofocus"))this.window?.focus()},100)}getAttachmentStatus(){let $=this.doc?.querySelector("#attachmentStatus");if($)return $;return $=document.createElement("div"),Object.assign($,{id:"attachmentStatus",innerHTML:"Drop file here",contentEditable:"false"}),Object.assign($.style,{position:"fixed",padding:"20px",top:"50%",left:"50%",translate:"-50% -50%",border:"2px dashed #ccc"}),this.doc?.body.appendChild($),$}upload($){let H=new FormData;H.append("Filedata",$);let L=new XMLHttpRequest;this.getAttachmentStatus().innerHTML='Uploading: <progress id="attachmentProgress"></div>';let h=this.getAttachmentStatus().querySelector("#attachmentProgress");L.upload.addEventListener("progress",(M)=>{if(h&&M.lengthComputable){let T=Math.round(M.loaded/M.total*100);h.value=M.loaded,h.max=M.total,h.textContent=`${T}%`}}),L.addEventListener("load",()=>{this.window?.focus(),this.getAttachmentStatus().remove();let M=L.responseText;if(/\D/.test(M)){alert("Error: "+M);return}this.cmd("inserthtml",`[attachment]${L.responseText}[/attachment]`)}),L.upload.addEventListener("error",()=>{this.getAttachmentStatus().remove()}),L.open("POST","/api/upload",!0),L.send(H)}buildEditBar(){let $=document.createElement("div");$.className="editbar",$.innerHTML=[`<select class="fontface">
        <option value="">Default Font</option>
        <optgroup label="Headings">
          <option value="heading_1" style="font-weight:bold;font-size: 2em">Heading 1</option>
          <option value="heading_2" style="font-weight:bold;font-size: 1.5em">Heading 2</option>
          <option value="heading_3" style="font-weight:bold;font-size: 1.17em">Heading 3</option>
          <option value="heading_4" style="font-weight:bold;font-size: 1em">Heading 4</option>
          <option value="heading_5" style="font-weight:bold;font-size: 0.83em">Heading 5</option>
          <option value="heading_6" style="font-weight:bold;font-size: 0.67em">Heading 6</option>
        </optgroup>
      </select>`,'<a class="bold" title="Bold"></a>','<a class="italic" title="Italic"></a>','<a class="underline" title="Underline"></a>','<a class="strikethrough" title="Strike-Through"></a>','<a class="forecolor" title="Foreground Color"></a>','<a class="backcolor" title="Background Color"></a>','<a class="insertimage" title="Insert Image"></a>','<a class="createlink" title="Insert Link"></a>','<a class="c_email" title="Insert Email"></a>','<a class="justifyleft" title="Align Left"></a>','<a class="justifycenter" title="Center"></a>','<a class="justifyright" title="Align Right"></a>','<a class="c_youtube" title="Insert video from any of your favorite video services!"></a>','<a class="c_code" title="Insert code"></a>','<a class="c_quote" title="Insert Quote"></a>','<a class="c_spoiler" title="Insert Spoiler"></a>','<a class="insertorderedlist" title="Create Ordered List"></a>','<a class="insertunorderedlist" title="Create Unordered List"></a>','<a class="c_smileys" title="Insert Emoticon"></a>','<a class="c_switcheditmode" title="Switch editor mode"></a>'].join(""),$.addEventListener("click",(L)=>{if(L.target instanceof HTMLElement&&L.target.matches(".editbar a"))this.editbarCommand(L,L.target.className)});let H=$.querySelector("select.fontface");if(H){H.addEventListener("input",(L)=>{let h=H.value;if(h.startsWith("heading_"))this.editbarCommand(L,"heading",h.replace("heading_","h"));else if(h)this.editbarCommand(L,"fontname",h)});for(let L of Object.keys(y$)){let h=y$[L].map((M)=>`<option style="font-family: ${M}">${M}</option>`);H.innerHTML+=`<optgroup label="${L}">${h}</optgroup>`}}return $}editbarCommand($,H,L){switch($.preventDefault(),H){case"forecolor":case"backcolor":this.showColors($.pageX,$.pageY,H);break;case"c_smileys":this.showEmotes($.pageX,$.pageY);break;case"c_switcheditmode":this.switchMode(!this.htmlMode);break;default:this.cmd(H,L);break}}async showEmotes($,H){let L=this.emoteWindow;if(!L){let h=await fetch("/api/emotes"),M=await h.json();if(h.ok)this.createEmoteWindow(M,{x:$,y:H});return}if(L.style.display==="none")L.style.display="",L.style.left=`${$}px`,L.style.top=`${H}px`;else this.hideEmotes()}hideEmotes(){if(this.emoteWindow)this.emoteWindow.style.display="none"}createEmoteWindow([$,H],L){let h=document.createElement("div");h.className="emotewin",$.forEach((M,T)=>{let E=H[T],F=document.createElement("a");F.href="javascript:void(0)",F.addEventListener("click",()=>{this.cmd("inserthtml",E),this.hideEmotes()}),F.innerHTML=`${E} ${M}`,h.appendChild(F)}),h.style.position="absolute",h.style.display="none",this.emoteWindow=h,document.querySelector("#page")?.appendChild(h),this.showEmotes(L.x,L.y)}colorHandler($,H){this.cmd($,H),this.hideColors()}showColors($,H,L){this.hideColors();let M=V(`
      <div>
        ${["#FFFFFF","#AAAAAA","#000000","#FF0000","#00FF00","#0000FF","#FFFF00","#00FFFF","#FF00FF"].map((T)=>`<button style="background-color:${T}" data-color="${T}"></button>`).join("")}
      </div>
    `);return Object.assign(M.style,{display:"grid",gridTemplateColumns:"20px 20px 20px",gridTemplateRows:"20px 20px 20px",position:"absolute",top:`${H}px`,left:`${$}px`,cursor:"pointer",zIndex:z()}),M.addEventListener("click",(T)=>{if(T.target instanceof HTMLButtonElement&&T.target.dataset.color)this.colorHandler(L,T.target.dataset.color)}),this.colorWindow=M,document.querySelector("#page")?.appendChild(M),null}hideColors(){if(this.colorWindow)this.colorWindow.remove(),this.colorWindow=void 0}cmd($,H){let L=this.getSelection(),h="",M=$,T=H;switch($.toLowerCase()){case"bold":h=`[b]${L}[/b]`;break;case"italic":h=`[i]${L}[/i]`;break;case"underline":h=`[u]${L}[/u]`;break;case"strikethrough":h=`[s]${L}[/s]`;break;case"justifyright":h=`[align=right]${L}[/align]`;break;case"justifycenter":h=`[align=center]${L}[/align]`;break;case"justifyleft":h=`[align=left]${L}[/align]`;break;case"insertimage":if(T=prompt("Image URL:")||"",!T)return;if(!EH(T)){alert("Please enter a valid URL.");return}h=`[img]${T}[/img]`;break;case"insertorderedlist":if(!this.htmlMode)h=`[ol]${L.replaceAll(/(.+([\r\n]+|$))/i,"* $1")}[/ol]`;break;case"insertunorderedlist":if(!this.htmlMode)h=`[ul]${L.replaceAll(/(.+([\r\n]+|$))/i,"* $1")}[/ul]`;break;case"createlink":if(T=prompt("Link:")||"",!T)return;if(!/^(https?|ftp|mailto):/.test(T))T=`https://${T}`;h=`[url=${T}]${L}[/url]`;break;case"c_email":if(T=prompt("Email:")||"",!T)return;M="createlink",T=`mailto:${T}`,h=`[url=${T}]${L}[/url]`;break;case"backcolor":if(p.firefox||p.safari)M="hilitecolor";h=`[bgcolor=${T}]${L}[/bgcolor]`;break;case"forecolor":h=`[color=${T}]${L}[/color]`;break;case"fontname":h=`[font=${T}]${L}[/font]`;break;case"c_code":M="inserthtml",T=`[code]${L}[/code]`,h=T;break;case"c_quote":M="inserthtml",T=prompt("Who said this?")||"",T=T?`=${T}`:"",T=`[quote${T}]${L}[/quote]`,h=T;break;case"c_spoiler":M="inserthtml",T=`[spoiler]${L}[/spoiler]`,h=T;break;case"c_youtube":if(M="inserthtml",T=prompt("Video URL?")||"",!T)return;T=`[video]${T}[/video]`,h=T;break;case"inserthtml":h=T||"";break;case"heading":if(h=`[${T}]${L}[/${T}]`,p.chrome)M="formatBlock",T=`<${T}>`;break;default:throw Error(`Unsupported editor command ${$}`)}if(this.htmlMode)this.doc?.execCommand(M,!1,T),this.doc?.dispatchEvent(new Event("input")),this.window?.focus();else O$(this.element,h),this.element.dispatchEvent(new Event("input"))}getSelection(){if(this.htmlMode)return this.window?.getSelection()?.toString()||"";return this.element.value.substring(this.element.selectionStart,this.element.selectionEnd)}getSource(){return this.doc?.body.innerHTML}setSource($){if(this.doc)this.doc.body.innerHTML=$}switchMode($){let{element:H,iframe:L}=this;if($)H.style.display="none",L.style.display="";else H.style.display="",L.style.display="none";this.htmlMode=$}}class m extends j{resetOnSubmit;static hydrate($){G("Form",$.querySelectorAll("form[data-ajax-form]"),this)}constructor($){super($);this.resetOnSubmit=$.dataset.ajaxForm==="resetOnSubmit",$.addEventListener("submit",(H)=>{H.preventDefault(),this.submitForm()})}submitForm(){let{element:$,resetOnSubmit:H}=this,{submitButton:L}=$,h=new FormData($,L),M=Array.from(h.entries()).filter((T)=>typeof T[1]==="string");if(RUN.stream.load($.action||globalThis.location.toString(),{body:new URLSearchParams(M)}),H)$.reset();RUN.stream.pollData()}}class a extends j{index;images;max;static hydrate($){G("ImageGallery",$.querySelectorAll(".image_gallery"),this)}constructor($){super($);let H=document.createElement("div"),L=document.createElement("button"),h=document.createElement("button");this.index=0,this.images=$.querySelectorAll("img"),this.max=Math.max(this.images.length,1),L.innerHTML="Next &raquo;",L.addEventListener("click",()=>{this.showNext()}),h.innerHTML="Prev &laquo;",h.addEventListener("click",()=>{this.showPrev()}),this.update(),H.appendChild(h),H.appendChild(document.createTextNode(" ")),H.appendChild(L),$.appendChild(H)}showNext(){if(this.index<this.max-1)this.index+=1;this.update()}showPrev(){if(this.index>0)this.index-=1;this.update()}update(){this.images.forEach(($,H)=>{let L=$.dataset.madeResized?$.parentNode:$;if(L)L.style.display=H===this.index?"block":"none"})}}var k$="999999px";class n extends j{static async hydrate($){let H=$.querySelectorAll(".bbcodeimg");await O(Array.from(H)),G("ImageResizer",H,this)}constructor($){super($);let H=1,L=1,{naturalWidth:h,naturalHeight:M}=$,T=R($),E=Number.parseInt(T.width,10)||Number.parseInt(T.maxWidth,10),F=Number.parseInt(T.height,10)||Number.parseInt(T.maxHeight,10);if(E&&h>E)H=E/M;if(F&&M>F)L=F/M;if(H=H&&L?Math.min(H,L):L||H,H<1)this.makeResizer(h*H,M*H)}makeResizer($,H){let{element:L}=this;L.style.maxWidth=k$,L.style.maxHeight=k$,L.dataset.madeResized="true";let h=Object.assign(document.createElement("a"),{target:"_blank",href:L.src});Object.assign(h.style,{display:"block",overflow:"hidden",width:`${$}px`,height:`${H}px`}),h.dataset.nw=`${L.naturalWidth}`,h.dataset.nh=`${L.naturalHeight}`,h.addEventListener("mousemove",(T)=>{let{x:E,y:F,w:x,h:q}=W(h);h.scrollLeft=(T.pageX-E)/x*(+(h.dataset.nw||0)-x)||0,h.scrollTop=(T.pageY-F)/q*(+(h.dataset.nh||0)-q)||0}),h.addEventListener("mouseover",()=>{L.style.width=`${h.dataset.nw}px`,L.style.height=`${h.dataset.nh}px`});let M=()=>{if(h.scrollLeft)h.scrollLeft=0,h.scrollTop=0;L.style.width=`${$}px`,L.style.height=`${H}px`};h.addEventListener("mouseout",M),M(),L.before(h),h.appendChild(L)}}function y($){let H=W($),L=$.getAttribute("title");if($.dataset.lastOnline){let M=Number.parseInt($.dataset.lastOnline??"",10);L=`Last Online: ${C(M)} ${G$(M)}`}if(!L)return;let h=document.querySelector("#tooltip");if(!h)h=V('<div id="tooltip" class="tooltip">Default text</div>'),document.querySelector("#page")?.appendChild(h);$.title="",$.addEventListener("mouseout",()=>{$.title=L,h.style.display="none"}),h.innerText=L,h.style.display="",Object.assign(h.style,{top:`${H.y-h.offsetHeight}px`,left:`${H.x}px`,zIndex:`${z()}`})}class o extends j{static hydrate($){G("Link",$.querySelectorAll("a"),this)}constructor($){super($);if($.dataset.useTooltip)$.addEventListener("mouseover",()=>y($));if(!$.href)return;let H=$.getAttribute("href"),L=!$.target&&H&&(H.startsWith("/")||H.startsWith("?"));if(H?.startsWith("javascript"))return;if(L){let M=$.onclick;$.onclick=null,$.addEventListener("click",(T)=>{if(T.preventDefault(),!M||M.call($,T)!==!1)RUN.stream.location(H)});return}$.target="_blank"}}class g${title="Title";wait=!0;content="Content";open=!1;minimizable=!0;resize;className="";pos="center";zIndex;windowContainer;id;onclose;animate=!0;oldpos="";constructor($={}){this.zIndex=z(),Object.assign(this,$)}render(){let $=V(`
      <div id="${this.id||""}" class="window ${this.className}">
        <div class="title">
          ${this.title}
          <div class="controls">
            ${this.minimizable?'<button data-action="minimize">-</button>':""}
            <button data-action="close" data-shortcut="Escape">X</button>
          </div>
        </div>
        <div class="content">${this.content}</div>
      </div>`);this.windowContainer=$,$.addEventListener("click",(M)=>{if(M.target instanceof HTMLElement){let T=M.target.dataset.action;if(T&&T in this)this[T]()}});let H=document.querySelector(".windows");if(!H)H=V('<div class="windows" style="z-index: 1"></div>'),document.body.appendChild(H);if(H.appendChild($),this.resize)this.renderResizeHandle(this.resize);let L=$.style;L.zIndex=`${this.zIndex+5}`;let{pos:h}=this;if(this.wait)O(Array.from($.querySelectorAll("img"))).then(()=>{this.setPosition(h)});else this.setPosition(h);return new f().autoZ().noChildActivation().boundingBox(0,0,document.documentElement.clientWidth-50,document.documentElement.clientHeight-50).apply($,$.querySelector(".title")||void 0),$}renderResizeHandle($){let{windowContainer:H}=this;if(!H)return;let L=H.querySelector($);if(!L)throw Error("Resize target not found");L.style.width=`${L.clientWidth}px`,L.style.height=`${L.clientHeight}px`;let h=V('<div class="resize"></div>');H.appendChild(h),h.style.left=`${H.clientWidth-16}px`,h.style.top=`${H.clientHeight-16}px`,new f().boundingBox(100,100,1/0,1/0).addListener({ondrag(M){let T=Number.parseFloat(L.style.width)+(M.dx??0),E=Number.parseFloat(L.style.height)+(M.dy??0);if(L.style.width=`${T}px`,T<H.clientWidth-20)L.style.width=`${H.clientWidth}px`;else h.style.left=`${H.clientWidth-16}px`;L.style.height=`${E}px`},ondrop(){h.style.left=`${H.clientWidth-16}px`}}).apply(h),L.style.width=`${H.clientWidth}px`,h.style.left=`${H.clientWidth-16}px`}close(){if(!this.windowContainer)return;if(this.windowContainer.remove(),this.windowContainer=void 0,this.onclose)this.onclose()}minimize(){let{windowContainer:$}=this;if(!$)return;let H=!$.classList.toggle("minimized");if($.querySelector(".controls [data-action=minimize]").innerHTML=H?"-":"\uD83D\uDDD6",H)$.removeAttribute("draggable");else $.setAttribute("draggable","false"),this.oldpos=this.getPosition();this.setPosition(H?this.oldpos:"",!1)}setPosition($,H=!0){let L=this.windowContainer;if(!L)return;let h=0,M=0,T=document.documentElement.clientHeight,E=document.documentElement.clientWidth;if($==="center")M=Math.floor((T-L.clientHeight)/2),h=Math.floor((E-L.clientWidth)/2);else{let F=/(\d+) (\d+)/.exec($);if(F)h=Number(F[1]),M=Number(F[2])}if(L.style.left=`${h}px`,this.animate&&H)A(L,[{top:`${M-100}px`},{top:`${M}px`}],300,"ease-out");else L.style.top=`${M}px`;this.pos=$}getPosition(){if(!this.windowContainer)return"";let $=this.windowContainer.style;return`${Number.parseFloat($.left)} ${Number.parseFloat($.top)}`}}var N=g$;class e extends j{static hydrate($){G("MediaPlayer",$.querySelectorAll(".media"),this)}constructor($){super($);let H=$.querySelector("a.popout"),L=$.querySelector("a.inline"),h=$.querySelector(".movie");if(!h)return;H?.addEventListener("click",(M)=>{M.preventDefault(),new N({title:H.href,content:h.innerHTML}).render()}),L?.addEventListener("click",(M)=>{M.preventDefault(),h.style.display="block"})}}var C$=[[-1,0],[1,0],[0,1],[0,-1],[-1,1],[-1,-1],[1,-1],[1,1]];class $$ extends j{static hydrate($){G("Othello",$.querySelectorAll(".othello"),this)}constructor($){super($);$.addEventListener("click",(H)=>{if(H.target instanceof HTMLTableCellElement&&!H.target.querySelector(".piece")){if(this.placePiece(H.target))this.updateScore(),this.moveNumber++,navigator.clipboard.writeText(`[othello]${this.getGameState()}[/othello]`),Q.success("BBCode copied to clipboard")}}),this.updateScore(),B.load("chessdrop")}placePiece($){let H=this.moveNumber%2?"black":"white",L=this.moveNumber%2?"white":"black",h=Array.from({length:8},()=>[]),M=Array.from({length:8},()=>!1),T=Z($);for(let F=1;F<=8;F++){let x;for(let q=0;q<8;q++){if(M[q])continue;if(x=this.getPieceAt(T[0]+F*C$[q][0],T[1]+F*C$[q][1]),!x){M[q]=!0,h[q]=[];continue}if(x.classList.contains(L)){h[q].push(x);continue}if(x.classList.contains(H))M[q]=!0}}let E=h.flat();if(!E.length)return Q.error("Invalid move! You must capture opposing pieces."),!1;return E.forEach((F)=>{F.classList.add(H),F.classList.remove(L)}),$.append(V(`<div class="piece ${H}"></div>`)),!0}get moveNumber(){return Number(this.element.dataset.moveNumber??"1")}set moveNumber($){this.element.dataset.moveNumber=`${$}`}isValidMove(){return!0}getPieceAt($,H){if($<0||H<0||$>=8||H>=8)return;return this.element.rows[$].cells[H].querySelector(".piece")??void 0}updateScore(){this.element.querySelector(".score-white").innerHTML=this.element.querySelectorAll(".piece.white").length+"",this.element.querySelector(".score-black").innerHTML=this.element.querySelectorAll(".piece.black").length+""}getGameState(){let $=[];for(let H=0;H<8;H++){$.push("");for(let L=0;L<8;L++){let h=this.getPieceAt(H,L);if(!h)$[H]+=" ";else if(h.classList.contains("white"))$[H]+="w";else if(h.classList.contains("black"))$[H]+="b"}}return $.join("/").replaceAll(/ +/g,(H)=>`${H.length}`)}}class H$ extends j{static hydrate($){G("PageList",$.querySelectorAll(".pages"),this)}constructor($){super($);$.addEventListener("wheel",(H)=>this.wheel(H))}wheel($){$.preventDefault();let H=Math.sign($.deltaY),L=Array.from(this.element.querySelectorAll("a")),h=Number.parseInt(L[1].innerHTML,10),M=Number.parseInt(L.at(-1)?.innerHTML||"",10),T=L.length-2;if(H>0&&h+T<M||H<0&&h>2)for(let E=0;E<T;E+=1)L[E+1].href=L[E+1].href.replace(/\d+$/,`${E+h+H}`),L[E+1].innerHTML=`${h+E+H}`}}class L$ extends j{static hydrate($){G("Spoiler",$.querySelectorAll(".spoilertext"),this)}constructor($){super($);$.addEventListener("click",function(){this.classList.toggle("spoiled")})}}class h$ extends j{static hydrate($){G("Switch",$.querySelectorAll("input.switch"),this)}constructor($){super($);$.style.display="none";let H=Object.assign(document.createElement("button"),{type:"button",title:$.className,className:$.className}),L=()=>{H.style.backgroundPosition=$.checked?"top":"bottom"};L(),H.addEventListener("click",()=>{$.checked=!$.checked,L(),$.dispatchEvent(new Event("change"))}),$.after(H)}}var S$="active";class M$ extends j{static hydrate($){G("Tabs",$.querySelectorAll(".tabs"),this)}constructor($){super($);$.addEventListener("click",(H)=>this.click(H))}click($){let{tabSelector:H}=this.element.dataset,{target:L}=$;if(!L||!(L instanceof HTMLElement)||L.tagName.toLowerCase()!=="a")return;let h=L;if(H){let T=L.closest(H);if(T)h=T}let M=this.element.querySelector(`.${S$}`);if(M)M.classList.remove(S$);h.className=S$,h.blur()}}var v$=[w,c,d,i,r,s,l,m,v,a,n,o,e,$$,H$,L$,h$,M$];function S($){J(),v$.forEach((H)=>{H.hydrate($)})}var I={loadscript($){document.body.appendChild(Object.assign(document.createElement("script"),{src:$}))},script($){(0,eval)($)},error($){Q.error($)},success($){Q.success($)},reload($=0){setTimeout(()=>globalThis.location.reload(),$)},refreshdata(){RUN.stream.pollData(!0)},addclass($,H){let L=document.querySelector($);if(L)L.classList.add(H)},title($){document.title=$},update($,H,L){let h=$,M=Array.from(document.querySelectorAll(".path"));if(h==="path"&&M.length>1){M.forEach((F)=>{F.innerHTML=H,S(F)});return}if(!/^\W/.test(h))h=`#${h}`;let T=document.querySelector(h);if(!T)return;T.innerHTML=H;let E=T.querySelector("[autofocus]");if(E)E.focus();if(L)B$(T);S(T)},removeel($){let H=document.querySelector($);if(H)H.remove()},back(){globalThis.history.back()},setstatus($){let H=document.querySelector("#status");if(H)H.className=$},appendrows($,H){let L=document.querySelector($);if(!L)return;let h=document.createElement("span");h.innerHTML=`<table>${H}</table>`;let M=h.getElementsByTagName("tbody")[0];S(M),L.appendChild(M)},location($){if(["?","/"].includes($.charAt(0))){RUN.stream.location($);return}document.location=$},enable($){let H=document.querySelector(`#${$}`);if(H)H.disabled=!1},addshout($){let H=Array.from(document.querySelectorAll("#shoutbox .shout")),L=document.createElement("span");L.innerHTML=$;let h=L.firstElementChild;if(!h)return;H[0].parentNode?.insertBefore(h,H[0]);while(H.length>globalSettings.shoutLimit-1)H.pop()?.remove();if(B$(h),globalSettings.soundShout)B.play("blip");S(h)},tick($){let H=document.querySelector("#ticker");if(!H)return;let L=document.createElement("div");L.innerHTML=$,L=L.firstElementChild,H.insertBefore(L,H.firstChild);let h=Array.from(H.querySelectorAll(".tick"));for(let M=100;M<h.length;M+=100)h[M].remove()},im($,H,L,h,M){w$({fromId:$,fromName:H,message:L,fromMe:h,timestamp:M})},imtoggleoffline($){document.querySelector(`#im_${$}`)?.classList.add("offline")},window($){if($.id&&document.getElementById($.id))return;let L=new N($);S(L.render())},closewindow($){let H=document.querySelector($+" [data-action=close]");if(H)H.click()},onlinelist($){let H=document.querySelector("#statusers");if(!H)return;$.forEach((L)=>{let h=document.querySelector(`#statusers .user${L.uid}`);if(!h)h=document.createElement("a"),h.addEventListener("click",function(){if(this.href)RUN.stream.location(this.href)}),h.addEventListener("mouseover",function(){y(this)});if(L.profileURL)h.href=L.profileURL;if(h.innerHTML=L.name,h.className=[`user${L.uid}`,`mgroup${L.groupID}`,L.status,`lastAction${L.lastAction}`].join(" "),L.locationVerbose)h.title=L.locationVerbose;if(L.status==="idle"){_$(h);return}if(H.firstChild)H.insertBefore(h,H.firstChild);else H.appendChild(h)})},snow($){Y($)},confetti($){Y($,!0)},setoffline($){let H=document.querySelector("#statusers");$.split(",").forEach((h)=>{let M=document.querySelector(`#statusers .user${h}`);if(M&&H)M.remove()})},async scrollToPost($){let H=document.getElementById(`pid_${$}`);if(!H)return!1;await O(Array.from(document.querySelectorAll("#page img")));let L=W(H);return globalThis.scrollTo({top:L.y}),!0},updateqreply($){let L=document.querySelector("#qreply")?.querySelector("textarea");if(L)L.focus(),L.value+=$,L.dispatchEvent(new Event("input"))},newmessage($,H){let L=document.querySelector("#notification"),h=document.querySelector("#num-messages");if(h)h.innerHTML=`${Number.parseInt(h.innerHTML,10)+1}`;if(!L)L=document.createElement("div"),L.id="notification",document.body.appendChild(L);L.style.display="",L.className="newmessage",L.addEventListener("click",()=>{L.style.display="none",RUN.stream.location(`/ucp/inbox?view=${H}`,3)}),L.innerHTML=$},playsound($){B.loadAndPlay($)},listrating($,H){let L=document.querySelector(`#postrating_${$}`),h;if(L){if(L.style.display!=="none"){A(L,[{height:"200px"},{height:"0px"}],300).then((M)=>M.style.display="none");return}L.style.display="block"}else{L=document.createElement("div"),L.className="postrating_list",L.id=`postrating_${$}`;let M=document.querySelector(`#pid_${$} .postrating`);if(!M)return;h=W(M),L.style.top=`${h.yh}px`,L.style.left=`${h.x}px`,document.querySelector("#page")?.appendChild(L)}L.innerHTML=H,A(L,[{height:"0px"},{height:"200px"}],300)}};var c$,U="",p$="";function W$(){if(U)document.title=U;U="",clearInterval(c$)}function d$($){if(document.hasFocus())return;if(W$(),!U)U=document.title;p$=$,c$=setInterval(()=>{document.title=document.title===U?p$:U},1000)}function FH($,H){if(d$(`New message from ${$}!`),!document.hasFocus()&&globalThis.Notification&&Notification.permission==="granted"){let L=new Notification(`${$} says:`,{body:H});L.onclick=()=>{globalThis.focus(),L.close()}}}function xH({fromId:$,fromName:H,message:L}){let h=document.querySelector(`#im_${$} .ims`);if(h)return h;let T=new N({title:`${H}`,content:`
        <div class='ims'></div>
        <div class='offline'>This user may be offline</div>
        <div>
            <form data-ajax-form='resetOnSubmit' method='post'>
                <input type='hidden' name='im_uid' value='${$}'>
                <input type='text' name='im_im' autocomplete='off'>
            </form>
        </div>
    `,className:"im",resize:".ims",animate:!0,id:`im_${$}`}).render();S(T);let E=()=>{T.querySelector('form input[name="im_im"]')?.focus()};T.addEventListener("click",E),E(),h=T.querySelector(".ims");let F=getComputedStyle(h);if(h.style.width=F.width,h.style.height=F.height,L&&globalSettings.soundIM)B.play("receive");return h}function V$($,H){if(!globalSettings.canIM){alert("You do not have permission to use this feature.");return}I.im($,H,"",1,Date.now())}function w$({fromId:$,fromName:H,message:L,fromMe:h,timestamp:M}){FH(H,L);let T=xH({fromId:$,fromName:H,message:L});if(!L)return;let E=L.startsWith("/me");if(!h)document.querySelector(`#im_${$}`)?.classList.remove("offline");let F=V(`
    <div class="${E?"action":""} ${h?"you":"them"}" data-timestamp="${M}">
      <a href="/profile/${h||$}" class="name">${E?"***"+H:H}</a>
      ${E?L.substring(3):": "+L}
    </div>
  `);if(T.appendChild(F),S(F),T.scrollTop>T.scrollHeight-T.clientHeight-50)T.scrollTop=T.scrollHeight;if(globalSettings.soundIM)B.play("receive")}function qH($){let H=$?$.split(","):[],L=H.length===1?"":"s",h=H.length?" and <br>":"";return[H,L,h]}function jH($){let H=$?$.split(","):[],h=(H?H.length:0)===1?"":"s";return[H,h]}class T${whichone=0;boundCheckLocation;pids=[];tids=[];modb;constructor(){this.boundCheckLocation=()=>this.checkLocation(),Object.assign(I,{modcontrols_clearbox:this.destroyModControls.bind(this),modcontrols_move:this.showMoveControls.bind(this),modcontrols_postsync:this.postSync.bind(this)})}checkLocation(){let{whichone:$}=this,L=($?/topic\/(\d+)/:/forum\/(\d+)/).exec(document.location.toString());if(L)this.moveTo(Number(L[1]));else this.showMoveControls($)}moveTo($){let{whichone:H}=this;this.renderModControls(`<form method="post" action="/modcontrols" data-ajax-form="true">
                move ${H?"posts":"topics"} here?
            <input type="hidden"
                name="${H?"dop":"dot"}"
                value="moveto">
            <input type="hidden" name="id" value="${$}">
            <input type="submit" value="Yes">
            <input type="submit" name="cancel" value="Cancel" onclick="this.form.submitButton=this">
            </form>`)}renderModControls($){if(this.modb=this.modb||document.querySelector("#modbox")||void 0,!this.modb)this.modb=document.createElement("div"),this.modb.id="modbox",document.body.appendChild(this.modb);this.modb.style.display="block",this.modb.innerHTML=$,S(this.modb)}destroyModControls(){if(globalThis.removeEventListener("pushstate",this.boundCheckLocation),this.modb)this.modb.innerHTML="",this.modb.style.display="none"}togbutton($){$.classList.toggle("selected")}postSync($,H){let[L,h,M]=qH($),[T,E]=jH(H);if(this.tids=T,this.pids=L,!T.length&&!L.length){this.destroyModControls();return}let F=T.length?`
            <select name="dot">
                <option value="delete">Delete</option>
                <option value="merge">Merge</option>
                <option value="move">Move</option>
                <option value="pin">Pin</option>
                <option value="unpin">Unpin</option>
                <option value="lock">Lock</option>
                <option value="unlock">Unlock</option>
            </select> &nbsp; &nbsp;
            <strong>${T.length}</strong> topic${E}${M}`:"",x=L.length?`
            <select name="dop">
                <option value="delete">Delete</option>
                <option value="move">Move</option>
            </select> &nbsp; &nbsp;
            <strong>${L.length}</strong> post${h}`:"",q=L.length&&T.length?"<br>":" &nbsp; &nbsp; ",K=`
        <form method="post" action="/modcontrols" data-ajax-form="true">
            ${F}
            ${x}
            ${q}
            <input type="submit" value="Go">
            <input
                name="cancel" type="submit"
                onclick="this.form.submitButton=this;" value="Cancel">
        </form>`;this.renderModControls(K)}showMoveControls($){this.whichone=$,globalThis.addEventListener("pushstate",this.boundCheckLocation),this.renderModControls(`Ok, now browse to the ${this.whichone?"topic":"forum"} you want to move the ${this.whichone?`${this.pids.length} posts`:`${this.tids.length} topics`} to...`)}}function GH(){new N({title:"Keyboard Shortcuts",id:"shortcuts",content:`
      <style>
        #shortcuts { width: 300px; }
        #shortcuts dt { float: left;margin-left: 5px;}
      </style>
      <h3>Navigation</h3>
      <dl>
        <dt>?</dt><dd>This help window</dd>
        <dt>h</dt><dd>Home / Board Index</dd>
        <dt>i</dt><dd>Inbox</dd>
        <dt>s</dt><dd>Settings</dd>
        `+(globalSettings.isAdmin?"<dt>a</dt><dd>Admin CP</dd>":"")+(globalSettings.isMod?"<dt>m</dt><dd>Moderator CP</dd>":"")+`</dl>

      <h3>Inbox</h3>
      <dl>
        <dt>c</dt><dd>Compose</dd>
        <dt>i</dt><dd>Inbox</dd>
        <dt>f</dt><dd>Flagged Messages</dd>
        <dt>r</dt><dd>Reply to Message</dd>
      </dl>

      <h3>Forum/Topic</h3>
      <dl>
        <dt>t</dt><dd>New Topic</dd>
        <dt>r</dt><dd>Reply</dd>
      </dl>
      `}).render()}function i$($){if($.target instanceof HTMLInputElement||$.target instanceof HTMLTextAreaElement||$.target instanceof HTMLSelectElement)return;if($.key==="?"){GH();return}document.documentElement.querySelector(`[data-shortcut="${$.key}"]`)?.click()}var _H=5000;class E${commands;lastURL;timeout;constructor(){this.lastURL=`${document.location.pathname}${document.location.search}`,this.commands=I}handleRequestData($,H,L=1){let h=!1;if(H.forEach(([M,...T])=>{if(M==="preventNavigation")h=!0;else if(M in this.commands)this.commands[M].apply(null,T)}),L>=2){if(!h)globalThis.history.pushState({lastURL:$},"",$),globalThis.dispatchEvent(new Event("pushstate")),this.lastURL=$}this.pollData()}location($,H=2){this.load($,{requestType:H})}async load($,{body:H,method:L="POST",requestType:h=1}={}){try{let M=await fetch($,{method:L,body:H,headers:{"X-JSACCESS":`${h}`,"Content-Type":"application/x-www-form-urlencoded"}});if(M.ok){let T=await M.json();this.handleRequestData($,T,h);return}Q.error("An unrecoverable error has occurred.<br>Please try again later.")}catch(M){if(!navigator.onLine)Q.error("You appear to be offline.");else Q.error("Network fetch failed: timeout")}}pollData($=!1){if($)this.load(this.lastURL);if(clearTimeout(this.timeout),document.cookie.includes(`actw=${window.name}`))this.timeout=setTimeout(()=>this.load(this.lastURL),_H)}updatePage($){if($!==this.lastURL)this.location($,3)}}var BH=2;class r${stream=new E$;onAppReady(){if(BH)S(document.body);let $=new Date;if($.getMonth()===11&&[23,24,25].includes($.getDate()))Y();J(),setInterval(J,30000),this.stream.pollData(),globalThis.addEventListener("popstate",({state:L})=>{if(L){let{lastURL:h}=L;this.stream.updatePage(h)}else this.stream.updatePage(document.location.toString())}),B.load("blip"),B.load("receive")}handleQuoting($){let H=new URLSearchParams($.search),L=H.get("quote");if(L){let h=document.querySelector(`#pid_${L} .post_content`),M=window.getSelection();if(h&&M&&h.contains(M.anchorNode)&&h.contains(M.focusNode))H.set("quotedText",M.toString())}H.set("qreply",document.querySelector("#qreply")?"1":"0"),this.stream.load(`${$.pathname}?${H.toString()}`)}setWindowActive(){document.cookie=`actw=${window.name}; SameSite:Lax`,W$(),this.stream.pollData()}}var F$=new r$;X(()=>{F$.onAppReady()});X(()=>{window.name=`${Math.random()}`,F$.setWindowActive(),globalThis.addEventListener("focus",()=>{F$.setWindowActive()})});X(function(){if(!D$())document.documentElement.classList.add("no-emoji");document.documentElement.classList.add("js-enabled")});X(()=>{globalThis.addEventListener("keyup",i$)});var s$=F$;Object.assign(globalThis,{RUN:s$,IMWindow:V$,ModControls:new T$});

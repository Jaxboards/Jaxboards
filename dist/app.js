"use strict";(()=>{function w(i,e){return i?i.currentStyle?i.currentStyle:window.getComputedStyle?window.getComputedStyle(i,e):!1:!1}function y(i){let{x:e,y:t,height:o,width:s}=i.getBoundingClientRect(),n=e+window.scrollX,l=t+window.scrollY;return{x:n,y:l,yh:l+o,xw:n+s,w:s,h:o}}function ge(i,e){return e.contains(i)}function j(i,e){i.parentNode&&i.parentNode.removeChild(i),e.parentNode.insertBefore(i,e)}function X(i,e){i.parentNode&&i.parentNode.removeChild(i),e.parentNode.insertBefore(i,e.nextSibling)}function b(){return Array.from(document.getElementsByTagName("*")).reduce((t,o)=>o.style.zIndex&&Number(o.style.zIndex)>t?Number(o.style.zIndex):t,0)+1}function Re(i){return i+(Math.round(i/10)===1?"th":["","st","nd","rd"][i%10]||"th")}function Q(i){let e=i.getHours()||12,t=`${i.getMinutes()}`.padStart(2,"0");return`${e%12||12}:${t}${e>12?"pm":"am"}`}function J(i){return`${i.getMonth()}/${i.getDate()}/${i.getFullYear()}`}var ze=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],ye=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],we=["January","February","March","April","May","June","July","August","September","October","November","December"];function be(i){let e=new Date,t=new Date;t.setTime(t-1e3*60*60*24);let o=new Date(i*1e3),s=(e-o)/1e3;return s<90?"a minute ago":s<3600?`${Math.round(s/60)} minutes ago`:J(e)===J(o)?`Today @ ${Q(o)}`:J(t)===J(o)?`Yesterday @ ${Q(o)}`:`${ze[o.getMonth()]} ${Re(o.getDate())}, ${o.getFullYear()} @ ${Q(o)}`}function K(i){let e=new Date(i*1e3),t=e.getHours(),o=t>=12?"pm":"am";t%=12,t=t||12;let s=`${e.getMinutes()}`.padStart(2,"0"),n=e.getMonth()+1,l=`${e.getDate()}`.padStart(2,"0"),r=e.getFullYear();return`${t}:${s}${o}, ${n}/${l}/${r}`}function We(i){let e=new Date(i);return String.fromCharCode(55357,56656+((e.getHours()%12||12)-1)+(e.getMinutes()>29?12:0))}function Z(i){let e=Array.from(i.classList).find(t=>t.startsWith("lastAction"));e!==void 0&&(i.prepend(We(parseInt(e.slice(10),10))),i.classList.remove(e))}function g(i,e){return Object.assign(i,e)}function T(i,...e){return i&&typeof i=="function"?i(...e):null}function M(i,e=2e3){return new Promise(t=>{let o=new Set,s=Array.from(i).filter(l=>!l.complete);if(!s.length){t();return}function n(){o.delete(this.src),o.size===0&&t()}s.forEach(l=>{o.has(l.src)||(o.add(l.src),l.addEventListener("error",n),l.addEventListener("load",n))}),e&&setTimeout(t,e)})}function q(){let i=document.querySelectorAll(".autodate"),e=Array.from(document.querySelectorAll("[data-timestamp]"));i&&(i.forEach(t=>{let o=parseInt(t.title,10),s=t.classList.contains("smalldate")?K(o):be(o);s!==t.innerHTML&&(t.innerHTML=s)}),e.forEach(t=>{t.title||(t.title=K(t.dataset.timestamp))}))}function H(i){let e=document.documentElement,t=document.getElementById("overlay");if(t)g(t.style,{zIndex:b(),top:0,height:`${e.clientHeight}px`,width:`${e.clientWidth}px`,display:i?"":"none"});else{if(!i)return;t=document.createElement("div"),t.id="overlay",g(t.style,{height:`${e.clientHeight}0px`,width:`${e.clientWidth}0px`}),e.appendChild(t)}}function ee(i){document.readyState==="complete"?i():document.addEventListener("DOMContentLoaded",i)}function _e(i){let e=document.body,t=document.documentElement;switch(i.keyCode){case 13:i.ENTER=!0;break;case 37:i.LEFT=!0;break;case 38:i.UP=!0;break;case .39:i.RIGHT=!0;break;case 40:i.DOWN=!0;break;default:break}return typeof i.srcElement>"u"&&(i.srcElement=i.target),typeof i.pageY>"u"&&(i.pageY=i.clientY+(parseInt(t.scrollTop||e.scrollTop,10)||0),i.pageX=i.clientX+(parseInt(t.scrollLeft||e.scrollLeft,10)||0)),i.cancel=()=>(i.returnValue=!1,i.preventDefault&&i.preventDefault(),i),i.stopBubbling=()=>(i.stopPropagation&&i.stopPropagation(),i.cancelBubble=!0,i),i}var D=_e;var xe="999999px";function Pe(i,e,t,o,s){s.style.maxWidth=xe,s.style.maxHeight=xe,s.madeResized=!0;let n=document.createElement("a");n.target="newwin",n.href=s.src,n.style.display="block",n.style.overflow="hidden",n.style.width=`${i}px`,n.style.height=`${t}px`,n.nw=e,n.nh=o,n.onmousemove=l=>{let r=y(n),c=D(l);n.scrollLeft=(c.pageX-r.x)/r.w*(n.nw-r.w)||0,n.scrollTop=(c.pageY-r.y)/r.h*(n.nh-r.h)||0},n.onmouseover=()=>{s.style.width=`${n.nw}px`,s.style.height=`${n.nh}px`},n.onmouseout=()=>{n.scrollLeft&&(n.scrollLeft=0,n.scrollTop=0),s.style.width=`${i}px`,s.style.height=`${t}px`},n.onmouseout(),j(n,s),n.appendChild(s)}function $e(i){let e,t,o;!i||!i.length||Array.from(i).filter(s=>!s.madeResized).forEach(s=>{let n=1,l=1,{naturalWidth:r,naturalHeight:c}=s,u=r,d=c;o=w(s),e=parseInt(o.width,10)||parseInt(o.maxWidth,10),t=parseInt(o.height,10)||parseInt(o.maxHeight,10),e&&u>e&&(n=e/u),t&&d>t&&(l=t/d),n=n&&l?Math.min(n,l):l||n,n<1&&(u*=n,d*=n,Pe(u,r,d,c,s))})}function R(i){let e=document.getElementById("tooltip_thingy"),t=y(i),o=i.getAttribute("title");if(o){if(i.title="",!e){e=document.createElement("table");let s=e.insertRow(0),n=e.insertRow(1),l=e.insertRow(2),r;e.id="tooltip_thingy",e.className="tooltip",s.className="top",n.className="content",l.className="bottom",r=s.insertCell(0),r.className="left",r.colSpan=2,r=s.insertCell(1),r.className="right",r=n.insertCell(0),r.className="left",r=n.insertCell(1),r.innerHTML="default text",r=n.insertCell(2),r.className="right",r=l.insertCell(0),r.className="left",r.colSpan=2,r=l.insertCell(1),r.className="right",document.querySelector("#page").appendChild(e)}e.rows[1].cells[1].innerText=o,e.style.display="",e.style.top=`${t.y-e.clientHeight}px`,e.style.left=`${t.x}px`,e.style.zIndex=b(),i.onmouseout=()=>{i.title=o,document.querySelector("#tooltip_thingy").style.display="none"}}}function ve(i){if(document.selection){let e=document.body.createTextRange();e.moveToElementText(i),e.select()}else if(window.getSelection){let e=document.createRange();e.selectNode(i);let t=window.getSelection();t.rangeCount&&t.removeAllRanges(),t.addRange(e)}}function Ce(i,e){let t=i.scrollTop;if(document.selection)i.focus(),document.selection.createRange().text=e;else{let o=i.selectionStart,s=i.selectionEnd;i.value=i.value.substring(0,o)+e+i.value.substr(s),i.selectionStart=o+e.length,i.selectionEnd=o+e.length}i.focus(),i.scrollTop=t}function Ee(i,e){return i?e?i.map((t,o)=>`${encodeURIComponent(t)}=${encodeURIComponent(e[o]||"")}`).join("&"):Object.keys(i).map(t=>`${encodeURIComponent(t)}=${encodeURIComponent(i[t]||"")}`).join("&"):""}var te=class{constructor(e){this.setup={readyState:4,callback(){},method:"POST",...e}}load(e,{callback:t,data:o,method:s=this.setup.method,requestType:n=1}={}){let l=null;o&&Array.isArray(o)&&Array.isArray(o[0])&&o[0].length===o[1].length?l=Ee(o[0],o[1]):typeof o!="string"&&(l=Ee(o));let r=new XMLHttpRequest;return t&&(this.setup.callback=t),r.onreadystatechange=()=>{r.readyState===this.setup.readyState&&this.setup.callback(r)},r.open(s,e,!0),r.url=e,r.type=n,s&&r.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),r.setRequestHeader("X-JSACCESS",n),r.send(l),r}},N=te;var f=class{static get selector(){throw new Error("No Selector defined")}constructor(e){this.element=e,e.hydrated=!0}};var Le="valid",Be="invalid",z=class extends f{static get selector(){return"input[data-autocomplete-action]"}constructor(e){super(e),e.autocomplete="off",this.action=e.dataset.autocompleteAction;let t=e.dataset.autocompleteOutput,o=e.dataset.autocompleteIndicator;if(this.outputElement=t&&document.querySelector(t),this.indicatorElement=o&&document.querySelector(o),!this.outputElement)throw new Error("Expected element to have data-autocomplete-output");e.addEventListener("keyup",s=>this.keyUp(s)),e.addEventListener("keydown",s=>{s.key==="Enter"&&s.preventDefault()})}getResultsContainer(){let e=y(this.element),t=document.querySelector("#autocomplete");return t||(t=g(document.createElement("div"),{id:"autocomplete"}),g(t.style,{zIndex:b()}),document.body.appendChild(t)),g(t.style,{top:`${e.yh}px`,left:`${e.x}px`,width:`${e.w}px`}),t}keyUp(e){let t=this.getResultsContainer(),o=Array.from(t.querySelectorAll("div")),s=o.findIndex(c=>c.classList.contains("selected"));if(o)switch(e.key){case"ArrowUp":s>=0&&(o[s].classList.remove("selected"),o[s-1].classList.add("selected"));return;case"ArrowDown":s===-1?o[0].classList.add("selected"):s<o.length-1&&(o[s].classList.remove("selected"),o[s+1].classList.add("selected"));return;case"Enter":s>=0&&o[s].onclick();return;default:this.indicatorElement&&(this.indicatorElement.classList.remove(Le),this.indicatorElement.classList.add(Be));break}let n=document.location.toString().match("/ACP/")?"../":"",l=encodeURIComponent(this.element.value),r=`act=${this.action}&term=${l}`;new N().load(`${n}api/?${r}`,{callback:c=>{let u=JSON.parse(c.responseText);if(t.innerHTML="",!u.length)t.style.display="none";else{t.style.display="";let[d,p]=u;d.forEach((m,h)=>{let E=p[h],C=document.createElement("div");C.innerHTML=E,C.onclick=()=>{t.style.display="none",this.indicatorElement&&this.indicatorElement.classList.add(Le),this.outputElement.value=m,this.outputElement.dispatchEvent(new Event("change")),this.element.value=E},t.appendChild(C)})}}})}};var se=class{constructor(e){let t=e;if(typeof t=="object")this.rgb=t;else if(typeof t=="string"){let o=t.match(/^rgb\((\d+),\s?(\d+),\s?(\d+)\)/i),s=t.match(/#?[^\da-fA-F]/);if(o)o[1]=parseFloat(o[1]),o[2]=parseFloat(o[2]),o[3]=parseFloat(o[3]),o.shift(),this.rgb=o;else if(s)if(t.charAt(0)==="#"&&(t=t.substr(1)),t.length===3&&(t=t.charAt(0)+t.charAt(0)+t.charAt(1)+t.charAt(1)+t.charAt(2)+t.charAt(2)),t.length!==6)this.rgb=[0,0,0];else{this.rgb=[];for(let n=0;n<3;n+=1)this.rgb[n]=parseInt(t.substr(n*2,2),16)}}else this.rgb=[0,0,0]}invert(){return this.rgb=[255-this.rgb[0],255-this.rgb[1],255-this.rgb[2]],this}toRGB(){return this.rgb}toHex(){if(!this.rgb)return!1;let e,t="",o,s="0123456789ABCDEF";for(o=0;o<3;o+=1)e=this.rgb[o],t+=s.charAt(Math.floor(e/16))+s.charAt(Math.floor(e%16));return t}},I=se;var oe=class{constructor(e,t,o,s){this.el=e,this.steps=t||30,this.delay=o||20,this.curLineup=0,this.stepCount=0,this.loop=s||0,this.lineup=[[]]}play(){return this.interval=setInterval(()=>this.step(),this.delay),this}morph(e,t,o){return Array.isArray(e)&&e.length===o.length?e.map((s,n)=>Math.round(this.morph(s,t,o[n]))):(o-e)*t+e}step(){let e=this.lineup[this.curLineup];this.stepCount+=1;let t=this.stepCount;typeof e[0]=="function"?(e[0](this.el),t=this.steps):e.forEach(o=>{let s=this.morph(o[1],t/this.steps,o[2]);o[0].match(/color/i)?s=`#${new I(s).toHex()}`:o[0]!=="opacity"&&(s=Math.round(s)),this.el.style[o[0]]=o[3]+s+o[4]}),t===this.steps&&(this.lineup.length-1>this.curLineup?(this.stepCount=0,this.curLineup+=1):this.loop===1?(this.stepCount=0,this.curLineup=0):clearInterval(this.interval))}add(e,t,o){let s=["","",""],n;return e.match(/color/i)?(n=new I(t).toRGB(),s[1]=new I(o).toRGB()):(s=o.match(/(\D*)(-?\d+)(\D*)/),s.shift(),n=parseFloat(t.match(/-?\d+/))),this.lineup[this.lineup.length-1].push([e,n,s[1],s[0],s[2]]),this}dehighlight(){this.el.style.backgroundColor="";let e=w(this.el).backgroundColor.toString(),t;return this.el.classList.add("highlight"),t=w(this.el).backgroundColor.toString(),t===e&&(t="FF0"),this.el.classList.add("highlight"),this.add("backgroundColor",t,e).then(()=>{this.el.style.backgroundColor=e})}then(e,t,o,s){return this.lineup.push([]),s&&(this.steps=s),typeof e=="function"?this.lineup[this.lineup.length-1].push(e):this.add(e,t,o),this}},x=oe;var W=class extends f{static get selector(){return".collapse-box"}constructor(e){super(e),e.querySelector(".collapse-button").addEventListener("click",()=>this.click())}click(){let e=this.element.querySelector(".collapse-content"),t=e.style,o=e.dataset.fullHeight,s=e.parentNode;t.overflow="hidden",t.height==="0px"?new x(e,5,10,0).add("height","0px",o).then(()=>{s.classList.remove("collapsed")}).play():(o||(o=`${e.clientHeight||e.offsetHeight}px`,e.dataset.fullHeight=o),new x(e,5,10,0).add("height",o,"0px").then(()=>{s.classList.add("collapsed")}).play())}};var _=class extends f{static get selector(){return"input.date"}constructor(e){super(e),this.picker=this.getPicker(),e.autocomplete="off",e.addEventListener("focus",()=>this.openPicker()),e.addEventListener("keydown",()=>this.closePicker())}getPicker(){if(this.picker)return this.picker;let e=document.querySelector("#datepicker");return e||(e=g(document.createElement("table"),{id:"datepicker"}),document.body.appendChild(e),e.style.display="none"),e}openPicker(){let e=y(this.element);g(this.picker.style,{display:"",zIndex:b(),position:"absolute",top:`${e.yh}px`,left:`${e.x}px`});let[t,o,s]=this.element.value.split("/").map(n=>parseInt(n,10));t&&o&&s?this.selectedDate=[s,t-1,o]:this.selectedDate=void 0,this.generate(s,t,o)}closePicker(){this.picker.style.display="none"}generate(e,t,o){let s=new Date,n=document.querySelector("#datepicker"),l,r,[c,u,d]=[e,t,o];c===void 0&&(c=s.getFullYear(),u=s.getMonth(),d=s.getDate(),this.selectedDate=[c,u,d]),u===-1&&(c-=1,u=11),u===12&&(c+=1,u=0),this.lastDate=[c,u,d];let p=new Date(c,u+1,0).getDate(),m=new Date(c,u,1).getDay();s=new Date(c,u,d),n.innerHTML="",l=n.insertRow(0),r=l.insertCell(0),r.innerHTML="&lt;",r.className="control",r.onclick=()=>this.lastYear(),r=l.insertCell(1),r.colSpan="5",r.className="year",r.innerHTML=c,r=l.insertCell(2),r.innerHTML=">",r.className="control",r.onclick=()=>this.nextYear(),l=n.insertRow(1),r=l.insertCell(0),r.innerHTML="<",r.className="control",r.onclick=()=>this.lastMonth(),r=l.insertCell(1),r.colSpan="5",r.innerHTML=we[u],r.className="month",r=l.insertCell(2),r.innerHTML=">",r.className="control",r.onclick=()=>this.nextMonth(),l=n.insertRow(2),l.className="weekdays";for(let h=0;h<7;h+=1)l.insertCell(h).innerHTML=ye[h];l=n.insertRow(3);for(let h=0;h<p;h+=1){if(!h)for(let C=0;C<m;C+=1)l.insertCell(C);(m+h)%7===0&&(l=n.insertRow(n.rows.length)),r=l.insertCell((m+h)%7),r.onclick=this.insert.bind(this,r);let E=c===this.selectedDate[0]&&u===this.selectedDate[1]&&h+1===this.selectedDate[2];r.className=`day${E?" selected":""}`,r.innerHTML=h+1}}lastYear(){let e=this.lastDate;this.generate(e[0]-1,e[1],e[2])}nextYear(){let e=this.lastDate;this.generate(e[0]+1,e[1],e[2])}lastMonth(){let e=this.lastDate;this.generate(e[0],e[1]-1,e[2])}nextMonth(){let e=this.lastDate;this.generate(e[0],e[1]+1,e[2])}insert(e){let t=this.lastDate;this.element.value=`${t[1]+1}/${e.innerHTML}/${t[0]}`,this.closePicker()}};var P=class extends f{static get selector(){return".image_gallery"}constructor(e){super(e);let t=document.createElement("div"),o=document.createElement("button"),s=document.createElement("button");this.index=0,this.images=e.querySelectorAll("img"),this.max=Math.max(this.images.length,1),o.innerHTML="Next &raquo;",o.addEventListener("click",()=>{this.showNext()}),s.innerHTML="Prev &laquo;",s.addEventListener("click",()=>{this.showPrev()}),this.update(),t.appendChild(s),t.appendChild(document.createTextNode(" ")),t.appendChild(o),e.appendChild(t)}showNext(){this.index<this.max-1&&(this.index+=1),this.update()}showPrev(){this.index>0&&(this.index-=1),this.update()}update(){this.images.forEach((e,t)=>{let o;e.madeResized?o=e.parentNode:o=e,o.style.display=t!==this.index?"none":"block"})}};var B=class extends f{static get selector(){return".pages"}constructor(e){super(e),e.addEventListener("wheel",t=>this.wheel(t))}wheel(e){e.preventDefault();let t=Math.sign(e.deltaY),o=Array.from(this.element.querySelectorAll("a")),s=parseInt(o[1].innerHTML,10),n=parseInt(o[o.length-1].innerHTML,10),l=o.length-2;if(t>0&&s+l<n||t<0&&s>2)for(let r=0;r<l;r+=1)o[r+1].href=o[r+1].href.replace(/\d+$/,r+s+t),o[r+1].innerHTML=s+r+t}};var F=class extends f{static get selector(){return"input.switch"}constructor(e){super(e),e.style.display="none";let t=g(document.createElement("button"),{type:"button",title:e.className,className:e.className}),o=()=>{t.style.backgroundPosition=e.checked?"top":"bottom"};o(),t.addEventListener("click",()=>{e.checked=!e.checked,o(),e.dispatchEvent(new Event("change"))}),X(t,e)}};var ie="active",U=class extends f{static get selector(){return".tabs"}constructor(e){super(e),e.addEventListener("click",t=>this.click(t))}click(e){let{tabSelector:t}=this.element.dataset,{target:o}=e;if(o.tagName.toLowerCase()!=="a")return;t&&(o=o.closest(t));let s=this.element.querySelector(`.${ie}`);s&&s.classList.remove(ie),o.className=ie,o.blur()}};var{userAgent:S}=navigator,L={chrome:/chrome/i.test(S),ie:/msie/i.test(S),iphone:/iphone/i.test(S),mobile:/mobile/i.test(S),n3ds:/nintendo 3ds/.test(S),firefox:/firefox/i.test(S),safari:/safari/i.test(S)};var Fe=["SCRIPT","STYLE","HR"];function ne(i){let e=i,t=/<(\w+)([^>]*)>([^]*?)<\/\1>/gi;return e=e.replace(/[\r\n]+/g,""),e=e.replace(/<(hr|br|meta)[^>]*>/gi,`
`),e=e.replace(/<img.*?src=["']?([^'"]+)["'](?: alt=["']?([^"']+)["'])?[^>]*\/?>/g,(o,s,n)=>n||`[img]${s}[/img]`),e=e.replace(t,(o,s,n,l)=>{let r=t.test(l)?ne(l):l,c={};n.replace(/(color|size|style|href|src)=(['"]?)(.*?)\2/gi,(Ze,He,Ve,De)=>{c[He]=De});let{style:u=""}=c,d=s.toLowerCase();if(Fe.includes(d))return"";let p=u.match(/text-align: ?(right|center|left)/i),m=u.match(/background(-color)?:[^;]+(rgb\([^)]+\)|#\s+)/i),h=u.match(/font-style: ?italic/i),E=u.match(/text-decoration:[^;]*underline/i),C=u.match(/text-decoration:[^;]*line-through/i),me=u.match(/font-size: ?([^;]+)/i),fe=u.match(/color: ?([^;]+)/i),qe=u.match(/font-weight: ?bold/i);return m&&(r=`[bgcolor=#${new I(m[2]).toHex()}]${r}[/bgcolor]`),p&&(r=`[align=${p[1]}]${r}[/align]`),(h||d==="i"||d==="em")&&(r=`[I]${r}[/I]`),(E||d==="u")&&(r=`[U]${r}[/U]`),(C||d==="s"||d==="strike")&&(r=`[S]${r}[/S]`),(qe||d==="strong"||d==="b")&&(r=`[B]${r}[/B]`),(c.size||me)&&(r=`[size=${c.size||me[1]}]${r}[/size]`),(c.color||fe)&&(r=`[color=${c.color||fe[1]}]${r}[/color]`),d==="a"&&c.href&&(r=`[url=${c.href}]${r}[/url]`),d==="ol"&&(r=`[ol]${r}[/ol]`),d==="ul"&&(r=`[ul]${r}[/ul]`),d.match(/h\d/i)&&(r=`[${d}]${r}[/${d}]`),d==="li"&&(r=`*${r.replace(/[\n\r]+/,"")}
`),d==="p"&&(r=`
${r==="&nbsp"?"":r}
`),d==="div"&&(r=`
${r}`),r}),e.replace(/&amp;/g,"&").replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&nbsp;/g," ")}function re(i){let e=i.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/(\s) /g,"$1&nbsp;");return e=e.replace(/\[b\]([^]*?)\[\/b\]/gi,"<b>$1</b>"),e=e.replace(/\[i\]([^]*?)\[\/i\]/gi,"<i>$1</i>"),e=e.replace(/\[u\]([^]*?)\[\/u\]/gi,"<u>$1</u>"),e=e.replace(/\[s\]([^]*?)\[\/s\]/gi,"<s>$1</s>"),e=e.replace(/\[img\]([^'"[]+)\[\/img\]/gi,'<img src="$1">'),e=e.replace(/\[color=([^\]]+)\](.*?)\[\/color\]/gi,'<span style="color:$1">$2</span>'),e=e.replace(/\[size=([^\]]+)\](.*?)\[\/size\]/gi,'<span style="font-size:$1">$2</span>'),e=e.replace(/\[url=([^\]]+)\](.*?)\[\/url\]/gi,'<a href="$1">$2</a>'),e=e.replace(/\[bgcolor=([^\]]+)\](.*?)\[\/bgcolor\]/gi,'<span style="backgroun-color:$1">$2</span>'),e=e.replace(/\[h(\d)\](.*?)\[\/h\1\]/g,"<h$1>$2</h$1>"),e=e.replace(/\[align=(left|right|center)\](.*?)\[\/align\]/g,'<div style="text-align:$1">$2</div>'),e=e.replace(/\[(ul|ol)\]([^]*?)\[\/\1\]/gi,(t,o,s)=>{let l=s.split(/(^|[\r\n]+)\*/).filter(r=>r.trim()).map(r=>`<li>${r}</li>`).join("");return`<${o}>${l}</${o}>`}),e=e.replace(/\n/g,"<br />"),e}var Ue=/^(ht|f)tps?:\/\/[\w.\-%&?=/]+$/,Oe=i=>Ue.test(i),O=class extends f{static get selector(){return"textarea.bbcode-editor"}constructor(e){super(e),this.iframe=document.createElement("iframe"),this.iframe.addEventListener("load",()=>this.iframeLoaded()),this.iframe.style.display="none",X(this.iframe,e),e.closest("form").addEventListener("submit",()=>{this.submit()})}iframeLoaded(){let{iframe:e,element:t}=this;e.className="editorframe",this.mode=L.mobile||L.n3ds?0:globalsettings.wysiwyg,this.mode=this.mode||0,this.window=e.contentWindow,this.doc=e.contentWindow.document;let o=w(t),s=this.doc.getElementsByTagName("body")[0];s&&o&&(s.style.backgroundColor=o.backgroundColor,s.style.color=o.color,s.style.borderColor="#FFF"),this.doc.designMode="on",this.editbar=document.createElement("div"),this.buildEditBar(),e.style.height=`${t.clientHeight}px`,j(this.editbar,t),this.setSource("<div></div>"),setTimeout(()=>{this.setSource(re(t.value)),this.switchMode(this.mode)},100)}buildEditBar(){this.editbar.className="editbar";let e=["bold","italic","underline","strikethrough","forecolor","backcolor","insertimage","createlink","c_email","justifyleft","justifycenter","justifyright","c_youtube","c_code","c_quote","c_spoiler","insertorderedlist","insertunorderedlist","c_smileys","c_switcheditmode"],t=["Bold","Italic","Underline","Strike-Through","Foreground Color","Background Color","Insert Image","Insert Link","Insert email","Align left","Center","Align right","Insert video from any of your favorite video services!","Insert code","Insert Quote","Insert Spoiler","Create Ordered List","Create Unordered List","Insert Emoticon","Switch editor mode"];e.forEach((o,s)=>{let n=document.createElement("a");n.className=o,n.title=t[s],n.href="javascript:void(0)",n.unselectable="on",n.onclick=l=>this.editbarCommand(l,o),this.editbar.appendChild(n)})}editbarCommand(e,t){switch(e.preventDefault(),t){case"forecolor":case"backcolor":this.showColors(e.pageX,e.pageY,t);break;case"c_smileys":this.showEmotes(e.pageX,e.pageY);break;case"c_switcheditmode":this.switchMode(Math.abs(this.mode-1));break;default:this.cmd(t);break}}showEmotes(e,t){let o=this.emoteWindow;if(!o){new N().load("/api/?act=emotes",{callback:s=>this.createEmoteWindow(s,{x:e,y:t})});return}o.style.display==="none"?(o.style.display="",o.style.top=`${t}px`,o.style.left=`${e}px`):this.hideEmotes()}hideEmotes(){this.emoteWindow&&(this.emoteWindow.style.display="none")}createEmoteWindow(e,t){let[o,s]=JSON.parse(e.responseText),n=document.createElement("div");n.className="emotewin",o.forEach((l,r)=>{let c=s[r],u=document.createElement("a");u.href="javascript:void(0)",u.onclick=()=>{this.cmd("inserthtml",c),this.hideEmotes()},u.innerHTML=`${c} ${l}`,n.appendChild(u)}),n.style.position="absolute",n.style.display="none",this.emoteWindow=n,document.querySelector("#page").appendChild(n),this.showEmotes(t.x,t.y)}colorHandler(e,t){this.cmd(e,t),this.hideColors()}showColors(e,t,o){this.hideColors();let s=["#FFFFFF","#AAAAAA","#000000","#FF0000","#00FF00","#0000FF","#FFFF00","#00FFFF","#FF00FF"],n=s.length,l=Math.ceil(Math.sqrt(n)),r=document.createElement("table");g(r.style,{borderCollapse:"collapse",position:"absolute",top:`${t}px`,left:`${e}px`});for(let c=0;c<l;c+=1){let u=r.insertRow(c);for(let d=0;d<l;d+=1){let p=u.insertCell(d),m=s[d+c*l];if(!m)continue;p.style.border="1px solid #000",p.style.padding=0;let h=document.createElement("a");h.href="javascript:void(0)",h.onclick=()=>this.colorHandler(o,m),p.appendChild(h),g(h.style,{display:"block",backgroundColor:m,height:"20px",width:"20px",margin:0})}}return this.colorWindow=r,document.querySelector("#page").appendChild(r),null}hideColors(){this.colorWindow&&(this.colorWindow.parentNode.removeChild(this.colorWindow),this.colorWindow=void 0)}cmd(e,t){let o,s=this.getSelection(),n,l=e,r=t;switch(e.toLowerCase()){case"bold":n=`[b]${s}[/b]`;break;case"italic":n=`[i]${s}[/i]`;break;case"underline":n=`[u]${s}[/u]`;break;case"strikethrough":n=`[s]${s}[/s]`;break;case"justifyright":n=`[align=right]${s}[/align]`;break;case"justifycenter":n=`[align=center]${s}[/align]`;break;case"justifyleft":n=`[align=left]${s}[/align]`;break;case"insertimage":if(r=prompt("Image URL:"),!r)return;if(!Oe(r)){alert("Please enter a valid URL.");return}n=`[img]${r}[/img]`;break;case"insertorderedlist":this.mode||(n=`[ol]${s.replace(/(.+([\r\n]+|$))/gi,"*$1")}[/ol]`);break;case"insertunorderedlist":this.mode||(n=`[ul]${s.replace(/(.+([\r\n]+|$))/gi,"*$1")}[/ul]`);break;case"createlink":if(r=prompt("Link:"),!r)return;r.match(/^(https?|ftp|mailto):/)||(r=`https://${r}`),n=`[url=${r}]${s}[/url]`;break;case"c_email":if(r=prompt("Email:"),!r)return;l="createlink",r=`mailto:${r}`,n=`[url=${r}]${s}[/url]`;break;case"backcolor":(L.firefox||L.safari)&&(l="hilitecolor"),n=`[bgcolor=${r}]${s}[/bgcolor]`;break;case"forecolor":n=`[color=${r}]${s}[/color]`;break;case"c_code":l="inserthtml",r=`[code]${s}[/code]`,n=r;break;case"c_quote":l="inserthtml",r=prompt("Who said this?"),r=`[quote${r?`=${r}`:""}]${s}[/quote]`,n=r;break;case"c_spoiler":l="inserthtml",r=`[spoiler]${s}[/spoiler]`,n=r;break;case"c_youtube":if(l="inserthtml",r=prompt("Video URL?"),!r)return;r=`[video]${r}[/video]`,n=r;break;case"inserthtml":n=r;break;default:throw new Error(`Unsupported editor command ${e}`)}this.mode?l==="inserthtml"&&L.ie?(o=this.doc.selection.createRange(),o.text.length?(o.pasteHTML(r),o.collapse(!1),o.select()):this.doc.body.innerHTML+=r):(this.doc.execCommand(l,!1,r||!1),this.iframe.contentWindow.focus&&this.iframe.contentWindow.focus()):Ce(this.element,n)}getSelection(){return this.mode?L.ie?this.doc.selection.createRange().text:this.window.getSelection():L.ie?(this.element.focus(),document.selection.createRange().text):this.element.value.substring(this.element.selectionStart,this.element.selectionEnd)}getSource(){return this.doc.body.innerHTML}setSource(e){this.doc&&this.doc.body&&(this.doc.body.innerHTML=e)}switchMode(e){let{element:t,iframe:o}=this;e?(this.setSource(re(t.value)),t.style.display="none",o.style.display=""):(t.value=ne(this.getSource()),t.style.display="",o.style.display="none"),this.mode=e}submit(){this.mode&&(this.switchMode(0),this.switchMode(1))}};var le=class{constructor(){this.droppables=[]}start(e,t,o){let s=new D(e).cancel().stopBubbling(),n=t||e.target,l=w(n),r=b();this.noChild&&(s.srcElement||s.target)!==(o||n)||n.getAttribute("draggable")!=="false"&&(this.sess={el:n,mx:parseInt(s.pageX,10),my:parseInt(s.pageY,10),ex:parseInt(l.left,10)||0,ey:parseInt(l.top,10)||0,info:{},bc:y(n),zIndex:n.style.zIndex},(!this.sess.zIndex||Number(this.sess.zIndex)<r-1)&&(n.style.zIndex=r),T(this.onstart,{...this.sess,droptarget:this.testDrops(this.sess.mx,this.sess.my)}),this.boundEvents={drag:c=>this.drag(c),drop:c=>this.drop(c)},document.addEventListener("mousemove",this.boundEvents.drag),document.addEventListener("mouseup",this.boundEvents.drop),this.drag(s))}drag(e){let t=new D(e).cancel(),o=this.sess.el.style,s,n=!1,l=parseInt(t.pageX,10),r=parseInt(t.pageY,10),c=l,u=r,d,p=this.sess.ex+c-this.sess.mx,m=this.sess.ey+u-this.sess.my,h=this.bounds;h&&(p<h[0]?(c=c-p+h[0],[p]=h):p>h[0]+h[2]&&(p=h[0]+h[2]),m<h[1]?(u=u-m+h[1],[m]=h):m>h[1]+h[3]&&(m=h[1]+h[3])),o.left=`${p}px`,o.top=`${m}px`,n=(s=this.sess.info).droptarget,s={left:p,top:m,e:t,el:this.sess.el,mx:c,my:u,droptarget:this.testDrops(l,r),dx:c-(s.mx||c),dy:u-(s.my||u),sx:this.sess.ex,sy:this.sess.ey},this.sess.info=s,T(this.ondrag,s),s.droptarget&&n!==s.droptarget&&T(this.ondragover,s),n&&s.droptarget!==n&&(d=s.droptarget,s.droptarget=n,T(this.ondragout,s),s.droptarget=d)}boundingBox(e,t,o,s){return this.bounds=[e,t,o,s],this}drop(){return document.removeEventListener("mouseup",this.boundEvents.drop),document.removeEventListener("mousemove",this.boundEvents.drag),T(this.ondrop,this.sess.info),this.autoZ||(this.sess.el.style.zIndex=this.sess.zIndex),!0}testDrops(e,t){let{droppables:o}=this,s,n=!1,l=[9999,9999];return o.length&&o.forEach(r=>{r===this.sess.el||ge(r,this.sess.el)||(s=y(r),l[0]>s.w&&l[1]>s.h&&e>=s.x&&t>=s.y&&e<=s.xw&&t<=s.yh&&(l=[s.w,s.h],n=r))}),n}drops(e){return this.droppables=e,this}addDrops(e){return this.droppables?(this.droppables=this.droppables.concat(e),this):this.drops(e)}addListener(e){return g(this,e),this}apply(e,t){if(Array.isArray(e))return e.forEach(s=>this.apply(s)),this;let o=w(e,"");return o=o.position,(!o||o==="static")&&(e.style.position="relative"),(t||e).onmousedown=t?s=>this.start(s,e,t):s=>this.start(s,e),this}autoZ(){return this.autoZ=!0,this}noChildActivation(){return this.noChild=!0,this}reset(e=this.sess.el){return e.style.top=0,e.style.left=0,this}},ae=le;var V=class{constructor(e={}){g(this,{title:"Title",wait:!0,content:"Content",open:!1,useoverlay:!1,minimizable:!0,resize:!1,className:"",pos:"center",zIndex:b(),...e})}create(){if(this.windowContainer)return null;let e=document.createElement("div"),t=document.createElement("div"),o=document.createElement("div"),s=document.createElement("div"),n=document.createElement("div"),l=document.createElement("div"),{pos:r}=this;this.windowContainer=e,this.id&&(e.id=this.id),this.contentcontainer=o,this.useOverlay&&H(!0,this.zIndex),e.className=`window${this.className?` ${this.className}`:""}`,t.className="title",o.className="content",this.minimizable&&(n.innerHTML="-",n.onclick=()=>this.minimize()),l.innerHTML="X",l.onclick=()=>this.close(),s.appendChild(n),s.appendChild(l),s.className="controls",t.innerHTML=this.title,o.innerHTML=this.content,t.appendChild(s),e.appendChild(t),e.appendChild(o);let c=()=>this.close();if(e.querySelectorAll("[data-window-close]").forEach(d=>{d.addEventListener("click",c)}),document.body.appendChild(e),this.resize){let d=e.querySelector(this.resize);if(!d)throw new Error("Resize target not found");d.style.width=`${d.clientWidth}px`,d.style.height=`${d.clientHeight}px`;let p=document.createElement("div");p.className="resize",e.appendChild(p),p.style.left=`${e.clientWidth-16}px`,p.style.top=`${e.clientHeight-16}px`,new ae().boundingBox(100,100,1/0,1/0).addListener({ondrag(m){let h=parseFloat(d.style.width)+m.dx,E=parseFloat(d.style.height)+m.dy;d.style.width=`${h}px`,h<e.clientWidth-20?d.style.width=`${e.clientWidth}px`:p.style.left=`${e.clientWidth-16}px`,d.style.height=`${E}px`},ondrop(){p.style.left=`${e.clientWidth-16}px`}}).apply(p),d.style.width=`${e.clientWidth}px`,p.style.left=`${e.clientWidth-16}px`}let u=e.style;return u.zIndex=this.zIndex+5,this.wait?M(e.querySelectorAll("img")).then(()=>{this.setPosition(r)}):this.setPosition(r),this.drag=new ae().autoZ().noChildActivation().boundingBox(0,0,document.documentElement.clientWidth-50,document.documentElement.clientHeight-50).apply(e,t),e.close=()=>this.close(),e.minimize=this.minimize,e}close(){this.windowContainer&&(document.body.removeChild(this.windowContainer),this.windowContainer=null,this.onclose&&this.onclose(),this.useOverlay&&H(!1))}minimize(){let e=this.windowContainer,t=e.classList.contains("minimized");if(e.classList.toggle("minimized"),t)e.removeAttribute("draggable"),this.setPosition(this.oldpos,0);else{e.setAttribute("draggable","false");let s=Array.from(document.querySelectorAll(".window")).reduce((n,l)=>l.classList.contains("minimized")?n+Number(l.clientWidth):n,0);this.oldpos=this.getPosition(),this.setPosition(`bl ${s} 0`,!1)}}setPosition(e,t){let o=this.windowContainer,s=0,n=0,l=document.documentElement.clientHeight,r=document.documentElement.clientWidth,c=e.match(/(\d+) (\d+)/);switch(c&&(s=Number(c[1]),n=Number(c[2])),s=Math.floor(s),n=Math.floor(n),e.charAt(1)==="r"&&(s=r-s-o.clientWidth),e.charAt(0)){case"b":n=l-n-o.clientHeight;break;case"c":n=(l-o.clientHeight)/2,s=(r-o.clientWidth)/2;break;default:}s=Math.floor(s),n=Math.floor(n),s<0&&(s=0),n<0&&(n=0),o.style.left=`${s}px`,this.animate||t?new x(o,10).add("top",`${n-100}px`,`${n}px`).play():o.style.top=`${n}px`,this.pos=e}getPosition(){let e=this.windowContainer.style;return`tl ${parseFloat(e.left)} ${parseFloat(e.top)}`}};V.close=function(e){let t=e;do{if(t.close){t.close();break}t=t.offsetParent}while(t)};var k=V;var Y=class extends f{static get selector(){return".media"}constructor(e){super(e);let t=e.querySelector("a.popout"),o=e.querySelector("a.inline"),s=e.querySelector(".movie");t.addEventListener("click",n=>{n.preventDefault(),new k({title:t.href,content:s.innerHTML}).create()}),o.addEventListener("click",n=>{n.preventDefault(),s.style.display="block"})}};function $(i){q(),i.querySelectorAll("a").forEach(s=>{if(s.dataset.useTooltip&&s.addEventListener("mouseover",()=>R(s)),s.href){let n=s.getAttribute("href"),{host:l,pathname:r}=window.location;if(s.host===l&&s.pathname===r){let u=s.onclick;s.onclick=void 0,s.addEventListener("click",d=>{d.preventDefault(),(!u||u.call(s)!==!1)&&RUN.stream.location(n)})}else s.target="_BLANK"}});let t=Array.from(i.querySelectorAll(".bbcodeimg"));t.length&&M(t).then(()=>{$e(t)}),i.querySelectorAll(".bbcode.code").forEach(s=>{s.addEventListener("click",()=>ve(s))}),[z,W,_,O,P,Y,B,F,U].forEach(s=>{i.querySelectorAll(s.selector).forEach(n=>new s(n))}),i.querySelectorAll("form[data-ajax-form]").forEach(s=>{let n=s.dataset.ajaxForm==="resetOnSubmit";s.addEventListener("submit",l=>{l.preventDefault(),RUN.submitForm(s,n)})}),Array.from(document.querySelectorAll(".idle")).forEach(s=>Z(s))}var ke,A="",Se="";function ce(){A&&(document.title=A),A="",clearInterval(ke)}function Ae(i){document.hasFocus()||(ce(),A||(A=document.title),Se=i,ke=setInterval(()=>{document.title=document.title===A?Se:A},1e3))}var de=class{constructor(){this.soundCache={}}load(e,t,o){let s=this.soundCache[e];if(s){o&&this.play(e);return}s=new Audio,this.soundCache[e]=s,s.autoplay=!!o,s.src=t}play(e){this.soundCache[e].play()}loadAndPlay(e,t){this.load(e,t,!0)}},v=new de;function ue(i,e){if(!globalsettings.can_im){alert("You do not have permission to use this feature.");return}RUN.stream.commands.im([i,e,!1])}function Te({fromId:i,fromName:e,message:t,fromMe:o,timestamp:s}){je(e,t);let n=Ye({fromId:i,fromName:e,message:t});if(!t)return;let l=document.createElement("div"),r=t.substring(0,3)==="/me";r&&(l.className="action",t=t.substring(3),e=`***${e}`),l.classList.add(o?"you":"them"),o||document.querySelector(`#im_${i}`).classList.remove("offline"),l.innerHTML=`<a href='?act=vu${o||parseInt(i,10)}' class='name'>${e}</a> ${r?"":": "}${t}`,l.dataset.timestamp=s;let c=n.scrollTop>n.scrollHeight-n.clientHeight-50;n.appendChild(l),c&&(n.scrollTop=n.scrollHeight),$(l),globalsettings.sound_im&&v.play("imbeep")}function Ye({fromId:i,fromName:e,message:t}){let o=document.querySelector(`#im_${i} .ims`);if(o)return o;let n=new k({title:`${e}`,content:`
            <div class='ims'></div>
            <div class='offline'>This user may be offline</div>
            <div>
                <form data-ajax-form='resetOnSubmit' method='post'>
                    <input type='hidden' name='im_uid' value='%s' />
                    <input type='text' name='im_im' autocomplete='off' />
                    <input type='hidden' name='act' value='blank' />
                </form>
            </div>
        `.replace(/%s/g,i),className:"im",resize:".ims",animate:!0}).create();$(n),n.id=`im_${i}`,n.onclick=()=>{n.querySelector("form").im_im.focus()},n.onclick(),o=document.querySelector(`#im_${i} .ims`);let l=getComputedStyle(o);return o.style.width=l.width,o.style.height=l.height,t&&globalsettings.sound_im&&v.play("imnewwindow"),o}function je(i,e){if(Ae(`New message from ${i}!`),!document.hasFocus()&&window.Notification&&Notification.permission==="granted"){let t=new Notification(`${i} says:`,{body:e});t.onclick=()=>{window.focus(),t.close()}}}var Me={loadscript([i]){document.body.appendChild(Object.assign(document.createElement("script"),{src:i}))},script(a){eval(a[0])},error(i){alert(i[0])},alert(i){alert(i[0])},reload(){window.location.reload()},refreshdata(){RUN.stream.pollData(!0)},addclass([i,e]){let t=document.querySelector(i);t&&t.classList.add(e)},title(i){document.title=i},update([i,e,t]){let o=i,s=Array.from(document.querySelectorAll(".path"));if(o==="path"&&s.length>1){s.forEach(l=>{l.innerHTML=e,$(l)});return}/^\W/.test(o)||(o=`#${o}`);let n=document.querySelector(o);n&&(n.innerHTML=e,t&&new x(n).dehighlight().play(),$(n))},removeel(i){let e=document.querySelector(i[0]);e&&e.parentNode.removeChild(e)},overlay:H,back(){window.history.back()},setstatus([i]){let e=document.querySelector("#status");e&&(e.className=i)},appendrows(i){let e=document.querySelector(i[0]),t=document.createElement("span");t.innerHTML=`<table>${i[1]}</table>`;let o=t.getElementsByTagName("tbody")[0];$(o),e.appendChild(o)},location([i]){i.charAt(0)==="?"?RUN.stream.location(i):document.location=i},enable([i]){let e=document.querySelector(`#${i}`);e&&(e.disabled=!1)},addshout([i]){let e=Array.from(document.querySelectorAll("#shoutbox .shout")),t,o=document.createElement("span");o.innerHTML=i;let s=o.firstChild;for(e[0].parentNode.insertBefore(s,e[0]);e.length>globalsettings.shoutlimit-1;)t=e.pop(),t.parentNode.removeChild(t);new x(s).dehighlight().play(),globalsettings.sound_shout&&v.play("sbblip"),$(s)},tick([i]){let e=document.querySelector("#ticker"),t=document.createElement("div");t.className="tick",t.innerHTML=i,t.style.display="none",t.style.overflow="hidden",e.insertBefore(t,e.firstChild);let o=w(t);o=o.height,t.style.height="0px",new x(t).add("height","0px",o).play();let s=Array.from(e.querySelectorAll(".tick")),n=s.length;if(t.style.display="block",n>100)for(let l=100;l<n;l+=100)t=s[l],t.bonked||(t=s[l],new x(t,30,500).add("opacity","1","0").then(r=>{r.parentNode.removeChild(r)}).play(),t.bonked=!0)},im([i,e,t,o,s]){Te({fromId:i,fromName:e,message:t,fromMe:o,timestamp:s})},imtoggleoffline(i){document.querySelector(`#im_${i}`).classList.add("offline")},window([options]){let existingWindow=options.id&&document.getElementById(options.id);if(existingWindow){existingWindow.querySelector(".title").innerHTML=options.title,existingWindow.querySelector(".content").innerHTML=options.content;return}let win=new k;win.title=options.title,win.content=options.content,win.minimizable=options.minimizable||0,win.useoverlay=options.useoverlay||0,win.animate=options.animate!==void 0?options.animate:!0,win.resize=options.resize||!1,win.className=options.className||"",options.onclose&&(win.onclose=eval(options.onclose)),options.pos&&(win.pos=options.pos);let winElement=win.create();winElement.id=options.id||"",$(winElement)},closewindow([i]){let e=document.querySelector(i);e&&k.close(e)},onlinelist(i){let e=document.querySelector("#statusers");e&&i[0].forEach(([t,o,s,n,l,r])=>{let c=document.querySelector(`#statusers .user${t}`);if(c||(c=document.createElement("a"),Number.isNaN(parseInt(t,10))||(c.href=`?act=vu${t}`),c.onclick=()=>{RUN.location(c.getAttribute("href"))}),c.innerHTML=n,c.className=`user${t} mgroup${o} ${s?` ${s}`:""} lastAction${r}`,l&&(c.title=l,c.onmouseover=()=>R(c,l)),s==="idle"){Z(c);return}e.firstChild?e.insertBefore(c,e.firstChild):e.appendChild(c)})},setoffline(i){let e=document.querySelector("#statusers");i[0].split(",").forEach(o=>{let s=document.querySelector(`#statusers .user${o}`);s&&e.removeChild(s)})},scrollToPost([i]){let e=document.getElementById(`pid_${i}`);return e?(M(document.querySelectorAll("#page img")).then(()=>{let t=y(e);window.scrollTo({top:t.y})}),!0):!1},updateqreply(i){let e=document.querySelector("#qreply");e&&(e.querySelector("textarea").focus(),e.querySelector("textarea").value+=i[0])},newmessage([i,e]){let t=document.querySelector("#notification"),o=document.querySelector("#num-messages");o&&(o.innerHTML=parseInt(o.innerHTML,10)+1),t||(t=document.createElement("div"),t.id="notification",document.body.appendChild(t)),t.style.display="",t.className="newmessage",t.onclick=()=>{t.style.display="none",RUN.stream.location(`?act=ucp&what=inbox&view=${e}`,3)},t.innerHTML=i},playsound(i){v.loadAndPlay(i[0],i[1],!!i[2])},attachfiles(){document.querySelector("#attachfiles").addEventListener("click",()=>{alert("Attaching files is under construction")})},listrating([i,e]){let t=document.querySelector(`#postrating_${i}`),o;if(t){if(t.style.display!=="none"){new x(t).add("height","200px","0px").then(()=>{t.style.display="none"}).play();return}t.style.display="block"}else t=document.createElement("div"),t.className="postrating_list",t.id=`postrating_${i}`,o=y(document.querySelector(`#pid_${i} .postrating`)),t.style.top=`${o.yh}px`,t.style.left=`${o.x}px`,document.querySelector("#page").appendChild(t);t.innerHTML=e,new x(t).add("height","0px","200px").play()}};var Xe=5e3,he=class{constructor(){this.request=new N({callback:e=>this.handleRequestData(e)}),this.lastURL=document.location.search.slice(1),this.commands=Me}handleRequestData(e){if(e.status!==200)return;e.parsed=!0;let{responseText:t}=e,o=!1;typeof t!="string"&&(t="");let s=[];if(t.length){try{s=JSON.parse(t)}catch(n){console.error(n),s=[]}s.forEach(([n,...l])=>{n==="softurl"?o=!0:this.commands[n]&&this.commands[n](l)})}if(e.type===2){let n=e.url.substring(1);o||(window.history.pushState({queryParams:n},"",`?${n}`),window.dispatchEvent(new Event("pushstate")),this.lastURL=n)}this.pollData()}location(e,t=2){let o=e.split("?");return o=o[1]||o[0],this.request.load(`?${o}`,{requestType:t}),this.busy=!0,!1}load(...e){this.request.load(...e)}loader(){return this.request.load(`?${this.lastURL}`),!0}pollData(e=!1){e&&this.loader(),clearTimeout(this.timeout),document.cookie.includes(`actw=${window.name}`)&&(this.timeout=setTimeout(()=>this.loader(),Xe))}updatePage(e){e!==this.lastURL&&this.location(e,3)}},Ne=he;var Je=2,pe=class{stream=new Ne;onAppReady(){Je&&$(document.body),q(),setInterval(q,1e3*30),this.stream.pollData(),window.addEventListener("popstate",({state:e})=>{if(e){let{queryParams:t}=e;this.stream.updatePage(t)}else{let t=document.location.search.replace(/^\?/,"");this.stream.updatePage(t)}}),v.load("sbblip","./Sounds/blip.mp3",!1),v.load("imbeep","./Sounds/receive.mp3",!1),v.load("imnewwindow","./Sounds/receive.mp3",!1)}submitForm(e,t=!1){let o=[],s=[],{submitButton:n}=e;[...Array.from(e.querySelectorAll("input")),...Array.from(e.querySelectorAll("select")),...Array.from(e.querySelectorAll("button"))].forEach(l=>{if(!(!l.name||l.type==="submit")){if(l instanceof HTMLSelectElement&&l.type==="select-multiple"){Array.from(l.options).filter(r=>r.selected).forEach(r=>{o.push(`${l.name}[]`),s.push(r.value)});return}l instanceof HTMLInputElement&&["checkbox","radio"].includes(l.type)&&!l.checked||(o.push(l.name),s.push(l.value))}}),n&&(o.push(n.name),s.push(n.value)),this.stream.load("?",{data:[o,s]}),t&&e.reset(),this.stream.pollData()}handleQuoting(e){this.stream.load(`${e.href}&qreply=${document.querySelector("#qreply")?"1":"0"}`)}setWindowActive(){document.cookie=`actw=${window.name}; SameSite:Lax`,ce(),this.stream.pollData()}},G=new pe;ee(()=>{G.onAppReady()});ee(()=>{window.name=`${Math.random()}`,G.setWindowActive(),window.addEventListener("focus",()=>{G.setWindowActive()})});var Ie=G;g(window,{RUN:Ie,IMWindow:ue});})();

"use strict";(()=>{var X=new Map,u=class{element;constructor(e){this.element=e}};function h(i,e,t){X.has(i)||X.set(i,new WeakMap),e.forEach(function(o){X.get(i)?.has(o)||X.get(i)?.set(o,new t(o))})}function Re(i){let e=i.getHours()||12,t=`${i.getMinutes()}`.padStart(2,"0");return`${e%12||12}:${t}${e>12?"pm":"am"}`}function Z(i){return new Date(i*1e3)}var ye=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],Ee=["January","February","March","April","May","June","July","August","September","October","November","December"];function We(i){return i[0].toUpperCase()+i.slice(1)}function J(i){let e=new Date,t=new Intl.RelativeTimeFormat(void 0,{numeric:"auto",style:"long"}),n=new Date;n.setTime(+n-1e3*60*60*24),n.setHours(0),n.setMinutes(0),n.setSeconds(0);let o=Z(i),s=Math.round((+o-+e)/1e3);if(s>-60)return t.format(s,"second");if(s>-3600)return t.format(Math.round(s/60),"minute");if(o>n){let r=new Date;return r.setHours(0),r.setMinutes(0),r.setSeconds(0),`${We(t.format(o>r?0:-1,"day"))} @ ${Re(o)}`}return Intl.DateTimeFormat(void 0,{month:"short",year:"numeric",day:"numeric",hour:"numeric",hour12:!0,minute:"numeric"}).format(o)}function ee(i){let e=Z(i),t=e.getHours(),n=t>=12?"pm":"am";t%=12,t=t||12;let o=`${e.getMinutes()}`.padStart(2,"0"),s=e.getMonth()+1,r=`${e.getDate()}`.padStart(2,"0"),a=e.getFullYear();return`${t}:${o}${n}, ${s}/${r}/${a}`}function te(i){let e=Z(i);return String.fromCodePoint(55357,56656+((e.getHours()%12||12)-1)+(e.getMinutes()>29?12:0))}function ne(i){let e=Array.from(i.classList).find(t=>t.startsWith("lastAction"));e!==void 0&&(i.prepend(te(Number.parseInt(e.slice(10),10))),i.classList.remove(e))}var A=class extends u{static hydrate(e){e.querySelectorAll(".idle").forEach(t=>ne(t))}};var ie=class{rgb;constructor(e){let t=e;if(typeof t=="object"){this.rgb=t;return}if(typeof t=="string"){let n=/^rgb\((\d+),\s?(\d+),\s?(\d+)\)/i.exec(t),o=/#?[^\da-fA-F]/.exec(t);if(n){this.rgb=[Number.parseFloat(n[1]),Number.parseFloat(n[2]),Number.parseFloat(n[3])];return}if(o){if(t.startsWith("#")&&(t=t.slice(1)),t.length===3&&(t=t.charAt(0)+t.charAt(0)+t.charAt(1)+t.charAt(1)+t.charAt(2)+t.charAt(2)),t.length!==6){this.rgb=[0,0,0];return}this.rgb=[];for(let s=0;s<3;s+=1)this.rgb[s]=Number.parseInt(t.slice(s*2,(s+1)*2),16)}}}invert(){return this.rgb&&(this.rgb=[255-this.rgb[0],255-this.rgb[1],255-this.rgb[2]]),this}toRGB(){return this.rgb}toHex(){return this.rgb?.map(e=>e.toString(16).padStart(2,"0")).join("")}},v=ie;function y(i){return globalThis.getComputedStyle(i)}function b(i){let{x:e,y:t,height:n,width:o}=i.getBoundingClientRect(),s=e+globalThis.scrollX,r=t+globalThis.scrollY;return{x:s,y:r,yh:r+n,xw:s+o,w:o,h:n}}function Le(i,e){return e.contains(i)}function k(i,e){e.before(i)}function ve(i,e){e.after(i)}function E(){return Array.from(document.querySelectorAll("*")).reduce((t,n)=>n.style.zIndex&&Number(n.style.zIndex)>t?Number(n.style.zIndex):t,0)+1}var oe=class{el;delay;steps;interval;curLineup;stepCount;lineup;constructor(e,t=30,n=20){this.el=e,this.steps=t,this.delay=n,this.curLineup=0,this.stepCount=0,this.lineup=[[]]}play(){return this.interval=setInterval(()=>this.step(),this.delay),this}morph(e,t,n){return Array.isArray(e)&&Array.isArray(n)?e.map((o,s)=>Math.round(this.morph(o,t,n[s]))):Array.isArray(e)||Array.isArray(n)?0:(n-e)*t+e}step(){let e=this.lineup[this.curLineup];this.stepCount+=1;let t=this.stepCount;typeof e[0]=="function"?(e[0](this.el),t=this.steps):e.forEach(n=>{let o=this.morph(n[1],t/this.steps,n[2]);/color/i.test(n[0])?o=`#${new v(o).toHex()}`:n[0]!=="opacity"&&(o=Math.round(o)),this.el.style[n[0]]=n[3]+o+n[4]}),t===this.steps&&(this.lineup.length-1>this.curLineup?(this.stepCount=0,this.curLineup+=1):clearInterval(this.interval))}add(e,t,n){let o=["","",""],s;return e.match(/color/i)?(s=new v(t).toRGB(),o[1]=new v(n).toRGB()):(o=/(\D*)(-?\d+)(\D*)/.exec(n),o.shift(),s=Number.parseFloat(/-?\d+/.exec(t)?.[0]??"")),this.lineup.at(-1)?.push([e,s,o[1],o[0],o[2]]),this}dehighlight(){this.el.style.backgroundColor="";let e=y(this.el).backgroundColor;this.el.classList.add("highlight");let t=y(this.el).backgroundColor;return t===e&&(t="FF0"),this.el.classList.add("highlight"),!t||!e?this:this.add("backgroundColor",t,e).andThen(()=>{this.el.style.backgroundColor=e})}andThen(e,t=void 0,n=void 0,o=void 0){return this.lineup.push([]),o&&(this.steps=o),typeof e=="function"?this.lineup.at(-1)?.push(e):t!==void 0&&n!==void 0&&this.add(e,t,n),this}},T=oe;var Te="valid",Me="invalid",D=class extends u{method;outputElement;indicatorElement;static hydrate(e){h("AutoComplete",e.querySelectorAll("input[data-autocomplete-action]"),this)}constructor(e){super(e),e.autocomplete="off",this.method=e.dataset.autocompleteAction;let t=e.dataset.autocompleteOutput,n=e.dataset.autocompleteIndicator,o=t?document.querySelector(t):void 0;if(!o)throw new Error("Expected element to have data-autocomplete-output");this.outputElement=o||document.createElement("input"),this.indicatorElement=n?document.querySelector(n):void 0,e.addEventListener("keyup",s=>this.keyUp(s)),e.addEventListener("keydown",s=>{s.key==="Enter"&&s.preventDefault()})}getResultsContainer(){let e=b(this.element),t=document.querySelector("#autocomplete");return t||(t=Object.assign(document.createElement("div"),{id:"autocomplete"}),Object.assign(t.style,{zIndex:E()}),document.body.appendChild(t)),Object.assign(t.style,{top:`${e.yh}px`,left:`${e.x}px`,width:`${e.w}px`}),t}keyUp(e){let t=this.getResultsContainer(),n=Array.from(t.querySelectorAll("div")),o=n.findIndex(s=>s.classList.contains("selected"));switch(e.key){case"ArrowUp":case"ArrowDown":n.at(o)?.classList.remove("selected"),n.at((o+(e.key==="ArrowDown"?1:-1))%n.length)?.classList.add("selected");return;case"Enter":o>=0&&n.at(o)?.dispatchEvent(new Event("click"));return;default:this.indicatorElement&&(this.indicatorElement.classList.remove(Te),this.indicatorElement.classList.add(Me)),this.clearResults(),this.element.value&&this.doSearch();break}}clearResults(){let e=this.getResultsContainer();e.style.display="none",e.innerHTML=""}async doSearch(){let e=this.getResultsContainer(),t=/ACP/.test(document.location.toString())?"../":"",o=`term=${encodeURIComponent(this.element.value)}`,s=await fetch(`${t}/api/${this.method}?${o}`);if(!s.ok)return;let r=await s.json();if(e.innerHTML="",r.length){e.style.display="";let[a,l]=r;a.forEach((m,c)=>{let p=l[c],f=document.createElement("div");f.innerHTML=p,f.addEventListener("click",()=>{e.style.display="none",this.indicatorElement&&(this.indicatorElement.classList.add(Te),this.indicatorElement.classList.remove(Me)),this.outputElement.value=`${m}`,this.outputElement.dispatchEvent(new Event("change")),this.element.value=p}),e.appendChild(f)});return}e.style.display="none"}};function we(i){if(!globalThis.getSelection)return;let e=document.createRange();e.selectNode(i);let t=globalThis.getSelection();t&&(t.rangeCount&&t.removeAllRanges(),t.addRange(e))}function xe(i,e){let t=i.scrollTop,n=i.selectionStart??0,o=i.selectionEnd??0;i.value=i.value.substring(0,n)+e+i.value.slice(o),i.selectionStart=n+e.length,i.selectionEnd=n+e.length,i.focus(),i.scrollTop=t}var I=class extends u{static hydrate(e){h("CodeBlock",e.querySelectorAll(".bbcode.code"),this)}constructor(e){super(e),e.addEventListener("click",()=>we(e))}};var N=class extends u{fullHeight=0;animationLengthInMs=200;static hydrate(e){h("CollapseBox",e.querySelectorAll(".collapse-box"),this)}constructor(e){super(e);let{collapseContent:t}=this;t&&Object.assign(t.style,{transition:`height ${this.animationLengthInMs}ms ease-in-out`}),this.element.addEventListener("click",n=>{n.target instanceof HTMLElement&&n.target.matches(".collapse-button")&&this.toggle()})}get collapseContent(){return this.element.querySelector(".collapse-content")}toggle(){let{collapseContent:e}=this;if(!e)return;let{style:t}=e;t.height==="0px"?(t.height=`${this.fullHeight}px`,setTimeout(()=>{t.removeProperty("height"),t.removeProperty("overflow")},this.animationLengthInMs)):(this.fullHeight=e.clientHeight||e.offsetHeight,t.height=`${this.fullHeight}px`,t.overflow="hidden",requestAnimationFrame(()=>{t.height="0px"}))}};function $(i,e=1e3){return new Promise(t=>{let n=new Set,o=Array.from(i).filter(r=>!r.complete);if(!o.length){t();return}function s(){n.delete(this.src),n.size===0&&t()}o.forEach(r=>{n.has(r.src)||(n.add(r.src),r.addEventListener("error",s),r.addEventListener("load",s))}),e&&setTimeout(t,e)})}function q(){let i=document.querySelectorAll(".autodate"),e=Array.from(document.querySelectorAll("[data-timestamp]"));i&&(i.forEach(t=>{let n=Number.parseInt(t.getAttribute("title")??"",10),o=t.classList.contains("smalldate")?ee(n):J(n);o!==t.innerHTML&&(t.innerHTML=o)}),e.forEach(t=>{t.title||(t.title=ee(Number.parseInt(t.dataset.timestamp??"",10)))}))}function se(i){document.readyState==="complete"?i():document.addEventListener("DOMContentLoaded",i)}function $e(){let i=document.createElement("input");return i.setAttribute("type","date"),i.type==="date"}function He(){let i=[String.fromCodePoint(9757,127999),String.fromCodePoint(9757)].map(e=>{let t=document.body.appendChild(document.createElement("span"));t.appendChild(document.createTextNode(e));let n=t.offsetWidth;return t.remove(),n});return i[0]===i[1]}var R=class extends u{picker;selectedDate;lastDate;static hydrate(e){$e()||h("DatePicker",e.querySelectorAll("input[type=date]"),this)}constructor(e){super(e),this.picker=this.getPicker(),e.autocomplete="off",e.addEventListener("focus",()=>this.openPicker()),e.addEventListener("keydown",()=>this.closePicker())}getPicker(){if(this.picker)return this.picker;let e=document.querySelector("#datepicker");return e||(e=Object.assign(document.createElement("table"),{id:"datepicker"}),document.body.appendChild(e),e.style.display="none"),e}openPicker(){let e=b(this.element);Object.assign(this.picker.style,{display:"",zIndex:E(),position:"absolute",top:`${e.yh}px`,left:`${e.x}px`});let[t,n,o]=this.element.value.split("/").map(s=>Number.parseInt(s,10));t&&n&&o?this.selectedDate=[o,t-1,n]:this.selectedDate=void 0,this.generate(o,t,n)}closePicker(){this.picker.style.display="none"}generate(e,t,n){let o=new Date,s=this.getPicker(),r,a,[l,m,c]=[e,t,n];l===void 0&&(l=o.getFullYear(),m=o.getMonth(),c=o.getDate(),this.selectedDate=[l,m,c]),m===-1&&(l-=1,m=11),m===12&&(l+=1,m=0),this.lastDate=[l,m,c];let p=new Date(l,m+1,0).getDate(),f=new Date(l,m,1).getDay();s.innerHTML="",r=s.insertRow(0),a=r.insertCell(0),a.innerHTML="&lt;",a.className="control",a.addEventListener("click",()=>this.lastYear()),a=r.insertCell(1),a.colSpan=5,a.className="year",a.innerHTML=`${l}`,a=r.insertCell(2),a.innerHTML=">",a.className="control",a.addEventListener("click",()=>this.nextYear()),r=s.insertRow(1),a=r.insertCell(0),a.innerHTML="<",a.className="control",a.addEventListener("click",()=>this.lastMonth()),a=r.insertCell(1),a.colSpan=5,a.innerHTML=Ee[m],a.className="month",a=r.insertCell(2),a.innerHTML=">",a.className="control",a.addEventListener("click",()=>this.nextMonth()),r=s.insertRow(2),r.className="weekdays";for(let d=0;d<7;d+=1)r.insertCell(d).innerHTML=ye[d];r=s.insertRow(3);for(let d=0;d<p;d+=1){if(!d)for(let S=0;S<f;S+=1)r.insertCell(S);(f+d)%7===0&&(r=s.insertRow(s.rows.length)),a=r.insertCell((f+d)%7),a.addEventListener("click",this.insert.bind(this,a));let C=!!this.selectedDate&&l===this.selectedDate[0]&&m===this.selectedDate[1]&&d+1===this.selectedDate[2];a.className=`day${C?" selected":""}`,a.innerHTML=`${d+1}`}}lastYear(){let e=this.lastDate;e&&this.generate(e[0]-1,e[1],e[2])}nextYear(){let e=this.lastDate;e&&this.generate(e[0]+1,e[1],e[2])}lastMonth(){let e=this.lastDate;e&&this.generate(e[0],e[1]-1,e[2])}nextMonth(){let e=this.lastDate;e&&this.generate(e[0],e[1]+1,e[2])}insert(e){let t=this.lastDate;t&&(this.element.value=`${t[1]+1}/${e.innerHTML}/${t[0]}`),this.closePicker()}};var Ce={a:(i,e)=>`[url=${e?.getAttribute("href")}]${i}[/url]`,b(...i){return this.strong(...i)},br:()=>`
`,div:i=>`
${i}`,em:i=>`[i]${i}[/i]`,font:(i,e)=>`[font=${e.style.fontFamily||e.getAttribute("face")}]${i}[/font]`,h1:i=>`[h1]${i}[/h1]`,h2:i=>`[h2]${i}[/h2]`,h3:i=>`[h3]${i}[/h3]`,h4:i=>`[h4]${i}[/h4]`,h5:i=>`[h5]${i}[/h5]`,h6:i=>`[h6]${i}[/h6]`,hr:()=>`
`,i(...i){return this.em(...i)},img:(i,e)=>{let t=e.getAttribute("alt")??"",n=e.getAttribute("src");return e.dataset.emoji?` ${e.dataset.emoji}`:n?`[img]${n}[/img]`:t},li:i=>`*${i.replace(/[\n\r]+/,"")}
`,meta:()=>`
`,ol:i=>`[ol]${i}[/ol]`,p:i=>`
${i==="&nbsp"?"":i}
`,strike:i=>`[s]${i}[/s]`,strong:i=>`[b]${i}[/b]`,u:i=>`[u]${i}[/u]`,ul:i=>`[ul]${i}[/ul]`},Q={"background-color":(i,e)=>{let t=i&&new v(i).toHex(),n=t?`${t}`:i;return["ffffff","white","transparent"].includes(n)?e:`[bgcolor=${n}]${e}[/bgcolor]`},color(i,e){let t=i&&new v(i).toHex();return`[color=${t?`${t}`:i}]${e}[/color]`},"font-family":(i,e)=>`[font=${i.replaceAll(/['"]/g,"")}]${e}[/font]`,"font-style":(i,e)=>`[i]${e}[/i]`,"font-size":(i,e)=>`[size=${i}]${e}[/size]`,"font-weight":(i,e)=>`[b]${e}[/b]`,"text-align":(i,e)=>`[align=${i}]${e}[/align]`,"text-decoration":function(e,t){return e==="line-through"?`[strike]${t}[/strike]`:`[u]${t}[/u]`}};function Fe(i){return i.replaceAll(/[\r\n]+/g,"").replaceAll("&amp;","&").replaceAll("&gt;",">").replaceAll("&lt;","<").replaceAll("&nbsp;"," ")}function re(i){let e=i.tagName.toLowerCase(),t="";for(let s of i.childNodes)t+=s.nodeType===Node.ELEMENT_NODE?re(s):Fe(s.textContent??"");if(e==="body")return t;if(i.style)for(let s of i.style)s in Q&&(t=Q[s](i.style.getPropertyValue(s),t));let n=i.getAttribute("size");n&&(t=Q.fontSize(n,t));let o=i.getAttribute("color");return o&&(t=Q.color(o,t)),e in Ce&&(t=Ce[e](t,i)),t}function ae(i){return i.replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll(/(\s) /g,"$1&nbsp;").replaceAll(/\[b\]([^]*?)\[\/b\]/gi,"<b>$1</b>").replaceAll(/\[i\]([^]*?)\[\/i\]/gi,"<i>$1</i>").replaceAll(/\[u\]([^]*?)\[\/u\]/gi,"<u>$1</u>").replaceAll(/\[s\]([^]*?)\[\/s\]/gi,"<s>$1</s>").replaceAll(/\[img\]([^'"[]+)\[\/img\]/gi,'<img src="$1">').replaceAll(/\[color=([^\]]+)\]([^]*?)\[\/color\]/gi,'<span style="color:$1">$2</span>').replaceAll(/\[size=([^\]]+)\]([^]*?)\[\/size\]/gi,'<span style="font-size:$1">$2</span>').replaceAll(/\[font=['"]?([^\]]+?)['"]?\]([^]*?)\[\/font\]/gi,'<span style="font-family:$1">$2</span>').replaceAll(/\[url=([^\]]+)\]([^]*?)\[\/url\]/gi,'<a href="$1">$2</a>').replaceAll(/\[bgcolor=([^\]]+)\]([^]*?)\[\/bgcolor\]/gi,'<span style="background-color:$1">$2</span>').replaceAll(/\[h(\d)\]([^]*?)\[\/h\1\]/g,"<h$1>$2</h$1>").replaceAll(/\[align=(left|right|center)\]([^]*?)\[\/align\]/g,'<div style="text-align:$1">$2</div>').replaceAll(/\[(ul|ol)\]([^]*?)\[\/\1\]/gi,(e,t,n)=>{let s=n.split(/(^|[\r\n]+)\*/).filter(r=>r.trim()).map(r=>`<li>${r}</li>`).join("");return`<${t}>${s}</${t}>`}).replaceAll(`
`,"<br>")}var{userAgent:M}=navigator,le={chrome:/chrome/i.test(M),ie:/msie/i.test(M),iphone:/iphone/i.test(M),mobile:/mobile/i.test(M),n3ds:/nintendo 3ds/.test(M),firefox:/firefox/i.test(M),safari:/safari/i.test(M)};var Pe=/^(ht|f)tps?:\/\/[\w.\-%&?=/]+$/,ze=i=>Pe.test(i),Se={"Sans Serif":["Arial","Arial Black","Arial Narrow","Arial Rounded MT Bold","Avant Garde","Calibri","Candara","Century Gothic","Franklin Gothic Medium","Futura","Geneva","Gill Sans","Helvetica","Impact","Lucida Grande","Optima","Segoe UI","Tahoma","Trebuchet MS","Verdana"],Serif:["Big Caslon","Bodoni MT","Book Antiqua","Calisto MT","Cambria","Didot","Garamond","Georgia","Goudy Old Style","Hoefler Text","Lucida Bright","Palatino","Perpetua","Rockwell","Rockwell Extra Bold","Baskerville","Times New Roman"],Monospaced:["Consolas","Courier New","Lucida Console","Lucida Sans Typewriter","Monaco","Andale Mono"],Fantasy:["Copperplate","Papyrus"],Script:["Brush Script MT"]},W=class extends u{iframe;colorWindow;container;htmlMode=!0;editbar;emoteWindow;static hydrate(e){h("Editor",e.querySelectorAll("textarea.bbcode-editor"),this)}constructor(e){super(e),this.container=document.createElement("div"),this.iframe=document.createElement("iframe"),this.iframe.style.display="none",this.iframe.addEventListener("load",()=>this.iframeLoaded(),{once:!0}),k(this.container,e),this.container.appendChild(e),this.container.appendChild(this.iframe)}get doc(){return this.window?.document}get window(){return this.iframe.contentWindow}iframeLoaded(){let{iframe:e,element:t}=this;if(e.className="editorframe",this.htmlMode=globalSettings.wysiwyg,this.doc?.addEventListener("input",()=>{this.element.value=re(this.doc.body)}),!this.doc)return;let n=y(t),o=this.doc.getElementsByTagName("body")[0];o&&n&&(o.style.backgroundColor=n.backgroundColor,o.style.color=n.color,o.style.borderColor="#FFF"),this.doc.designMode="on",this.editbar=this.buildEditBar(),e.style.height=`${t.clientHeight}px`,k(this.editbar,t),this.setSource("<div></div>"),setTimeout(()=>{this.setSource(ae(t.value)),this.switchMode(this.htmlMode)},100)}buildEditBar(){let e=document.createElement("div");e.className="editbar",e.innerHTML=['<select class="fontface"><option>Default Font</option></select>','<a class="bold" title="Bold"></a>','<a class="italic" title="Italic"></a>','<a class="underline" title="Underline"></a>','<a class="strikethrough" title="Strike-Through"></a>','<a class="forecolor" title="Foreground Color"></a>','<a class="backcolor" title="Background Color"></a>','<a class="insertimage" title="Insert Image"></a>','<a class="createlink" title="Insert Link"></a>','<a class="c_email" title="Insert Email"></a>','<a class="justifyleft" title="Align Left"></a>','<a class="justifycenter" title="Center"></a>','<a class="justifyright" title="Align Right"></a>','<a class="c_youtube" title="Insert video from any of your favorite video services!"></a>','<a class="c_code" title="Insert code"></a>','<a class="c_quote" title="Insert Quote"></a>','<a class="c_spoiler" title="Insert Spoiler"></a>','<a class="insertorderedlist" title="Create Ordered List"></a>','<a class="insertunorderedlist" title="Create Unordered List"></a>','<a class="c_smileys" title="Insert Emoticon"></a>','<a class="c_switcheditmode" title="Switch editor mode"></a>'].join(""),e.addEventListener("click",n=>{n.target instanceof HTMLElement&&n.target.matches(".editbar a")&&this.editbarCommand(n,n.target.className)});let t=e.querySelector("select.fontface");if(t){t.addEventListener("input",n=>{this.editbarCommand(n,"fontname",t.value)});for(let n of Object.keys(Se)){let o=Se[n].map(s=>`<option style="font-family: ${s}">${s}</option>`);t.innerHTML+=`<optgroup label="${n}">${o}</optgroup>`}}return e}editbarCommand(e,t,n){switch(e.preventDefault(),t){case"forecolor":case"backcolor":this.showColors(e.pageX,e.pageY,t);break;case"c_smileys":this.showEmotes(e.pageX,e.pageY);break;case"c_switcheditmode":this.switchMode(!this.htmlMode);break;default:this.cmd(t,n);break}}async showEmotes(e,t){let n=this.emoteWindow;if(!n){let o=await fetch("/api/emotes"),s=await o.json();o.ok&&this.createEmoteWindow(s,{x:e,y:t});return}n.style.display==="none"?(n.style.display="",n.style.left=`${e}px`,n.style.top=`${t}px`):this.hideEmotes()}hideEmotes(){this.emoteWindow&&(this.emoteWindow.style.display="none")}createEmoteWindow([e,t],n){let o=document.createElement("div");o.className="emotewin",e.forEach((s,r)=>{let a=t[r],l=document.createElement("a");l.href="javascript:void(0)",l.addEventListener("click",()=>{this.cmd("inserthtml",a),this.hideEmotes()}),l.innerHTML=`${a} ${s}`,o.appendChild(l)}),o.style.position="absolute",o.style.display="none",this.emoteWindow=o,document.querySelector("#page")?.appendChild(o),this.showEmotes(n.x,n.y)}colorHandler(e,t){this.cmd(e,t),this.hideColors()}showColors(e,t,n){this.hideColors();let o=["#FFFFFF","#AAAAAA","#000000","#FF0000","#00FF00","#0000FF","#FFFF00","#00FFFF","#FF00FF"],s=o.length,r=Math.ceil(Math.sqrt(s)),a=document.createElement("table");Object.assign(a.style,{borderCollapse:"collapse",position:"absolute",top:`${t}px`,left:`${e}px`});for(let l=0;l<r;l+=1){let m=a.insertRow(l);for(let c=0;c<r;c+=1){let p=m.insertCell(c),f=o[c+l*r];if(!f)continue;p.style.border="1px solid #000",p.style.padding="0px";let d=document.createElement("a");d.href="javascript:void(0)",d.addEventListener("click",()=>this.colorHandler(n,f)),p.appendChild(d),Object.assign(d.style,{display:"block",backgroundColor:f,height:"20px",width:"20px",margin:0})}}return this.colorWindow=a,document.querySelector("#page")?.appendChild(a),null}hideColors(){this.colorWindow&&(this.colorWindow.remove(),this.colorWindow=void 0)}cmd(e,t){let n=this.getSelection(),o="",s=e,r=t;switch(e.toLowerCase()){case"bold":o=`[b]${n}[/b]`;break;case"italic":o=`[i]${n}[/i]`;break;case"underline":o=`[u]${n}[/u]`;break;case"strikethrough":o=`[s]${n}[/s]`;break;case"justifyright":o=`[align=right]${n}[/align]`;break;case"justifycenter":o=`[align=center]${n}[/align]`;break;case"justifyleft":o=`[align=left]${n}[/align]`;break;case"insertimage":if(r=prompt("Image URL:")||"",!r)return;if(!ze(r)){alert("Please enter a valid URL.");return}o=`[img]${r}[/img]`;break;case"insertorderedlist":this.htmlMode||(o=`[ol]${n.replaceAll(/(.+([\r\n]+|$))/i,"*$1")}[/ol]`);break;case"insertunorderedlist":this.htmlMode||(o=`[ul]${n.replaceAll(/(.+([\r\n]+|$))/i,"*$1")}[/ul]`);break;case"createlink":if(r=prompt("Link:")||"",!r)return;/^(https?|ftp|mailto):/.test(r)||(r=`https://${r}`),o=`[url=${r}]${n}[/url]`;break;case"c_email":if(r=prompt("Email:")||"",!r)return;s="createlink",r=`mailto:${r}`,o=`[url=${r}]${n}[/url]`;break;case"backcolor":(le.firefox||le.safari)&&(s="hilitecolor"),o=`[bgcolor=${r}]${n}[/bgcolor]`;break;case"forecolor":o=`[color=${r}]${n}[/color]`;break;case"fontname":o=`[font=${r}]${n}[/font]`;break;case"c_code":s="inserthtml",r=`[code]${n}[/code]`,o=r;break;case"c_quote":s="inserthtml",r=prompt("Who said this?")||"",r=r?`=${r}`:"",r=`[quote${r}]${n}[/quote]`,o=r;break;case"c_spoiler":s="inserthtml",r=`[spoiler]${n}[/spoiler]`,o=r;break;case"c_youtube":if(s="inserthtml",r=prompt("Video URL?")||"",!r)return;r=`[video]${r}[/video]`,o=r;break;case"inserthtml":o=r||"";break;default:throw new Error(`Unsupported editor command ${e}`)}this.htmlMode?(this.doc?.execCommand(s,!1,r),this.window?.focus()):xe(this.element,o)}getSelection(){return this.htmlMode?this.window?.getSelection()?.toString()||"":this.element.value.substring(this.element.selectionStart,this.element.selectionEnd)}getSource(){return this.doc?.body.innerHTML}setSource(e){this.doc&&(this.doc.body.innerHTML=e)}switchMode(e){let{element:t,iframe:n}=this;e?(this.setSource(ae(t.value)),t.style.display="none",n.style.display=""):(t.style.display="",n.style.display="none"),this.htmlMode=e}};var F=class extends u{resetOnSubmit;static hydrate(e){h("Form",e.querySelectorAll("form[data-ajax-form]"),this)}constructor(e){super(e),this.resetOnSubmit=e.dataset.ajaxForm==="resetOnSubmit",e.addEventListener("submit",t=>{t.preventDefault(),this.submitForm()})}submitForm(){let{element:e,resetOnSubmit:t}=this,{submitButton:n}=e,o=new FormData(e,n),s=Array.from(o.entries()).filter(r=>typeof r[1]=="string");RUN.stream.load(e.action||globalThis.location.toString(),{body:new URLSearchParams(s)}),t&&e.reset(),RUN.stream.pollData()}};var P=class extends u{index;images;max;static hydrate(e){h("ImageGallery",e.querySelectorAll(".image_gallery"),this)}constructor(e){super(e);let t=document.createElement("div"),n=document.createElement("button"),o=document.createElement("button");this.index=0,this.images=e.querySelectorAll("img"),this.max=Math.max(this.images.length,1),n.innerHTML="Next &raquo;",n.addEventListener("click",()=>{this.showNext()}),o.innerHTML="Prev &laquo;",o.addEventListener("click",()=>{this.showPrev()}),this.update(),t.appendChild(o),t.appendChild(document.createTextNode(" ")),t.appendChild(n),e.appendChild(t)}showNext(){this.index<this.max-1&&(this.index+=1),this.update()}showPrev(){this.index>0&&(this.index-=1),this.update()}update(){this.images.forEach((e,t)=>{let n=e.dataset.madeResized?e.parentNode:e;n&&(n.style.display=t===this.index?"block":"none")})}};var Ae="999999px",z=class extends u{static async hydrate(e){let t=e.querySelectorAll(".bbcodeimg");await $(Array.from(t)),h("ImageResizer",t,this)}constructor(e){super(e);let t=1,n=1,{naturalWidth:o,naturalHeight:s}=e,r=y(e),a=Number.parseInt(r.width,10)||Number.parseInt(r.maxWidth,10),l=Number.parseInt(r.height,10)||Number.parseInt(r.maxHeight,10);a&&o>a&&(t=a/s),l&&s>l&&(n=l/s),t=t&&n?Math.min(t,n):n||t,t<1&&this.makeResizer(o*t,s*t)}makeResizer(e,t){let{element:n}=this;n.style.maxWidth=Ae,n.style.maxHeight=Ae,n.dataset.madeResized="true";let o=Object.assign(document.createElement("a"),{target:"_blank",href:n.src});Object.assign(o.style,{display:"block",overflow:"hidden",width:`${e}px`,height:`${t}px`}),o.dataset.nw=`${n.naturalWidth}`,o.dataset.nh=`${n.naturalHeight}`,o.addEventListener("mousemove",r=>{let{x:a,y:l,w:m,h:c}=b(o);o.scrollLeft=(r.pageX-a)/m*(+(o.dataset.nw||0)-m)||0,o.scrollTop=(r.pageY-l)/c*(+(o.dataset.nh||0)-c)||0}),o.addEventListener("mouseover",()=>{n.style.width=`${o.dataset.nw}px`,n.style.height=`${o.dataset.nh}px`});let s=()=>{o.scrollLeft&&(o.scrollLeft=0,o.scrollTop=0),n.style.width=`${e}px`,n.style.height=`${t}px`};o.addEventListener("mouseout",s),s(),k(o,n),o.appendChild(n)}};function j(i){let e=document.querySelector("#tooltip_thingy"),t=b(i),n=i.getAttribute("title");if(i.dataset.lastOnline){let o=Number.parseInt(i.dataset.lastOnline??"",10);n=`Last Online: ${J(o)} ${te(o)}`}if(n){if(i.title="",!e){e=document.createElement("table");let o=e.insertRow(0),s=e.insertRow(1),r=e.insertRow(2),a;e.id="tooltip_thingy",e.className="tooltip",o.className="top",s.className="content",r.className="bottom",a=o.insertCell(0),a.className="left",a.colSpan=2,a=o.insertCell(1),a.className="right",a=s.insertCell(0),a.className="left",a=s.insertCell(1),a.innerHTML="default text",a=s.insertCell(2),a.className="right",a=r.insertCell(0),a.className="left",a.colSpan=2,a=r.insertCell(1),a.className="right",document.querySelector("#page")?.appendChild(e)}e.rows[1].cells[1].innerText=n,e.style.display="",e.style.top=`${t.y-e.clientHeight}px`,e.style.left=`${t.x}px`,e.style.zIndex=`${E()}`,i.addEventListener("mouseout",()=>{i.title=n,e.style.display="none"})}}var B=class extends u{static hydrate(e){h("Link",e.querySelectorAll("a"),this)}constructor(e){if(super(e),e.dataset.useTooltip&&e.addEventListener("mouseover",()=>j(e)),!e.href)return;let t=e.getAttribute("href"),n=!e.target&&t&&(t.startsWith("/")||t.startsWith("?"));if(!t?.startsWith("javascript")){if(n){let s=e.onclick;e.onclick=null,e.addEventListener("click",r=>{r.preventDefault(),(!s||s.call(e,r)!==!1)&&RUN.stream.location(t)});return}e.target="_blank"}}};var ce=class{sess;boundEvents;droppables;noChild=!1;bounds;onstart;ondragover;ondrag;ondragout;ondrop;autoZIndex=!0;constructor(){this.droppables=[],this.sess={el:document.body,mx:0,my:0},this.boundEvents={drag:e=>this.drag(e),drop:()=>this.drop()}}start(e,t,n){e.preventDefault(),e.stopPropagation();let o=t||e.target,s=y(o),r=E();this.noChild&&e.target!==(n||o)||o.getAttribute("draggable")!=="false"&&(this.sess={el:o,mx:e.pageX,my:e.pageY,ex:Number.parseInt(s.left,10)||0,ey:Number.parseInt(s.top,10)||0,info:{el:o,mx:0,my:0},zIndex:o.style.zIndex},(!this.sess.zIndex||Number(this.sess.zIndex)<r-1)&&(o.style.zIndex=`${r}`),this.onstart?.({...this.sess,droptarget:this.testDrops(this.sess.mx,this.sess.my)}),document.addEventListener("mousemove",this.boundEvents.drag),document.addEventListener("mouseup",this.boundEvents.drop),this.drag(e))}drag(e){e.stopPropagation();let t=this.sess.el.style,n=e.pageX,o=e.pageY,s=n,r=o,a,l=(this.sess.ex??0)+s-this.sess.mx,m=(this.sess.ey??0)+r-this.sess.my,c=this.bounds;c&&(l<c[0]?(s=s-l+c[0],[l]=c):l>c[0]+c[2]&&(l=c[0]+c[2]),m<c[1]?(r=r-m+c[1],[m]=c):m>c[1]+c[3]&&(m=c[1]+c[3])),t.left=`${l}px`,t.top=`${m}px`;let p=this.sess.info,f=p?.droptarget,d={left:l,top:m,el:this.sess.el,mx:s,my:r,dx:s-(p?.mx||s),dy:r-(p?.my||r),droptarget:this.testDrops(n,o)};this.sess.info=d,this.ondrag?.(d),d.droptarget&&f!==d.droptarget&&this.ondragover?.(d),f&&d.droptarget!==f&&(a=d.droptarget,d.droptarget=f,this.ondragout?.(d),d.droptarget=a)}boundingBox(e,t,n,o){return this.bounds=[e,t,n,o],this}drop(){return this.boundEvents&&(document.removeEventListener("mouseup",this.boundEvents.drop),document.removeEventListener("mousemove",this.boundEvents.drag)),this.ondrop?.(this.sess.info??{}),this.autoZIndex&&(this.sess.el.style.zIndex=this.sess.zIndex??""),!0}testDrops(e,t){let{droppables:n}=this,o,s=[9999,9999];if(n.length)return n.findLast(r=>{if(!(r===this.sess.el||Le(r,this.sess.el))&&(o=b(r),s[0]>o.w&&s[1]>o.h&&e>=o.x&&t>=o.y&&e<=o.xw&&t<=o.yh))return s=[o.w,o.h],r})}drops(e){return this.droppables=e,this}addDrops(e){return this.droppables?(this.droppables=this.droppables.concat(e),this):this.drops(e)}addListener(e){return Object.assign(this,e),this}apply(e,t){if(Array.isArray(e))return e.forEach(s=>this.apply(s)),this;let o=y(e)?.position;return(!o||o==="static")&&(e.style.position="relative"),(t||e).onmousedown=t?s=>this.start(s,e,t):s=>this.start(s,e),this}autoZ(){return this.autoZIndex=!1,this}noChildActivation(){return this.noChild=!0,this}reset(e=this.sess.el){return e.style.top="0",e.style.left="0",this}},de=ce;var me=class{title="Title";wait=!0;content="Content";open=!1;minimizable=!0;resize;className="";pos="center";zIndex;windowContainer;id;onclose;animate=!1;oldpos;constructor(e={}){this.zIndex=E(),Object.assign(this,e)}static close(e){let t=e;do{if("close"in t&&typeof t.close=="function"){t.close();break}t=t.parentElement}while(t)}create(){if(this.windowContainer)return this.windowContainer;let e=document.createElement("div"),t=document.createElement("div"),n=document.createElement("div"),o=document.createElement("div"),s=document.createElement("div"),r=document.createElement("div"),{pos:a}=this;this.windowContainer=e,this.id&&(e.id=this.id),e.className=`window${this.className?` ${this.className}`:""}`,t.className="title",n.className="content",this.minimizable&&(s.innerHTML="-",s.addEventListener("click",()=>this.minimize())),r.innerHTML="X",r.addEventListener("click",()=>this.close()),o.appendChild(s),o.appendChild(r),o.className="controls",t.innerHTML=this.title,n.innerHTML=this.content,t.appendChild(o),e.appendChild(t),e.appendChild(n);let l=()=>this.close();if(e.querySelectorAll("[data-window-close]").forEach(c=>{c.addEventListener("click",l)}),document.body.appendChild(e),this.resize){let c=e.querySelector(this.resize);if(!c)throw new Error("Resize target not found");c.style.width=`${c.clientWidth}px`,c.style.height=`${c.clientHeight}px`;let p=document.createElement("div");p.className="resize",e.appendChild(p),p.style.left=`${e.clientWidth-16}px`,p.style.top=`${e.clientHeight-16}px`,new de().boundingBox(100,100,1/0,1/0).addListener({ondrag(f){let d=Number.parseFloat(c.style.width)+(f.dx??0),C=Number.parseFloat(c.style.height)+(f.dy??0);c.style.width=`${d}px`,d<e.clientWidth-20?c.style.width=`${e.clientWidth}px`:p.style.left=`${e.clientWidth-16}px`,c.style.height=`${C}px`},ondrop(){p.style.left=`${e.clientWidth-16}px`}}).apply(p),c.style.width=`${e.clientWidth}px`,p.style.left=`${e.clientWidth-16}px`}let m=e.style;return m.zIndex=`${this.zIndex+5}`,this.wait?$(Array.from(e.querySelectorAll("img"))).then(()=>{this.setPosition(a)}):this.setPosition(a),new de().autoZ().noChildActivation().boundingBox(0,0,document.documentElement.clientWidth-50,document.documentElement.clientHeight-50).apply(e,t),Object.assign(e,{close:()=>this.close(),minimize:()=>this.minimize()})}close(){this.windowContainer&&(this.windowContainer.remove(),this.windowContainer=void 0,this.onclose&&this.onclose())}minimize(){let e=this.windowContainer;if(!e)return;let t=e.classList.contains("minimized");if(e.classList.toggle("minimized"),t)e.removeAttribute("draggable"),this.setPosition(this.oldpos??"");else{e.setAttribute("draggable","false");let o=Array.from(document.querySelectorAll(".window")).reduce((s,r)=>r.classList.contains("minimized")?s+Number(r.clientWidth):s,0);this.oldpos=this.getPosition(),this.setPosition(`bl ${o} 0`,!1)}}setPosition(e,t=!1){let n=this.windowContainer;if(!n)return;let o=0,s=0,r=document.documentElement.clientHeight,a=document.documentElement.clientWidth,l=/(\d+) (\d+)/.exec(e);switch(l&&(o=Number(l[1]),s=Number(l[2])),o=Math.floor(o),s=Math.floor(s),e.charAt(1)==="r"&&(o=a-o-n.clientWidth),e.charAt(0)){case"b":s=r-s-n.clientHeight;break;case"c":s=(r-n.clientHeight)/2,o=(a-n.clientWidth)/2;break;default:}o=Math.floor(o),s=Math.floor(s),o<0&&(o=0),s<0&&(s=0),n.style.left=`${o}px`,this.animate||t?new T(n,10).add("top",`${s-100}px`,`${s}px`).play():n.style.top=`${s}px`,this.pos=e}getPosition(){if(!this.windowContainer)return"";let e=this.windowContainer.style;return`tl ${Number.parseFloat(e.left)} ${Number.parseFloat(e.top)}`}},w=me;var U=class extends u{static hydrate(e){h("MediaPlayer",e.querySelectorAll(".media"),this)}constructor(e){super(e);let t=e.querySelector("a.popout"),n=e.querySelector("a.inline"),o=e.querySelector(".movie");o&&(t?.addEventListener("click",s=>{s.preventDefault(),new w({title:t.href,content:o.innerHTML}).create()}),n?.addEventListener("click",s=>{s.preventDefault(),o.style.display="block"}))}};var O=class extends u{static hydrate(e){h("PageList",e.querySelectorAll(".pages"),this)}constructor(e){super(e),e.addEventListener("wheel",t=>this.wheel(t))}wheel(e){e.preventDefault();let t=Math.sign(e.deltaY),n=Array.from(this.element.querySelectorAll("a")),o=Number.parseInt(n[1].innerHTML,10),s=Number.parseInt(n.at(-1)?.innerHTML||"",10),r=n.length-2;if(t>0&&o+r<s||t<0&&o>2)for(let a=0;a<r;a+=1)n[a+1].href=n[a+1].href.replace(/\d+$/,`${a+o+t}`),n[a+1].innerHTML=`${o+a+t}`}};var _=class extends u{static hydrate(e){h("Switch",e.querySelectorAll("input.switch"),this)}constructor(e){super(e),e.style.display="none";let t=Object.assign(document.createElement("button"),{type:"button",title:e.className,className:e.className}),n=()=>{t.style.backgroundPosition=e.checked?"top":"bottom"};n(),t.addEventListener("click",()=>{e.checked=!e.checked,n(),e.dispatchEvent(new Event("change"))}),ve(t,e)}};var ue="active",Y=class extends u{static hydrate(e){h("Tabs",e.querySelectorAll(".tabs"),this)}constructor(e){super(e),e.addEventListener("click",t=>this.click(t))}click(e){let{tabSelector:t}=this.element.dataset,{target:n}=e;if(!n||!(n instanceof HTMLElement)||n.tagName.toLowerCase()!=="a")return;let o=n;if(t){let r=n.closest(t);r&&(o=r)}let s=this.element.querySelector(`.${ue}`);s&&s.classList.remove(ue),o.className=ue,o.blur()}};function g(i){q(),[D,I,N,R,W,F,A,P,z,B,U,O,_,Y].forEach(e=>{e.hydrate(i)})}var he=class{soundCache={};load(e,t,n){let o=this.soundCache[e];if(o){n&&this.play(e);return}o=new Audio,this.soundCache[e]=o,o.autoplay=!!n,o.src=t}play(e){this.soundCache[e].play()}loadAndPlay(e,t){this.load(e,t,!0)}},L=new he;var H={loadscript(i){document.body.appendChild(Object.assign(document.createElement("script"),{src:i}))},script(i){(0,eval)(i)},error(i){alert(i)},alert(i){alert([i])},reload(i=0){setTimeout(()=>globalThis.location.reload(),i)},refreshdata(){RUN.stream.pollData(!0)},addclass(i,e){let t=document.querySelector(i);t&&t.classList.add(e)},title(i){document.title=i},update(i,e,t){let n=i,o=Array.from(document.querySelectorAll(".path"));if(n==="path"&&o.length>1){o.forEach(r=>{r.innerHTML=e,g(r)});return}/^\W/.test(n)||(n=`#${n}`);let s=document.querySelector(n);s&&(s.innerHTML=e,t&&new T(s).dehighlight().play(),g(s))},removeel(i){let e=document.querySelector(i);e&&e.remove()},back(){globalThis.history.back()},setstatus(i){let e=document.querySelector("#status");e&&(e.className=i)},appendrows(i,e){let t=document.querySelector(i);if(!t)return;let n=document.createElement("span");n.innerHTML=`<table>${e}</table>`;let o=n.getElementsByTagName("tbody")[0];g(o),t.appendChild(o)},location(i){if(["?","/"].includes(i.charAt(0))){RUN.stream.location(i);return}document.location=i},enable(i){let e=document.querySelector(`#${i}`);e&&(e.disabled=!1)},addshout(i){let e=Array.from(document.querySelectorAll("#shoutbox .shout")),t=document.createElement("span");t.innerHTML=i;let n=t.firstElementChild;if(n){for(e[0].parentNode?.insertBefore(n,e[0]);e.length>globalSettings.shoutLimit-1;)e.pop()?.remove();new T(n).dehighlight().play(),globalSettings.soundShout&&L.play("sbblip"),g(n)}},tick(i){let e=document.querySelector("#ticker");if(!e)return;let t=document.createElement("div");t.innerHTML=i,t=t.firstElementChild,e.insertBefore(t,e.firstChild);let n=Array.from(e.querySelectorAll(".tick"));for(let o=100;o<n.length;o+=100)n[o].remove()},im(i,e,t,n,o){ke({fromId:i,fromName:e,message:t,fromMe:n,timestamp:o})},imtoggleoffline(i){document.querySelector(`#im_${i}`)?.classList.add("offline")},window(i){if(i.id&&document.getElementById(i.id))return;let t=new w;t.title=i.title,t.content=i.content,t.minimizable=i.minimizable||!1,t.animate=i.animate??!0,t.resize=i.resize||void 0,t.className=i.className||"",i.pos&&(t.pos=i.pos);let n=t.create();n.id=i.id||"",g(n)},closewindow(i){let e=document.querySelector(i);e&&w.close(e)},onlinelist(i){let e=document.querySelector("#statusers");e&&i.forEach(t=>{let n=document.querySelector(`#statusers .user${t.uid}`);if(n||(n=document.createElement("a")),n.innerHTML=t.name,n.className=[`user${t.uid}`,`mgroup${t.groupID}`,t.status,`lastAction${t.lastAction}`].join(" "),t.profileURL&&(n.href=t.profileURL,n.addEventListener("click",function(){RUN.stream.location(this.href)})),t.locationVerbose&&(n.title=t.locationVerbose,n.addEventListener("mouseover",()=>j(n))),t.status==="idle"){ne(n);return}e.firstChild?e.insertBefore(n,e.firstChild):e.appendChild(n)})},setoffline(i){let e=document.querySelector("#statusers");i.split(",").forEach(n=>{let o=document.querySelector(`#statusers .user${n}`);o&&e&&o.remove()})},async scrollToPost(i){let e=document.getElementById(`pid_${i}`);if(!e)return!1;await $(Array.from(document.querySelectorAll("#page img")));let t=b(e);return globalThis.scrollTo({top:t.y}),!0},updateqreply(i){let t=document.querySelector("#qreply")?.querySelector("textarea");t&&(t.focus(),t.value+=i)},newmessage(i,e){let t=document.querySelector("#notification"),n=document.querySelector("#num-messages");n&&(n.innerHTML=`${Number.parseInt(n.innerHTML,10)+1}`),t||(t=document.createElement("div"),t.id="notification",document.body.appendChild(t)),t.style.display="",t.className="newmessage",t.addEventListener("click",()=>{t.style.display="none",RUN.stream.location(`/ucp/inbox?view=${e}`,3)}),t.innerHTML=i},playsound(i,e){L.loadAndPlay(i,e)},attachfiles(){document.querySelector("#attachfiles")?.addEventListener("click",()=>{alert("Attaching files is under construction")})},listrating(i,e){let t=document.querySelector(`#postrating_${i}`),n;if(t){if(t.style.display!=="none"){new T(t).add("height","200px","0px").andThen(o=>{o.style.display="none"}).play();return}t.style.display="block"}else{t=document.createElement("div"),t.className="postrating_list",t.id=`postrating_${i}`;let o=document.querySelector(`#pid_${i} .postrating`);if(!o)return;n=b(o),t.style.top=`${n.yh}px`,t.style.left=`${n.x}px`,document.querySelector("#page")?.appendChild(t)}t.innerHTML=e,new T(t).add("height","0px","200px").play()}};var Ie=-1,x="",De="";function pe(){x&&(document.title=x),x="",clearInterval(Ie)}function Ne(i){document.hasFocus()||(pe(),x||(x=document.title),De=i,Ie=setInterval(()=>{document.title=document.title===x?De:x},1e3))}function je(i,e){if(Ne(`New message from ${i}!`),!document.hasFocus()&&globalThis.Notification&&Notification.permission==="granted"){let t=new Notification(`${i} says:`,{body:e});t.onclick=()=>{globalThis.focus(),t.close()}}}function Be({fromId:i,fromName:e,message:t}){let n=document.querySelector(`#im_${i} .ims`);if(n)return n;let s=new w({title:`${e}`,content:`
            <div class='ims'></div>
            <div class='offline'>This user may be offline</div>
            <div>
                <form data-ajax-form='resetOnSubmit' method='post'>
                    <input type='hidden' name='im_uid' value='%s'>
                    <input type='text' name='im_im' autocomplete='off'>
                </form>
            </div>
        `.replaceAll("%s",`${i}`),className:"im",resize:".ims",animate:!0,id:`im_${i}`}).create();g(s);let r=()=>{s.querySelector('form input[name="im_im"]')?.focus()};s.onclick=r,r(),n=s.querySelector(".ims");let a=getComputedStyle(n);return n.style.width=a.width,n.style.height=a.height,t&&globalSettings.soundIM&&L.play("imnewwindow"),n}function fe(i,e){if(!globalSettings.canIM){alert("You do not have permission to use this feature.");return}H.im(i,e,"",1,Date.now())}function ke({fromId:i,fromName:e,message:t,fromMe:n,timestamp:o}){je(e,t);let s=Be({fromId:i,fromName:e,message:t});if(!t)return;let r=document.createElement("div"),a=t.startsWith("/me");a&&(r.className="action",t=t.substring(3),e=`***${e}`),r.classList.add(n?"you":"them"),n||document.querySelector(`#im_${i}`)?.classList.remove("offline"),r.innerHTML=`<a href='/profile/${n||i}' class='name'>${e}</a> ${a?"":": "}${t}`,r.dataset.timestamp=`${o}`;let l=s.scrollTop>s.scrollHeight-s.clientHeight-50;s.appendChild(r),l&&(s.scrollTop=s.scrollHeight),g(r),globalSettings.soundIM&&L.play("imbeep")}function Ue(i){let e=i?i.split(","):[],t=e.length===1?"":"s",n=e.length?" and <br>":"";return[e,t,n]}function Oe(i){let e=i?i.split(","):[],n=(e?e.length:0)===1?"":"s";return[e,n]}var G=class{whichone=0;boundCheckLocation;pids=[];tids=[];modb;constructor(){this.boundCheckLocation=()=>this.checkLocation(),Object.assign(H,{modcontrols_clearbox:this.destroyModControls.bind(this),modcontrols_move:this.showMoveControls.bind(this),modcontrols_postsync:this.postSync.bind(this)})}checkLocation(){let{whichone:e}=this,n=(e?/topic\/(\d+)/:/forum\/(\d+)/).exec(document.location.toString());n?this.moveTo(Number(n[1])):this.showMoveControls(e)}moveTo(e){let{whichone:t}=this;this.renderModControls(`<form method="post" action="/modcontrols" data-ajax-form="true">
                move ${t?"posts":"topics"} here?
            <input type="hidden"
                name="${t?"dop":"dot"}"
                value="moveto">
            <input type="hidden" name="id" value="${e}">
            <input type="submit" value="Yes">
            <input type="submit" name="cancel" value="Cancel" onclick="this.form.submitButton=this">
            </form>`)}renderModControls(e){this.modb=this.modb||document.querySelector("#modbox")||void 0,this.modb||(this.modb=document.createElement("div"),this.modb.id="modbox",document.body.appendChild(this.modb)),this.modb.style.display="block",this.modb.innerHTML=e,g(this.modb)}destroyModControls(){globalThis.removeEventListener("pushstate",this.boundCheckLocation),this.modb&&(this.modb.innerHTML="",this.modb.style.display="none")}togbutton(e){e.classList.toggle("selected")}postSync(e,t){let[n,o,s]=Ue(e),[r,a]=Oe(t);if(this.tids=r,this.pids=n,!r.length&&!n.length){this.destroyModControls();return}let l=r.length?`
            <select name="dot">
                <option value="delete">Delete</option>
                <option value="merge">Merge</option>
                <option value="move">Move</option>
                <option value="pin">Pin</option>
                <option value="unpin">Unpin</option>
                <option value="lock">Lock</option>
                <option value="unlock">Unlock</option>
            </select> &nbsp; &nbsp;
            <strong>${r.length}</strong> topic${a}${s}`:"",m=n.length?`
            <select name="dop">
                <option value="delete">Delete</option>
                <option value="move">Move</option>
            </select> &nbsp; &nbsp;
            <strong>${n.length}</strong> post${o}`:"",c=n.length&&r.length?"<br>":" &nbsp; &nbsp; ",p=`
        <form method="post" action="/modcontrols" data-ajax-form="true">
            ${l}
            ${m}
            ${c}
            <input type="submit" value="Go">
            <input
                name="cancel" type="submit"
                onclick="this.form.submitButton=this;" value="Cancel">
        </form>`;this.renderModControls(p)}showMoveControls(e){this.whichone=e,globalThis.addEventListener("pushstate",this.boundCheckLocation),this.renderModControls(`Ok, now browse to the ${this.whichone?"topic":"forum"} you want to move the ${this.whichone?`${this.pids.length} posts`:`${this.tids.length} topics`} to...`)}};function _e(i=200){let e=document.querySelector("#snow");if(e===null){e=document.createElement("div"),e.id="snow",Object.assign(e.style,{position:"fixed",top:0,left:0,zIndex:1});let t=document.createElement("style");t.appendChild(document.createTextNode(`
            .snowflake {
                position: absolute;
                width: 10px;
                height: 10px;
                background: linear-gradient(white, white);
                /* Workaround for Chromium's selective color inversion */
                border-radius: 50%;
                filter: drop-shadow(0 0 10px white);
            }`)),document.body.prepend(t),document.body.prepend(e)}e.innerHTML="";for(let t=1;t<i;t+=1){let n=document.createElement("div");n.className="snowflake",e.appendChild(n)}}function Ye(){let i=document.getElementById("snow-css");return i||(i=document.createElement("style"),i.id="snow-css",document.head.appendChild(i),i)}function Ge(i){let e=Ye();e.innerHTML=i,document.head.appendChild(e)}function Ve(i=100){return Math.floor(Math.random()*i)+1}function Xe(i,e){let t=Math.ceil(i),n=Math.floor(e);return Math.floor(Math.random()*(n-t+1))+t}function Ze(i,e){return Math.random()*(e-i)+i}function Je(i=200){let t=100*document.body.offsetHeight/window.innerHeight,n="snowflake",o="";for(let s=1;s<i;s+=1){let r=Math.random()*100,a=Math.random()*10,l=r+a,m=r+a/2,c=Ze(.3,.8),p=c*t,f=Math.random(),d=Xe(10,t/10*3),C=Ve(t/10*3)*-1,S=Math.random();o+=`
      .${n}:nth-child(${s}) {
        opacity: ${S};
        transform: translate(${r}vw, -10px) scale(${f});
        animation: fall-${s} ${d}s ${C}s linear infinite;
      }
      @keyframes fall-${s} {
        ${c*100}% {
          transform: translate(${l}vw, ${p}vh) scale(${f});
        }
        to {
          transform: translate(${m}vw, ${t}vh) scale(${f});
        }
      }
    `}Ge(o)}function ge(){Je(200),_e(200)}var Qe=5e3,V=class{commands;lastURL;timeout=0;constructor(){this.lastURL=`${document.location.pathname}${document.location.search}`,this.commands=H}handleRequestData(e,t,n=1){let o=!1;t.forEach(([s,...r])=>{s==="softurl"?o=!0:s in this.commands&&this.commands[s].apply(null,r)}),n===2&&(o||(globalThis.history.pushState({lastURL:e},"",e),globalThis.dispatchEvent(new Event("pushstate")),this.lastURL=e)),this.pollData()}location(e,t=2){this.load(e,{requestType:t})}async load(e,{body:t,method:n="POST",requestType:o=1}={}){let s=await fetch(e,{method:n,body:t,headers:{"X-JSACCESS":`${o}`,"Content-Type":"application/x-www-form-urlencoded"}});if(s.ok){let r=await s.json();this.handleRequestData(e,r,o)}}pollData(e=!1){e&&this.load(this.lastURL),clearTimeout(this.timeout),document.cookie.includes(`actw=${window.name}`)&&(this.timeout=setTimeout(()=>this.load(this.lastURL),Qe))}updatePage(e){e!==this.lastURL&&this.location(e,3)}};var Ke=2,be=class{stream=new V;onAppReady(){Ke&&g(document.body);let e=new Date;e.getMonth()===11&&[23,24,25].includes(e.getDate())&&ge(),q(),setInterval(q,1e3*30),this.stream.pollData(),globalThis.addEventListener("popstate",({state:n})=>{if(n){let{lastURL:o}=n;this.stream.updatePage(o)}else this.stream.updatePage(document.location.toString())}),L.load("sbblip","/Sounds/blip.mp3",!1),L.load("imbeep","/Sounds/receive.mp3",!1),L.load("imnewwindow","/Sounds/receive.mp3",!1)}handleQuoting(e){this.stream.load(`${e.href}&qreply=${document.querySelector("#qreply")?"1":"0"}`)}setWindowActive(){document.cookie=`actw=${window.name}; SameSite:Lax`,pe(),this.stream.pollData()}},K=new be;se(()=>{K.onAppReady()});se(()=>{window.name=`${Math.random()}`,K.setWindowActive(),globalThis.addEventListener("focus",()=>{K.setWindowActive()}),He()||document.documentElement.classList.add("no-emoji")});var qe=K;Object.assign(globalThis,{RUN:qe,IMWindow:fe,ModControls:new G});})();

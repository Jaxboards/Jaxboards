"use strict";(()=>{var Q=class{constructor(){this.soundCache={}}load(e,t,n){let s=this.soundCache[e];if(s){n&&this.play(e);return}s=new Audio,this.soundCache[e]=s,s.autoplay=!!n,s.src=t}play(e){this.soundCache[e].play()}loadAndPlay(e,t){this.load(e,t,!0)}},E=new Q;var Ee=-1,x="",ye="";function K(){x&&(document.title=x),x="",clearInterval(Ee)}function Le(i){document.hasFocus()||(K(),x||(x=document.title),ye=i,Ee=setInterval(()=>{document.title=document.title===x?ye:x},1e3))}var Z=new Map,u=class{element;constructor(e){this.element=e}};function p(i,e,t){Z.has(i)||Z.set(i,new WeakMap),e.forEach(function(s){Z.get(i)?.has(s)||Z.get(i)?.set(s,new t(s))})}function y(i){return globalThis.getComputedStyle(i)}function b(i){let{x:e,y:t,height:n,width:s}=i.getBoundingClientRect(),l=e+globalThis.scrollX,o=t+globalThis.scrollY;return{x:l,y:o,yh:o+n,xw:l+s,w:s,h:n}}function ve(i,e){return e.contains(i)}function S(i,e){i.remove(),e.parentNode?.insertBefore(i,e)}function xe(i,e){i.remove(),e.parentNode?.insertBefore(i,e.nextSibling)}function L(){return Array.from(document.querySelectorAll("*")).reduce((t,n)=>n.style.zIndex&&Number(n.style.zIndex)>t?Number(n.style.zIndex):t,0)+1}var Te="valid",je="invalid",A=class extends u{action;outputElement;indicatorElement;static hydrate(e){p("AutoComplete",e.querySelectorAll("input[data-autocomplete-action]"),this)}constructor(e){super(e),e.autocomplete="off",this.action=e.dataset.autocompleteAction;let t=e.dataset.autocompleteOutput,n=e.dataset.autocompleteIndicator,s=t?document.querySelector(t):void 0;if(!s)throw new Error("Expected element to have data-autocomplete-output");this.outputElement=s||document.createElement("input"),this.indicatorElement=n?document.querySelector(n):void 0,e.addEventListener("keyup",l=>this.keyUp(l)),e.addEventListener("keydown",l=>{l.key==="Enter"&&l.preventDefault()})}getResultsContainer(){let e=b(this.element),t=document.querySelector("#autocomplete");return t||(t=Object.assign(document.createElement("div"),{id:"autocomplete"}),Object.assign(t.style,{zIndex:L()}),document.body.appendChild(t)),Object.assign(t.style,{top:`${e.yh}px`,left:`${e.x}px`,width:`${e.w}px`}),t}keyUp(e){let t=this.getResultsContainer(),n=Array.from(t.querySelectorAll("div")),s=n.findIndex(l=>l.classList.contains("selected"));if(n)switch(e.key){case"ArrowUp":s>=0&&(n[s].classList.remove("selected"),n[s-1].classList.add("selected"));return;case"ArrowDown":s===-1?n[0].classList.add("selected"):s<n.length-1&&(n[s].classList.remove("selected"),n[s+1].classList.add("selected"));return;case"Enter":s>=0&&n[s].dispatchEvent(new Event("click"));return;default:this.indicatorElement&&(this.indicatorElement.classList.remove(Te),this.indicatorElement.classList.add(je));break}this.doSearch()}async doSearch(){let e=this.getResultsContainer(),t=/ACP/.test(document.location.toString())?"../":"",n=encodeURIComponent(this.element.value),s=`act=${this.action}&term=${n}`,l=await fetch(`${t}api/?${s}`);if(!l.ok)return;let o=await l.json();if(e.innerHTML="",o.length){e.style.display="";let[r,a]=o;r.forEach((d,c)=>{let h=a[c],f=document.createElement("div");f.innerHTML=h,f.addEventListener("click",()=>{e.style.display="none",this.indicatorElement&&this.indicatorElement.classList.add(Te),this.outputElement.value=`${d}`,this.outputElement.dispatchEvent(new Event("change")),this.element.value=h}),e.appendChild(f)});return}e.style.display="none"}};var k=class extends u{fullHeight=0;static hydrate(e){p("CollapseBox",e.querySelectorAll(".collapse-box"),this)}constructor(e){super(e);let{collapseContent:t}=this;t&&(this.fullHeight=t.clientHeight||t.offsetHeight,Object.assign(t.style,{height:`${this.fullHeight}px`,transition:"height 200ms ease-in-out",overflow:"hidden"})),this.element.addEventListener("click",n=>{n.target instanceof HTMLElement&&n.target.matches(".collapse-button")&&this.toggle()})}get collapseContent(){return this.element.querySelector(".collapse-content")}toggle(){let{collapseContent:e}=this;if(!e)return;let{style:t}=e;t.height=`${t.height==="0px"?this.fullHeight:0}px`}};function _e(i){let e=i.getHours()||12,t=`${i.getMinutes()}`.padStart(2,"0");return`${e%12||12}:${t}${e>12?"pm":"am"}`}function G(i){return new Date(i*1e3)}var Me=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],we=["January","February","March","April","May","June","July","August","September","October","November","December"];function Oe(i){return i[0].toUpperCase()+i.slice(1)}function J(i){let e=new Date,t=new Intl.RelativeTimeFormat(void 0,{numeric:"auto",style:"long"}),n=new Date;n.setTime(+n-1e3*60*60*24),n.setHours(0),n.setMinutes(0),n.setSeconds(0);let s=G(i),l=Math.round((+s-+e)/1e3);if(l>-60)return t.format(l,"second");if(l>-3600)return t.format(Math.round(l/60),"minute");if(s>n){let o=new Date;return o.setHours(0),o.setMinutes(0),o.setSeconds(0),`${Oe(t.format(s>o?0:-1,"day"))} @ ${_e(s)}`}return Intl.DateTimeFormat(void 0,{month:"short",year:"numeric",day:"numeric",hour:"numeric",hour12:!0,minute:"numeric"}).format(s)}function ee(i){let e=G(i),t=e.getHours(),n=t>=12?"pm":"am";t%=12,t=t||12;let s=`${e.getMinutes()}`.padStart(2,"0"),l=e.getMonth()+1,o=`${e.getDate()}`.padStart(2,"0"),r=e.getFullYear();return`${t}:${s}${n}, ${l}/${o}/${r}`}function w(i,e=1e3){return new Promise(t=>{let n=new Set,s=Array.from(i).filter(o=>!o.complete);if(!s.length){t();return}function l(){n.delete(this.src),n.size===0&&t()}s.forEach(o=>{n.has(o.src)||(n.add(o.src),o.addEventListener("error",l),o.addEventListener("load",l))}),e&&setTimeout(t,e)})}function I(){let i=document.querySelectorAll(".autodate"),e=Array.from(document.querySelectorAll("[data-timestamp]"));i&&(i.forEach(t=>{let n=Number.parseInt(t.getAttribute("title")??"",10),s=t.classList.contains("smalldate")?ee(n):J(n);s!==t.innerHTML&&(t.innerHTML=s)}),e.forEach(t=>{t.title||(t.title=ee(Number.parseInt(t.dataset.timestamp??"",10)))}))}function te(i){document.readyState==="complete"?i():document.addEventListener("DOMContentLoaded",i)}function $e(){let i=document.createElement("input");return i.setAttribute("type","date"),i.type==="date"}function He(){let i=[String.fromCodePoint(9757,127999),String.fromCodePoint(9757)].map(e=>{let t=document.body.appendChild(document.createElement("span"));t.appendChild(document.createTextNode(e));let n=t.offsetWidth;return t.remove(),n});return i[0]===i[1]}var D=class extends u{picker;selectedDate;lastDate;static hydrate(e){$e()||p("DatePicker",e.querySelectorAll("input[type=date]"),this)}constructor(e){super(e),this.picker=this.getPicker(),e.autocomplete="off",e.addEventListener("focus",()=>this.openPicker()),e.addEventListener("keydown",()=>this.closePicker())}getPicker(){if(this.picker)return this.picker;let e=document.querySelector("#datepicker");return e||(e=Object.assign(document.createElement("table"),{id:"datepicker"}),document.body.appendChild(e),e.style.display="none"),e}openPicker(){let e=b(this.element);Object.assign(this.picker.style,{display:"",zIndex:L(),position:"absolute",top:`${e.yh}px`,left:`${e.x}px`});let[t,n,s]=this.element.value.split("/").map(l=>Number.parseInt(l,10));t&&n&&s?this.selectedDate=[s,t-1,n]:this.selectedDate=void 0,this.generate(s,t,n)}closePicker(){this.picker.style.display="none"}generate(e,t,n){let s=new Date,l=this.getPicker(),o,r,[a,d,c]=[e,t,n];a===void 0&&(a=s.getFullYear(),d=s.getMonth(),c=s.getDate(),this.selectedDate=[a,d,c]),d===-1&&(a-=1,d=11),d===12&&(a+=1,d=0),this.lastDate=[a,d,c];let h=new Date(a,d+1,0).getDate(),f=new Date(a,d,1).getDay();l.innerHTML="",o=l.insertRow(0),r=o.insertCell(0),r.innerHTML="&lt;",r.className="control",r.onclick=()=>this.lastYear(),r=o.insertCell(1),r.colSpan=5,r.className="year",r.innerHTML=`${a}`,r=o.insertCell(2),r.innerHTML=">",r.className="control",r.onclick=()=>this.nextYear(),o=l.insertRow(1),r=o.insertCell(0),r.innerHTML="<",r.className="control",r.onclick=()=>this.lastMonth(),r=o.insertCell(1),r.colSpan=5,r.innerHTML=we[d],r.className="month",r=o.insertCell(2),r.innerHTML=">",r.className="control",r.onclick=()=>this.nextMonth(),o=l.insertRow(2),o.className="weekdays";for(let m=0;m<7;m+=1)o.insertCell(m).innerHTML=Me[m];o=l.insertRow(3);for(let m=0;m<h;m+=1){if(!m)for(let C=0;C<f;C+=1)o.insertCell(C);(f+m)%7===0&&(o=l.insertRow(l.rows.length)),r=o.insertCell((f+m)%7),r.onclick=this.insert.bind(this,r);let H=!!this.selectedDate&&a===this.selectedDate[0]&&d===this.selectedDate[1]&&m+1===this.selectedDate[2];r.className=`day${H?" selected":""}`,r.innerHTML=`${m+1}`}}lastYear(){let e=this.lastDate;e&&this.generate(e[0]-1,e[1],e[2])}nextYear(){let e=this.lastDate;e&&this.generate(e[0]+1,e[1],e[2])}lastMonth(){let e=this.lastDate;e&&this.generate(e[0],e[1]-1,e[2])}nextMonth(){let e=this.lastDate;e&&this.generate(e[0],e[1]+1,e[2])}insert(e){let t=this.lastDate;t&&(this.element.value=`${t[1]+1}/${e.innerHTML}/${t[0]}`),this.closePicker()}};var ne=class{rgb;constructor(e){let t=e;if(typeof t=="object"){this.rgb=t;return}if(typeof t=="string"){let n=t.match(/^rgb\((\d+),\s?(\d+),\s?(\d+)\)/i),s=t.match(/#?[^\da-fA-F]/);if(n){n.shift(),this.rgb=[Number.parseFloat(n[1]),Number.parseFloat(n[2]),Number.parseFloat(n[3])];return}if(s){if(t.charAt(0)==="#"&&(t=t.slice(1)),t.length===3&&(t=t.charAt(0)+t.charAt(0)+t.charAt(1)+t.charAt(1)+t.charAt(2)+t.charAt(2)),t.length!==6){this.rgb=[0,0,0];return}this.rgb=[];for(let l=0;l<3;l+=1)this.rgb[l]=Number.parseInt(t.slice(l*2,(l+1)*2),16)}}this.rgb=[0,0,0]}invert(){return this.rgb=[255-this.rgb[0],255-this.rgb[1],255-this.rgb[2]],this}toRGB(){return this.rgb}toHex(){return this.rgb.map(e=>e.toString(16).padStart(2,"0")).join("")}},$=ne;var Fe=["SCRIPT","STYLE","HR"],Ue=/text-align: ?(right|center|left)/i,Be=/background(-color)?:[^;]+(rgb\([^)]+\)|#\s+)/i,Ye=/font-style: ?italic/i,Xe=/text-decoration:[^;]*underline/i,Ze=/text-decoration:[^;]*line-through/i,Ge=/font-size: ?([^;]+)/i,Je=/color: ?([^;]+)/i,Ve=/font-weight: ?bold/i;function se(i){let e=i,t=/<(\w+)([^>]*)>([^]*?)<\/\1>/gi;return e=e.replaceAll(/[\r\n]+/g,""),e=e.replaceAll(/<(hr|br|meta)[^>]*>/gi,`
`),e=e.replaceAll(/<img.*?src=["']?([^'"]+)["'](?: alt=["']?([^"']+)["'])?[^>]*\/?>/g,(n,s,l)=>l||`[img]${s}[/img]`),e=e.replaceAll(t,(n,s,l,o)=>{let r=t.test(o)?se(o):o,a={};l.replaceAll(/(color|size|style|href|src)=(['"]?)(.*?)\2/gi,(lt,We,at,Pe)=>(a[We]=Pe,""));let{style:d=""}=a,c=s.toLowerCase();if(Fe.includes(c))return"";let h=Ue.exec(d),f=Be.exec(d),m=Ye.exec(d),H=Xe.exec(d),C=Ze.exec(d),ge=Ge.exec(d),be=Je.exec(d),ze=Ve.exec(d);return f&&(r=`[bgcolor=#${new $(f[2]).toHex()}]${r}[/bgcolor]`),h&&(r=`[align=${h[1]}]${r}[/align]`),(m||c==="i"||c==="em")&&(r=`[i]${r}[/i]`),(H||c==="u")&&(r=`[u]${r}[/u]`),(C||c==="s"||c==="strike")&&(r=`[s]${r}[/s]`),(ze||c==="strong"||c==="b")&&(r=`[b]${r}[/b]`),(a.size||ge)&&(r=`[size=${a.size||ge?.[1]}]${r}[/size]`),(a.color||be)&&(r=`[color=${a.color||be?.[1]}]${r}[/color]`),c==="a"&&a.href&&(r=`[url=${a.href}]${r}[/url]`),c==="ol"&&(r=`[ol]${r}[/ol]`),c==="ul"&&(r=`[ul]${r}[/ul]`),/h\d/i.test(c)&&(r=`[${c}]${r}[/${c}]`),c==="li"&&(r=`*${r.replace(/[\n\r]+/,"")}
`),c==="p"&&(r=`
${r==="&nbsp"?"":r}
`),c==="div"&&(r=`
${r}`),r}),e.replaceAll("&amp;","&").replaceAll("&gt;",">").replaceAll("&lt;","<").replaceAll("&nbsp;"," ")}function ie(i){let e=i.replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll(/(\s) /g,"$1&nbsp;");return e=e.replaceAll(/\[b\]([^]*?)\[\/b\]/gi,"<b>$1</b>"),e=e.replaceAll(/\[i\]([^]*?)\[\/i\]/gi,"<i>$1</i>"),e=e.replaceAll(/\[u\]([^]*?)\[\/u\]/gi,"<u>$1</u>"),e=e.replaceAll(/\[s\]([^]*?)\[\/s\]/gi,"<s>$1</s>"),e=e.replaceAll(/\[img\]([^'"[]+)\[\/img\]/gi,'<img src="$1">'),e=e.replaceAll(/\[color=([^\]]+)\](.*?)\[\/color\]/gi,'<span style="color:$1">$2</span>'),e=e.replaceAll(/\[size=([^\]]+)\](.*?)\[\/size\]/gi,'<span style="font-size:$1">$2</span>'),e=e.replaceAll(/\[url=([^\]]+)\](.*?)\[\/url\]/gi,'<a href="$1">$2</a>'),e=e.replaceAll(/\[bgcolor=([^\]]+)\](.*?)\[\/bgcolor\]/gi,'<span style="backgroun-color:$1">$2</span>'),e=e.replaceAll(/\[h(\d)\](.*?)\[\/h\1\]/g,"<h$1>$2</h$1>"),e=e.replaceAll(/\[align=(left|right|center)\](.*?)\[\/align\]/g,'<div style="text-align:$1">$2</div>'),e=e.replaceAll(/\[(ul|ol)\]([^]*?)\[\/\1\]/gi,(t,n,s)=>{let o=s.split(/(^|[\r\n]+)\*/).filter(r=>r.trim()).map(r=>`<li>${r}</li>`).join("");return`<${n}>${o}</${n}>`}),e=e.replaceAll(`
`,"<br />"),e}var{userAgent:T}=navigator,N={chrome:/chrome/i.test(T),ie:/msie/i.test(T),iphone:/iphone/i.test(T),mobile:/mobile/i.test(T),n3ds:/nintendo 3ds/.test(T),firefox:/firefox/i.test(T),safari:/safari/i.test(T)};function Ce(i){if(!globalThis.getSelection)return;let e=document.createRange();e.selectNode(i);let t=globalThis.getSelection();t&&(t.rangeCount&&t.removeAllRanges(),t.addRange(e))}function Se(i,e){let t=i.scrollTop,n=i.selectionStart??0,s=i.selectionEnd??0;i.value=i.value.substring(0,n)+e+i.value.slice(s),i.selectionStart=n+e.length,i.selectionEnd=n+e.length,i.focus(),i.scrollTop=t}var Qe=/^(ht|f)tps?:\/\/[\w.\-%&?=/]+$/,Ke=i=>Qe.test(i),q=class i extends u{iframe;colorWindow;container;htmlMode=!1;editbar;emoteWindow;static hydrate(e){p("Editor",e.querySelectorAll("textarea.bbcode-editor"),this)}constructor(e){super(e),this.container=document.createElement("div"),this.iframe=document.createElement("iframe"),this.iframe.style.display="none",this.iframe.addEventListener("load",()=>this.iframeLoaded(),{once:!0}),this.container.addEventListener("click",t=>{t.target instanceof HTMLElement&&t.target.matches(".editbar a")&&this.editbarCommand(t,t.target.className)}),S(this.container,e),this.container.appendChild(e),this.container.appendChild(this.iframe)}get doc(){return this.window?.document}get window(){return this.iframe.contentWindow}iframeLoaded(){let{iframe:e,element:t}=this;if(e.className="editorframe",this.htmlMode=N.mobile||N.n3ds?!1:globalSettings.wysiwyg,this.doc?.addEventListener("input",()=>{this.element.value=se(this.getSource()||"")}),!this.doc)return;let n=y(t),s=this.doc.getElementsByTagName("body")[0];s&&n&&(s.style.backgroundColor=n.backgroundColor,s.style.color=n.color,s.style.borderColor="#FFF"),this.doc.designMode="on",this.editbar=i.buildEditBar(),e.style.height=`${t.clientHeight}px`,S(this.editbar,t),this.setSource("<div></div>"),setTimeout(()=>{this.setSource(ie(t.value)),this.switchMode(this.htmlMode)},100)}static buildEditBar(){let e=document.createElement("div");return e.className="editbar",e.innerHTML=['<a class="bold" title="Bold"></a>','<a class="italic" title="Italic"></a>','<a class="underline" title="Underline"></a>','<a class="strikethrough" title="Strike-Through"></a>','<a class="forecolor" title="Foreground Color"></a>','<a class="backcolor" title="Background Color"></a>','<a class="insertimage" title="Insert Image"></a>','<a class="createlink" title="Insert Link"></a>','<a class="c_email" title="Insert Email"></a>','<a class="justifyleft" title="Align Left"></a>','<a class="justifycenter" title="Center"></a>','<a class="justifyright" title="Align Right"></a>','<a class="c_youtube" title="Insert video from any of your favorite video services!"></a>','<a class="c_code" title="Insert code"></a>','<a class="c_quote" title="Insert Quote"></a>','<a class="c_spoiler" title="Insert Spoiler"></a>','<a class="insertorderedlist" title="Create Ordered List"></a>','<a class="insertunorderedlist" title="Create Unordered List"></a>','<a class="c_smileys" title="Insert Emoticon"></a>','<a class="c_switcheditmode" title="Switch editor mode"></a>'].join(""),e}editbarCommand(e,t){switch(e.preventDefault(),t){case"forecolor":case"backcolor":this.showColors(e.pageX,e.pageY,t);break;case"c_smileys":this.showEmotes(e.pageX,e.pageY);break;case"c_switcheditmode":this.switchMode(!this.htmlMode);break;default:this.cmd(t);break}}async showEmotes(e,t){let n=this.emoteWindow;if(!n){let s=await fetch("/api/?act=emotes");s.ok&&this.createEmoteWindow(await s.json(),{x:e,y:t});return}n.style.display==="none"?(n.style.display="",n.style.left=`${e}px`,n.style.top=`${t}px`):this.hideEmotes()}hideEmotes(){this.emoteWindow&&(this.emoteWindow.style.display="none")}createEmoteWindow([e,t],n){let s=document.createElement("div");s.className="emotewin",e.forEach((l,o)=>{let r=t[o],a=document.createElement("a");a.href="javascript:void(0)",a.onclick=()=>{this.cmd("inserthtml",r),this.hideEmotes()},a.innerHTML=`${r} ${l}`,s.appendChild(a)}),s.style.position="absolute",s.style.display="none",this.emoteWindow=s,document.querySelector("#page")?.appendChild(s),this.showEmotes(n.x,n.y)}colorHandler(e,t){this.cmd(e,t),this.hideColors()}showColors(e,t,n){this.hideColors();let s=["#FFFFFF","#AAAAAA","#000000","#FF0000","#00FF00","#0000FF","#FFFF00","#00FFFF","#FF00FF"],l=s.length,o=Math.ceil(Math.sqrt(l)),r=document.createElement("table");Object.assign(r.style,{borderCollapse:"collapse",position:"absolute",top:`${t}px`,left:`${e}px`});for(let a=0;a<o;a+=1){let d=r.insertRow(a);for(let c=0;c<o;c+=1){let h=d.insertCell(c),f=s[c+a*o];if(!f)continue;h.style.border="1px solid #000",h.style.padding="0px";let m=document.createElement("a");m.href="javascript:void(0)",m.onclick=()=>this.colorHandler(n,f),h.appendChild(m),Object.assign(m.style,{display:"block",backgroundColor:f,height:"20px",width:"20px",margin:0})}}return this.colorWindow=r,document.querySelector("#page")?.appendChild(r),null}hideColors(){this.colorWindow&&(this.colorWindow.remove(),this.colorWindow=void 0)}cmd(e,t){let n=this.getSelection(),s="",l=e,o=t;switch(e.toLowerCase()){case"bold":s=`[b]${n}[/b]`;break;case"italic":s=`[i]${n}[/i]`;break;case"underline":s=`[u]${n}[/u]`;break;case"strikethrough":s=`[s]${n}[/s]`;break;case"justifyright":s=`[align=right]${n}[/align]`;break;case"justifycenter":s=`[align=center]${n}[/align]`;break;case"justifyleft":s=`[align=left]${n}[/align]`;break;case"insertimage":if(o=prompt("Image URL:")||"",!o)return;if(!Ke(o)){alert("Please enter a valid URL.");return}s=`[img]${o}[/img]`;break;case"insertorderedlist":this.htmlMode||(s=`[ol]${n.replaceAll(/(.+([\r\n]+|$))/i,"*$1")}[/ol]`);break;case"insertunorderedlist":this.htmlMode||(s=`[ul]${n.replaceAll(/(.+([\r\n]+|$))/i,"*$1")}[/ul]`);break;case"createlink":if(o=prompt("Link:")||"",!o)return;/^(https?|ftp|mailto):/.test(o)||(o=`https://${o}`),s=`[url=${o}]${n}[/url]`;break;case"c_email":if(o=prompt("Email:")||"",!o)return;l="createlink",o=`mailto:${o}`,s=`[url=${o}]${n}[/url]`;break;case"backcolor":(N.firefox||N.safari)&&(l="hilitecolor"),s=`[bgcolor=${o}]${n}[/bgcolor]`;break;case"forecolor":s=`[color=${o}]${n}[/color]`;break;case"c_code":l="inserthtml",o=`[code]${n}[/code]`,s=o;break;case"c_quote":l="inserthtml",o=prompt("Who said this?")||"",o=o?`=${o}`:"",o=`[quote${o}]${n}[/quote]`,s=o;break;case"c_spoiler":l="inserthtml",o=`[spoiler]${n}[/spoiler]`,s=o;break;case"c_youtube":if(l="inserthtml",o=prompt("Video URL?")||"",!o)return;o=`[video]${o}[/video]`,s=o;break;case"inserthtml":s=o||"";break;default:throw new Error(`Unsupported editor command ${e}`)}this.htmlMode?(this.doc?.execCommand(l,!1,o),this.window?.focus()):Se(this.element,s)}getSelection(){return this.htmlMode?this.window?.getSelection()?.toString()||"":this.element.value.substring(this.element.selectionStart,this.element.selectionEnd)}getSource(){return this.doc?.body.innerHTML}setSource(e){this.doc&&(this.doc.body.innerHTML=e)}switchMode(e){let{element:t,iframe:n}=this;e?(this.setSource(ie(t.value)),t.style.display="none",n.style.display=""):(t.style.display="",n.style.display="none"),this.htmlMode=e}};var R=class extends u{resetOnSubmit;static hydrate(e){p("Form",e.querySelectorAll("form[data-ajax-form]"),this)}constructor(e){super(e),this.resetOnSubmit=e.dataset.ajaxForm==="resetOnSubmit",e.addEventListener("submit",t=>{t.preventDefault(),this.submitForm()})}submitForm(){let{element:e,resetOnSubmit:t}=this,n=[],s=[],{submitButton:l}=e;["input","select","button","textarea"].flatMap(r=>Array.from(e.querySelectorAll(r))).forEach(r=>{if(!(!r.name||r.type==="submit")){if(r instanceof HTMLSelectElement&&r.type==="select-multiple"){Array.from(r.options).filter(a=>a.selected).forEach(a=>{n.push(`${r.name}[]`),s.push(a.value)});return}r instanceof HTMLInputElement&&["checkbox","radio"].includes(r.type)&&!r.checked||(n.push(r.name),s.push(r.value))}}),l&&(n.push(l.name),s.push(l.value)),RUN.stream.load(e.action||globalThis.location,{data:[n,s]}),t&&e.reset(),RUN.stream.pollData()}};function oe(i){let e=G(i);return String.fromCodePoint(55357,56656+((e.getHours()%12||12)-1)+(e.getMinutes()>29?12:0))}function re(i){let e=Array.from(i.classList).find(t=>t.startsWith("lastAction"));e!==void 0&&(i.prepend(oe(Number.parseInt(e.slice(10),10))),i.classList.remove(e))}var z=class extends u{static hydrate(e){e.querySelectorAll(".idle").forEach(t=>re(t))}};var W=class extends u{index;images;max;static hydrate(e){p("ImageGallery",e.querySelectorAll(".image_gallery"),this)}constructor(e){super(e);let t=document.createElement("div"),n=document.createElement("button"),s=document.createElement("button");this.index=0,this.images=e.querySelectorAll("img"),this.max=Math.max(this.images.length,1),n.innerHTML="Next &raquo;",n.addEventListener("click",()=>{this.showNext()}),s.innerHTML="Prev &laquo;",s.addEventListener("click",()=>{this.showPrev()}),this.update(),t.appendChild(s),t.appendChild(document.createTextNode(" ")),t.appendChild(n),e.appendChild(t)}showNext(){this.index<this.max-1&&(this.index+=1),this.update()}showPrev(){this.index>0&&(this.index-=1),this.update()}update(){this.images.forEach((e,t)=>{let n=e.dataset.madeResized?e.parentNode:e;n&&(n.style.display=t!==this.index?"none":"block")})}};function et(i){let e=document.body,t=document.documentElement;switch(i.keyCode){case 13:i.ENTER=!0;break;case 37:i.LEFT=!0;break;case 38:i.UP=!0;break;case .39:i.RIGHT=!0;break;case 40:i.DOWN=!0;break;default:break}return typeof i.srcElement>"u"&&(i.srcElement=i.target),typeof i.pageY>"u"&&(i.pageY=i.clientY+(Number.parseInt(t.scrollTop||e.scrollTop,10)||0),i.pageX=i.clientX+(Number.parseInt(t.scrollLeft||e.scrollLeft,10)||0)),i.cancel=()=>(i.returnValue=!1,i.preventDefault&&i.preventDefault(),i),i.stopBubbling=()=>(i.stopPropagation&&i.stopPropagation(),i.cancelBubble=!0,i),i}var Ae=et;var ke="999999px",P=class extends u{static hydrate(e){let t=e.querySelectorAll(".bbcodeimg");w(Array.from(t)).then(()=>p("ImageResizer",t,this))}constructor(e){super(e);let t=1,n=1,{naturalWidth:s,naturalHeight:l}=e,o=s,r=l,a=y(e),d=Number.parseInt(a.width,10)||Number.parseInt(a.maxWidth,10),c=Number.parseInt(a.height,10)||Number.parseInt(a.maxHeight,10);d&&o>d&&(t=d/o),c&&r>c&&(n=c/r),t=t&&n?Math.min(t,n):n||t,t<1&&(o*=t,r*=t,this.makeResizer(o,r))}makeResizer(e,t){let{element:n}=this;n.style.maxWidth=ke,n.style.maxHeight=ke,n.dataset.madeResized="true";let s=document.createElement("a");s.target="_BLANK",s.href=n.src,s.style.display="block",s.style.overflow="hidden",s.style.width=`${e}px`,s.style.height=`${t}px`,s.dataset.nw=`${n.naturalWidth}`,s.dataset.nh=`${n.naturalHeight}`,s.onmousemove=o=>{let r=b(s),a=Ae(o);s.scrollLeft=(a.pageX-r.x)/r.w*(+(s.dataset.nw||0)-r.w)||0,s.scrollTop=(a.pageY-r.y)/r.h*(+(s.dataset.nh||0)-r.h)||0},s.onmouseover=()=>{n.style.width=`${s.dataset.nw}px`,n.style.height=`${s.dataset.nh}px`};let l=()=>{s.scrollLeft&&(s.scrollLeft=0,s.scrollTop=0),n.style.width=`${e}px`,n.style.height=`${t}px`};s.onmouseout=l,l(),S(s,n),s.appendChild(n)}};function j(i){let e=document.querySelector("#tooltip_thingy"),t=b(i),n=i.getAttribute("title");if(i.dataset.lastOnline){let s=Number.parseInt(i.dataset.lastOnline??"",10);n=`Last Online: ${J(s)} ${oe(s)}`}if(n){if(i.title="",!e){e=document.createElement("table");let s=e.insertRow(0),l=e.insertRow(1),o=e.insertRow(2),r;e.id="tooltip_thingy",e.className="tooltip",s.className="top",l.className="content",o.className="bottom",r=s.insertCell(0),r.className="left",r.colSpan=2,r=s.insertCell(1),r.className="right",r=l.insertCell(0),r.className="left",r=l.insertCell(1),r.innerHTML="default text",r=l.insertCell(2),r.className="right",r=o.insertCell(0),r.className="left",r.colSpan=2,r=o.insertCell(1),r.className="right",document.querySelector("#page")?.appendChild(e)}e.rows[1].cells[1].innerText=n,e.style.display="",e.style.top=`${t.y-e.clientHeight}px`,e.style.left=`${t.x}px`,e.style.zIndex=`${L()}`,i.onmouseout=()=>{i.title=n,e.style.display="none"}}}var _=class extends u{static hydrate(e){p("Link",e.querySelectorAll("a"),this)}constructor(e){if(super(e),e.dataset.useTooltip&&e.addEventListener("mouseover",()=>j(e)),!e.href)return;let t=e.getAttribute("href"),n=!e.target&&t&&(t.startsWith("/")||t.startsWith("?"));if(!t?.startsWith("javascript")){if(n){let l=e.onclick;e.onclick=null,e.addEventListener("click",o=>{o.preventDefault(),(!l||l.call(e,o)!==!1)&&RUN.stream.location(t)});return}e.target="_BLANK"}}};var le=class{el;delay;steps;interval;curLineup;stepCount;loop;lineup;constructor(e,t=30,n=20,s=0){this.el=e,this.steps=t,this.delay=n,this.curLineup=0,this.stepCount=0,this.loop=s,this.lineup=[[]]}play(){return this.interval=setInterval(()=>this.step(),this.delay),this}morph(e,t,n){return Array.isArray(e)&&e.length===n.length?e.map((s,l)=>Math.round(this.morph(s,t,n[l]))):(n-e)*t+e}step(){let e=this.lineup[this.curLineup];this.stepCount+=1;let t=this.stepCount;typeof e[0]=="function"?(e[0](this.el),t=this.steps):e.forEach(n=>{let s=this.morph(n[1],t/this.steps,n[2]);n[0].match(/color/i)?s=`#${new $(s).toHex()}`:n[0]!=="opacity"&&(s=Math.round(s)),this.el.style[n[0]]=n[3]+s+n[4]}),t===this.steps&&(this.lineup.length-1>this.curLineup?(this.stepCount=0,this.curLineup+=1):this.loop===1?(this.stepCount=0,this.curLineup=0):clearInterval(this.interval))}add(e,t,n){let s=["","",""],l;return e.match(/color/i)?(l=new $(t).toRGB(),s[1]=new $(n).toRGB()):(s=n.match(/(\D*)(-?\d+)(\D*)/),s.shift(),l=Number.parseFloat(t.match(/-?\d+/)?.[0]??"")),this.lineup[this.lineup.length-1].push([e,l,s[1],s[0],s[2]]),this}dehighlight(){this.el.style.backgroundColor="";let e=y(this.el).backgroundColor;this.el.classList.add("highlight");let t=y(this.el).backgroundColor;return t===e&&(t="FF0"),this.el.classList.add("highlight"),!t||!e?this:this.add("backgroundColor",t,e).andThen(()=>{this.el.style.backgroundColor=e})}andThen(e,t=void 0,n=void 0,s=void 0){return this.lineup.push([]),s&&(this.steps=s),typeof e=="function"?this.lineup[this.lineup.length-1].push(e):t!==void 0&&n!==void 0&&this.add(e,t,n),this}},v=le;var ae=class{sess;boundEvents;droppables;noChild=!1;bounds;onstart;ondragover;ondrag;ondragout;ondrop;autoZIndex=!0;constructor(){this.droppables=[],this.sess={el:document.body,mx:0,my:0},this.boundEvents={drag:e=>this.drag(e),drop:()=>this.drop()}}start(e,t,n){e.preventDefault(),e.stopPropagation();let s=t||e.target,l=y(s),o=L();this.noChild&&e.target!==(n||s)||s.getAttribute("draggable")!=="false"&&(this.sess={el:s,mx:e.pageX,my:e.pageY,ex:Number.parseInt(l.left,10)||0,ey:Number.parseInt(l.top,10)||0,info:{el:s,mx:0,my:0},zIndex:s.style.zIndex},(!this.sess.zIndex||Number(this.sess.zIndex)<o-1)&&(s.style.zIndex=`${o}`),this.onstart?.({...this.sess,droptarget:this.testDrops(this.sess.mx,this.sess.my)}),document.addEventListener("mousemove",this.boundEvents.drag),document.addEventListener("mouseup",this.boundEvents.drop),this.drag(e))}drag(e){e.stopPropagation();let t=this.sess.el.style,n=e.pageX,s=e.pageY,l=n,o=s,r,a=(this.sess.ex??0)+l-this.sess.mx,d=(this.sess.ey??0)+o-this.sess.my,c=this.bounds;c&&(a<c[0]?(l=l-a+c[0],[a]=c):a>c[0]+c[2]&&(a=c[0]+c[2]),d<c[1]?(o=o-d+c[1],[d]=c):d>c[1]+c[3]&&(d=c[1]+c[3])),t.left=`${a}px`,t.top=`${d}px`;let h=this.sess.info,f=h?.droptarget,m={left:a,top:d,el:this.sess.el,mx:l,my:o,dx:l-(h?.mx||l),dy:o-(h?.my||o),droptarget:this.testDrops(n,s)};this.sess.info=m,this.ondrag?.(m),m.droptarget&&f!==m.droptarget&&this.ondragover?.(m),f&&m.droptarget!==f&&(r=m.droptarget,m.droptarget=f,this.ondragout?.(m),m.droptarget=r)}boundingBox(e,t,n,s){return this.bounds=[e,t,n,s],this}drop(){return this.boundEvents&&(document.removeEventListener("mouseup",this.boundEvents.drop),document.removeEventListener("mousemove",this.boundEvents.drag)),this.ondrop?.(this.sess.info),this.autoZIndex&&(this.sess.el.style.zIndex=this.sess.zIndex??""),!0}testDrops(e,t){let{droppables:n}=this,s,l=[9999,9999];if(n.length)return n.findLast(o=>{if(!(o===this.sess.el||ve(o,this.sess.el))&&(s=b(o),l[0]>s.w&&l[1]>s.h&&e>=s.x&&t>=s.y&&e<=s.xw&&t<=s.yh))return l=[s.w,s.h],o})}drops(e){return this.droppables=e,this}addDrops(e){return this.droppables?(this.droppables=this.droppables.concat(e),this):this.drops(e)}addListener(e){return Object.assign(this,e),this}apply(e,t){if(Array.isArray(e))return e.forEach(l=>this.apply(l)),this;let s=y(e)?.position;return(!s||s==="static")&&(e.style.position="relative"),(t||e).onmousedown=t?l=>this.start(l,e,t):l=>this.start(l,e),this}autoZ(){return this.autoZIndex=!1,this}noChildActivation(){return this.noChild=!0,this}reset(e=this.sess.el){return e.style.top="0",e.style.left="0",this}},ce=ae;var de=class{title;wait;content;open;minimizable;resize;className;pos;zIndex;windowContainer;id;onclose;animate;oldpos;constructor(e={}){this.title="Title",this.wait=!0,this.title="Title",this.wait=!0,this.content="Content",this.open=!1,this.minimizable=!0,this.resize=void 0,this.className="",this.pos="center",this.zIndex=L(),this.animate=!1,Object.assign(this,e)}static close=function(t){let n=t;do{if("close"in n&&typeof n.close=="function"){n.close();break}n=n.parentElement}while(n)};create(){if(this.windowContainer)return this.windowContainer;let e=document.createElement("div"),t=document.createElement("div"),n=document.createElement("div"),s=document.createElement("div"),l=document.createElement("div"),o=document.createElement("div"),{pos:r}=this;this.windowContainer=e,this.id&&(e.id=this.id),e.className=`window${this.className?` ${this.className}`:""}`,t.className="title",n.className="content",this.minimizable&&(l.innerHTML="-",l.onclick=()=>this.minimize()),o.innerHTML="X",o.onclick=()=>this.close(),s.appendChild(l),s.appendChild(o),s.className="controls",t.innerHTML=this.title,n.innerHTML=this.content,t.appendChild(s),e.appendChild(t),e.appendChild(n);let a=()=>this.close();if(e.querySelectorAll("[data-window-close]").forEach(c=>{c.addEventListener("click",a)}),document.body.appendChild(e),this.resize){let c=e.querySelector(this.resize);if(!c)throw new Error("Resize target not found");c.style.width=`${c.clientWidth}px`,c.style.height=`${c.clientHeight}px`;let h=document.createElement("div");h.className="resize",e.appendChild(h),h.style.left=`${e.clientWidth-16}px`,h.style.top=`${e.clientHeight-16}px`,new ce().boundingBox(100,100,1/0,1/0).addListener({ondrag(f){let m=Number.parseFloat(c.style.width)+(f.dx??0),H=Number.parseFloat(c.style.height)+(f.dy??0);c.style.width=`${m}px`,m<e.clientWidth-20?c.style.width=`${e.clientWidth}px`:h.style.left=`${e.clientWidth-16}px`,c.style.height=`${H}px`},ondrop(){h.style.left=`${e.clientWidth-16}px`}}).apply(h),c.style.width=`${e.clientWidth}px`,h.style.left=`${e.clientWidth-16}px`}let d=e.style;return d.zIndex=`${this.zIndex+5}`,this.wait?w(Array.from(e.querySelectorAll("img"))).then(()=>{this.setPosition(r)}):this.setPosition(r),new ce().autoZ().noChildActivation().boundingBox(0,0,document.documentElement.clientWidth-50,document.documentElement.clientHeight-50).apply(e,t),Object.assign(e,{close:()=>this.close(),minimize:this.minimize})}close(){this.windowContainer&&(document.body.removeChild(this.windowContainer),this.windowContainer=void 0,this.onclose&&this.onclose())}minimize(){let e=this.windowContainer;if(!e)return;let t=e.classList.contains("minimized");if(e.classList.toggle("minimized"),t)e.removeAttribute("draggable"),this.setPosition(this.oldpos??"");else{e.setAttribute("draggable","false");let s=Array.from(document.querySelectorAll(".window")).reduce((l,o)=>o.classList.contains("minimized")?l+Number(o.clientWidth):l,0);this.oldpos=this.getPosition(),this.setPosition(`bl ${s} 0`,!1)}}setPosition(e,t=!1){let n=this.windowContainer;if(!n)return;let s=0,l=0,o=document.documentElement.clientHeight,r=document.documentElement.clientWidth,a=e.match(/(\d+) (\d+)/);switch(a&&(s=Number(a[1]),l=Number(a[2])),s=Math.floor(s),l=Math.floor(l),e.charAt(1)==="r"&&(s=r-s-n.clientWidth),e.charAt(0)){case"b":l=o-l-n.clientHeight;break;case"c":l=(o-n.clientHeight)/2,s=(r-n.clientWidth)/2;break;default:}s=Math.floor(s),l=Math.floor(l),s<0&&(s=0),l<0&&(l=0),n.style.left=`${s}px`,this.animate||t?new v(n,10).add("top",`${l-100}px`,`${l}px`).play():n.style.top=`${l}px`,this.pos=e}getPosition(){if(!this.windowContainer)return"";let e=this.windowContainer.style;return`tl ${Number.parseFloat(e.left)} ${Number.parseFloat(e.top)}`}},M=de;var O=class extends u{static hydrate(e){p("MediaPlayer",e.querySelectorAll(".media"),this)}constructor(e){super(e);let t=e.querySelector("a.popout"),n=e.querySelector("a.inline"),s=e.querySelector(".movie");s&&(t?.addEventListener("click",l=>{l.preventDefault(),new M({title:t.href,content:s.innerHTML}).create()}),n?.addEventListener("click",l=>{l.preventDefault(),s.style.display="block"}))}};var F=class extends u{static hydrate(e){p("PageList",e.querySelectorAll(".pages"),this)}constructor(e){super(e),e.addEventListener("wheel",t=>this.wheel(t))}wheel(e){e.preventDefault();let t=Math.sign(e.deltaY),n=Array.from(this.element.querySelectorAll("a")),s=Number.parseInt(n[1].innerHTML,10),l=Number.parseInt(n.at(-1)?.innerHTML||"",10),o=n.length-2;if(t>0&&s+o<l||t<0&&s>2)for(let r=0;r<o;r+=1)n[r+1].href=n[r+1].href.replace(/\d+$/,`${r+s+t}`),n[r+1].innerHTML=`${s+r+t}`}};var U=class extends u{static hydrate(e){p("Switch",e.querySelectorAll("input.switch"),this)}constructor(e){super(e),e.style.display="none";let t=Object.assign(document.createElement("button"),{type:"button",title:e.className,className:e.className}),n=()=>{t.style.backgroundPosition=e.checked?"top":"bottom"};n(),t.addEventListener("click",()=>{e.checked=!e.checked,n(),e.dispatchEvent(new Event("change"))}),xe(t,e)}};var me="active",B=class extends u{static hydrate(e){p("Tabs",e.querySelectorAll(".tabs"),this)}constructor(e){super(e),e.addEventListener("click",t=>this.click(t))}click(e){let{tabSelector:t}=this.element.dataset,{target:n}=e;if(!n||!(n instanceof HTMLElement)||n.tagName.toLowerCase()!=="a")return;let s=n;if(t){let o=n.closest(t);o&&(s=o)}let l=this.element.querySelector(`.${me}`);l&&l.classList.remove(me),s.className=me,s.blur()}};function g(i){I(),i.querySelectorAll(".bbcode.code").forEach(e=>{e.addEventListener("click",()=>Ce(e))}),[A,k,D,q,R,z,W,P,_,O,F,U,B].forEach(e=>{e.hydrate(i)})}function tt(i,e){if(Le(`New message from ${i}!`),!document.hasFocus()&&globalThis.Notification&&Notification.permission==="granted"){let t=new Notification(`${i} says:`,{body:e});t.onclick=()=>{globalThis.focus(),t.close()}}}function nt({fromId:i,fromName:e,message:t}){let n=document.querySelector(`#im_${i} .ims`);if(n)return n;let l=new M({title:`${e}`,content:`
            <div class='ims'></div>
            <div class='offline'>This user may be offline</div>
            <div>
                <form data-ajax-form='resetOnSubmit' method='post'>
                    <input type='hidden' name='im_uid' value='%s' />
                    <input type='text' name='im_im' autocomplete='off' />
                    <input type='hidden' name='act' value='blank' />
                </form>
            </div>
        `.replaceAll("%s",`${i}`),className:"im",resize:".ims",animate:!0,id:`im_${i}`}).create();g(l);let o=()=>{l.querySelector("form")?.im_im.focus()};l.onclick=o,o(),n=document.querySelector(`#im_${i} .ims`);let r=getComputedStyle(n);return n.style.width=r.width,n.style.height=r.height,t&&globalSettings.soundIM&&E.play("imnewwindow"),n}function ue(i,e){if(!globalSettings.canIM){alert("You do not have permission to use this feature.");return}RUN.stream.commands.im(i,e,"")}function Ie({fromId:i,fromName:e,message:t,fromMe:n,timestamp:s}){tt(e,t);let l=nt({fromId:i,fromName:e,message:t});if(!t)return;let o=document.createElement("div"),r=t.substring(0,3)==="/me";r&&(o.className="action",t=t.substring(3),e=`***${e}`),o.classList.add(n?"you":"them"),n||document.querySelector(`#im_${i}`)?.classList.remove("offline"),o.innerHTML=`<a href='/profile/${n||i}' class='name'>${e}</a> ${r?"":": "}${t}`,o.dataset.timestamp=`${s}`;let a=l.scrollTop>l.scrollHeight-l.clientHeight-50;l.appendChild(o),a&&(l.scrollTop=l.scrollHeight),g(o),globalSettings.soundIM&&E.play("imbeep")}var Y={loadscript(i){document.body.appendChild(Object.assign(document.createElement("script"),{src:i}))},script(i){(0,eval)(i)},error(i){alert(i)},alert(i){alert([i])},reload(i=0){setTimeout(()=>globalThis.location.reload(),i)},refreshdata(){RUN.stream.pollData(!0)},addclass(i,e){let t=document.querySelector(i);t&&t.classList.add(e)},title(i){document.title=i},update(i,e,t){let n=i,s=Array.from(document.querySelectorAll(".path"));if(n==="path"&&s.length>1){s.forEach(o=>{o.innerHTML=e,g(o)});return}/^\W/.test(n)||(n=`#${n}`);let l=document.querySelector(n);l&&(l.innerHTML=e,t&&new v(l).dehighlight().play(),g(l))},removeel(i){let e=document.querySelector(i);e&&e.parentNode?.removeChild(e)},back(){globalThis.history.back()},setstatus(i){let e=document.querySelector("#status");e&&(e.className=i)},appendrows(i,e){let t=document.querySelector(i);if(!t)return;let n=document.createElement("span");n.innerHTML=`<table>${e}</table>`;let s=n.getElementsByTagName("tbody")[0];g(s),t.appendChild(s)},location(i){if(["?","/"].includes(i.charAt(0))){RUN.stream.location(i);return}document.location=i},enable(i){let e=document.querySelector(`#${i}`);e&&(e.disabled=!1)},addshout(i){let e=Array.from(document.querySelectorAll("#shoutbox .shout")),t=document.createElement("span");t.innerHTML=i;let n=t.firstElementChild;if(n){for(e[0].parentNode?.insertBefore(n,e[0]);e.length>globalSettings.shoutLimit-1;)e.pop()?.remove();new v(n).dehighlight().play(),globalSettings.soundShout&&E.play("sbblip"),g(n)}},tick(i){let e=document.querySelector("#ticker");if(!e)return;let t=document.createElement("div");t.className="tick",t.innerHTML=i,t.style.display="none",t.style.overflow="hidden",e.insertBefore(t,e.firstChild);let n=y(t);t.style.height="0px",new v(t).add("height","0px",n.height).play();let s=Array.from(e.querySelectorAll(".tick")),l=s.length;if(t.style.display="block",l>100)for(let o=100;o<l;o+=100)t=s[o],t.dataset.removed||(t=s[o],new v(t,30,500).add("opacity","1","0").andThen(r=>{r.parentNode?.removeChild(r)}).play(),t.dataset.bonked="true")},im(i,e,t,n,s){Ie({fromId:i,fromName:e,message:t,fromMe:n,timestamp:s})},imtoggleoffline(i){document.querySelector(`#im_${i}`)?.classList.add("offline")},window(i){if(i.id&&document.getElementById(i.id))return;let t=new M;t.title=i.title,t.content=i.content,t.minimizable=i.minimizable||!1,t.animate=i.animate!==void 0?i.animate:!0,t.resize=i.resize||void 0,t.className=i.className||"",i.pos&&(t.pos=i.pos);let n=t.create();n.id=i.id||"",g(n)},closewindow(i){let e=document.querySelector(i);e&&M.close(e)},onlinelist(i){let e=document.querySelector("#statusers");e&&i.forEach(([t,n,s,l,o,r])=>{let a=document.querySelector(`#statusers .user${t}`);if(a||(a=document.createElement("a"),a.href=`/profile/${t}`,a.onclick=()=>{RUN.location(a.getAttribute("href"))}),a.innerHTML=l,a.className=`user${t} mgroup${n} ${s?` ${s}`:""} lastAction${r}`,o&&(a.title=o,a.onmouseover=()=>j(a,o)),s==="idle"){re(a);return}e.firstChild?e.insertBefore(a,e.firstChild):e.appendChild(a)})},setoffline(i){let e=document.querySelector("#statusers");i.split(",").forEach(n=>{let s=document.querySelector(`#statusers .user${n}`);s&&e&&e.removeChild(s)})},scrollToPost(i){let e=document.getElementById(`pid_${i}`);return e?(w(Array.from(document.querySelectorAll("#page img"))).then(()=>{let t=b(e);globalThis.scrollTo({top:t.y})}),!0):!1},updateqreply(i){let t=document.querySelector("#qreply")?.querySelector("textarea");t&&(t.focus(),t.value+=i)},newmessage(i,e){let t=document.querySelector("#notification"),n=document.querySelector("#num-messages");n&&(n.innerHTML=`${Number.parseInt(n.innerHTML,10)+1}`),t||(t=document.createElement("div"),t.id="notification",document.body.appendChild(t)),t.style.display="",t.className="newmessage",t.onclick=()=>{t.style.display="none",RUN.stream.location(`?act=ucp&what=inbox&view=${e}`,3)},t.innerHTML=i},playsound(i,e){E.loadAndPlay(i,e)},attachfiles(){document.querySelector("#attachfiles")?.addEventListener("click",()=>{alert("Attaching files is under construction")})},listrating(i,e){let t=document.querySelector(`#postrating_${i}`),n;if(t){if(t.style.display!=="none"){new v(t).add("height","200px","0px").andThen(()=>{t.style.display="none"}).play();return}t.style.display="block"}else t=document.createElement("div"),t.className="postrating_list",t.id=`postrating_${i}`,n=b(document.querySelector(`#pid_${i} .postrating`)),t.style.top=`${n.yh}px`,t.style.left=`${n.x}px`,document.querySelector("#page")?.appendChild(t);t.innerHTML=e,new v(t).add("height","0px","200px").play()}};function st(i){let e=i?i.split(","):[],t=e.length===1?"":"s",n=e.length?" and <br>":"";return[e,t,n]}function it(i){let e=i?i.split(","):[],n=(e?e.length:0)===1?"":"s";return[e,n]}var X=class{whichone=0;boundCheckLocation;pids=[];tids=[];modb;constructor(){this.boundCheckLocation=()=>this.checkLocation(),Object.assign(Y,{modcontrols_postsync:(e,t)=>{let[n,s,l]=st(e),[o,r]=it(t);if(this.tids=o,this.pids=n,!o.length&&!n.length){this.destroyModControls();return}let a=o.length?`
                    <select name='dot'>
                        <option value='delete'>Delete</option>
                        <option value='merge'>Merge</option>
                        <option value='move'>Move</option>
                        <option value='pin'>Pin</option>
                        <option value='unpin'>Unpin</option>
                        <option value='lock'>Lock</option>
                        <option value='unlock'>Unlock</option>
                    </select> &nbsp; &nbsp;
                    <strong>${o.length}</strong> topic${r}${l}`:"",d=n.length?`
                    <select name='dop'>
                        <option value='delete'>Delete</option>
                        <option value='move'>Move</option>
                    </select> &nbsp; &nbsp;
                    <strong>${n.length}</strong> post${s}`:"",c=n.length&&o.length?"<br>":" &nbsp; &nbsp; ",h=`
                <form method='post' data-ajax-form='true'>
                    <input type='hidden' name='act' value='modcontrols'>
                    ${a}
                    ${d}
                    ${c}
                    <input type='submit' value='Go'>
                    <input
                        name='cancel' type='submit'
                        onclick='this.form.submitButton=this;' value='Cancel'>
                </form>`;this.createModControls(h)},modcontrols_move:e=>{this.whichone=e,globalThis.addEventListener("pushstate",this.boundCheckLocation),this.createModControls(`Ok, now browse to the ${this.whichone?"topic":"forum"} you want to move the ${this.whichone?`${this.pids.length} posts`:`${this.tids.length} topics`} to...`)},modcontrols_clearbox:()=>{this.destroyModControls()}})}checkLocation(){let{whichone:e}=this,t=e?/topic\/(\d+)/:/forum\/(\d+)/,n=document.location.toString().match(t);n?this.moveto(Number(n[1])):Y.modcontrols_move()}moveto(e){let{whichone:t}=this;this.createModControls(`<form method="post" data-ajax-form="true">
                move ${t?"posts":"topics"} here?
            <input type="hidden" name="act" value="modcontrols">
            <input type="hidden"
                name="${t?"dop":"dot"}"
                value="moveto">
            <input type="hidden" name="id" value="${e}">
            <input type="submit" value="Yes">
            <input type="submit" name="cancel" value="Cancel" onclick="this.form.submitButton=this">
            </form>`)}createModControls(e){this.modb=this.modb||document.querySelector("#modbox")||void 0,this.modb||(this.modb=document.createElement("div"),this.modb.id="modbox",document.body.appendChild(this.modb)),this.modb.style.display="block",this.modb.innerHTML=e,g(this.modb)}destroyModControls(){globalThis.removeEventListener("pushstate",this.boundCheckLocation),this.modb&&(this.modb.innerHTML="",this.modb.style.display="none")}togbutton(e){e.classList.toggle("selected")}};function De(i,e){if(!i)return"";if(Array.isArray(i)){if(!e)throw new Error("Invalid arguments for buildQueryString. Received array and undefined");return i.map((t,n)=>`${encodeURIComponent(t)}=${encodeURIComponent(e[n]||"")}`).join("&")}return Object.keys(i).map(t=>`${encodeURIComponent(t)}=${encodeURIComponent(i[t]||"")}`).join("&")}var he=class{setup={readyState:4,method:"POST"};constructor(e={}){Object.assign(this.setup,e)}load(e,{callback:t,data:n,method:s="POST",requestType:l=1}={}){let o=null;n&&Array.isArray(n)?o=De(n[0],n[1]):n&&typeof n!="string"&&(o=De(n));let r=new XMLHttpRequest;return t&&(this.setup.callback=t),r.onreadystatechange=()=>{r.readyState===this.setup.readyState&&this.setup.callback?.(r)},r.open(s,e,!0),Object.assign(r,{url:e,requestType:l}),s&&r.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),r.setRequestHeader("X-JSACCESS",`${l}`),r.send(o),r}},Ne=he;var ot=5e3,pe=class{request;commands;lastURL;constructor(){this.request=new Ne({callback:e=>this.handleRequestData(e)}),this.lastURL=`${document.location.pathname}${document.location.search}`,this.commands=Y}handleRequestData(e){if(e.status!==200)return;let{responseText:t}=e,n=!1;typeof t!="string"&&(t="");let s=[];if(t.length){try{s=JSON.parse(t)}catch(l){console.error(l),s=[]}s.forEach(([l,...o])=>{l==="softurl"?n=!0:this.commands[l]&&this.commands[l](...o)})}e.requestType===2&&(n||(globalThis.history.pushState({lastURL:e.responseURL},"",e.responseURL),globalThis.dispatchEvent(new Event("pushstate")),this.lastURL=e.responseURL)),this.pollData()}location(e,t=2){return this.request.load(e,{requestType:t}),!1}load(...e){this.request.load(...e)}loader(){return this.request.load(this.lastURL),!0}pollData(e=!1){e&&this.loader(),clearTimeout(this.timeout),document.cookie.includes(`actw=${globalThis.name}`)&&(this.timeout=setTimeout(()=>this.loader(),ot))}updatePage(e){e!==this.lastURL&&this.location(e,3)}},qe=pe;var rt=2,fe=class{stream=new qe;onAppReady(){rt&&g(document.body),I(),setInterval(I,1e3*30),this.stream.pollData(),globalThis.addEventListener("popstate",({state:e})=>{if(e){let{lastURL:t}=e;this.stream.updatePage(t)}else this.stream.updatePage(document.location)}),E.load("sbblip","/Sounds/blip.mp3",!1),E.load("imbeep","/Sounds/receive.mp3",!1),E.load("imnewwindow","/Sounds/receive.mp3",!1)}handleQuoting(e){this.stream.load(`${e.href}&qreply=${document.querySelector("#qreply")?"1":"0"}`)}setWindowActive(){document.cookie=`actw=${globalThis.name}; SameSite:Lax`,K(),this.stream.pollData()}},V=new fe;te(()=>{V.onAppReady()});te(()=>{globalThis.name=`${Math.random()}`,V.setWindowActive(),globalThis.addEventListener("focus",()=>{V.setWindowActive()}),He()||document.documentElement.classList.add("no-emoji")});var Re=V;Object.assign(globalThis,{RUN:Re,IMWindow:ue,ModControls:new X});})();

var X=new Map;class u{element;constructor($){this.element=$}}function x($,h,H){if(!X.has($))X.set($,new WeakMap);h.forEach(function(f){if(X.get($)?.has(f))return;X.get($)?.set(f,new H(f))})}function d$($){let h=$.getHours()||12,H=`${$.getMinutes()}`.padStart(2,"0");return`${h%12||12}:${H}${h>12?"pm":"am"}`}function p($){return new Date($*1000)}var _$=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],K$=["January","February","March","April","May","June","July","August","September","October","November","December"];function t$($){return $[0].toUpperCase()+$.slice(1)}function g($){let h=new Date,H=new Intl.RelativeTimeFormat(void 0,{numeric:"auto",style:"long"}),L=new Date;L.setTime(+L-86400000),L.setHours(0),L.setMinutes(0),L.setSeconds(0);let f=p($),T=Math.round((+f-+h)/1000);if(T>-60)return H.format(T,"second");if(T>-3600)return H.format(Math.round(T/60),"minute");if(f>L){let E=new Date;return E.setHours(0),E.setMinutes(0),E.setSeconds(0),`${t$(H.format(f>E?0:-1,"day"))} @ ${d$(f)}`}return Intl.DateTimeFormat(void 0,{month:"short",year:"numeric",day:"numeric",hour:"numeric",hour12:!0,minute:"numeric"}).format(f)}function M$($){let h=p($),H=h.getHours(),L=H>=12?"pm":"am";H%=12,H=H||12;let f=`${h.getMinutes()}`.padStart(2,"0"),T=h.getMonth()+1,E=`${h.getDate()}`.padStart(2,"0"),M=h.getFullYear();return`${H}:${f}${L}, ${T}/${E}/${M}`}function u$($){let h=p($);return String.fromCodePoint(55357,56656+((h.getHours()%12||12)-1)+(h.getMinutes()>29?12:0))}function x$($){let h=Array.from($.classList).find((H)=>H.startsWith("lastAction"));if(h===void 0)return;$.prepend(u$(Number.parseInt(h.slice(10),10))),$.classList.remove(h)}class C extends u{static hydrate($){$.querySelectorAll(".idle").forEach((h)=>x$(h))}}function o$($=200){let h=document.querySelector("#snow");if(h===null){h=document.createElement("div"),h.id="snow",Object.assign(h.style,{position:"fixed",top:0,left:0,zIndex:1});let H=document.createElement("style");H.appendChild(document.createTextNode(`
            .snowflake {
                position: absolute;
                width: 10px;
                height: 10px;
                background: linear-gradient(white, white);
                /* Workaround for Chromium's selective color inversion */
                border-radius: 50%;
                filter: drop-shadow(0 0 10px white);
            }`)),document.body.prepend(H),document.body.prepend(h)}h.innerHTML="";for(let H=1;H<=$;H+=1){let L=document.createElement("div");L.className="snowflake",h.appendChild(L)}}function l$(){let $=document.getElementById("snow-css");if($)return $;return $=document.createElement("style"),$.id="snow-css",document.head.appendChild($),$}function s$($){let h=l$();h.innerHTML=$,document.head.appendChild(h)}function m$($=100){return Math.floor(Math.random()*$)+1}function a$($,h){let H=Math.ceil($),L=Math.floor(h);return Math.floor(Math.random()*(L-H+1))+H}function n$($,h){return Math.random()*(h-$)+$}function e$($=200){let H=100*document.body.offsetHeight/window.innerHeight,L="snowflake",f="";for(let T=1;T<=$;T+=1){let E=Math.random()*100,M=Math.random()*10,F=E+M,b=E+M/2,A=n$(0.3,0.8),j=A*H,q=Math.random(),E$=a$(10,H/10*3),U=m$(H/10*3)*-1,w$=Math.random();f+=`
      .snowflake:nth-child(${T}) {
        opacity: ${w$};
        transform: translate(${E}vw, -10px) scale(${q});
        animation: fall-${T} ${E$}s ${U}s linear infinite;
      }
      @keyframes fall-${T} {
        ${A*100}% {
          transform: translate(${F}vw, ${j}vh) scale(${q});
        }
        to {
          transform: translate(${b}vw, ${H}vh) scale(${q});
        }
      }
    `}s$(f)}function O($=200){e$($),o$($)}async function Q($,h,H=600,L="linear"){return new Promise((f)=>{$.animate(h,{duration:H,easing:L}).addEventListener("finish",()=>{Object.assign($.style,h.at(-1)),f($)},{once:!0})})}function F$($){return Q($,[{backgroundColor:"#FF0"},{backgroundColor:""}],1000)}function N($){return globalThis.getComputedStyle($)}function B($){let{x:h,y:H,height:L,width:f}=$.getBoundingClientRect(),T=h+globalThis.scrollX,E=H+globalThis.scrollY;return{x:T,y:E,yh:E+L,xw:T+f,w:f,h:L}}function Q$($,h){return h.contains($)}function D($,h){h.before($)}function W$($,h){h.after($)}function P(){return Array.from(document.querySelectorAll("*")).reduce((H,L)=>{if(L.style.zIndex&&Number(L.style.zIndex)>H)return Number(L.style.zIndex);return H},0)+1}var N$="valid",z$="invalid";class k extends u{method;outputElement;indicatorElement;static hydrate($){x("AutoComplete",$.querySelectorAll("input[data-autocomplete-action]"),this)}constructor($){super($);$.autocomplete="off",this.method=$.dataset.autocompleteAction;let h=$.dataset.autocompleteOutput,H=$.dataset.autocompleteIndicator,L=h?document.querySelector(h):void 0;if(!L)throw Error("Expected element to have data-autocomplete-output");this.outputElement=L||document.createElement("input"),this.indicatorElement=H?document.querySelector(H):void 0,$.addEventListener("keyup",(f)=>this.keyUp(f)),$.addEventListener("keydown",(f)=>{if(f.key==="Enter")f.preventDefault()})}getResultsContainer(){let $=B(this.element),h=document.querySelector("#autocomplete");if(!h)h=Object.assign(document.createElement("div"),{id:"autocomplete"}),Object.assign(h.style,{zIndex:P()}),document.body.appendChild(h);return Object.assign(h.style,{top:`${$.yh}px`,left:`${$.x}px`,width:`${$.w}px`}),h}keyUp($){let h=this.getResultsContainer(),H=Array.from(h.querySelectorAll("div")),L=H.findIndex((f)=>f.classList.contains("selected"));switch($.key){case"ArrowUp":case"ArrowDown":H.at(L)?.classList.remove("selected"),H.at((L+($.key==="ArrowDown"?1:-1))%H.length)?.classList.add("selected");return;case"Enter":if(L>=0)H.at(L)?.dispatchEvent(new Event("click"));return;default:if(this.indicatorElement)this.indicatorElement.classList.remove(N$),this.indicatorElement.classList.add(z$);if(this.clearResults(),this.element.value)this.doSearch();break}}clearResults(){let $=this.getResultsContainer();$.style.display="none",$.innerHTML=""}async doSearch(){let $=this.getResultsContainer(),h=/ACP/.test(document.location.toString())?"../":"",L=`term=${encodeURIComponent(this.element.value)}`,f=await fetch(`${h}/api/${this.method}?${L}`);if(!f.ok)return;let T=await f.json();if($.innerHTML="",T.length){$.style.display="";let[E,M]=T;E.forEach((F,b)=>{let A=M[b],j=document.createElement("div");j.innerHTML=A,j.addEventListener("click",()=>{if($.style.display="none",this.indicatorElement)this.indicatorElement.classList.add(N$),this.indicatorElement.classList.remove(z$);this.outputElement.value=`${F}`,this.outputElement.dispatchEvent(new Event("change")),this.element.value=A}),$.appendChild(j)});return}$.style.display="none"}}function _($){let h=document.createElement("div");return h.innerHTML=$,h.firstElementChild}function b$($){return[$?.closest("tr")?.rowIndex??0,$?.cellIndex??0]}var{userAgent:z}=navigator;function Z(){return"ontouchstart"in window}var r={chrome:/chrome/i.test(z),ie:/msie/i.test(z),iphone:/iphone/i.test(z),mobile:/mobile/i.test(z),n3ds:/nintendo 3ds/.test(z),firefox:/firefox/i.test(z),safari:/safari/i.test(z)};class V${sess;boundEvents;droppables;noChild=!1;bounds;onstart;ondragover;ondrag;ondragout;ondrop;autoZIndex=!0;constructor(){this.droppables=[],this.sess={el:document.body,mx:0,my:0,reset:()=>{return}},this.boundEvents={drag:($)=>this.drag($),drop:()=>this.drop()}}start($,h,H){$.preventDefault(),$.stopPropagation();let L=h||$.target,f=N(L),T=P();if(this.noChild&&$.target!==(H||L))return;if(L.getAttribute("draggable")==="false")return;if(this.sess={el:L,mx:$ instanceof MouseEvent?$.pageX:$.targetTouches[0].pageX,my:$ instanceof MouseEvent?$.pageY:$.targetTouches[0].pageY,ex:Number.parseInt(f.left,10)||0,ey:Number.parseInt(f.top,10)||0,info:{el:L,mx:0,my:0,reset:()=>{return}},reset:()=>this.reset(),zIndex:L.style.zIndex},!this.sess.zIndex||Number(this.sess.zIndex)<T-1)L.style.zIndex=`${T}`;this.onstart?.({...this.sess,droptarget:this.testDrops(this.sess.mx,this.sess.my)}),document.addEventListener(Z()?"touchmove":"mousemove",this.boundEvents.drag),document.addEventListener(Z()?"touchend":"mouseup",this.boundEvents.drop),this.drag($)}drag($){$.stopPropagation();let h=this.sess.el.style,H=$ instanceof MouseEvent?$.pageX:$.targetTouches[0].pageX,L=$ instanceof MouseEvent?$.pageY:$.targetTouches[0].pageY,f=H,T=L,E,M=(this.sess.ex??0)+f-this.sess.mx,F=(this.sess.ey??0)+T-this.sess.my,b=this.bounds;if(b){if(M<b[0])f=f-M+b[0],[M]=b;else if(M>b[0]+b[2])M=b[0]+b[2];if(F<b[1])T=T-F+b[1],[F]=b;else if(F>b[1]+b[3])F=b[1]+b[3]}h.left=`${M}px`,h.top=`${F}px`;let A=this.sess.info,j=A?.droptarget,q={...this.sess,left:M,top:F,mx:f,my:T,dx:f-(A?.mx||f),dy:T-(A?.my||T),droptarget:this.testDrops(H,L)};if(this.sess.info=q,this.ondrag?.(q),q.droptarget&&j!==q.droptarget)this.ondragover?.(q);if(j&&q.droptarget!==j)E=q.droptarget,q.droptarget=j,this.ondragout?.(q),q.droptarget=E}boundingBox($,h,H,L){return this.bounds=[$,h,H,L],this}drop(){if(this.boundEvents)document.removeEventListener(Z()?"touchend":"mouseup",this.boundEvents.drop),document.removeEventListener(Z()?"touchmove":"mousemove",this.boundEvents.drag);if(this.ondrop?.(this.sess.info??{}),this.autoZIndex)this.sess.el.style.zIndex=this.sess.zIndex??"";return!0}testDrops($,h){let{droppables:H}=this,L,f=[9999,9999];if(!H.length)return;return H.findLast((T)=>{if(T===this.sess.el||Q$(T,this.sess.el))return;if(L=B(T),f[0]>L.w&&f[1]>L.h&&$>=L.x&&h>=L.y&&$<=L.xw&&h<=L.yh)return f=[L.w,L.h],T;return})}drops($){return this.droppables=$,this}addDrops($){if(!this.droppables)return this.drops($);return this.droppables=this.droppables.concat($),this}addListener($){return Object.assign(this,$),this}apply($,h){if(Array.isArray($))return $.forEach((f)=>this.apply(f)),this;let L=N($)?.position;if(!L||L==="static")$.style.position="relative";return(h||$).addEventListener(Z()?"touchstart":"mousedown",h?(f)=>this.start(f,$,h):(f)=>this.start(f,$)),this}autoZ(){return this.autoZIndex=!1,this}noChildActivation(){return this.noChild=!0,this}reset($=this.sess.el){return $.style.top="0",$.style.left="0",this}}var V=V$;var q$="50px";class Y${success($){this.showToast($,"success",3000)}error($){this.showToast($,"error")}async showToast($,h,H=0){let L=document.createElement("div"),f=async()=>{await Q(L,[{top:q$},{top:`-${q$}`}]),L.remove()};L.classList.add(h),Object.assign(L.style,{position:"fixed",left:"50%",transform:"translateX(-50%)",boxShadow:"black 5px 5px 10px",zIndex:P()}),L.addEventListener("click",f,{once:!0}),L.innerHTML=$;let T=document.createElement("a");if(T.href="javascript:void(0)",T.innerHTML=" [X]",T.title="close notification",T.addEventListener("click",f,{once:!0}),L.append(T),document.body.appendChild(L),await Q(L,[{top:"0"},{top:q$}],600,"ease-in-out"),H)await new Promise((E)=>setTimeout(E,H)),f()}}var G=new Y$;class i extends u{static hydrate($){x("Chess",$.querySelectorAll(".checkers"),this)}constructor($){super($);let h=new V;h.addListener({ondrop:(H)=>{if(H.reset(),!H.droptarget)return;let{droptarget:L,el:f}=H,T=b$(f.closest("td")),E=b$(L);if(!this.isValidMove(T,E))return;if(L.parentElement instanceof HTMLTableRowElement&&[1,8].includes(L.parentElement.rowIndex))f.dataset.piece=(f.dataset.piece??"").toUpperCase(),f.innerHTML="â™›";L.querySelector(".piece")?.remove(),L.append(f),navigator.clipboard.writeText("[checkers]"+this.getGameState()+"[/checkers]"),G.success("BBCode copied to clipboard")}}),h.drops(Array.from($.querySelectorAll("td"))),h.apply(Array.from($.querySelectorAll(".piece")))}isValidMove($,h){if(h[0]%2===h[1]%2)return!1;if(Math.abs(h[0]-$[0])!==Math.abs(h[1]-$[1]))return!1;return!0}getGameState(){let $=Array.from(this.element.querySelectorAll("td")),h=[];for(let H=0;H<8;H++){h.push([]);for(let L=0;L<4;L++){let f=H%2?0:1;h[H].push($[H*8+L*2+f].querySelector(".piece")?.dataset.piece||" ")}}return h.map((H)=>H.join("")).join("/").replaceAll(/ +/g,(H)=>`${H.length}`)}}class v extends u{static hydrate($){x("Chess",$.querySelectorAll(".chess"),this)}constructor($){super($);let h=new V;h.addListener({ondrop:(H)=>{if(H.droptarget)H.droptarget.querySelector(".piece")?.remove(),H.droptarget.append(H.el),navigator.clipboard.writeText("[chess]"+this.getFENNotation()+"[/chess]"),G.success("BBCode copied to clipboard");H.reset()}}),h.drops(Array.from($.querySelectorAll("td"))),h.apply(Array.from($.querySelectorAll(".piece")))}getFENNotation(){return Array.from(this.element.querySelectorAll("td")).map((h,H)=>(H&&H%8===0?"/":"")+(h.querySelector(".piece")?.dataset.piece||" ")).join("").replaceAll(/ +/g,(h)=>`${h.length}`)}}function Z$($){if(!globalThis.getSelection)return;let h=document.createRange();h.selectNode($);let H=globalThis.getSelection();if(!H)return;if(H.rangeCount)H.removeAllRanges();H.addRange(h)}function R$($,h){let H=$.scrollTop,L=$.selectionStart??0,f=$.selectionEnd??0;$.value=$.value.substring(0,L)+h+$.value.slice(f),$.selectionStart=L+h.length,$.selectionEnd=L+h.length,$.focus(),$.scrollTop=H}class w extends u{static hydrate($){x("CodeBlock",$.querySelectorAll(".bbcode.code"),this)}constructor($){super($);$.addEventListener("click",()=>Z$($))}}class d extends u{fullHeight=0;animationLengthInMs=200;static hydrate($){x("CollapseBox",$.querySelectorAll(".collapse-box"),this)}constructor($){super($);let{collapseContent:h}=this;if(h)Object.assign(h.style,{transition:`height ${this.animationLengthInMs}ms ease-in-out`});this.toggle(),this.element.addEventListener("click",(H)=>{if(H.target instanceof HTMLElement&&H.target.matches(".collapse-button"))this.isOpen=!this.isOpen,this.toggle()})}get boxID(){return this.element.getAttribute("id")||""}get collapseContent(){return this.element.querySelector(".collapse-content")}get isOpen(){return!(globalThis.sessionStorage.getItem("collapsed")??"").split(",").includes(this.boxID)}set isOpen($){let h=(globalThis.sessionStorage.getItem("collapsed")??"").split(",").filter(Boolean);if($)h=h.filter((H)=>H!==this.boxID);else h.push(this.boxID);globalThis.sessionStorage.setItem("collapsed",h.join(",")??"")}toggle(){let{collapseContent:$}=this;if(!$)return;let{style:h}=$;if(this.isOpen){if(!this.fullHeight)return;h.height=`${this.fullHeight}px`,this.element.classList.remove("collapsed"),setTimeout(()=>{h.removeProperty("height"),h.removeProperty("overflow")},this.animationLengthInMs)}else this.fullHeight=$.clientHeight||$.offsetHeight,h.height=`${this.fullHeight}px`,h.overflow="hidden",this.element.classList.add("collapsed"),requestAnimationFrame(()=>{h.height="0px"})}}function R($,h=1000){return new Promise((H)=>{let L=new Set,f=Array.from($).filter((E)=>!E.complete);if(!f.length){H();return}function T(){if(L.delete(this.src),L.size===0)H()}if(f.forEach((E)=>{if(!L.has(E.src))L.add(E.src),E.addEventListener("error",T),E.addEventListener("load",T)}),h)setTimeout(H,h)})}function I(){let $=document.querySelectorAll(".autodate"),h=Array.from(document.querySelectorAll("[data-timestamp]"));if(!$)return;$.forEach((H)=>{let L=Number.parseInt(H.getAttribute("title")??"",10),f=H.classList.contains("smalldate")?M$(L):g(L);if(f!==H.innerHTML)H.innerHTML=f}),h.forEach((H)=>{if(!H.title)H.title=M$(Number.parseInt(H.dataset.timestamp??"",10))})}function y($){if(document.readyState==="complete")$();else document.addEventListener("DOMContentLoaded",$)}function c$(){let $=document.createElement("input");return $.setAttribute("type","date"),$.type==="date"}function U$(){let $=[String.fromCodePoint(9757,127999),String.fromCodePoint(9757)].map((h)=>{let H=document.body.appendChild(document.createElement("span"));H.appendChild(document.createTextNode(h));let L=H.offsetWidth;return H.remove(),L});return $[0]===$[1]}class t extends u{picker;selectedDate;lastDate;static hydrate($){if(c$())return;x("DatePicker",$.querySelectorAll("input[type=date]"),this)}constructor($){super($);this.picker=this.getPicker(),$.autocomplete="off",$.addEventListener("focus",()=>this.openPicker()),$.addEventListener("keydown",()=>this.closePicker())}getPicker(){if(this.picker)return this.picker;let $=document.querySelector("#datepicker");if(!$)$=Object.assign(document.createElement("table"),{id:"datepicker"}),document.body.appendChild($),$.style.display="none";return $}openPicker(){let $=B(this.element);Object.assign(this.picker.style,{display:"",zIndex:P(),position:"absolute",top:`${$.yh}px`,left:`${$.x}px`});let[h,H,L]=this.element.value.split("/").map((f)=>Number.parseInt(f,10));if(h&&H&&L)this.selectedDate=[L,h-1,H];else this.selectedDate=void 0;this.generate(L,h,H)}closePicker(){this.picker.style.display="none"}generate($,h,H){let L=new Date,f=this.getPicker(),T,E,[M,F,b]=[$,h,H];if(M===void 0)M=L.getFullYear(),F=L.getMonth(),b=L.getDate(),this.selectedDate=[M,F,b];if(F===-1)M-=1,F=11;if(F===12)M+=1,F=0;this.lastDate=[M,F,b];let A=new Date(M,F+1,0).getDate(),j=new Date(M,F,1).getDay();f.innerHTML="",T=f.insertRow(0),E=T.insertCell(0),E.innerHTML="&lt;",E.className="control",E.addEventListener("click",()=>this.lastYear()),E=T.insertCell(1),E.colSpan=5,E.className="year",E.innerHTML=`${M}`,E=T.insertCell(2),E.innerHTML=">",E.className="control",E.addEventListener("click",()=>this.nextYear()),T=f.insertRow(1),E=T.insertCell(0),E.innerHTML="<",E.className="control",E.addEventListener("click",()=>this.lastMonth()),E=T.insertCell(1),E.colSpan=5,E.innerHTML=K$[F],E.className="month",E=T.insertCell(2),E.innerHTML=">",E.className="control",E.addEventListener("click",()=>this.nextMonth()),T=f.insertRow(2),T.className="weekdays";for(let q=0;q<7;q+=1)T.insertCell(q).innerHTML=_$[q];T=f.insertRow(3);for(let q=0;q<A;q+=1){if(!q)for(let U=0;U<j;U+=1)T.insertCell(U);if((j+q)%7===0)T=f.insertRow(f.rows.length);E=T.insertCell((j+q)%7),E.addEventListener("click",this.insert.bind(this,E));let E$=!!this.selectedDate&&M===this.selectedDate[0]&&F===this.selectedDate[1]&&q+1===this.selectedDate[2];E.className=`day${E$?" selected":""}`,E.innerHTML=`${q+1}`}}lastYear(){let $=this.lastDate;if($)this.generate($[0]-1,$[1],$[2])}nextYear(){let $=this.lastDate;if($)this.generate($[0]+1,$[1],$[2])}lastMonth(){let $=this.lastDate;if($)this.generate($[0],$[1]-1,$[2])}nextMonth(){let $=this.lastDate;if($)this.generate($[0],$[1]+1,$[2])}insert($){let h=this.lastDate;if(h)this.element.value=`${h[1]+1}/${$.innerHTML}/${h[0]}`;this.closePicker()}}class O${rgb;constructor($){let h=/^rgb\((\d+),\s?(\d+),\s?(\d+)\)/i.exec($),H=/#?([\da-fA-F]+)/.exec($);if(h){this.rgb=[Number.parseFloat(h[1]),Number.parseFloat(h[2]),Number.parseFloat(h[3])];return}if(H){let L=H[1];if(L.length===3)L=L.charAt(0)+L.charAt(0)+L.charAt(1)+L.charAt(1)+L.charAt(2)+L.charAt(2);if(L.length!==6){this.rgb=[0,0,0];return}this.rgb=[];for(let f=0;f<3;f+=1)this.rgb[f]=Number.parseInt(L.slice(f*2,(f+1)*2),16)}}invert(){if(this.rgb)this.rgb=[255-this.rgb[0],255-this.rgb[1],255-this.rgb[2]];return this}toRGB(){return this.rgb}toHex(){return"#"+this.rgb?.map(($)=>$.toString(16).padStart(2,"0")).join("")}}var j$=O$;var D$={a:($,h)=>`[url=${h?.getAttribute("href")}]${$}[/url]`,b(...$){return this.strong(...$)},br:()=>`
`,div:($)=>`
${$}`,em:($)=>`[i]${$}[/i]`,font:($,h)=>{let H=h.style.fontFamily||h.getAttribute("face");return H?`[font=${H}]${$}[/font]`:$},h1:($)=>`[h1]${$}[/h1]`,h2:($)=>`[h2]${$}[/h2]`,h3:($)=>`[h3]${$}[/h3]`,h4:($)=>`[h4]${$}[/h4]`,h5:($)=>`[h5]${$}[/h5]`,h6:($)=>`[h6]${$}[/h6]`,hr:()=>`
`,i(...$){return this.em(...$)},img:($,h)=>{let H=h.getAttribute("alt")??"",L=h.getAttribute("src");if(h.dataset.emoji)return` ${h.dataset.emoji}`;if(L)return`[img]${L}[/img]`;return H},li:($)=>`* ${$.replace(/[\n\r]+/,"")}
`,meta:()=>`
`,ol:($)=>`[ol]${$}[/ol]`,p:($)=>`
${$==="&nbsp"?"":$}
`,strike:($)=>`[s]${$}[/s]`,strong:($)=>`[b]${$}[/b]`,u:($)=>`[u]${$}[/u]`,ul:($)=>`[ul]${$}[/ul]`},o={"background-color":($,h)=>{let H=$&&new j$($).toHex(),L=H?`${H}`:$;if(["ffffff","white","transparent"].includes(L))return h;return`[bgcolor=${L}]${h}[/bgcolor]`},color($,h){let H=$&&new j$($).toHex();return`[color=${H?`${H}`:$}]${h}[/color]`},"font-family":($,h)=>`[font=${$.replaceAll(/['"]/g,"")}]${h}[/font]`,"font-style":($,h)=>`[i]${h}[/i]`,"font-size":($,h)=>`[size=${$}]${h}[/size]`,"font-weight":($,h)=>`[b]${h}[/b]`,"text-align":($,h)=>`[align=${$}]${h}[/align]`,"text-decoration":function(h,H){return h==="line-through"?`[strike]${H}[/strike]`:`[u]${H}[/u]`}};function $h($){return $.replaceAll(/[\r\n]+/g,"").replaceAll("&amp;","&").replaceAll("&gt;",">").replaceAll("&lt;","<").replaceAll("&nbsp;"," ")}function P$($){let h=$.tagName.toLowerCase(),H="";for(let T of $.childNodes)H+=T.nodeType===Node.ELEMENT_NODE?P$(T):$h(T.textContent??"");if(h==="body")return H;if($.style){for(let T of $.style)if(T in o)H=o[T]($.style.getPropertyValue(T),H)}let L=$.getAttribute("size");if(L)H=o.fontSize(L,H);let f=$.getAttribute("color");if(f)H=o.color(f,H);if(h in D$)H=D$[h](H,$);return H}function S$($){return $.replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll(/(\s) /g,"$1&nbsp;").replaceAll(/\[b\]([^]*?)\[\/b\]/gi,"<b>$1</b>").replaceAll(/\[i\]([^]*?)\[\/i\]/gi,"<i>$1</i>").replaceAll(/\[u\]([^]*?)\[\/u\]/gi,"<u>$1</u>").replaceAll(/\[s\]([^]*?)\[\/s\]/gi,"<s>$1</s>").replaceAll(/\[img\]([^'"[]+)\[\/img\]/gi,'<img src="$1">').replaceAll(/\[color=([^\]]+)\]([^]*?)\[\/color\]/gi,'<span style="color:$1">$2</span>').replaceAll(/\[size=([^\]]+)\]([^]*?)\[\/size\]/gi,'<span style="font-size:$1">$2</span>').replaceAll(/\[font=['"]?([^\]]+?)['"]?\]([^]*?)\[\/font\]/gi,'<span style="font-family:$1">$2</span>').replaceAll(/\[url=([^\]]+)\]([^]*?)\[\/url\]/gi,'<a href="$1">$2</a>').replaceAll(/\[bgcolor=([^\]]+)\]([^]*?)\[\/bgcolor\]/gi,'<span style="background-color:$1">$2</span>').replaceAll(/\[h(\d)\]([^]*?)\[\/h\1\]/g,"<h$1>$2</h$1>").replaceAll(/\[align=(left|right|center)\]([^]*?)\[\/align\]/g,'<div style="text-align:$1">$2</div>').replaceAll(/\[(ul|ol)\]([^]*?)\[\/\1\]/gi,(h,H,L)=>{let T=L.split(/(^|[\r\n]+)\* ?/).filter((E)=>E.trim()).map((E)=>`<li>${E}</li>`).join("");return`<${H}>${T}</${H}>`}).replaceAll(`
`,"<br>")}var hh=/^(ht|f)tps?:\/\/[\w.\-%&?=/]+$/,Hh=($)=>hh.test($),I$={"Sans Serif":["Arial","Arial Black","Arial Narrow","Arial Rounded MT Bold","Avant Garde","Calibri","Candara","Century Gothic","Comic Sans MS","Franklin Gothic Medium","Futura","Geneva","Gill Sans","Helvetica","Impact","Lucida Grande","Optima","Segoe UI","Tahoma","Trebuchet MS","Verdana"],Serif:["Big Caslon","Bodoni MT","Book Antiqua","Calisto MT","Cambria","Didot","Garamond","Georgia","Goudy Old Style","Hoefler Text","Lucida Bright","Palatino","Perpetua","Rockwell","Rockwell Extra Bold","Baskerville","Times New Roman"],Monospaced:["Consolas","Courier New","Lucida Console","Lucida Sans Typewriter","Monaco","Andale Mono"],Fantasy:["Copperplate","Papyrus"],Script:["Brush Script MT"]};class l extends u{iframe;colorWindow;container;htmlMode=!0;editbar;emoteWindow;static hydrate($){x("Editor",$.querySelectorAll("textarea.bbcode-editor"),this)}constructor($){super($);this.container=Object.assign(document.createElement("div"),{className:"editor"}),this.iframe=document.createElement("iframe"),this.iframe.style.display="none",this.iframe.addEventListener("load",()=>this.iframeLoaded(),{once:!0}),D(this.container,$),this.container.appendChild($),this.container.appendChild(this.iframe)}get doc(){return this.window?.document}get window(){return this.iframe.contentWindow}iframeLoaded(){let{iframe:$,element:h}=this;if($.className="editorframe",this.htmlMode=globalSettings.wysiwyg,h.addEventListener("input",()=>{this.setSource(S$(h.value))}),this.doc?.addEventListener("input",()=>{if(!this.doc)return;this.element.value=P$(this.doc.body)}),this.doc?.addEventListener("paste",(f)=>{f.preventDefault();let T=f.clipboardData?.getData("text/plain");this.doc?.execCommand("insertText",!1,T)}),this.doc?.addEventListener("drop",(f)=>{if(!f.dataTransfer?.files.length)return;this.upload(f.dataTransfer.files[0])}),this.doc?.addEventListener("dragleave",()=>{this.getAttachmentStatus().remove()}),this.doc?.addEventListener("dragover",()=>{this.getAttachmentStatus()}),!this.doc)return;let H=N(h),L=this.doc.getElementsByTagName("body")[0];if(L&&H)L.style.backgroundColor=H.backgroundColor,L.style.color=H.color,L.style.borderColor="#FFF";this.doc.designMode="on",this.editbar=this.buildEditBar(),$.style.height=`${h.clientHeight}px`,D(this.editbar,h),this.setSource("<div></div>"),setTimeout(()=>{if(this.setSource(S$(h.value)),this.switchMode(this.htmlMode),h.hasAttribute("autofocus"))this.window?.focus()},100)}getAttachmentStatus(){let $=this.doc?.querySelector("#attachmentStatus");if($)return $;return $=document.createElement("div"),Object.assign($,{id:"attachmentStatus",innerHTML:"Drop file here",contentEditable:"false"}),Object.assign($.style,{position:"fixed",padding:"20px",top:"50%",left:"50%",translate:"-50% -50%",border:"2px dashed #ccc"}),this.doc?.body.appendChild($),$}upload($){let h=new FormData;h.append("Filedata",$);let H=new XMLHttpRequest;this.getAttachmentStatus().innerHTML='Uploading: <progress id="attachmentProgress"></div>';let L=this.getAttachmentStatus().querySelector("#attachmentProgress");H.upload.addEventListener("progress",(f)=>{if(L&&f.lengthComputable){let T=Math.round(f.loaded/f.total*100);L.value=f.loaded,L.max=f.total,L.textContent=`${T}%`}}),H.addEventListener("load",()=>{this.window?.focus(),this.getAttachmentStatus().remove();let f=H.responseText;if(/\D/.test(f)){alert("Error: "+f);return}this.cmd("inserthtml",`[attachment]${H.responseText}[/attachment]`)}),H.upload.addEventListener("error",()=>{this.getAttachmentStatus().remove()}),H.open("POST","/api/upload",!0),H.send(h)}buildEditBar(){let $=document.createElement("div");$.className="editbar",$.innerHTML=[`<select class="fontface">
        <option value="">Default Font</option>
        <optgroup label="Headings">
          <option value="heading_1" style="font-weight:bold;font-size: 2em">Heading 1</option>
          <option value="heading_2" style="font-weight:bold;font-size: 1.5em">Heading 2</option>
          <option value="heading_3" style="font-weight:bold;font-size: 1.17em">Heading 3</option>
          <option value="heading_4" style="font-weight:bold;font-size: 1em">Heading 4</option>
          <option value="heading_5" style="font-weight:bold;font-size: 0.83em">Heading 5</option>
          <option value="heading_6" style="font-weight:bold;font-size: 0.67em">Heading 6</option>
        </optgroup>
      </select>`,'<a class="bold" title="Bold"></a>','<a class="italic" title="Italic"></a>','<a class="underline" title="Underline"></a>','<a class="strikethrough" title="Strike-Through"></a>','<a class="forecolor" title="Foreground Color"></a>','<a class="backcolor" title="Background Color"></a>','<a class="insertimage" title="Insert Image"></a>','<a class="createlink" title="Insert Link"></a>','<a class="c_email" title="Insert Email"></a>','<a class="justifyleft" title="Align Left"></a>','<a class="justifycenter" title="Center"></a>','<a class="justifyright" title="Align Right"></a>','<a class="c_youtube" title="Insert video from any of your favorite video services!"></a>','<a class="c_code" title="Insert code"></a>','<a class="c_quote" title="Insert Quote"></a>','<a class="c_spoiler" title="Insert Spoiler"></a>','<a class="insertorderedlist" title="Create Ordered List"></a>','<a class="insertunorderedlist" title="Create Unordered List"></a>','<a class="c_smileys" title="Insert Emoticon"></a>','<a class="c_switcheditmode" title="Switch editor mode"></a>'].join(""),$.addEventListener("click",(H)=>{if(H.target instanceof HTMLElement&&H.target.matches(".editbar a"))this.editbarCommand(H,H.target.className)});let h=$.querySelector("select.fontface");if(h){h.addEventListener("input",(H)=>{let L=h.value;if(L.startsWith("heading_"))this.editbarCommand(H,"heading",L.replace("heading_","h"));else if(L)this.editbarCommand(H,"fontname",L)});for(let H of Object.keys(I$)){let L=I$[H].map((f)=>`<option style="font-family: ${f}">${f}</option>`);h.innerHTML+=`<optgroup label="${H}">${L}</optgroup>`}}return $}editbarCommand($,h,H){switch($.preventDefault(),h){case"forecolor":case"backcolor":this.showColors($.pageX,$.pageY,h);break;case"c_smileys":this.showEmotes($.pageX,$.pageY);break;case"c_switcheditmode":this.switchMode(!this.htmlMode);break;default:this.cmd(h,H);break}}async showEmotes($,h){let H=this.emoteWindow;if(!H){let L=await fetch("/api/emotes"),f=await L.json();if(L.ok)this.createEmoteWindow(f,{x:$,y:h});return}if(H.style.display==="none")H.style.display="",H.style.left=`${$}px`,H.style.top=`${h}px`;else this.hideEmotes()}hideEmotes(){if(this.emoteWindow)this.emoteWindow.style.display="none"}createEmoteWindow([$,h],H){let L=document.createElement("div");L.className="emotewin",$.forEach((f,T)=>{let E=h[T],M=document.createElement("a");M.href="javascript:void(0)",M.addEventListener("click",()=>{this.cmd("inserthtml",E),this.hideEmotes()}),M.innerHTML=`${E} ${f}`,L.appendChild(M)}),L.style.position="absolute",L.style.display="none",this.emoteWindow=L,document.querySelector("#page")?.appendChild(L),this.showEmotes(H.x,H.y)}colorHandler($,h){this.cmd($,h),this.hideColors()}showColors($,h,H){this.hideColors();let f=_(`
      <div>
        ${["#FFFFFF","#AAAAAA","#000000","#FF0000","#00FF00","#0000FF","#FFFF00","#00FFFF","#FF00FF"].map((T)=>`<button style="background-color:${T}" data-color="${T}"></button>`).join("")}
      </div>
    `);return Object.assign(f.style,{display:"grid",gridTemplateColumns:"20px 20px 20px",gridTemplateRows:"20px 20px 20px",position:"absolute",top:`${h}px`,left:`${$}px`,cursor:"pointer",zIndex:P()}),f.addEventListener("click",(T)=>{if(T.target instanceof HTMLButtonElement&&T.target.dataset.color)this.colorHandler(H,T.target.dataset.color)}),this.colorWindow=f,document.querySelector("#page")?.appendChild(f),null}hideColors(){if(this.colorWindow)this.colorWindow.remove(),this.colorWindow=void 0}cmd($,h){let H=this.getSelection(),L="",f=$,T=h;switch($.toLowerCase()){case"bold":L=`[b]${H}[/b]`;break;case"italic":L=`[i]${H}[/i]`;break;case"underline":L=`[u]${H}[/u]`;break;case"strikethrough":L=`[s]${H}[/s]`;break;case"justifyright":L=`[align=right]${H}[/align]`;break;case"justifycenter":L=`[align=center]${H}[/align]`;break;case"justifyleft":L=`[align=left]${H}[/align]`;break;case"insertimage":if(T=prompt("Image URL:")||"",!T)return;if(!Hh(T)){alert("Please enter a valid URL.");return}L=`[img]${T}[/img]`;break;case"insertorderedlist":if(!this.htmlMode)L=`[ol]${H.replaceAll(/(.+([\r\n]+|$))/i,"* $1")}[/ol]`;break;case"insertunorderedlist":if(!this.htmlMode)L=`[ul]${H.replaceAll(/(.+([\r\n]+|$))/i,"* $1")}[/ul]`;break;case"createlink":if(T=prompt("Link:")||"",!T)return;if(!/^(https?|ftp|mailto):/.test(T))T=`https://${T}`;L=`[url=${T}]${H}[/url]`;break;case"c_email":if(T=prompt("Email:")||"",!T)return;f="createlink",T=`mailto:${T}`,L=`[url=${T}]${H}[/url]`;break;case"backcolor":if(r.firefox||r.safari)f="hilitecolor";L=`[bgcolor=${T}]${H}[/bgcolor]`;break;case"forecolor":L=`[color=${T}]${H}[/color]`;break;case"fontname":L=`[font=${T}]${H}[/font]`;break;case"c_code":f="inserthtml",T=`[code]${H}[/code]`,L=T;break;case"c_quote":f="inserthtml",T=prompt("Who said this?")||"",T=T?`=${T}`:"",T=`[quote${T}]${H}[/quote]`,L=T;break;case"c_spoiler":f="inserthtml",T=`[spoiler]${H}[/spoiler]`,L=T;break;case"c_youtube":if(f="inserthtml",T=prompt("Video URL?")||"",!T)return;T=`[video]${T}[/video]`,L=T;break;case"inserthtml":L=T||"";break;case"heading":if(L=`[${T}]${H}[/${T}]`,r.chrome)f="formatBlock",T=`<${T}>`;break;default:throw Error(`Unsupported editor command ${$}`)}if(this.htmlMode)this.doc?.execCommand(f,!1,T),this.doc?.dispatchEvent(new Event("input")),this.window?.focus();else R$(this.element,L),this.element.dispatchEvent(new Event("input"))}getSelection(){if(this.htmlMode)return this.window?.getSelection()?.toString()||"";return this.element.value.substring(this.element.selectionStart,this.element.selectionEnd)}getSource(){return this.doc?.body.innerHTML}setSource($){if(this.doc)this.doc.body.innerHTML=$}switchMode($){let{element:h,iframe:H}=this;if($)h.style.display="none",H.style.display="";else h.style.display="",H.style.display="none";this.htmlMode=$}}class s extends u{resetOnSubmit;static hydrate($){x("Form",$.querySelectorAll("form[data-ajax-form]"),this)}constructor($){super($);this.resetOnSubmit=$.dataset.ajaxForm==="resetOnSubmit",$.addEventListener("submit",(h)=>{h.preventDefault(),this.submitForm()})}submitForm(){let{element:$,resetOnSubmit:h}=this,{submitButton:H}=$,L=new FormData($,H),f=Array.from(L.entries()).filter((T)=>typeof T[1]==="string");if(RUN.stream.load($.action||globalThis.location.toString(),{body:new URLSearchParams(f)}),h)$.reset();RUN.stream.pollData()}}class m extends u{index;images;max;static hydrate($){x("ImageGallery",$.querySelectorAll(".image_gallery"),this)}constructor($){super($);let h=document.createElement("div"),H=document.createElement("button"),L=document.createElement("button");this.index=0,this.images=$.querySelectorAll("img"),this.max=Math.max(this.images.length,1),H.innerHTML="Next &raquo;",H.addEventListener("click",()=>{this.showNext()}),L.innerHTML="Prev &laquo;",L.addEventListener("click",()=>{this.showPrev()}),this.update(),h.appendChild(L),h.appendChild(document.createTextNode(" ")),h.appendChild(H),$.appendChild(h)}showNext(){if(this.index<this.max-1)this.index+=1;this.update()}showPrev(){if(this.index>0)this.index-=1;this.update()}update(){this.images.forEach(($,h)=>{let H=$.dataset.madeResized?$.parentNode:$;if(H)H.style.display=h===this.index?"block":"none"})}}var y$="999999px";class a extends u{static async hydrate($){let h=$.querySelectorAll(".bbcodeimg");await R(Array.from(h)),x("ImageResizer",h,this)}constructor($){super($);let h=1,H=1,{naturalWidth:L,naturalHeight:f}=$,T=N($),E=Number.parseInt(T.width,10)||Number.parseInt(T.maxWidth,10),M=Number.parseInt(T.height,10)||Number.parseInt(T.maxHeight,10);if(E&&L>E)h=E/f;if(M&&f>M)H=M/f;if(h=h&&H?Math.min(h,H):H||h,h<1)this.makeResizer(L*h,f*h)}makeResizer($,h){let{element:H}=this;H.style.maxWidth=y$,H.style.maxHeight=y$,H.dataset.madeResized="true";let L=Object.assign(document.createElement("a"),{target:"_blank",href:H.src});Object.assign(L.style,{display:"block",overflow:"hidden",width:`${$}px`,height:`${h}px`}),L.dataset.nw=`${H.naturalWidth}`,L.dataset.nh=`${H.naturalHeight}`,L.addEventListener("mousemove",(T)=>{let{x:E,y:M,w:F,h:b}=B(L);L.scrollLeft=(T.pageX-E)/F*(+(L.dataset.nw||0)-F)||0,L.scrollTop=(T.pageY-M)/b*(+(L.dataset.nh||0)-b)||0}),L.addEventListener("mouseover",()=>{H.style.width=`${L.dataset.nw}px`,H.style.height=`${L.dataset.nh}px`});let f=()=>{if(L.scrollLeft)L.scrollLeft=0,L.scrollTop=0;H.style.width=`${$}px`,H.style.height=`${h}px`};L.addEventListener("mouseout",f),f(),D(L,H),L.appendChild(H)}}function J($){let h=B($),H=$.getAttribute("title");if($.dataset.lastOnline){let f=Number.parseInt($.dataset.lastOnline??"",10);H=`Last Online: ${g(f)} ${u$(f)}`}if(!H)return;let L=document.querySelector("#tooltip");if(!L)L=_('<div id="tooltip" class="tooltip">Default text</div>'),document.querySelector("#page")?.appendChild(L);$.title="",$.addEventListener("mouseout",()=>{$.title=H,L.style.display="none"}),L.innerText=H,L.style.display="",Object.assign(L.style,{top:`${h.y-L.offsetHeight}px`,left:`${h.x}px`,zIndex:`${P()}`})}class n extends u{static hydrate($){x("Link",$.querySelectorAll("a"),this)}constructor($){super($);if($.dataset.useTooltip)$.addEventListener("mouseover",()=>J($));if(!$.href)return;let h=$.getAttribute("href"),H=!$.target&&h&&(h.startsWith("/")||h.startsWith("?"));if(h?.startsWith("javascript"))return;if(H){let f=$.onclick;$.onclick=null,$.addEventListener("click",(T)=>{if(T.preventDefault(),!f||f.call($,T)!==!1)RUN.stream.location(h)});return}$.target="_blank"}}class J${title="Title";wait=!0;content="Content";open=!1;minimizable=!0;resize;className="";pos="center";zIndex;windowContainer;id;onclose;animate=!0;oldpos="";constructor($={}){this.zIndex=P(),Object.assign(this,$)}render(){let $=_(`
      <div id="${this.id||""}" class="window ${this.className}">
        <div class="title">
          ${this.title}
          <div class="controls">
            ${this.minimizable?'<button data-action="minimize">-</button>':""}
            <button data-action="close" data-shortcut="Escape">X</button>
          </div>
        </div>
        <div class="content">${this.content}</div>
      </div>`);this.windowContainer=$,$.addEventListener("click",(f)=>{if(f.target instanceof HTMLElement){let T=f.target.dataset.action;if(T&&T in this)this[T]()}});let h=document.querySelector(".windows");if(!h)h=_('<div class="windows" style="z-index: 1"></div>'),document.body.appendChild(h);if(h.appendChild($),this.resize)this.renderResizeHandle(this.resize);let H=$.style;H.zIndex=`${this.zIndex+5}`;let{pos:L}=this;if(this.wait)R(Array.from($.querySelectorAll("img"))).then(()=>{this.setPosition(L)});else this.setPosition(L);return new V().autoZ().noChildActivation().boundingBox(0,0,document.documentElement.clientWidth-50,document.documentElement.clientHeight-50).apply($,$.querySelector(".title")||void 0),$}renderResizeHandle($){let{windowContainer:h}=this;if(!h)return;let H=h.querySelector($);if(!H)throw Error("Resize target not found");H.style.width=`${H.clientWidth}px`,H.style.height=`${H.clientHeight}px`;let L=_('<div class="resize"></div>');h.appendChild(L),L.style.left=`${h.clientWidth-16}px`,L.style.top=`${h.clientHeight-16}px`,new V().boundingBox(100,100,1/0,1/0).addListener({ondrag(f){let T=Number.parseFloat(H.style.width)+(f.dx??0),E=Number.parseFloat(H.style.height)+(f.dy??0);if(H.style.width=`${T}px`,T<h.clientWidth-20)H.style.width=`${h.clientWidth}px`;else L.style.left=`${h.clientWidth-16}px`;H.style.height=`${E}px`},ondrop(){L.style.left=`${h.clientWidth-16}px`}}).apply(L),H.style.width=`${h.clientWidth}px`,L.style.left=`${h.clientWidth-16}px`}close(){if(!this.windowContainer)return;if(this.windowContainer.remove(),this.windowContainer=void 0,this.onclose)this.onclose()}minimize(){let{windowContainer:$}=this;if(!$)return;let h=!$.classList.toggle("minimized");if($.querySelector(".controls [data-action=minimize]").innerHTML=h?"-":"\uD83D\uDDD6",h)$.removeAttribute("draggable");else $.setAttribute("draggable","false"),this.oldpos=this.getPosition();this.setPosition(h?this.oldpos:"",!1)}setPosition($,h=!0){let H=this.windowContainer;if(!H)return;let L=0,f=0,T=document.documentElement.clientHeight,E=document.documentElement.clientWidth;if($==="center")f=Math.floor((T-H.clientHeight)/2),L=Math.floor((E-H.clientWidth)/2);else{let M=/(\d+) (\d+)/.exec($);if(M)L=Number(M[1]),f=Number(M[2])}if(H.style.left=`${L}px`,this.animate&&h)Q(H,[{top:`${f-100}px`},{top:`${f}px`}],300,"ease-out");else H.style.top=`${f}px`;this.pos=$}getPosition(){if(!this.windowContainer)return"";let $=this.windowContainer.style;return`${Number.parseFloat($.left)} ${Number.parseFloat($.top)}`}}var W=J$;class e extends u{static hydrate($){x("MediaPlayer",$.querySelectorAll(".media"),this)}constructor($){super($);let h=$.querySelector("a.popout"),H=$.querySelector("a.inline"),L=$.querySelector(".movie");if(!L)return;h?.addEventListener("click",(f)=>{f.preventDefault(),new W({title:h.href,content:L.innerHTML}).render()}),H?.addEventListener("click",(f)=>{f.preventDefault(),L.style.display="block"})}}class $$ extends u{static hydrate($){x("PageList",$.querySelectorAll(".pages"),this)}constructor($){super($);$.addEventListener("wheel",(h)=>this.wheel(h))}wheel($){$.preventDefault();let h=Math.sign($.deltaY),H=Array.from(this.element.querySelectorAll("a")),L=Number.parseInt(H[1].innerHTML,10),f=Number.parseInt(H.at(-1)?.innerHTML||"",10),T=H.length-2;if(h>0&&L+T<f||h<0&&L>2)for(let E=0;E<T;E+=1)H[E+1].href=H[E+1].href.replace(/\d+$/,`${E+L+h}`),H[E+1].innerHTML=`${L+E+h}`}}class h$ extends u{static hydrate($){x("Switch",$.querySelectorAll("input.switch"),this)}constructor($){super($);$.style.display="none";let h=Object.assign(document.createElement("button"),{type:"button",title:$.className,className:$.className}),H=()=>{h.style.backgroundPosition=$.checked?"top":"bottom"};H(),h.addEventListener("click",()=>{$.checked=!$.checked,H(),$.dispatchEvent(new Event("change"))}),W$(h,$)}}var A$="active";class H$ extends u{static hydrate($){x("Tabs",$.querySelectorAll(".tabs"),this)}constructor($){super($);$.addEventListener("click",(h)=>this.click(h))}click($){let{tabSelector:h}=this.element.dataset,{target:H}=$;if(!H||!(H instanceof HTMLElement)||H.tagName.toLowerCase()!=="a")return;let L=H;if(h){let T=H.closest(h);if(T)L=T}let f=this.element.querySelector(`.${A$}`);if(f)f.classList.remove(A$);L.className=A$,L.blur()}}function S($){I(),[k,v,i,w,d,t,l,s,C,m,a,n,e,$$,h$,H$].forEach((h)=>{h.hydrate($)})}class X${soundCache={};load($,h,H){let L=this.soundCache[$];if(L){if(H)this.play($);return}L=new Audio,this.soundCache[$]=L,L.autoplay=!!H,L.src=h}play($){this.soundCache[$].play()}loadAndPlay($,h){this.load($,h,!0)}}var K=new X$;var c={loadscript($){document.body.appendChild(Object.assign(document.createElement("script"),{src:$}))},script($){(0,eval)($)},error($){G.error($)},success($){G.success($)},reload($=0){setTimeout(()=>globalThis.location.reload(),$)},refreshdata(){RUN.stream.pollData(!0)},addclass($,h){let H=document.querySelector($);if(H)H.classList.add(h)},title($){document.title=$},update($,h,H){let L=$,f=Array.from(document.querySelectorAll(".path"));if(L==="path"&&f.length>1){f.forEach((M)=>{M.innerHTML=h,S(M)});return}if(!/^\W/.test(L))L=`#${L}`;let T=document.querySelector(L);if(!T)return;T.innerHTML=h;let E=T.querySelector("[autofocus]");if(E)E.focus();if(H)F$(T);S(T)},removeel($){let h=document.querySelector($);if(h)h.remove()},back(){globalThis.history.back()},setstatus($){let h=document.querySelector("#status");if(h)h.className=$},appendrows($,h){let H=document.querySelector($);if(!H)return;let L=document.createElement("span");L.innerHTML=`<table>${h}</table>`;let f=L.getElementsByTagName("tbody")[0];S(f),H.appendChild(f)},location($){if(["?","/"].includes($.charAt(0))){RUN.stream.location($);return}document.location=$},enable($){let h=document.querySelector(`#${$}`);if(h)h.disabled=!1},addshout($){let h=Array.from(document.querySelectorAll("#shoutbox .shout")),H=document.createElement("span");H.innerHTML=$;let L=H.firstElementChild;if(!L)return;h[0].parentNode?.insertBefore(L,h[0]);while(h.length>globalSettings.shoutLimit-1)h.pop()?.remove();if(F$(L),globalSettings.soundShout)K.play("sbblip");S(L)},tick($){let h=document.querySelector("#ticker");if(!h)return;let H=document.createElement("div");H.innerHTML=$,H=H.firstElementChild,h.insertBefore(H,h.firstChild);let L=Array.from(h.querySelectorAll(".tick"));for(let f=100;f<L.length;f+=100)L[f].remove()},im($,h,H,L,f){p$({fromId:$,fromName:h,message:H,fromMe:L,timestamp:f})},imtoggleoffline($){document.querySelector(`#im_${$}`)?.classList.add("offline")},window($){if($.id&&document.getElementById($.id))return;let H=new W($);S(H.render())},closewindow($){let h=document.querySelector($+" [data-action=close]");if(h)h.click()},onlinelist($){let h=document.querySelector("#statusers");if(!h)return;$.forEach((H)=>{let L=document.querySelector(`#statusers .user${H.uid}`);if(!L)L=document.createElement("a"),L.addEventListener("click",function(){if(this.href)RUN.stream.location(this.href)}),L.addEventListener("mouseover",function(){J(this)});if(H.profileURL)L.href=H.profileURL;if(L.innerHTML=H.name,L.className=[`user${H.uid}`,`mgroup${H.groupID}`,H.status,`lastAction${H.lastAction}`].join(" "),H.locationVerbose)L.title=H.locationVerbose;if(H.status==="idle"){x$(L);return}if(h.firstChild)h.insertBefore(L,h.firstChild);else h.appendChild(L)})},snow($){O($)},setoffline($){let h=document.querySelector("#statusers");$.split(",").forEach((L)=>{let f=document.querySelector(`#statusers .user${L}`);if(f&&h)f.remove()})},async scrollToPost($){let h=document.getElementById(`pid_${$}`);if(!h)return!1;await R(Array.from(document.querySelectorAll("#page img")));let H=B(h);return globalThis.scrollTo({top:H.y}),!0},updateqreply($){let H=document.querySelector("#qreply")?.querySelector("textarea");if(H)H.focus(),H.value+=$,H.dispatchEvent(new Event("input"))},newmessage($,h){let H=document.querySelector("#notification"),L=document.querySelector("#num-messages");if(L)L.innerHTML=`${Number.parseInt(L.innerHTML,10)+1}`;if(!H)H=document.createElement("div"),H.id="notification",document.body.appendChild(H);H.style.display="",H.className="newmessage",H.addEventListener("click",()=>{H.style.display="none",RUN.stream.location(`/ucp/inbox?view=${h}`,3)}),H.innerHTML=$},playsound($,h){K.loadAndPlay($,h)},listrating($,h){let H=document.querySelector(`#postrating_${$}`),L;if(H){if(H.style.display!=="none"){Q(H,[{height:"200px"},{height:"0px"}],300).then((f)=>f.style.display="none");return}H.style.display="block"}else{H=document.createElement("div"),H.className="postrating_list",H.id=`postrating_${$}`;let f=document.querySelector(`#pid_${$} .postrating`);if(!f)return;L=B(f),H.style.top=`${L.yh}px`,H.style.left=`${L.x}px`,document.querySelector("#page")?.appendChild(H)}H.innerHTML=h,Q(H,[{height:"0px"},{height:"200px"}],300)}};var C$,Y="",g$="";function B$(){if(Y)document.title=Y;Y="",clearInterval(C$)}function k$($){if(document.hasFocus())return;if(B$(),!Y)Y=document.title;g$=$,C$=setInterval(()=>{document.title=document.title===Y?g$:Y},1000)}function Lh($,h){if(k$(`New message from ${$}!`),!document.hasFocus()&&globalThis.Notification&&Notification.permission==="granted"){let H=new Notification(`${$} says:`,{body:h});H.onclick=()=>{globalThis.focus(),H.close()}}}function fh({fromId:$,fromName:h,message:H}){let L=document.querySelector(`#im_${$} .ims`);if(L)return L;let T=new W({title:`${h}`,content:`
        <div class='ims'></div>
        <div class='offline'>This user may be offline</div>
        <div>
            <form data-ajax-form='resetOnSubmit' method='post'>
                <input type='hidden' name='im_uid' value='${$}'>
                <input type='text' name='im_im' autocomplete='off'>
            </form>
        </div>
    `,className:"im",resize:".ims",animate:!0,id:`im_${$}`}).render();S(T);let E=()=>{T.querySelector('form input[name="im_im"]')?.focus()};T.addEventListener("click",E),E(),L=T.querySelector(".ims");let M=getComputedStyle(L);if(L.style.width=M.width,L.style.height=M.height,H&&globalSettings.soundIM)K.play("imnewwindow");return L}function G$($,h){if(!globalSettings.canIM){alert("You do not have permission to use this feature.");return}c.im($,h,"",1,Date.now())}function p$({fromId:$,fromName:h,message:H,fromMe:L,timestamp:f}){Lh(h,H);let T=fh({fromId:$,fromName:h,message:H});if(!H)return;let E=H.startsWith("/me");if(!L)document.querySelector(`#im_${$}`)?.classList.remove("offline");let M=_(`
    <div class="${E?"action":""} ${L?"you":"them"}" data-timestamp="${f}">
      <a href="/profile/${L||$}" class="name">${E?"***"+h:h}</a>
      ${E?H.substring(3):": "+H}
    </div>
  `);if(T.appendChild(M),S(M),T.scrollTop>T.scrollHeight-T.clientHeight-50)T.scrollTop=T.scrollHeight;if(globalSettings.soundIM)K.play("imbeep")}function Th($){let h=$?$.split(","):[],H=h.length===1?"":"s",L=h.length?" and <br>":"";return[h,H,L]}function Eh($){let h=$?$.split(","):[],L=(h?h.length:0)===1?"":"s";return[h,L]}class L${whichone=0;boundCheckLocation;pids=[];tids=[];modb;constructor(){this.boundCheckLocation=()=>this.checkLocation(),Object.assign(c,{modcontrols_clearbox:this.destroyModControls.bind(this),modcontrols_move:this.showMoveControls.bind(this),modcontrols_postsync:this.postSync.bind(this)})}checkLocation(){let{whichone:$}=this,H=($?/topic\/(\d+)/:/forum\/(\d+)/).exec(document.location.toString());if(H)this.moveTo(Number(H[1]));else this.showMoveControls($)}moveTo($){let{whichone:h}=this;this.renderModControls(`<form method="post" action="/modcontrols" data-ajax-form="true">
                move ${h?"posts":"topics"} here?
            <input type="hidden"
                name="${h?"dop":"dot"}"
                value="moveto">
            <input type="hidden" name="id" value="${$}">
            <input type="submit" value="Yes">
            <input type="submit" name="cancel" value="Cancel" onclick="this.form.submitButton=this">
            </form>`)}renderModControls($){if(this.modb=this.modb||document.querySelector("#modbox")||void 0,!this.modb)this.modb=document.createElement("div"),this.modb.id="modbox",document.body.appendChild(this.modb);this.modb.style.display="block",this.modb.innerHTML=$,S(this.modb)}destroyModControls(){if(globalThis.removeEventListener("pushstate",this.boundCheckLocation),this.modb)this.modb.innerHTML="",this.modb.style.display="none"}togbutton($){$.classList.toggle("selected")}postSync($,h){let[H,L,f]=Th($),[T,E]=Eh(h);if(this.tids=T,this.pids=H,!T.length&&!H.length){this.destroyModControls();return}let M=T.length?`
            <select name="dot">
                <option value="delete">Delete</option>
                <option value="merge">Merge</option>
                <option value="move">Move</option>
                <option value="pin">Pin</option>
                <option value="unpin">Unpin</option>
                <option value="lock">Lock</option>
                <option value="unlock">Unlock</option>
            </select> &nbsp; &nbsp;
            <strong>${T.length}</strong> topic${E}${f}`:"",F=H.length?`
            <select name="dop">
                <option value="delete">Delete</option>
                <option value="move">Move</option>
            </select> &nbsp; &nbsp;
            <strong>${H.length}</strong> post${L}`:"",b=H.length&&T.length?"<br>":" &nbsp; &nbsp; ",A=`
        <form method="post" action="/modcontrols" data-ajax-form="true">
            ${M}
            ${F}
            ${b}
            <input type="submit" value="Go">
            <input
                name="cancel" type="submit"
                onclick="this.form.submitButton=this;" value="Cancel">
        </form>`;this.renderModControls(A)}showMoveControls($){this.whichone=$,globalThis.addEventListener("pushstate",this.boundCheckLocation),this.renderModControls(`Ok, now browse to the ${this.whichone?"topic":"forum"} you want to move the ${this.whichone?`${this.pids.length} posts`:`${this.tids.length} topics`} to...`)}}function Mh(){new W({title:"Keyboard Shortcuts",id:"shortcuts",content:`
      <style>
        #shortcuts { width: 300px; }
        #shortcuts dt { float: left;margin-left: 5px;}
      </style>
      <h3>Navigation</h3>
      <dl>
        <dt>?</dt><dd>This help window</dd>
        <dt>h</dt><dd>Home / Board Index</dd>
        <dt>i</dt><dd>Inbox</dd>
        <dt>s</dt><dd>Settings</dd>
        `+(globalSettings.isAdmin?"<dt>a</dt><dd>Admin CP</dd>":"")+(globalSettings.isMod?"<dt>m</dt><dd>Moderator CP</dd>":"")+`</dl>

      <h3>Inbox</h3>
      <dl>
        <dt>c</dt><dd>Compose</dd>
        <dt>i</dt><dd>Inbox</dd>
        <dt>f</dt><dd>Flagged Messages</dd>
        <dt>r</dt><dd>Reply to Message</dd>
      </dl>

      <h3>Forum/Topic</h3>
      <dl>
        <dt>t</dt><dd>New Topic</dd>
        <dt>r</dt><dd>Reply</dd>
      </dl>
      `}).render()}function r$($){if($.target instanceof HTMLInputElement||$.target instanceof HTMLTextAreaElement||$.target instanceof HTMLSelectElement)return;if($.key==="?"){Mh();return}document.documentElement.querySelector(`[data-shortcut="${$.key}"]`)?.click()}var uh=5000;class f${commands;lastURL;timeout;constructor(){this.lastURL=`${document.location.pathname}${document.location.search}`,this.commands=c}handleRequestData($,h,H=1){let L=!1;if(h.forEach(([f,...T])=>{if(f==="preventNavigation")L=!0;else if(f in this.commands)this.commands[f].apply(null,T)}),H>=2){if(!L)globalThis.history.pushState({lastURL:$},"",$),globalThis.dispatchEvent(new Event("pushstate")),this.lastURL=$}this.pollData()}location($,h=2){this.load($,{requestType:h})}async load($,{body:h,method:H="POST",requestType:L=1}={}){try{let f=await fetch($,{method:H,body:h,headers:{"X-JSACCESS":`${L}`,"Content-Type":"application/x-www-form-urlencoded"}});if(f.ok){let T=await f.json();this.handleRequestData($,T,L);return}G.error("An unrecoverable error has occurred.<br>Please try again later.")}catch(f){if(!navigator.onLine)G.error("You appear to be offline.");else G.error("Network fetch failed: timeout")}}pollData($=!1){if($)this.load(this.lastURL);if(clearTimeout(this.timeout),document.cookie.includes(`actw=${window.name}`))this.timeout=setTimeout(()=>this.load(this.lastURL),uh)}updatePage($){if($!==this.lastURL)this.location($,3)}}var xh=2;class i${stream=new f$;onAppReady(){if(xh)S(document.body);let $=new Date;if($.getMonth()===11&&[23,24,25].includes($.getDate()))O();I(),setInterval(I,30000),this.stream.pollData(),globalThis.addEventListener("popstate",({state:H})=>{if(H){let{lastURL:L}=H;this.stream.updatePage(L)}else this.stream.updatePage(document.location.toString())}),K.load("sbblip","/Sounds/blip.mp3",!1),K.load("imbeep","/Sounds/receive.mp3",!1),K.load("imnewwindow","/Sounds/receive.mp3",!1)}handleQuoting($){let h=new URLSearchParams($.search),H=h.get("quote");if(H){let L=document.querySelector(`#pid_${H} .post_content`),f=window.getSelection();if(L&&f&&L.contains(f.anchorNode)&&L.contains(f.focusNode))h.set("quotedText",f.toString())}h.set("qreply",document.querySelector("#qreply")?"1":"0"),this.stream.load(`${$.pathname}?${h.toString()}`)}setWindowActive(){document.cookie=`actw=${window.name}; SameSite:Lax`,B$(),this.stream.pollData()}}var T$=new i$;y(()=>{T$.onAppReady()});y(()=>{window.name=`${Math.random()}`,T$.setWindowActive(),globalThis.addEventListener("focus",()=>{T$.setWindowActive()})});y(function(){if(!U$())document.documentElement.classList.add("no-emoji");document.documentElement.classList.add("js-enabled")});y(()=>{globalThis.addEventListener("keyup",r$)});var v$=T$;Object.assign(globalThis,{RUN:v$,IMWindow:G$,ModControls:new L$});

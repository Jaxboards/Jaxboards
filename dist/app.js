"use strict";(()=>{var me=-1,x="",ue="";function U(){x&&(document.title=x),x="",clearInterval(me)}function he(s){document.hasFocus()||(U(),x||(x=document.title),ue=s,me=setInterval(()=>{document.title=document.title===x?ue:x},1e3))}function pe(s,e){if(!s)return"";if(Array.isArray(s)){if(!e)throw new Error("Invalid arguments for buildQueryString. Received array and undefined");return s.map((t,n)=>`${encodeURIComponent(t)}=${encodeURIComponent(e[n]||"")}`).join("&")}return Object.keys(s).map(t=>`${encodeURIComponent(t)}=${encodeURIComponent(s[t]||"")}`).join("&")}var Y=class{setup={readyState:4,method:"POST"};constructor(e={}){Object.assign(this.setup,e)}load(e,{callback:t,data:n,method:i="POST",requestType:o=1}={}){let l=null;n&&Array.isArray(n)?l=pe(n[0],n[1]):n&&typeof n!="string"&&(l=pe(n));let r=new XMLHttpRequest;return t&&(this.setup.callback=t),r.onreadystatechange=()=>{r.readyState===this.setup.readyState&&this.setup.callback?.(r)},r.open(i,e,!0),Object.assign(r,{url:e,requestType:o}),i&&r.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),r.setRequestHeader("X-JSACCESS",`${o}`),r.send(l),r}},M=Y;function f(s){return window.getComputedStyle(s)}function p(s){let{x:e,y:t,height:n,width:i}=s.getBoundingClientRect(),o=e+window.scrollX,l=t+window.scrollY;return{x:o,y:l,yh:l+n,xw:o+i,w:i,h:n}}function fe(s,e){return e.contains(s)}function j(s,e){s.remove(),e.parentNode?.insertBefore(s,e)}function F(s,e){s.remove(),e.parentNode?.insertBefore(s,e.nextSibling)}function b(){return Array.from(document.querySelectorAll("*")).reduce((t,n)=>n.style.zIndex&&Number(n.style.zIndex)>t?Number(n.style.zIndex):t,0)+1}var ge="valid",Ne="invalid",A=class{element;action;outputElement;indicatorElement;static selector(e){e.querySelectorAll("input[data-autocomplete-action]").forEach(t=>new this(t))}constructor(e){this.element=e,e.autocomplete="off",this.action=e.dataset.autocompleteAction;let t=e.dataset.autocompleteOutput,n=e.dataset.autocompleteIndicator,i=t?document.querySelector(t):void 0;if(!i)throw new Error("Expected element to have data-autocomplete-output");this.outputElement=i||document.createElement("input"),this.indicatorElement=n?document.querySelector(n):void 0,e.addEventListener("keyup",o=>this.keyUp(o)),e.addEventListener("keydown",o=>{o.key==="Enter"&&o.preventDefault()})}getResultsContainer(){let e=p(this.element),t=document.querySelector("#autocomplete");return t||(t=Object.assign(document.createElement("div"),{id:"autocomplete"}),Object.assign(t.style,{zIndex:b()}),document.body.appendChild(t)),Object.assign(t.style,{top:`${e.yh}px`,left:`${e.x}px`,width:`${e.w}px`}),t}keyUp(e){let t=this.getResultsContainer(),n=Array.from(t.querySelectorAll("div")),i=n.findIndex(a=>a.classList.contains("selected"));if(n)switch(e.key){case"ArrowUp":i>=0&&(n[i].classList.remove("selected"),n[i-1].classList.add("selected"));return;case"ArrowDown":i===-1?n[0].classList.add("selected"):i<n.length-1&&(n[i].classList.remove("selected"),n[i+1].classList.add("selected"));return;case"Enter":i>=0&&n[i].dispatchEvent(new Event("click"));return;default:this.indicatorElement&&(this.indicatorElement.classList.remove(ge),this.indicatorElement.classList.add(Ne));break}let o=document.location.toString().match("/ACP/")?"../":"",l=encodeURIComponent(this.element.value),r=`act=${this.action}&term=${l}`;new M().load(`${o}api/?${r}`,{callback:a=>{let d=JSON.parse(a.responseText);if(t.innerHTML="",!d.length)t.style.display="none";else{t.style.display="";let[c,m]=d;c.forEach((h,u)=>{let L=m[u],w=document.createElement("div");w.innerHTML=L,w.onclick=()=>{t.style.display="none",this.indicatorElement&&this.indicatorElement.classList.add(ge),this.outputElement.value=`${h}`,this.outputElement.dispatchEvent(new Event("change")),this.element.value=L},t.appendChild(w)})}}})}};var X=class{rgb;constructor(e){let t=e;if(typeof t=="object"){this.rgb=t;return}if(typeof t=="string"){let n=t.match(/^rgb\((\d+),\s?(\d+),\s?(\d+)\)/i),i=t.match(/#?[^\da-fA-F]/);if(n){n.shift(),this.rgb=[Number.parseFloat(n[1]),Number.parseFloat(n[2]),Number.parseFloat(n[3])];return}if(i){if(t.charAt(0)==="#"&&(t=t.slice(1)),t.length===3&&(t=t.charAt(0)+t.charAt(0)+t.charAt(1)+t.charAt(1)+t.charAt(2)+t.charAt(2)),t.length!==6){this.rgb=[0,0,0];return}this.rgb=[];for(let o=0;o<3;o+=1)this.rgb[o]=Number.parseInt(t.slice(o*2,(o+1)*2),16)}}this.rgb=[0,0,0]}invert(){return this.rgb=[255-this.rgb[0],255-this.rgb[1],255-this.rgb[2]],this}toRGB(){return this.rgb}toHex(){return this.rgb.map(e=>e.toString(16).padStart(2,"0")).join("")}},$=X;var J=class{el;delay;steps;interval;curLineup;stepCount;loop;lineup;constructor(e,t=30,n=20,i=0){this.el=e,this.steps=t,this.delay=n,this.curLineup=0,this.stepCount=0,this.loop=i,this.lineup=[[]]}play(){return this.interval=setInterval(()=>this.step(),this.delay),this}morph(e,t,n){return Array.isArray(e)&&e.length===n.length?e.map((i,o)=>Math.round(this.morph(i,t,n[o]))):(n-e)*t+e}step(){let e=this.lineup[this.curLineup];this.stepCount+=1;let t=this.stepCount;typeof e[0]=="function"?(e[0](this.el),t=this.steps):e.forEach(n=>{let i=this.morph(n[1],t/this.steps,n[2]);n[0].match(/color/i)?i=`#${new $(i).toHex()}`:n[0]!=="opacity"&&(i=Math.round(i)),this.el.style[n[0]]=n[3]+i+n[4]}),t===this.steps&&(this.lineup.length-1>this.curLineup?(this.stepCount=0,this.curLineup+=1):this.loop===1?(this.stepCount=0,this.curLineup=0):clearInterval(this.interval))}add(e,t,n){let i=["","",""],o;return e.match(/color/i)?(o=new $(t).toRGB(),i[1]=new $(n).toRGB()):(i=n.match(/(\D*)(-?\d+)(\D*)/),i.shift(),o=Number.parseFloat(t.match(/-?\d+/)?.[0]??"")),this.lineup[this.lineup.length-1].push([e,o,i[1],i[0],i[2]]),this}dehighlight(){this.el.style.backgroundColor="";let e=f(this.el).backgroundColor;this.el.classList.add("highlight");let t=f(this.el).backgroundColor;return t===e&&(t="FF0"),this.el.classList.add("highlight"),!t||!e?this:this.add("backgroundColor",t,e).andThen(()=>{this.el.style.backgroundColor=e})}andThen(e,t=void 0,n=void 0,i=void 0){return this.lineup.push([]),i&&(this.steps=i),typeof e=="function"?this.lineup[this.lineup.length-1].push(e):t!==void 0&&n!==void 0&&this.add(e,t,n),this}},g=J;var C=class{element;static selector(e){e.querySelectorAll(".collapse-box").forEach(t=>new this(t))}constructor(e){this.element=e,e.querySelector(".collapse-button")?.addEventListener("click",()=>this.click())}click(){let e=this.element.querySelector(".collapse-content");if(!e)return;let{style:t}=e,{fullHeight:n}=e.dataset,i=this.element;t.overflow="hidden",t.height==="0px"&&n?new g(e,5,10,0).add("height","0px",n).andThen(()=>{i.classList.remove("collapsed")}).play():(n||(n=`${e.clientHeight||e.offsetHeight}px`,e.dataset.fullHeight=n),new g(e,5,10,0).add("height",n,"0px").andThen(()=>{i.classList.add("collapsed")}).play())}};function De(s){let e=s.getHours()||12,t=`${s.getMinutes()}`.padStart(2,"0");return`${e%12||12}:${t}${e>12?"pm":"am"}`}function Z(s){return new Date(s*1e3)}var ye=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],be=["January","February","March","April","May","June","July","August","September","October","November","December"];function qe(s){return s[0].toUpperCase()+s.slice(1)}function _(s){let e=new Date,t=new Intl.RelativeTimeFormat(void 0,{numeric:"auto",style:"long"}),n=new Date;n.setTime(+n-1e3*60*60*24),n.setHours(0),n.setMinutes(0),n.setSeconds(0);let i=Z(s),o=Math.round((+i-+e)/1e3);if(o>-60)return t.format(o,"second");if(o>-3600)return t.format(Math.round(o/60),"minute");if(i>n){let l=new Date;return l.setHours(0),l.setMinutes(0),l.setSeconds(0),`${qe(t.format(i>l?0:-1,"day"))} @ ${De(i)}`}return Intl.DateTimeFormat(void 0,{month:"short",year:"numeric",day:"numeric",hour:"numeric",hour12:!0,minute:"numeric"}).format(i)}function V(s){let e=Z(s),t=e.getHours(),n=t>=12?"pm":"am";t%=12,t=t||12;let i=`${e.getMinutes()}`.padStart(2,"0"),o=e.getMonth()+1,l=`${e.getDate()}`.padStart(2,"0"),r=e.getFullYear();return`${t}:${i}${n}, ${o}/${l}/${r}`}function G(s){let e=Z(s);return String.fromCodePoint(55357,56656+((e.getHours()%12||12)-1)+(e.getMinutes()>29?12:0))}function B(s){let e=Array.from(s.classList).find(t=>t.startsWith("lastAction"));e!==void 0&&(s.prepend(G(Number.parseInt(e.slice(10),10))),s.classList.remove(e))}function H(s,e=2e3){return new Promise(t=>{let n=new Set,i=Array.from(s).filter(l=>!l.complete);if(!i.length){t();return}function o(){n.delete(this.src),n.size===0&&t()}i.forEach(l=>{n.has(l.src)||(n.add(l.src),l.addEventListener("error",o),l.addEventListener("load",o))}),e&&setTimeout(t,e)})}function k(){let s=document.querySelectorAll(".autodate"),e=Array.from(document.querySelectorAll("[data-timestamp]"));s&&(s.forEach(t=>{let n=Number.parseInt(t.getAttribute("title")??"",10),i=t.classList.contains("smalldate")?V(n):_(n);i!==t.innerHTML&&(t.innerHTML=i)}),e.forEach(t=>{t.title||(t.title=V(Number.parseInt(t.dataset.timestamp??"",10)))}))}function Q(s){document.readyState==="complete"?s():document.addEventListener("DOMContentLoaded",s)}function Ee(){let s=document.createElement("input");return s.setAttribute("type","date"),s.type==="date"}function we(){let s=[String.fromCodePoint(9757,127999),String.fromCodePoint(9757)].map(e=>{let t=document.body.appendChild(document.createElement("span"));t.appendChild(document.createTextNode(e));let n=t.offsetWidth;return t.remove(),n});return s[0]===s[1]}var I=class{picker;element;selectedDate;lastDate;static selector(e){Ee()||e.querySelectorAll("input[type=date]").forEach(t=>new this(t))}constructor(e){this.element=e,this.picker=this.getPicker(),e.autocomplete="off",e.addEventListener("focus",()=>this.openPicker()),e.addEventListener("keydown",()=>this.closePicker())}getPicker(){if(this.picker)return this.picker;let e=document.querySelector("#datepicker");return e||(e=Object.assign(document.createElement("table"),{id:"datepicker"}),document.body.appendChild(e),e.style.display="none"),e}openPicker(){let e=p(this.element);Object.assign(this.picker.style,{display:"",zIndex:b(),position:"absolute",top:`${e.yh}px`,left:`${e.x}px`});let[t,n,i]=this.element.value.split("/").map(o=>Number.parseInt(o,10));t&&n&&i?this.selectedDate=[i,t-1,n]:this.selectedDate=void 0,this.generate(i,t,n)}closePicker(){this.picker.style.display="none"}generate(e,t,n){let i=new Date,o=this.getPicker(),l,r,[a,d,c]=[e,t,n];a===void 0&&(a=i.getFullYear(),d=i.getMonth(),c=i.getDate(),this.selectedDate=[a,d,c]),d===-1&&(a-=1,d=11),d===12&&(a+=1,d=0),this.lastDate=[a,d,c];let m=new Date(a,d+1,0).getDate(),h=new Date(a,d,1).getDay();o.innerHTML="",l=o.insertRow(0),r=l.insertCell(0),r.innerHTML="&lt;",r.className="control",r.onclick=()=>this.lastYear(),r=l.insertCell(1),r.colSpan=5,r.className="year",r.innerHTML=`${a}`,r=l.insertCell(2),r.innerHTML=">",r.className="control",r.onclick=()=>this.nextYear(),l=o.insertRow(1),r=l.insertCell(0),r.innerHTML="<",r.className="control",r.onclick=()=>this.lastMonth(),r=l.insertCell(1),r.colSpan=5,r.innerHTML=be[d],r.className="month",r=l.insertCell(2),r.innerHTML=">",r.className="control",r.onclick=()=>this.nextMonth(),l=o.insertRow(2),l.className="weekdays";for(let u=0;u<7;u+=1)l.insertCell(u).innerHTML=ye[u];l=o.insertRow(3);for(let u=0;u<m;u+=1){if(!u)for(let w=0;w<h;w+=1)l.insertCell(w);(h+u)%7===0&&(l=o.insertRow(o.rows.length)),r=l.insertCell((h+u)%7),r.onclick=this.insert.bind(this,r);let L=!!this.selectedDate&&a===this.selectedDate[0]&&d===this.selectedDate[1]&&u+1===this.selectedDate[2];r.className=`day${L?" selected":""}`,r.innerHTML=`${u+1}`}}lastYear(){let e=this.lastDate;e&&this.generate(e[0]-1,e[1],e[2])}nextYear(){let e=this.lastDate;e&&this.generate(e[0]+1,e[1],e[2])}lastMonth(){let e=this.lastDate;e&&this.generate(e[0],e[1]-1,e[2])}nextMonth(){let e=this.lastDate;e&&this.generate(e[0],e[1]+1,e[2])}insert(e){let t=this.lastDate;t&&(this.element.value=`${t[1]+1}/${e.innerHTML}/${t[0]}`),this.closePicker()}};var Re=["SCRIPT","STYLE","HR"],ze=/text-align: ?(right|center|left)/i,We=/background(-color)?:[^;]+(rgb\([^)]+\)|#\s+)/i,Pe=/font-style: ?italic/i,je=/text-decoration:[^;]*underline/i,Fe=/text-decoration:[^;]*line-through/i,_e=/font-size: ?([^;]+)/i,Be=/color: ?([^;]+)/i,Oe=/font-weight: ?bold/i;function K(s){let e=s,t=/<(\w+)([^>]*)>([^]*?)<\/\1>/gi;return e=e.replaceAll(/[\r\n]+/g,""),e=e.replaceAll(/<(hr|br|meta)[^>]*>/gi,`
`),e=e.replaceAll(/<img.*?src=["']?([^'"]+)["'](?: alt=["']?([^"']+)["'])?[^>]*\/?>/g,(n,i,o)=>o||`[img]${i}[/img]`),e=e.replaceAll(t,(n,i,o,l)=>{let r=t.test(l)?K(l):l,a={};o.replaceAll(/(color|size|style|href|src)=(['"]?)(.*?)\2/gi,(Ke,ke,et,Ie)=>(a[ke]=Ie,""));let{style:d=""}=a,c=i.toLowerCase();if(Re.includes(c))return"";let m=ze.exec(d),h=We.exec(d),u=Pe.exec(d),L=je.exec(d),w=Fe.exec(d),ce=_e.exec(d),de=Be.exec(d),Ce=Oe.exec(d);return h&&(r=`[bgcolor=#${new $(h[2]).toHex()}]${r}[/bgcolor]`),m&&(r=`[align=${m[1]}]${r}[/align]`),(u||c==="i"||c==="em")&&(r=`[I]${r}[/I]`),(L||c==="u")&&(r=`[U]${r}[/U]`),(w||c==="s"||c==="strike")&&(r=`[S]${r}[/S]`),(Ce||c==="strong"||c==="b")&&(r=`[B]${r}[/B]`),(a.size||ce)&&(r=`[size=${a.size||ce?.[1]}]${r}[/size]`),(a.color||de)&&(r=`[color=${a.color||de?.[1]}]${r}[/color]`),c==="a"&&a.href&&(r=`[url=${a.href}]${r}[/url]`),c==="ol"&&(r=`[ol]${r}[/ol]`),c==="ul"&&(r=`[ul]${r}[/ul]`),/h\d/i.test(c)&&(r=`[${c}]${r}[/${c}]`),c==="li"&&(r=`*${r.replace(/[\n\r]+/,"")}
`),c==="p"&&(r=`
${r==="&nbsp"?"":r}
`),c==="div"&&(r=`
${r}`),r}),e.replaceAll("&amp;","&").replaceAll("&gt;",">").replaceAll("&lt;","<").replaceAll("&nbsp;"," ")}function ee(s){let e=s.replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll(/(\s) /g,"$1&nbsp;");return e=e.replaceAll(/\[b\]([^]*?)\[\/b\]/gi,"<b>$1</b>"),e=e.replaceAll(/\[i\]([^]*?)\[\/i\]/gi,"<i>$1</i>"),e=e.replaceAll(/\[u\]([^]*?)\[\/u\]/gi,"<u>$1</u>"),e=e.replaceAll(/\[s\]([^]*?)\[\/s\]/gi,"<s>$1</s>"),e=e.replaceAll(/\[img\]([^'"[]+)\[\/img\]/gi,'<img src="$1">'),e=e.replaceAll(/\[color=([^\]]+)\](.*?)\[\/color\]/gi,'<span style="color:$1">$2</span>'),e=e.replaceAll(/\[size=([^\]]+)\](.*?)\[\/size\]/gi,'<span style="font-size:$1">$2</span>'),e=e.replaceAll(/\[url=([^\]]+)\](.*?)\[\/url\]/gi,'<a href="$1">$2</a>'),e=e.replaceAll(/\[bgcolor=([^\]]+)\](.*?)\[\/bgcolor\]/gi,'<span style="backgroun-color:$1">$2</span>'),e=e.replaceAll(/\[h(\d)\](.*?)\[\/h\1\]/g,"<h$1>$2</h$1>"),e=e.replaceAll(/\[align=(left|right|center)\](.*?)\[\/align\]/g,'<div style="text-align:$1">$2</div>'),e=e.replaceAll(/\[(ul|ol)\]([^]*?)\[\/\1\]/gi,(t,n,i)=>{let l=i.split(/(^|[\r\n]+)\*/).filter(r=>r.trim()).map(r=>`<li>${r}</li>`).join("");return`<${n}>${l}</${n}>`}),e=e.replaceAll(`
`,"<br />"),e}var{userAgent:v}=navigator,S={chrome:/chrome/i.test(v),ie:/msie/i.test(v),iphone:/iphone/i.test(v),mobile:/mobile/i.test(v),n3ds:/nintendo 3ds/.test(v),firefox:/firefox/i.test(v),safari:/safari/i.test(v)};function Le(s){if(!window.getSelection)return;let e=document.createRange();e.selectNode(s);let t=window.getSelection();t&&(t.rangeCount&&t.removeAllRanges(),t.addRange(e))}function xe(s,e){let t=s.scrollTop,n=s.selectionStart??0,i=s.selectionEnd??0;s.value=s.value.substring(0,n)+e+s.value.slice(i),s.selectionStart=n+e.length,s.selectionEnd=n+e.length,s.focus(),s.scrollTop=t}var Ue=/^(ht|f)tps?:\/\/[\w.\-%&?=/]+$/,Ye=s=>Ue.test(s),N=class{iframe;element;colorWindow;doc;htmlMode=!1;editbar;emoteWindow;window;static selector(e){e.querySelectorAll("textarea.bbcode-editor").forEach(t=>new this(t))}constructor(e){this.element=e,this.iframe=document.createElement("iframe"),this.iframe.addEventListener("load",()=>this.iframeLoaded()),this.iframe.style.display="none",F(this.iframe,e),e.closest("form")?.addEventListener("submit",()=>{this.submit()})}iframeLoaded(){let{iframe:e,element:t}=this;if(e.className="editorframe",this.htmlMode=S.mobile||S.n3ds?!1:globalSettings.wysiwyg,this.window=e.contentWindow||void 0,this.doc=e.contentWindow?.document,!this.doc)return;let n=f(t),i=this.doc.getElementsByTagName("body")[0];i&&n&&(i.style.backgroundColor=n.backgroundColor,i.style.color=n.color,i.style.borderColor="#FFF"),this.doc.designMode="on",this.editbar=this.buildEditBar(),e.style.height=`${t.clientHeight}px`,j(this.editbar,t),this.setSource("<div></div>"),setTimeout(()=>{this.setSource(ee(t.value)),this.switchMode(this.htmlMode)},100)}buildEditBar(){let e=document.createElement("div");e.className="editbar";let t=["bold","italic","underline","strikethrough","forecolor","backcolor","insertimage","createlink","c_email","justifyleft","justifycenter","justifyright","c_youtube","c_code","c_quote","c_spoiler","insertorderedlist","insertunorderedlist","c_smileys","c_switcheditmode"],n=["Bold","Italic","Underline","Strike-Through","Foreground Color","Background Color","Insert Image","Insert Link","Insert email","Align left","Center","Align right","Insert video from any of your favorite video services!","Insert code","Insert Quote","Insert Spoiler","Create Ordered List","Create Unordered List","Insert Emoticon","Switch editor mode"];for(let i=0;i<t.length;i+=1){let o=document.createElement("a");o.className=t[i],o.title=n[i],o.href="javascript:void(0)",o.onclick=l=>this.editbarCommand(l,t[i]),e.appendChild(o)}return e}editbarCommand(e,t){switch(e.preventDefault(),t){case"forecolor":case"backcolor":this.showColors(e.pageX,e.pageY,t);break;case"c_smileys":this.showEmotes(e.pageX,e.pageY);break;case"c_switcheditmode":this.switchMode(!this.htmlMode);break;default:this.cmd(t);break}}showEmotes(e,t){let n=this.emoteWindow;if(!n){new M().load("/api/?act=emotes",{callback:i=>this.createEmoteWindow(i,{x:e,y:t})});return}n.style.display==="none"?(n.style.display="",n.style.top=`${t}px`,n.style.left=`${e}px`):this.hideEmotes()}hideEmotes(){this.emoteWindow&&(this.emoteWindow.style.display="none")}createEmoteWindow(e,t){let[n,i]=JSON.parse(e.responseText),o=document.createElement("div");o.className="emotewin",n.forEach((l,r)=>{let a=i[r],d=document.createElement("a");d.href="javascript:void(0)",d.onclick=()=>{this.cmd("inserthtml",a),this.hideEmotes()},d.innerHTML=`${a} ${l}`,o.appendChild(d)}),o.style.position="absolute",o.style.display="none",this.emoteWindow=o,document.querySelector("#page")?.appendChild(o),this.showEmotes(t.x,t.y)}colorHandler(e,t){this.cmd(e,t),this.hideColors()}showColors(e,t,n){this.hideColors();let i=["#FFFFFF","#AAAAAA","#000000","#FF0000","#00FF00","#0000FF","#FFFF00","#00FFFF","#FF00FF"],o=i.length,l=Math.ceil(Math.sqrt(o)),r=document.createElement("table");Object.assign(r.style,{borderCollapse:"collapse",position:"absolute",top:`${t}px`,left:`${e}px`});for(let a=0;a<l;a+=1){let d=r.insertRow(a);for(let c=0;c<l;c+=1){let m=d.insertCell(c),h=i[c+a*l];if(!h)continue;m.style.border="1px solid #000",m.style.padding="0px";let u=document.createElement("a");u.href="javascript:void(0)",u.onclick=()=>this.colorHandler(n,h),m.appendChild(u),Object.assign(u.style,{display:"block",backgroundColor:h,height:"20px",width:"20px",margin:0})}}return this.colorWindow=r,document.querySelector("#page")?.appendChild(r),null}hideColors(){this.colorWindow&&(this.colorWindow.remove(),this.colorWindow=void 0)}cmd(e,t){let n,i=this.getSelection(),o="",l=e,r=t||"";switch(e.toLowerCase()){case"bold":o=`[b]${i}[/b]`;break;case"italic":o=`[i]${i}[/i]`;break;case"underline":o=`[u]${i}[/u]`;break;case"strikethrough":o=`[s]${i}[/s]`;break;case"justifyright":o=`[align=right]${i}[/align]`;break;case"justifycenter":o=`[align=center]${i}[/align]`;break;case"justifyleft":o=`[align=left]${i}[/align]`;break;case"insertimage":if(r=prompt("Image URL:")||"",!r)return;if(!Ye(r)){alert("Please enter a valid URL.");return}o=`[img]${r}[/img]`;break;case"insertorderedlist":this.htmlMode||(o=`[ol]${i.replaceAll(/(.+([\r\n]+|$))/i,"*$1")}[/ol]`);break;case"insertunorderedlist":this.htmlMode||(o=`[ul]${i.replaceAll(/(.+([\r\n]+|$))/i,"*$1")}[/ul]`);break;case"createlink":if(r=prompt("Link:")||"",!r)return;r.match(/^(https?|ftp|mailto):/)||(r=`https://${r}`),o=`[url=${r}]${i}[/url]`;break;case"c_email":if(r=prompt("Email:")||"",!r)return;l="createlink",r=`mailto:${r}`,o=`[url=${r}]${i}[/url]`;break;case"backcolor":(S.firefox||S.safari)&&(l="hilitecolor"),o=`[bgcolor=${r}]${i}[/bgcolor]`;break;case"forecolor":o=`[color=${r}]${i}[/color]`;break;case"c_code":l="inserthtml",r=`[code]${i}[/code]`,o=r;break;case"c_quote":l="inserthtml",r=prompt("Who said this?")||"",r=`[quote${r?`=${r}`:""}]${i}[/quote]`,o=r;break;case"c_spoiler":l="inserthtml",r=`[spoiler]${i}[/spoiler]`,o=r;break;case"c_youtube":if(l="inserthtml",r=prompt("Video URL?")||"",!r)return;r=`[video]${r}[/video]`,o=r;break;case"inserthtml":o=r;break;default:throw new Error(`Unsupported editor command ${e}`)}this.htmlMode?l==="inserthtml"&&S.ie?(n=this.doc?.selection.createRange(),n.text.length?(n.pasteHTML(r),n.collapse(!1),n.select()):this.doc.body.innerHTML+=r):(this.doc.execCommand(l,!1,r||!1),this.iframe.contentWindow.focus&&this.iframe.contentWindow.focus()):xe(this.element,o)}getSelection(){return this.htmlMode?this.window?.getSelection()?.toString()||"":this.element.value.substring(this.element.selectionStart,this.element.selectionEnd)}getSource(){return this.doc?.body.innerHTML}setSource(e){this.doc&&this.doc.body&&(this.doc.body.innerHTML=e)}switchMode(e){let{element:t,iframe:n}=this;e?(this.setSource(ee(t.value)),t.style.display="none",n.style.display=""):(t.value=K(this.getSource()||""),t.style.display="",n.style.display="none"),this.htmlMode=e}submit(){this.htmlMode&&(this.switchMode(!1),this.switchMode(!0))}};var D=class{element;index;images;max;static selector(e){e.querySelectorAll(".image_gallery").forEach(t=>new this(t))}constructor(e){this.element=e;let t=document.createElement("div"),n=document.createElement("button"),i=document.createElement("button");this.index=0,this.images=e.querySelectorAll("img"),this.max=Math.max(this.images.length,1),n.innerHTML="Next &raquo;",n.addEventListener("click",()=>{this.showNext()}),i.innerHTML="Prev &laquo;",i.addEventListener("click",()=>{this.showPrev()}),this.update(),t.appendChild(i),t.appendChild(document.createTextNode(" ")),t.appendChild(n),e.appendChild(t)}showNext(){this.index<this.max-1&&(this.index+=1),this.update()}showPrev(){this.index>0&&(this.index-=1),this.update()}update(){this.images.forEach((e,t)=>{let n=e.dataset.madeResized?e.parentNode:e;n&&(n.style.display=t!==this.index?"none":"block")})}};var te=class{sess;boundEvents;droppables;noChild=!1;bounds;onstart;ondragover;ondrag;ondragout;ondrop;autoZIndex=!0;constructor(){this.droppables=[],this.sess={el:document.body,mx:0,my:0},this.boundEvents={drag:e=>this.drag(e),drop:()=>this.drop()}}start(e,t,n){e.preventDefault(),e.stopPropagation();let i=t||e.target,o=f(i),l=b();this.noChild&&e.target!==(n||i)||i.getAttribute("draggable")!=="false"&&(this.sess={el:i,mx:e.pageX,my:e.pageY,ex:Number.parseInt(o.left,10)||0,ey:Number.parseInt(o.top,10)||0,info:{el:i,mx:0,my:0},zIndex:i.style.zIndex},(!this.sess.zIndex||Number(this.sess.zIndex)<l-1)&&(i.style.zIndex=`${l}`),this.onstart?.({...this.sess,droptarget:this.testDrops(this.sess.mx,this.sess.my)}),document.addEventListener("mousemove",this.boundEvents.drag),document.addEventListener("mouseup",this.boundEvents.drop),this.drag(e))}drag(e){e.stopPropagation();let t=this.sess.el.style,n=e.pageX,i=e.pageY,o=n,l=i,r,a=(this.sess.ex??0)+o-this.sess.mx,d=(this.sess.ey??0)+l-this.sess.my,c=this.bounds;c&&(a<c[0]?(o=o-a+c[0],[a]=c):a>c[0]+c[2]&&(a=c[0]+c[2]),d<c[1]?(l=l-d+c[1],[d]=c):d>c[1]+c[3]&&(d=c[1]+c[3])),t.left=`${a}px`,t.top=`${d}px`;let m=this.sess.info,h=m?.droptarget,u={left:a,top:d,el:this.sess.el,mx:o,my:l,dx:o-(m?.mx||o),dy:l-(m?.my||l),droptarget:this.testDrops(n,i)};this.sess.info=u,this.ondrag?.(u),u.droptarget&&h!==u.droptarget&&this.ondragover?.(u),h&&u.droptarget!==h&&(r=u.droptarget,u.droptarget=h,this.ondragout?.(u),u.droptarget=r)}boundingBox(e,t,n,i){return this.bounds=[e,t,n,i],this}drop(){return this.boundEvents&&(document.removeEventListener("mouseup",this.boundEvents.drop),document.removeEventListener("mousemove",this.boundEvents.drag)),this.ondrop?.(this.sess.info),this.autoZIndex&&(this.sess.el.style.zIndex=this.sess.zIndex??""),!0}testDrops(e,t){let{droppables:n}=this,i,o=[9999,9999];if(n.length)return n.findLast(l=>{if(!(l===this.sess.el||fe(l,this.sess.el))&&(i=p(l),o[0]>i.w&&o[1]>i.h&&e>=i.x&&t>=i.y&&e<=i.xw&&t<=i.yh))return o=[i.w,i.h],l})}drops(e){return this.droppables=e,this}addDrops(e){return this.droppables?(this.droppables=this.droppables.concat(e),this):this.drops(e)}addListener(e){return Object.assign(this,e),this}apply(e,t){if(Array.isArray(e))return e.forEach(o=>this.apply(o)),this;let i=f(e)?.position;return(!i||i==="static")&&(e.style.position="relative"),(t||e).onmousedown=t?o=>this.start(o,e,t):o=>this.start(o,e),this}autoZ(){return this.autoZIndex=!1,this}noChildActivation(){return this.noChild=!0,this}reset(e=this.sess.el){return e.style.top="0",e.style.left="0",this}},ne=te;var ie=class{title;wait;content;open;minimizable;resize;className;pos;zIndex;windowContainer;id;onclose;animate;oldpos;constructor(e={}){this.title="Title",this.wait=!0,this.title="Title",this.wait=!0,this.content="Content",this.open=!1,this.minimizable=!0,this.resize=void 0,this.className="",this.pos="center",this.zIndex=b(),this.animate=!1,Object.assign(this,e)}static close=function(t){let n=t;do{if("close"in n&&typeof n.close=="function"){n.close();break}n=n.parentElement}while(n)};create(){if(this.windowContainer)return this.windowContainer;let e=document.createElement("div"),t=document.createElement("div"),n=document.createElement("div"),i=document.createElement("div"),o=document.createElement("div"),l=document.createElement("div"),{pos:r}=this;this.windowContainer=e,this.id&&(e.id=this.id),e.className=`window${this.className?` ${this.className}`:""}`,t.className="title",n.className="content",this.minimizable&&(o.innerHTML="-",o.onclick=()=>this.minimize()),l.innerHTML="X",l.onclick=()=>this.close(),i.appendChild(o),i.appendChild(l),i.className="controls",t.innerHTML=this.title,n.innerHTML=this.content,t.appendChild(i),e.appendChild(t),e.appendChild(n);let a=()=>this.close();if(e.querySelectorAll("[data-window-close]").forEach(c=>{c.addEventListener("click",a)}),document.body.appendChild(e),this.resize){let c=e.querySelector(this.resize);if(!c)throw new Error("Resize target not found");c.style.width=`${c.clientWidth}px`,c.style.height=`${c.clientHeight}px`;let m=document.createElement("div");m.className="resize",e.appendChild(m),m.style.left=`${e.clientWidth-16}px`,m.style.top=`${e.clientHeight-16}px`,new ne().boundingBox(100,100,1/0,1/0).addListener({ondrag(h){let u=Number.parseFloat(c.style.width)+(h.dx??0),L=Number.parseFloat(c.style.height)+(h.dy??0);c.style.width=`${u}px`,u<e.clientWidth-20?c.style.width=`${e.clientWidth}px`:m.style.left=`${e.clientWidth-16}px`,c.style.height=`${L}px`},ondrop(){m.style.left=`${e.clientWidth-16}px`}}).apply(m),c.style.width=`${e.clientWidth}px`,m.style.left=`${e.clientWidth-16}px`}let d=e.style;return d.zIndex=`${this.zIndex+5}`,this.wait?H(Array.from(e.querySelectorAll("img"))).then(()=>{this.setPosition(r)}):this.setPosition(r),new ne().autoZ().noChildActivation().boundingBox(0,0,document.documentElement.clientWidth-50,document.documentElement.clientHeight-50).apply(e,t),Object.assign(e,{close:()=>this.close(),minimize:this.minimize})}close(){this.windowContainer&&(document.body.removeChild(this.windowContainer),this.windowContainer=void 0,this.onclose&&this.onclose())}minimize(){let e=this.windowContainer;if(!e)return;let t=e.classList.contains("minimized");if(e.classList.toggle("minimized"),t)e.removeAttribute("draggable"),this.setPosition(this.oldpos??"");else{e.setAttribute("draggable","false");let i=Array.from(document.querySelectorAll(".window")).reduce((o,l)=>l.classList.contains("minimized")?o+Number(l.clientWidth):o,0);this.oldpos=this.getPosition(),this.setPosition(`bl ${i} 0`,!1)}}setPosition(e,t=!1){let n=this.windowContainer;if(!n)return;let i=0,o=0,l=document.documentElement.clientHeight,r=document.documentElement.clientWidth,a=e.match(/(\d+) (\d+)/);switch(a&&(i=Number(a[1]),o=Number(a[2])),i=Math.floor(i),o=Math.floor(o),e.charAt(1)==="r"&&(i=r-i-n.clientWidth),e.charAt(0)){case"b":o=l-o-n.clientHeight;break;case"c":o=(l-n.clientHeight)/2,i=(r-n.clientWidth)/2;break;default:}i=Math.floor(i),o=Math.floor(o),i<0&&(i=0),o<0&&(o=0),n.style.left=`${i}px`,this.animate||t?new g(n,10).add("top",`${o-100}px`,`${o}px`).play():n.style.top=`${o}px`,this.pos=e}getPosition(){if(!this.windowContainer)return"";let e=this.windowContainer.style;return`tl ${Number.parseFloat(e.left)} ${Number.parseFloat(e.top)}`}},T=ie;var q=class{element;static selector(e){e.querySelectorAll(".media").forEach(t=>new this(t))}constructor(e){this.element=e;let t=e.querySelector("a.popout"),n=e.querySelector("a.inline"),i=e.querySelector(".movie");i&&(t?.addEventListener("click",o=>{o.preventDefault(),new T({title:t.href,content:i.innerHTML}).create()}),n?.addEventListener("click",o=>{o.preventDefault(),i.style.display="block"}))}};var R=class{element;static selector(e){e.querySelectorAll(".pages").forEach(t=>new this(t))}constructor(e){this.element=e,e.addEventListener("wheel",t=>this.wheel(t))}wheel(e){e.preventDefault();let t=Math.sign(e.deltaY),n=Array.from(this.element.querySelectorAll("a")),i=Number.parseInt(n[1].innerHTML,10),o=Number.parseInt(n[n.length-1].innerHTML,10),l=n.length-2;if(t>0&&i+l<o||t<0&&i>2)for(let r=0;r<l;r+=1)n[r+1].href=n[r+1].href.replace(/\d+$/,`${r+i+t}`),n[r+1].innerHTML=`${i+r+t}`}};var z=class{element;static selector(e){e.querySelectorAll("input.switch").forEach(t=>new this(t))}constructor(e){this.element=e,e.style.display="none";let t=Object.assign(document.createElement("button"),{type:"button",title:e.className,className:e.className}),n=()=>{t.style.backgroundPosition=e.checked?"top":"bottom"};n(),t.addEventListener("click",()=>{e.checked=!e.checked,n(),e.dispatchEvent(new Event("change"))}),F(t,e)}};var se="active",W=class{element;static selector(e){e.querySelectorAll(".tabs").forEach(t=>new this(t))}constructor(e){this.element=e,e.addEventListener("click",t=>this.click(t))}click(e){let{tabSelector:t}=this.element.dataset,{target:n}=e;if(!n||!(n instanceof HTMLElement)||n.tagName.toLowerCase()!=="a")return;let i=n;if(t){let l=n.closest(t);l&&(i=l)}let o=this.element.querySelector(`.${se}`);o&&o.classList.remove(se),i.className=se,i.blur()}};function Xe(s){let e=document.body,t=document.documentElement;switch(s.keyCode){case 13:s.ENTER=!0;break;case 37:s.LEFT=!0;break;case 38:s.UP=!0;break;case .39:s.RIGHT=!0;break;case 40:s.DOWN=!0;break;default:break}return typeof s.srcElement>"u"&&(s.srcElement=s.target),typeof s.pageY>"u"&&(s.pageY=s.clientY+(Number.parseInt(t.scrollTop||e.scrollTop,10)||0),s.pageX=s.clientX+(Number.parseInt(t.scrollLeft||e.scrollLeft,10)||0)),s.cancel=()=>(s.returnValue=!1,s.preventDefault&&s.preventDefault(),s),s.stopBubbling=()=>(s.stopPropagation&&s.stopPropagation(),s.cancelBubble=!0,s),s}var ve=Xe;var Te="999999px";function Je(s,e,t,n,i){i.style.maxWidth=Te,i.style.maxHeight=Te,i.dataset.madeResized="true";let o=document.createElement("a");o.target="newwin",o.href=i.src,o.style.display="block",o.style.overflow="hidden",o.style.width=`${s}px`,o.style.height=`${t}px`,o.dataset.nw=`${e}`,o.dataset.nh=`${n}`,o.onmousemove=r=>{let a=p(o),d=ve(r);o.scrollLeft=(d.pageX-a.x)/a.w*(+(o.dataset.nw||0)-a.w)||0,o.scrollTop=(d.pageY-a.y)/a.h*(+(o.dataset.nh||0)-a.h)||0},o.onmouseover=()=>{i.style.width=`${o.dataset.nw}px`,i.style.height=`${o.dataset.nh}px`};let l=()=>{o.scrollLeft&&(o.scrollLeft=0,o.scrollTop=0),i.style.width=`${s}px`,i.style.height=`${t}px`};o.onmouseout=l,l(),j(o,i),o.appendChild(i)}function Me(s){s.length&&Array.from(s).filter(e=>!e.dataset.madeResized).forEach(e=>{let t=1,n=1,{naturalWidth:i,naturalHeight:o}=e,l=i,r=o,a=f(e),d=Number.parseInt(a.width,10)||Number.parseInt(a.maxWidth,10),c=Number.parseInt(a.height,10)||Number.parseInt(a.maxHeight,10);d&&l>d&&(t=d/l),c&&r>c&&(n=c/r),t=t&&n?Math.min(t,n):n||t,t<1&&(l*=t,r*=t,Je(l,i,r,o,e))})}function P(s){let e=document.querySelector("#tooltip_thingy"),t=p(s),n=s.getAttribute("title");if(s.dataset.lastOnline){let i=Number.parseInt(s.dataset.lastOnline??"",10);n=`Last Online: ${_(i)} ${G(i)}`}if(n){if(s.title="",!e){e=document.createElement("table");let i=e.insertRow(0),o=e.insertRow(1),l=e.insertRow(2),r;e.id="tooltip_thingy",e.className="tooltip",i.className="top",o.className="content",l.className="bottom",r=i.insertCell(0),r.className="left",r.colSpan=2,r=i.insertCell(1),r.className="right",r=o.insertCell(0),r.className="left",r=o.insertCell(1),r.innerHTML="default text",r=o.insertCell(2),r.className="right",r=l.insertCell(0),r.className="left",r.colSpan=2,r=l.insertCell(1),r.className="right",document.querySelector("#page")?.appendChild(e)}e.rows[1].cells[1].innerText=n,e.style.display="",e.style.top=`${t.y-e.clientHeight}px`,e.style.left=`${t.x}px`,e.style.zIndex=`${b()}`,s.onmouseout=()=>{s.title=n,e.style.display="none"}}}function y(s){k(),s.querySelectorAll("a").forEach(i=>{if(i.dataset.useTooltip&&i.addEventListener("mouseover",()=>P(i)),!i.href)return;let o=i.getAttribute("href"),{host:l,pathname:r}=window.location,a=!i.target&&i.host===l&&i.pathname===r;if(!o?.startsWith("javascript")){if(a){let c=i.onclick;i.onclick=null,i.addEventListener("click",m=>{m.preventDefault(),(!c||c.call(i,m)!==!1)&&RUN.stream.location(o)});return}i.target="_BLANK"}});let t=Array.from(s.querySelectorAll(".bbcodeimg"));t.length&&H(t).then(()=>{Me(t)}),s.querySelectorAll(".bbcode.code").forEach(i=>{i.addEventListener("click",()=>Le(i))}),[A,C,I,N,D,q,R,z,W].forEach(i=>{i.selector(s)}),s.querySelectorAll("form[data-ajax-form]").forEach(i=>{let o=i.dataset.ajaxForm==="resetOnSubmit";i.addEventListener("submit",l=>{l.preventDefault(),RUN.submitForm(i,o)})}),Array.from(document.querySelectorAll(".idle")).forEach(i=>B(i))}var oe=class{constructor(){this.soundCache={}}load(e,t,n){let i=this.soundCache[e];if(i){n&&this.play(e);return}i=new Audio,this.soundCache[e]=i,i.autoplay=!!n,i.src=t}play(e){this.soundCache[e].play()}loadAndPlay(e,t){this.load(e,t,!0)}},E=new oe;function Ze(s,e){if(he(`New message from ${s}!`),!document.hasFocus()&&window.Notification&&Notification.permission==="granted"){let t=new Notification(`${s} says:`,{body:e});t.onclick=()=>{window.focus(),t.close()}}}function Ve({fromId:s,fromName:e,message:t}){let n=document.querySelector(`#im_${s} .ims`);if(n)return n;let o=new T({title:`${e}`,content:`
            <div class='ims'></div>
            <div class='offline'>This user may be offline</div>
            <div>
                <form data-ajax-form='resetOnSubmit' method='post'>
                    <input type='hidden' name='im_uid' value='%s' />
                    <input type='text' name='im_im' autocomplete='off' />
                    <input type='hidden' name='act' value='blank' />
                </form>
            </div>
        `.replaceAll("%s",`${s}`),className:"im",resize:".ims",animate:!0,id:`im_${s}`}).create();y(o);let l=()=>{o.querySelector("form")?.im_im.focus()};o.onclick=l,l(),n=document.querySelector(`#im_${s} .ims`);let r=getComputedStyle(n);return n.style.width=r.width,n.style.height=r.height,t&&globalSettings.soundIM&&E.play("imnewwindow"),n}function re(s,e){if(!globalSettings.canIM){alert("You do not have permission to use this feature.");return}RUN.stream.commands.im(s,e,"")}function $e({fromId:s,fromName:e,message:t,fromMe:n,timestamp:i}){Ze(e,t);let o=Ve({fromId:s,fromName:e,message:t});if(!t)return;let l=document.createElement("div"),r=t.substring(0,3)==="/me";r&&(l.className="action",t=t.substring(3),e=`***${e}`),l.classList.add(n?"you":"them"),n||document.querySelector(`#im_${s}`)?.classList.remove("offline"),l.innerHTML=`<a href='?act=vu${n||s}' class='name'>${e}</a> ${r?"":": "}${t}`,l.dataset.timestamp=`${i}`;let a=o.scrollTop>o.scrollHeight-o.clientHeight-50;o.appendChild(l),a&&(o.scrollTop=o.scrollHeight),y(l),globalSettings.soundIM&&E.play("imbeep")}var He={loadscript(s){document.body.appendChild(Object.assign(document.createElement("script"),{src:s}))},script(script){eval(script)},error(s){alert(s)},alert(s){alert([s])},reload(s=0){setTimeout(()=>window.location.reload(),s)},refreshdata(){RUN.stream.pollData(!0)},addclass(s,e){let t=document.querySelector(s);t&&t.classList.add(e)},title(s){document.title=s},update(s,e,t){let n=s,i=Array.from(document.querySelectorAll(".path"));if(n==="path"&&i.length>1){i.forEach(l=>{l.innerHTML=e,y(l)});return}/^\W/.test(n)||(n=`#${n}`);let o=document.querySelector(n);o&&(o.innerHTML=e,t&&new g(o).dehighlight().play(),y(o))},removeel(s){let e=document.querySelector(s);e&&e.parentNode?.removeChild(e)},back(){window.history.back()},setstatus(s){let e=document.querySelector("#status");e&&(e.className=s)},appendrows(s,e){let t=document.querySelector(s);if(!t)return;let n=document.createElement("span");n.innerHTML=`<table>${e}</table>`;let i=n.getElementsByTagName("tbody")[0];y(i),t.appendChild(i)},location(s){s.charAt(0)==="?"?RUN.stream.location(s):document.location=s},enable(s){let e=document.querySelector(`#${s}`);e&&(e.disabled=!1)},addshout(s){let e=Array.from(document.querySelectorAll("#shoutbox .shout")),t=document.createElement("span");t.innerHTML=s;let n=t.firstElementChild;if(n){for(e[0].parentNode?.insertBefore(n,e[0]);e.length>globalSettings.shoutLimit-1;)e.pop()?.remove();new g(n).dehighlight().play(),globalSettings.soundShout&&E.play("sbblip"),y(n)}},tick(s){let e=document.querySelector("#ticker");if(!e)return;let t=document.createElement("div");t.className="tick",t.innerHTML=s,t.style.display="none",t.style.overflow="hidden",e.insertBefore(t,e.firstChild);let n=f(t);t.style.height="0px",new g(t).add("height","0px",n.height).play();let i=Array.from(e.querySelectorAll(".tick")),o=i.length;if(t.style.display="block",o>100)for(let l=100;l<o;l+=100)t=i[l],t.dataset.removed||(t=i[l],new g(t,30,500).add("opacity","1","0").andThen(r=>{r.parentNode?.removeChild(r)}).play(),t.dataset.bonked="true")},im(s,e,t,n,i){$e({fromId:s,fromName:e,message:t,fromMe:n,timestamp:i})},imtoggleoffline(s){document.querySelector(`#im_${s}`)?.classList.add("offline")},window(s){if(s.id&&document.getElementById(s.id))return;let t=new T;t.title=s.title,t.content=s.content,t.minimizable=s.minimizable||!1,t.animate=s.animate!==void 0?s.animate:!0,t.resize=s.resize||void 0,t.className=s.className||"",s.pos&&(t.pos=s.pos);let n=t.create();n.id=s.id||"",y(n)},closewindow(s){let e=document.querySelector(s);e&&T.close(e)},onlinelist(s){let e=document.querySelector("#statusers");e&&s.forEach(([t,n,i,o,l,r])=>{let a=document.querySelector(`#statusers .user${t}`);if(a||(a=document.createElement("a"),a.href=`?act=vu${t}`,a.onclick=()=>{RUN.location(a.getAttribute("href"))}),a.innerHTML=o,a.className=`user${t} mgroup${n} ${i?` ${i}`:""} lastAction${r}`,l&&(a.title=l,a.onmouseover=()=>P(a,l)),i==="idle"){B(a);return}e.firstChild?e.insertBefore(a,e.firstChild):e.appendChild(a)})},setoffline(s){let e=document.querySelector("#statusers");s.split(",").forEach(n=>{let i=document.querySelector(`#statusers .user${n}`);i&&e&&e.removeChild(i)})},scrollToPost(s){let e=document.getElementById(`pid_${s}`);return e?(H(Array.from(document.querySelectorAll("#page img"))).then(()=>{let t=p(e);window.scrollTo({top:t.y})}),!0):!1},updateqreply(s){let t=document.querySelector("#qreply")?.querySelector("textarea");t&&(t.focus(),t.value+=s)},newmessage(s,e){let t=document.querySelector("#notification"),n=document.querySelector("#num-messages");n&&(n.innerHTML=`${Number.parseInt(n.innerHTML,10)+1}`),t||(t=document.createElement("div"),t.id="notification",document.body.appendChild(t)),t.style.display="",t.className="newmessage",t.onclick=()=>{t.style.display="none",RUN.stream.location(`?act=ucp&what=inbox&view=${e}`,3)},t.innerHTML=s},playsound(s,e){E.loadAndPlay(s,e)},attachfiles(){document.querySelector("#attachfiles")?.addEventListener("click",()=>{alert("Attaching files is under construction")})},listrating(s,e){let t=document.querySelector(`#postrating_${s}`),n;if(t){if(t.style.display!=="none"){new g(t).add("height","200px","0px").andThen(()=>{t.style.display="none"}).play();return}t.style.display="block"}else t=document.createElement("div"),t.className="postrating_list",t.id=`postrating_${s}`,n=p(document.querySelector(`#pid_${s} .postrating`)),t.style.top=`${n.yh}px`,t.style.left=`${n.x}px`,document.querySelector("#page")?.appendChild(t);t.innerHTML=e,new g(t).add("height","0px","200px").play()}};var Ge=5e3,le=class{constructor(){this.request=new M({callback:e=>this.handleRequestData(e)}),this.lastURL=document.location.search.slice(1),this.commands=He}handleRequestData(e){if(e.status!==200)return;e.parsed=!0;let{responseText:t}=e,n=!1;typeof t!="string"&&(t="");let i=[];if(t.length){try{i=JSON.parse(t)}catch(o){console.error(o),i=[]}i.forEach(([o,...l])=>{o==="softurl"?n=!0:this.commands[o]&&this.commands[o](...l)})}if(e.requestType===2){let o=e.url.substring(1);n||(window.history.pushState({queryParams:o},"",`?${o}`),window.dispatchEvent(new Event("pushstate")),this.lastURL=o)}this.pollData()}location(e,t=2){let n=e.split("?");return n=n[1]||n[0],this.request.load(`?${n}`,{requestType:t}),this.busy=!0,!1}load(...e){this.request.load(...e)}loader(){return this.request.load(`?${this.lastURL}`),!0}pollData(e=!1){e&&this.loader(),clearTimeout(this.timeout),document.cookie.includes(`actw=${window.name}`)&&(this.timeout=setTimeout(()=>this.loader(),Ge))}updatePage(e){e!==this.lastURL&&this.location(e,3)}},Se=le;var Qe=2,ae=class{stream=new Se;onAppReady(){Qe&&y(document.body),k(),setInterval(k,1e3*30),this.stream.pollData(),window.addEventListener("popstate",({state:e})=>{if(e){let{queryParams:t}=e;this.stream.updatePage(t)}else{let t=document.location.search.replace(/^\?/,"");this.stream.updatePage(t)}}),E.load("sbblip","./Sounds/blip.mp3",!1),E.load("imbeep","./Sounds/receive.mp3",!1),E.load("imnewwindow","./Sounds/receive.mp3",!1)}submitForm(e,t=!1){let n=[],i=[],{submitButton:o}=e;["input","select","button","textarea"].flatMap(r=>Array.from(e.querySelectorAll(r))).forEach(r=>{if(!(!r.name||r.type==="submit")){if(r instanceof HTMLSelectElement&&r.type==="select-multiple"){Array.from(r.options).filter(a=>a.selected).forEach(a=>{n.push(`${r.name}[]`),i.push(a.value)});return}r instanceof HTMLInputElement&&["checkbox","radio"].includes(r.type)&&!r.checked||(n.push(r.name),i.push(r.value))}}),o&&(n.push(o.name),i.push(o.value)),this.stream.load(window.location.search,{data:[n,i]}),t&&e.reset(),this.stream.pollData()}handleQuoting(e){this.stream.load(`${e.href}&qreply=${document.querySelector("#qreply")?"1":"0"}`)}setWindowActive(){document.cookie=`actw=${window.name}; SameSite:Lax`,U(),this.stream.pollData()}},O=new ae;Q(()=>{O.onAppReady()});Q(()=>{window.name=`${Math.random()}`,O.setWindowActive(),window.addEventListener("focus",()=>{O.setWindowActive()}),we()||document.documentElement.classList.add("no-emoji")});var Ae=O;Object.assign(window,{RUN:Ae,IMWindow:re});})();

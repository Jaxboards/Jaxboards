var X=new Map;class f{element;constructor($){this.element=$}}function b($,L,h){if(!X.has($))X.set($,new WeakMap);L.forEach(function(M){if(X.get($)?.has(M))return;X.get($)?.set(M,new h(M))})}function i$($){let L=$.getHours()||12,h=`${$.getMinutes()}`.padStart(2,"0");return`${L%12||12}:${h}${L>12?"pm":"am"}`}function p($){return new Date($*1000)}var G$=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],K$=["January","February","March","April","May","June","July","August","September","October","November","December"];function v$($){return $[0].toUpperCase()+$.slice(1)}function g($){let L=new Date,h=new Intl.RelativeTimeFormat(void 0,{numeric:"auto",style:"long"}),H=new Date;H.setTime(+H-86400000),H.setHours(0),H.setMinutes(0),H.setSeconds(0);let M=p($),u=Math.round((+M-+L)/1000);if(u>-60)return h.format(u,"second");if(u>-3600)return h.format(Math.round(u/60),"minute");if(M>H){let E=new Date;return E.setHours(0),E.setMinutes(0),E.setSeconds(0),`${v$(h.format(M>E?0:-1,"day"))} @ ${i$(M)}`}return Intl.DateTimeFormat(void 0,{month:"short",year:"numeric",day:"numeric",hour:"numeric",hour12:!0,minute:"numeric"}).format(M)}function T$($){let L=p($),h=L.getHours(),H=h>=12?"pm":"am";h%=12,h=h||12;let M=`${L.getMinutes()}`.padStart(2,"0"),u=L.getMonth()+1,E=`${L.getDate()}`.padStart(2,"0"),T=L.getFullYear();return`${h}:${M}${H}, ${u}/${E}/${T}`}function f$($){let L=p($);return String.fromCodePoint(55357,56656+((L.getHours()%12||12)-1)+(L.getMinutes()>29?12:0))}function b$($){let L=Array.from($.classList).find((h)=>h.startsWith("lastAction"));if(L===void 0)return;$.prepend(f$(Number.parseInt(L.slice(10),10))),$.classList.remove(L)}class r extends f{static hydrate($){$.querySelectorAll(".idle").forEach((L)=>b$(L))}}function t$($=200){let L=document.querySelector("#snow");if(L===null){L=document.createElement("div"),L.id="snow",Object.assign(L.style,{position:"fixed",top:0,left:0,zIndex:1});let h=document.createElement("style");h.appendChild(document.createTextNode(`
            .snowflake {
                position: absolute;
                width: 10px;
                height: 10px;
                background: linear-gradient(white, white);
                /* Workaround for Chromium's selective color inversion */
                border-radius: 50%;
                filter: drop-shadow(0 0 10px white);
            }`)),document.body.prepend(h),document.body.prepend(L)}L.innerHTML="";for(let h=1;h<=$;h+=1){let H=document.createElement("div");H.className="snowflake",L.appendChild(H)}}function w$(){let $=document.getElementById("snow-css");if($)return $;return $=document.createElement("style"),$.id="snow-css",document.head.appendChild($),$}function d$($){let L=w$();L.innerHTML=$,document.head.appendChild(L)}function s$($=100){return Math.floor(Math.random()*$)+1}function l$($,L){let h=Math.ceil($),H=Math.floor(L);return Math.floor(Math.random()*(H-h+1))+h}function o$($,L){return Math.random()*(L-$)+$}function m$($=200){let h=100*document.body.offsetHeight/window.innerHeight,H="snowflake",M="";for(let u=1;u<=$;u+=1){let E=Math.random()*100,T=Math.random()*10,x=E+T,F=E+T/2,A=o$(0.3,0.8),S=A*h,q=Math.random(),E$=l$(10,h/10*3),O=s$(h/10*3)*-1,k$=Math.random();M+=`
      .snowflake:nth-child(${u}) {
        opacity: ${k$};
        transform: translate(${E}vw, -10px) scale(${q});
        animation: fall-${u} ${E$}s ${O}s linear infinite;
      }
      @keyframes fall-${u} {
        ${A*100}% {
          transform: translate(${x}vw, ${S}vh) scale(${q});
        }
        to {
          transform: translate(${F}vw, ${h}vh) scale(${q});
        }
      }
    `}d$(M)}function D($=200){m$($),t$($)}async function N($,L,h=600,H="linear"){return new Promise((M)=>{$.animate(L,{duration:h,easing:H}).addEventListener("finish",()=>{Object.assign($.style,L.at(-1)),M($)},{once:!0})})}function x$($){return N($,[{backgroundColor:"#FF0"},{backgroundColor:""}],1000)}function _($){let L=document.createElement("div");return L.innerHTML=$,L.firstElementChild}function Y($){return[$?.closest("tr")?.rowIndex??0,$?.cellIndex??0]}function W($){return globalThis.getComputedStyle($)}function G($){let{x:L,y:h,height:H,width:M}=$.getBoundingClientRect(),u=L+globalThis.scrollX,E=h+globalThis.scrollY;return{x:u,y:E,yh:E+H,xw:u+M,w:M,h:H}}function B(){return Array.from(document.querySelectorAll("*")).reduce((h,H)=>{if(H.style.zIndex&&Number(H.style.zIndex)>h)return Number(H.style.zIndex);return h},0)+1}var _$="valid",N$="invalid";class C extends f{method;outputElement;indicatorElement;static hydrate($){b("AutoComplete",$.querySelectorAll("input[data-autocomplete-action]"),this)}constructor($){super($);$.autocomplete="off",this.method=$.dataset.autocompleteAction;let L=$.dataset.autocompleteOutput,h=$.dataset.autocompleteIndicator,H=L?document.querySelector(L):void 0;if(!H)throw Error("Expected element to have data-autocomplete-output");this.outputElement=H||document.createElement("input"),this.indicatorElement=h?document.querySelector(h):void 0,$.addEventListener("keyup",(M)=>this.keyUp(M)),$.addEventListener("keydown",(M)=>{if(M.key==="Enter")M.preventDefault()})}getResultsContainer(){let $=G(this.element),L=document.querySelector("#autocomplete");if(!L)L=Object.assign(document.createElement("div"),{id:"autocomplete"}),Object.assign(L.style,{zIndex:B()}),document.body.appendChild(L);return Object.assign(L.style,{top:`${$.yh}px`,left:`${$.x}px`,width:`${$.w}px`}),L}keyUp($){let L=this.getResultsContainer(),h=Array.from(L.querySelectorAll("div")),H=h.findIndex((M)=>M.classList.contains("selected"));switch($.key){case"ArrowUp":case"ArrowDown":h.at(H)?.classList.remove("selected"),h.at((H+($.key==="ArrowDown"?1:-1))%h.length)?.classList.add("selected");return;case"Enter":if(H>=0)h.at(H)?.dispatchEvent(new Event("click"));return;default:if(this.indicatorElement)this.indicatorElement.classList.remove(_$),this.indicatorElement.classList.add(N$);if(this.clearResults(),this.element.value)this.doSearch();break}}clearResults(){let $=this.getResultsContainer();$.style.display="none",$.innerHTML=""}async doSearch(){let $=this.getResultsContainer(),L=/ACP/.test(document.location.toString())?"../":"",H=`term=${encodeURIComponent(this.element.value)}`,M=await fetch(`${L}/api/${this.method}?${H}`);if(!M.ok)return;let u=await M.json();if($.innerHTML="",u.length){$.style.display="";let[E,T]=u;E.forEach((x,F)=>{let A=T[F],S=document.createElement("div");S.innerHTML=A,S.addEventListener("click",()=>{if($.style.display="none",this.indicatorElement)this.indicatorElement.classList.add(_$),this.indicatorElement.classList.remove(N$);this.outputElement.value=`${x}`,this.outputElement.dispatchEvent(new Event("change")),this.element.value=A}),$.appendChild(S)});return}$.style.display="none"}}var{userAgent:V}=navigator;function Z(){return"ontouchstart"in window}var k={chrome:/chrome/i.test(V),ie:/msie/i.test(V),iphone:/iphone/i.test(V),mobile:/mobile/i.test(V),n3ds:/nintendo 3ds/.test(V),firefox:/firefox/i.test(V),safari:/safari/i.test(V)};class Q${sess;boundEvents;droppables;noChild=!1;bounds;onstart;ondragover;ondrag;ondragout;ondrop;autoZIndex=!0;constructor(){this.droppables=[],this.sess={el:document.body,mx:0,my:0,reset:()=>{return}},this.boundEvents={drag:($)=>this.drag($),drop:()=>this.drop()}}start($,L,h){$.preventDefault(),$.stopPropagation();let H=L||$.target,M=W(H),u=B();if(this.noChild&&$.target!==(h||H))return;if(H.getAttribute("draggable")==="false")return;if(this.sess={el:H,mx:$ instanceof MouseEvent?$.pageX:$.targetTouches[0].pageX,my:$ instanceof MouseEvent?$.pageY:$.targetTouches[0].pageY,ex:Number.parseInt(M.left,10)||0,ey:Number.parseInt(M.top,10)||0,info:{el:H,mx:0,my:0,reset:()=>{return}},reset:()=>this.reset(),zIndex:H.style.zIndex},!this.sess.zIndex||Number(this.sess.zIndex)<u-1)H.style.zIndex=`${u}`;this.onstart?.({...this.sess,droptarget:this.testDrops(this.sess.mx,this.sess.my)}),document.addEventListener(Z()?"touchmove":"mousemove",this.boundEvents.drag),document.addEventListener(Z()?"touchend":"mouseup",this.boundEvents.drop),this.drag($)}drag($){$.stopPropagation();let L=this.sess.el.style,h=$ instanceof MouseEvent?$.pageX:$.targetTouches[0].pageX,H=$ instanceof MouseEvent?$.pageY:$.targetTouches[0].pageY,M=h,u=H,E,T=(this.sess.ex??0)+M-this.sess.mx,x=(this.sess.ey??0)+u-this.sess.my,F=this.bounds;if(F){if(T<F[0])M=M-T+F[0],[T]=F;else if(T>F[0]+F[2])T=F[0]+F[2];if(x<F[1])u=u-x+F[1],[x]=F;else if(x>F[1]+F[3])x=F[1]+F[3]}L.left=`${T}px`,L.top=`${x}px`;let A=this.sess.info,S=A?.droptarget,q={...this.sess,left:T,top:x,mx:M,my:u,dx:M-(A?.mx||M),dy:u-(A?.my||u),droptarget:this.testDrops(h,H)};if(this.sess.info=q,this.ondrag?.(q),q.droptarget&&S!==q.droptarget)this.ondragover?.(q);if(S&&q.droptarget!==S)E=q.droptarget,q.droptarget=S,this.ondragout?.(q),q.droptarget=E}boundingBox($,L,h,H){return this.bounds=[$,L,h,H],this}drop(){if(this.boundEvents)document.removeEventListener(Z()?"touchend":"mouseup",this.boundEvents.drop),document.removeEventListener(Z()?"touchmove":"mousemove",this.boundEvents.drag);if(this.ondrop?.(this.sess.info??{}),this.autoZIndex)this.sess.el.style.zIndex=this.sess.zIndex??"";return!0}testDrops($,L){let{droppables:h}=this,H,M=[9999,9999];if(!h.length)return;return h.findLast((u)=>{if(u===this.sess.el||this.sess.el.contains(u))return;if(H=G(u),M[0]>H.w&&M[1]>H.h&&$>=H.x&&L>=H.y&&$<=H.xw&&L<=H.yh)return M=[H.w,H.h],u;return})}drops($){return this.droppables=$,this}addDrops($){if(!this.droppables)return this.drops($);return this.droppables=this.droppables.concat($),this}addListener($){return Object.assign(this,$),this}apply($,L){if(Array.isArray($))return $.forEach((M)=>this.apply(M)),this;let H=W($)?.position;if(!H||H==="static")$.style.position="relative";return(L||$).addEventListener(Z()?"touchstart":"mousedown",L?(M)=>this.start(M,$,L):(M)=>this.start(M,$)),this}autoZ(){return this.autoZIndex=!1,this}noChildActivation(){return this.noChild=!0,this}reset($=this.sess.el){return $.style.top="0",$.style.left="0",this}}var z=Q$;var F$="50px";class W${success($){this.showToast($,"success",3000)}error($){this.showToast($,"error")}async showToast($,L,h=0){let H=document.createElement("div"),M=async()=>{await N(H,[{top:F$},{top:`-${F$}`}]),H.remove()};H.classList.add(L),Object.assign(H.style,{position:"fixed",left:"50%",transform:"translateX(-50%)",boxShadow:"black 5px 5px 10px",zIndex:B()}),H.addEventListener("click",M,{once:!0}),H.innerHTML=$;let u=document.createElement("a");if(u.href="javascript:void(0)",u.innerHTML=" [X]",u.title="close notification",u.addEventListener("click",M,{once:!0}),H.append(u),document.body.appendChild(H),await N(H,[{top:"0"},{top:F$}],600,"ease-in-out"),h)await new Promise((E)=>setTimeout(E,h)),M()}}var K=new W$;class V${soundCache={};load($,L,h){let H=this.soundCache[$];if(H){if(h)this.play($);return}H=new Audio,this.soundCache[$]=H,H.autoplay=!!h,H.src=L}play($){this.soundCache[$].play()}loadAndPlay($,L){this.load($,L,!0)}}var j=new V$;class i extends f{static hydrate($){b("Checkers",$.querySelectorAll(".checkers"),this)}constructor($){super($);j.load("chessdrop","/Sounds/chessdrop.mp3",!1);let L=new z;L.addListener({ondrop:(h)=>{if(h.reset(),!h.droptarget)return;let{droptarget:H,el:M}=h,u=Y(M.closest("td")),E=Y(H);if(!this.isValidMove(u,E))return;if([1,8].includes(E[0]))this.promote(M);this.getCapturedPiece(u,E)?.remove(),H.append(M),j.play("chessdrop"),this.moveNumber++,navigator.clipboard.writeText("[checkers]"+this.gameState+"[/checkers]"),K.success("BBCode copied to clipboard")}}),L.drops(Array.from($.querySelectorAll("td"))),L.apply(Array.from($.querySelectorAll(".piece")))}getCapturedPiece($,L){let h=[L[0]-$[0],L[1]-$[1]];if(h.map(Math.abs).join(",")!=="2,2")return;return this.element.rows[$[0]+h[0]/2].cells[$[1]+h[1]/2].querySelector(".piece")??void 0}promote($){$.dataset.piece=$.dataset.piece?.toUpperCase(),$.innerHTML="â™›"}isValidMove($,L){let h=this.element,H=[L[0]-$[0],L[1]-$[1]].map(Math.abs),M=h.rows[$[0]].cells[$[1]].querySelector(".piece")?.dataset.piece??"",u=this.getCapturedPiece($,L)?.dataset.piece??"";if(L[0]%2===L[1]%2)return!1;if(H[0]!=H[1])return!1;if(M==="b"&&L[0]<=$[0])return!1;if(M==="r"&&L[0]>=$[0])return!1;if(u.toLowerCase()===M.toLowerCase())return!1;if(h.rows[L[0]].cells[L[1]].querySelector(".piece"))return!1;return H[0]===(u?2:1)}get moveNumber(){return Number(this.element.dataset.moveNumber??"1")}set moveNumber($){this.element.dataset.moveNumber=`${$}`}get gameState(){let $=Array.from(this.element.querySelectorAll("td")),L=[];for(let h=0;h<8;h++){L.push([]);for(let H=0;H<4;H++){let M=h%2?0:1;L[h].push($[h*8+H*2+M].querySelector(".piece")?.dataset.piece||" ")}}return L.map((h)=>h.join("")).join("/").replaceAll(/ +/g,(h)=>`${h.length}`)+` ${this.moveNumber}`}}class v extends f{static hydrate($){b("Chess",$.querySelectorAll(".chess"),this)}constructor($){super($);j.load("chessdrop","/Sounds/chessdrop.mp3",!1);let L=new z;L.addListener({ondrop:(h)=>{if(h.reset(),!h.droptarget)return;let H=h.el.dataset.piece,M=h.droptarget.querySelector(".piece"),u=M?.dataset.piece?.trim()??"",E=Y(h.el.closest("td")),T=Y(h.droptarget);if(!this.isValidMove(H,u,E,T))return;M?.remove(),h.droptarget.append(h.el),j.play("chessdrop"),this.moveNumber++,navigator.clipboard.writeText("[chess]"+this.getFENNotation()+"[/chess]"),K.success("BBCode copied to clipboard")}}),L.drops(Array.from($.querySelectorAll("td"))),L.apply(Array.from($.querySelectorAll(".piece")))}get moveNumber(){return Number(this.element.dataset.moveNumber??"1")}set moveNumber($){this.element.dataset.moveNumber=`${$}`}isValidMove($="",L="",h,H){let M=[h[0]-H[0],h[1]-H[1]].map(Math.abs),u=Math.min(...M)===0,E=M[0]===M[1];if(L!==""&&$.toLowerCase()===$===(L.toLowerCase()===L))return!1;switch($){case"p":return h[0]<H[0]&&Math.max(...M)<=(h[0]===2?2:1)&&(L?E:u);case"P":return h[0]>H[0]&&Math.max(...M)<=(h[0]===7?2:1)&&(L?E:u);case"r":case"R":return u;case"b":case"B":return E;case"n":case"N":return M.toSorted((T,x)=>T-x).join(",")==="1,2";case"q":case"Q":return u||E;case"k":case"K":return Math.max(...M)<=2&&(E||u)}return!0}getFENNotation(){return Array.from(this.element.querySelectorAll("td")).map((L,h)=>(h&&h%8===0?"/":"")+(L.querySelector(".piece")?.dataset.piece||" ")).join("").replaceAll(/ +/g,(L)=>`${L.length}`)+` ${this.moveNumber}`}}function z$($){if(!globalThis.getSelection)return;let L=document.createRange();L.selectNode($);let h=globalThis.getSelection();if(!h)return;if(h.rangeCount)h.removeAllRanges();h.addRange(L)}function R$($,L){let h=$.scrollTop,H=$.selectionStart??0,M=$.selectionEnd??0;$.value=$.value.substring(0,H)+L+$.value.slice(M),$.selectionStart=H+L.length,$.selectionEnd=H+L.length,$.focus(),$.scrollTop=h}class t extends f{static hydrate($){b("CodeBlock",$.querySelectorAll(".bbcode.code"),this)}constructor($){super($);$.addEventListener("click",()=>z$($))}}class w extends f{fullHeight=0;animationLengthInMs=200;static hydrate($){b("CollapseBox",$.querySelectorAll(".collapse-box"),this)}constructor($){super($);let{collapseContent:L}=this;if(L)Object.assign(L.style,{transition:`height ${this.animationLengthInMs}ms ease-in-out`});this.toggle(),this.element.addEventListener("click",(h)=>{if(h.target instanceof HTMLElement&&h.target.matches(".collapse-button"))this.isOpen=!this.isOpen,this.toggle()})}get boxID(){return this.element.getAttribute("id")||""}get collapseContent(){return this.element.querySelector(".collapse-content")}get isOpen(){return!(globalThis.sessionStorage.getItem("collapsed")??"").split(",").includes(this.boxID)}set isOpen($){let L=(globalThis.sessionStorage.getItem("collapsed")??"").split(",").filter(Boolean);if($)L=L.filter((h)=>h!==this.boxID);else L.push(this.boxID);globalThis.sessionStorage.setItem("collapsed",L.join(",")??"")}toggle(){let{collapseContent:$}=this;if(!$)return;let{style:L}=$;if(this.isOpen){if(!this.fullHeight)return;L.height=`${this.fullHeight}px`,this.element.classList.remove("collapsed"),setTimeout(()=>{L.removeProperty("height"),L.removeProperty("overflow")},this.animationLengthInMs)}else this.fullHeight=$.clientHeight||$.offsetHeight,L.height=`${this.fullHeight}px`,L.overflow="hidden",this.element.classList.add("collapsed"),requestAnimationFrame(()=>{L.height="0px"})}}function U($,L=1000){return new Promise((h)=>{let H=new Set,M=Array.from($).filter((E)=>!E.complete);if(!M.length){h();return}function u(){if(H.delete(this.src),H.size===0)h()}if(M.forEach((E)=>{if(!H.has(E.src))H.add(E.src),E.addEventListener("error",u),E.addEventListener("load",u)}),L)setTimeout(h,L)})}function I(){let $=document.querySelectorAll(".autodate"),L=Array.from(document.querySelectorAll("[data-timestamp]"));if(!$)return;$.forEach((h)=>{let H=Number.parseInt(h.getAttribute("title")??"",10),M=h.classList.contains("smalldate")?T$(H):g(H);if(M!==h.innerHTML)h.innerHTML=M}),L.forEach((h)=>{if(!h.title)h.title=T$(Number.parseInt(h.dataset.timestamp??"",10))})}function y($){if(document.readyState==="complete")$();else document.addEventListener("DOMContentLoaded",$)}function Y$(){let $=document.createElement("input");return $.setAttribute("type","date"),$.type==="date"}function Z$(){let $=[String.fromCodePoint(9757,127999),String.fromCodePoint(9757)].map((L)=>{let h=document.body.appendChild(document.createElement("span"));h.appendChild(document.createTextNode(L));let H=h.offsetWidth;return h.remove(),H});return $[0]===$[1]}class d extends f{picker;selectedDate;lastDate;static hydrate($){if(Y$())return;b("DatePicker",$.querySelectorAll("input[type=date]"),this)}constructor($){super($);this.picker=this.getPicker(),$.autocomplete="off",$.addEventListener("focus",()=>this.openPicker()),$.addEventListener("keydown",()=>this.closePicker())}getPicker(){if(this.picker)return this.picker;let $=document.querySelector("#datepicker");if(!$)$=Object.assign(document.createElement("table"),{id:"datepicker"}),document.body.appendChild($),$.style.display="none";return $}openPicker(){let $=G(this.element);Object.assign(this.picker.style,{display:"",zIndex:B(),position:"absolute",top:`${$.yh}px`,left:`${$.x}px`});let[L,h,H]=this.element.value.split("/").map((M)=>Number.parseInt(M,10));if(L&&h&&H)this.selectedDate=[H,L-1,h];else this.selectedDate=void 0;this.generate(H,L,h)}closePicker(){this.picker.style.display="none"}generate($,L,h){let H=new Date,M=this.getPicker(),u,E,[T,x,F]=[$,L,h];if(T===void 0)T=H.getFullYear(),x=H.getMonth(),F=H.getDate(),this.selectedDate=[T,x,F];if(x===-1)T-=1,x=11;if(x===12)T+=1,x=0;this.lastDate=[T,x,F];let A=new Date(T,x+1,0).getDate(),S=new Date(T,x,1).getDay();M.innerHTML="",u=M.insertRow(0),E=u.insertCell(0),E.innerHTML="&lt;",E.className="control",E.addEventListener("click",()=>this.lastYear()),E=u.insertCell(1),E.colSpan=5,E.className="year",E.innerHTML=`${T}`,E=u.insertCell(2),E.innerHTML=">",E.className="control",E.addEventListener("click",()=>this.nextYear()),u=M.insertRow(1),E=u.insertCell(0),E.innerHTML="<",E.className="control",E.addEventListener("click",()=>this.lastMonth()),E=u.insertCell(1),E.colSpan=5,E.innerHTML=K$[x],E.className="month",E=u.insertCell(2),E.innerHTML=">",E.className="control",E.addEventListener("click",()=>this.nextMonth()),u=M.insertRow(2),u.className="weekdays";for(let q=0;q<7;q+=1)u.insertCell(q).innerHTML=G$[q];u=M.insertRow(3);for(let q=0;q<A;q+=1){if(!q)for(let O=0;O<S;O+=1)u.insertCell(O);if((S+q)%7===0)u=M.insertRow(M.rows.length);E=u.insertCell((S+q)%7),E.addEventListener("click",this.insert.bind(this,E));let E$=!!this.selectedDate&&T===this.selectedDate[0]&&x===this.selectedDate[1]&&q+1===this.selectedDate[2];E.className=`day${E$?" selected":""}`,E.innerHTML=`${q+1}`}}lastYear(){let $=this.lastDate;if($)this.generate($[0]-1,$[1],$[2])}nextYear(){let $=this.lastDate;if($)this.generate($[0]+1,$[1],$[2])}lastMonth(){let $=this.lastDate;if($)this.generate($[0],$[1]-1,$[2])}nextMonth(){let $=this.lastDate;if($)this.generate($[0],$[1]+1,$[2])}insert($){let L=this.lastDate;if(L)this.element.value=`${L[1]+1}/${$.innerHTML}/${L[0]}`;this.closePicker()}}class U${rgb;constructor($){let L=/^rgb\((\d+),\s?(\d+),\s?(\d+)\)/i.exec($),h=/#?([\da-fA-F]+)/.exec($);if(L){this.rgb=[Number.parseFloat(L[1]),Number.parseFloat(L[2]),Number.parseFloat(L[3])];return}if(h){let H=h[1];if(H.length===3)H=H.charAt(0)+H.charAt(0)+H.charAt(1)+H.charAt(1)+H.charAt(2)+H.charAt(2);if(H.length!==6){this.rgb=[0,0,0];return}this.rgb=[];for(let M=0;M<3;M+=1)this.rgb[M]=Number.parseInt(H.slice(M*2,(M+1)*2),16)}}invert(){if(this.rgb)this.rgb=[255-this.rgb[0],255-this.rgb[1],255-this.rgb[2]];return this}toRGB(){return this.rgb}toHex(){return"#"+this.rgb?.map(($)=>$.toString(16).padStart(2,"0")).join("")}}var q$=U$;var c$={a:($,L)=>`[url=${L?.getAttribute("href")}]${$}[/url]`,b(...$){return this.strong(...$)},br:()=>`
`,div:($)=>`
${$}`,em:($)=>`[i]${$}[/i]`,font:($,L)=>{let h=L.style.fontFamily||L.getAttribute("face");return h?`[font=${h}]${$}[/font]`:$},h1:($)=>`[h1]${$}[/h1]`,h2:($)=>`[h2]${$}[/h2]`,h3:($)=>`[h3]${$}[/h3]`,h4:($)=>`[h4]${$}[/h4]`,h5:($)=>`[h5]${$}[/h5]`,h6:($)=>`[h6]${$}[/h6]`,hr:()=>`
`,i(...$){return this.em(...$)},img:($,L)=>{let h=L.getAttribute("alt")??"",H=L.getAttribute("src");if(L.dataset.emoji)return` ${L.dataset.emoji}`;if(H)return`[img]${H}[/img]`;return h},li:($)=>`* ${$.replace(/[\n\r]+/,"")}
`,meta:()=>`
`,ol:($)=>`[ol]${$}[/ol]`,p:($)=>`
${$==="&nbsp"?"":$}
`,strike:($)=>`[s]${$}[/s]`,strong:($)=>`[b]${$}[/b]`,u:($)=>`[u]${$}[/u]`,ul:($)=>`[ul]${$}[/ul]`},s={"background-color":($,L)=>{let h=$&&new q$($).toHex(),H=h?`${h}`:$;if(["ffffff","white","transparent"].includes(H))return L;return`[bgcolor=${H}]${L}[/bgcolor]`},color($,L){let h=$&&new q$($).toHex();return`[color=${h?`${h}`:$}]${L}[/color]`},"font-family":($,L)=>`[font=${$.replaceAll(/['"]/g,"")}]${L}[/font]`,"font-style":($,L)=>`[i]${L}[/i]`,"font-size":($,L)=>`[size=${$}]${L}[/size]`,"font-weight":($,L)=>`[b]${L}[/b]`,"text-align":($,L)=>`[align=${$}]${L}[/align]`,"text-decoration":function(L,h){return L==="line-through"?`[strike]${h}[/strike]`:`[u]${h}[/u]`}};function a$($){return $.replaceAll(/[\r\n]+/g,"").replaceAll("&amp;","&").replaceAll("&gt;",">").replaceAll("&lt;","<").replaceAll("&nbsp;"," ")}function j$($){let L=$.tagName.toLowerCase(),h="";for(let u of $.childNodes)h+=u.nodeType===Node.ELEMENT_NODE?j$(u):a$(u.textContent??"");if(L==="body")return h;if($.style){for(let u of $.style)if(u in s)h=s[u]($.style.getPropertyValue(u),h)}let H=$.getAttribute("size");if(H)h=s.fontSize(H,h);let M=$.getAttribute("color");if(M)h=s.color(M,h);if(L in c$)h=c$[L](h,$);return h}function S$($){return $.replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll(/(\s) /g,"$1&nbsp;").replaceAll(/\[b\]([^]*?)\[\/b\]/gi,"<b>$1</b>").replaceAll(/\[i\]([^]*?)\[\/i\]/gi,"<i>$1</i>").replaceAll(/\[u\]([^]*?)\[\/u\]/gi,"<u>$1</u>").replaceAll(/\[s\]([^]*?)\[\/s\]/gi,"<s>$1</s>").replaceAll(/\[img\]([^'"[]+)\[\/img\]/gi,'<img src="$1">').replaceAll(/\[color=([^\]]+)\]([^]*?)\[\/color\]/gi,'<span style="color:$1">$2</span>').replaceAll(/\[size=([^\]]+)\]([^]*?)\[\/size\]/gi,'<span style="font-size:$1">$2</span>').replaceAll(/\[font=['"]?([^\]]+?)['"]?\]([^]*?)\[\/font\]/gi,'<span style="font-family:$1">$2</span>').replaceAll(/\[url=([^\]]+)\]([^]*?)\[\/url\]/gi,'<a href="$1">$2</a>').replaceAll(/\[bgcolor=([^\]]+)\]([^]*?)\[\/bgcolor\]/gi,'<span style="background-color:$1">$2</span>').replaceAll(/\[h(\d)\]([^]*?)\[\/h\1\]/g,"<h$1>$2</h$1>").replaceAll(/\[align=(left|right|center)\]([^]*?)\[\/align\]/g,'<div style="text-align:$1">$2</div>').replaceAll(/\[(ul|ol)\]([^]*?)\[\/\1\]/gi,(L,h,H)=>{let u=H.split(/(^|[\r\n]+)\* ?/).filter((E)=>E.trim()).map((E)=>`<li>${E}</li>`).join("");return`<${h}>${u}</${h}>`}).replaceAll(`
`,"<br>")}var n$=/^(ht|f)tps?:\/\/[\w.\-%&?=/]+$/,e$=($)=>n$.test($),O$={"Sans Serif":["Arial","Arial Black","Arial Narrow","Arial Rounded MT Bold","Avant Garde","Calibri","Candara","Century Gothic","Comic Sans MS","Franklin Gothic Medium","Futura","Geneva","Gill Sans","Helvetica","Impact","Lucida Grande","Optima","Segoe UI","Tahoma","Trebuchet MS","Verdana"],Serif:["Big Caslon","Bodoni MT","Book Antiqua","Calisto MT","Cambria","Didot","Garamond","Georgia","Goudy Old Style","Hoefler Text","Lucida Bright","Palatino","Perpetua","Rockwell","Rockwell Extra Bold","Baskerville","Times New Roman"],Monospaced:["Consolas","Courier New","Lucida Console","Lucida Sans Typewriter","Monaco","Andale Mono"],Fantasy:["Copperplate","Papyrus"],Script:["Brush Script MT"]};class l extends f{iframe;colorWindow;container;htmlMode=!0;editbar;emoteWindow;static hydrate($){b("Editor",$.querySelectorAll("textarea.bbcode-editor"),this)}constructor($){super($);this.container=Object.assign(document.createElement("div"),{className:"editor"}),this.iframe=document.createElement("iframe"),this.iframe.style.display="none",this.iframe.addEventListener("load",()=>this.iframeLoaded(),{once:!0}),$.before(this.container),this.container.appendChild($),this.container.appendChild(this.iframe)}get doc(){return this.window?.document}get window(){return this.iframe.contentWindow}iframeLoaded(){let{iframe:$,element:L}=this;if($.className="editorframe",this.htmlMode=globalSettings.wysiwyg,L.addEventListener("input",()=>{this.setSource(S$(L.value))}),this.doc?.addEventListener("input",()=>{if(!this.doc)return;this.element.value=j$(this.doc.body)}),this.doc?.addEventListener("paste",(M)=>{M.preventDefault();let u=M.clipboardData?.getData("text/plain");this.doc?.execCommand("insertText",!1,u)}),this.doc?.addEventListener("drop",(M)=>{if(!M.dataTransfer?.files.length)return;this.upload(M.dataTransfer.files[0])}),this.doc?.addEventListener("dragleave",()=>{this.getAttachmentStatus().remove()}),this.doc?.addEventListener("dragover",()=>{this.getAttachmentStatus()}),!this.doc)return;let h=W(L),H=this.doc.getElementsByTagName("body")[0];if(H&&h)H.style.backgroundColor=h.backgroundColor,H.style.color=h.color,H.style.borderColor="#FFF";this.doc.designMode="on",this.editbar=this.buildEditBar(),$.style.height=`${L.clientHeight}px`,L.before(this.editbar),this.setSource("<div></div>"),setTimeout(()=>{if(this.setSource(S$(L.value)),this.switchMode(this.htmlMode),L.hasAttribute("autofocus"))this.window?.focus()},100)}getAttachmentStatus(){let $=this.doc?.querySelector("#attachmentStatus");if($)return $;return $=document.createElement("div"),Object.assign($,{id:"attachmentStatus",innerHTML:"Drop file here",contentEditable:"false"}),Object.assign($.style,{position:"fixed",padding:"20px",top:"50%",left:"50%",translate:"-50% -50%",border:"2px dashed #ccc"}),this.doc?.body.appendChild($),$}upload($){let L=new FormData;L.append("Filedata",$);let h=new XMLHttpRequest;this.getAttachmentStatus().innerHTML='Uploading: <progress id="attachmentProgress"></div>';let H=this.getAttachmentStatus().querySelector("#attachmentProgress");h.upload.addEventListener("progress",(M)=>{if(H&&M.lengthComputable){let u=Math.round(M.loaded/M.total*100);H.value=M.loaded,H.max=M.total,H.textContent=`${u}%`}}),h.addEventListener("load",()=>{this.window?.focus(),this.getAttachmentStatus().remove();let M=h.responseText;if(/\D/.test(M)){alert("Error: "+M);return}this.cmd("inserthtml",`[attachment]${h.responseText}[/attachment]`)}),h.upload.addEventListener("error",()=>{this.getAttachmentStatus().remove()}),h.open("POST","/api/upload",!0),h.send(L)}buildEditBar(){let $=document.createElement("div");$.className="editbar",$.innerHTML=[`<select class="fontface">
        <option value="">Default Font</option>
        <optgroup label="Headings">
          <option value="heading_1" style="font-weight:bold;font-size: 2em">Heading 1</option>
          <option value="heading_2" style="font-weight:bold;font-size: 1.5em">Heading 2</option>
          <option value="heading_3" style="font-weight:bold;font-size: 1.17em">Heading 3</option>
          <option value="heading_4" style="font-weight:bold;font-size: 1em">Heading 4</option>
          <option value="heading_5" style="font-weight:bold;font-size: 0.83em">Heading 5</option>
          <option value="heading_6" style="font-weight:bold;font-size: 0.67em">Heading 6</option>
        </optgroup>
      </select>`,'<a class="bold" title="Bold"></a>','<a class="italic" title="Italic"></a>','<a class="underline" title="Underline"></a>','<a class="strikethrough" title="Strike-Through"></a>','<a class="forecolor" title="Foreground Color"></a>','<a class="backcolor" title="Background Color"></a>','<a class="insertimage" title="Insert Image"></a>','<a class="createlink" title="Insert Link"></a>','<a class="c_email" title="Insert Email"></a>','<a class="justifyleft" title="Align Left"></a>','<a class="justifycenter" title="Center"></a>','<a class="justifyright" title="Align Right"></a>','<a class="c_youtube" title="Insert video from any of your favorite video services!"></a>','<a class="c_code" title="Insert code"></a>','<a class="c_quote" title="Insert Quote"></a>','<a class="c_spoiler" title="Insert Spoiler"></a>','<a class="insertorderedlist" title="Create Ordered List"></a>','<a class="insertunorderedlist" title="Create Unordered List"></a>','<a class="c_smileys" title="Insert Emoticon"></a>','<a class="c_switcheditmode" title="Switch editor mode"></a>'].join(""),$.addEventListener("click",(h)=>{if(h.target instanceof HTMLElement&&h.target.matches(".editbar a"))this.editbarCommand(h,h.target.className)});let L=$.querySelector("select.fontface");if(L){L.addEventListener("input",(h)=>{let H=L.value;if(H.startsWith("heading_"))this.editbarCommand(h,"heading",H.replace("heading_","h"));else if(H)this.editbarCommand(h,"fontname",H)});for(let h of Object.keys(O$)){let H=O$[h].map((M)=>`<option style="font-family: ${M}">${M}</option>`);L.innerHTML+=`<optgroup label="${h}">${H}</optgroup>`}}return $}editbarCommand($,L,h){switch($.preventDefault(),L){case"forecolor":case"backcolor":this.showColors($.pageX,$.pageY,L);break;case"c_smileys":this.showEmotes($.pageX,$.pageY);break;case"c_switcheditmode":this.switchMode(!this.htmlMode);break;default:this.cmd(L,h);break}}async showEmotes($,L){let h=this.emoteWindow;if(!h){let H=await fetch("/api/emotes"),M=await H.json();if(H.ok)this.createEmoteWindow(M,{x:$,y:L});return}if(h.style.display==="none")h.style.display="",h.style.left=`${$}px`,h.style.top=`${L}px`;else this.hideEmotes()}hideEmotes(){if(this.emoteWindow)this.emoteWindow.style.display="none"}createEmoteWindow([$,L],h){let H=document.createElement("div");H.className="emotewin",$.forEach((M,u)=>{let E=L[u],T=document.createElement("a");T.href="javascript:void(0)",T.addEventListener("click",()=>{this.cmd("inserthtml",E),this.hideEmotes()}),T.innerHTML=`${E} ${M}`,H.appendChild(T)}),H.style.position="absolute",H.style.display="none",this.emoteWindow=H,document.querySelector("#page")?.appendChild(H),this.showEmotes(h.x,h.y)}colorHandler($,L){this.cmd($,L),this.hideColors()}showColors($,L,h){this.hideColors();let M=_(`
      <div>
        ${["#FFFFFF","#AAAAAA","#000000","#FF0000","#00FF00","#0000FF","#FFFF00","#00FFFF","#FF00FF"].map((u)=>`<button style="background-color:${u}" data-color="${u}"></button>`).join("")}
      </div>
    `);return Object.assign(M.style,{display:"grid",gridTemplateColumns:"20px 20px 20px",gridTemplateRows:"20px 20px 20px",position:"absolute",top:`${L}px`,left:`${$}px`,cursor:"pointer",zIndex:B()}),M.addEventListener("click",(u)=>{if(u.target instanceof HTMLButtonElement&&u.target.dataset.color)this.colorHandler(h,u.target.dataset.color)}),this.colorWindow=M,document.querySelector("#page")?.appendChild(M),null}hideColors(){if(this.colorWindow)this.colorWindow.remove(),this.colorWindow=void 0}cmd($,L){let h=this.getSelection(),H="",M=$,u=L;switch($.toLowerCase()){case"bold":H=`[b]${h}[/b]`;break;case"italic":H=`[i]${h}[/i]`;break;case"underline":H=`[u]${h}[/u]`;break;case"strikethrough":H=`[s]${h}[/s]`;break;case"justifyright":H=`[align=right]${h}[/align]`;break;case"justifycenter":H=`[align=center]${h}[/align]`;break;case"justifyleft":H=`[align=left]${h}[/align]`;break;case"insertimage":if(u=prompt("Image URL:")||"",!u)return;if(!e$(u)){alert("Please enter a valid URL.");return}H=`[img]${u}[/img]`;break;case"insertorderedlist":if(!this.htmlMode)H=`[ol]${h.replaceAll(/(.+([\r\n]+|$))/i,"* $1")}[/ol]`;break;case"insertunorderedlist":if(!this.htmlMode)H=`[ul]${h.replaceAll(/(.+([\r\n]+|$))/i,"* $1")}[/ul]`;break;case"createlink":if(u=prompt("Link:")||"",!u)return;if(!/^(https?|ftp|mailto):/.test(u))u=`https://${u}`;H=`[url=${u}]${h}[/url]`;break;case"c_email":if(u=prompt("Email:")||"",!u)return;M="createlink",u=`mailto:${u}`,H=`[url=${u}]${h}[/url]`;break;case"backcolor":if(k.firefox||k.safari)M="hilitecolor";H=`[bgcolor=${u}]${h}[/bgcolor]`;break;case"forecolor":H=`[color=${u}]${h}[/color]`;break;case"fontname":H=`[font=${u}]${h}[/font]`;break;case"c_code":M="inserthtml",u=`[code]${h}[/code]`,H=u;break;case"c_quote":M="inserthtml",u=prompt("Who said this?")||"",u=u?`=${u}`:"",u=`[quote${u}]${h}[/quote]`,H=u;break;case"c_spoiler":M="inserthtml",u=`[spoiler]${h}[/spoiler]`,H=u;break;case"c_youtube":if(M="inserthtml",u=prompt("Video URL?")||"",!u)return;u=`[video]${u}[/video]`,H=u;break;case"inserthtml":H=u||"";break;case"heading":if(H=`[${u}]${h}[/${u}]`,k.chrome)M="formatBlock",u=`<${u}>`;break;default:throw Error(`Unsupported editor command ${$}`)}if(this.htmlMode)this.doc?.execCommand(M,!1,u),this.doc?.dispatchEvent(new Event("input")),this.window?.focus();else R$(this.element,H),this.element.dispatchEvent(new Event("input"))}getSelection(){if(this.htmlMode)return this.window?.getSelection()?.toString()||"";return this.element.value.substring(this.element.selectionStart,this.element.selectionEnd)}getSource(){return this.doc?.body.innerHTML}setSource($){if(this.doc)this.doc.body.innerHTML=$}switchMode($){let{element:L,iframe:h}=this;if($)L.style.display="none",h.style.display="";else L.style.display="",h.style.display="none";this.htmlMode=$}}class o extends f{resetOnSubmit;static hydrate($){b("Form",$.querySelectorAll("form[data-ajax-form]"),this)}constructor($){super($);this.resetOnSubmit=$.dataset.ajaxForm==="resetOnSubmit",$.addEventListener("submit",(L)=>{L.preventDefault(),this.submitForm()})}submitForm(){let{element:$,resetOnSubmit:L}=this,{submitButton:h}=$,H=new FormData($,h),M=Array.from(H.entries()).filter((u)=>typeof u[1]==="string");if(RUN.stream.load($.action||globalThis.location.toString(),{body:new URLSearchParams(M)}),L)$.reset();RUN.stream.pollData()}}class m extends f{index;images;max;static hydrate($){b("ImageGallery",$.querySelectorAll(".image_gallery"),this)}constructor($){super($);let L=document.createElement("div"),h=document.createElement("button"),H=document.createElement("button");this.index=0,this.images=$.querySelectorAll("img"),this.max=Math.max(this.images.length,1),h.innerHTML="Next &raquo;",h.addEventListener("click",()=>{this.showNext()}),H.innerHTML="Prev &laquo;",H.addEventListener("click",()=>{this.showPrev()}),this.update(),L.appendChild(H),L.appendChild(document.createTextNode(" ")),L.appendChild(h),$.appendChild(L)}showNext(){if(this.index<this.max-1)this.index+=1;this.update()}showPrev(){if(this.index>0)this.index-=1;this.update()}update(){this.images.forEach(($,L)=>{let h=$.dataset.madeResized?$.parentNode:$;if(h)h.style.display=L===this.index?"block":"none"})}}var D$="999999px";class a extends f{static async hydrate($){let L=$.querySelectorAll(".bbcodeimg");await U(Array.from(L)),b("ImageResizer",L,this)}constructor($){super($);let L=1,h=1,{naturalWidth:H,naturalHeight:M}=$,u=W($),E=Number.parseInt(u.width,10)||Number.parseInt(u.maxWidth,10),T=Number.parseInt(u.height,10)||Number.parseInt(u.maxHeight,10);if(E&&H>E)L=E/M;if(T&&M>T)h=T/M;if(L=L&&h?Math.min(L,h):h||L,L<1)this.makeResizer(H*L,M*L)}makeResizer($,L){let{element:h}=this;h.style.maxWidth=D$,h.style.maxHeight=D$,h.dataset.madeResized="true";let H=Object.assign(document.createElement("a"),{target:"_blank",href:h.src});Object.assign(H.style,{display:"block",overflow:"hidden",width:`${$}px`,height:`${L}px`}),H.dataset.nw=`${h.naturalWidth}`,H.dataset.nh=`${h.naturalHeight}`,H.addEventListener("mousemove",(u)=>{let{x:E,y:T,w:x,h:F}=G(H);H.scrollLeft=(u.pageX-E)/x*(+(H.dataset.nw||0)-x)||0,H.scrollTop=(u.pageY-T)/F*(+(H.dataset.nh||0)-F)||0}),H.addEventListener("mouseover",()=>{h.style.width=`${H.dataset.nw}px`,h.style.height=`${H.dataset.nh}px`});let M=()=>{if(H.scrollLeft)H.scrollLeft=0,H.scrollTop=0;h.style.width=`${$}px`,h.style.height=`${L}px`};H.addEventListener("mouseout",M),M(),h.before(H),H.appendChild(h)}}function J($){let L=G($),h=$.getAttribute("title");if($.dataset.lastOnline){let M=Number.parseInt($.dataset.lastOnline??"",10);h=`Last Online: ${g(M)} ${f$(M)}`}if(!h)return;let H=document.querySelector("#tooltip");if(!H)H=_('<div id="tooltip" class="tooltip">Default text</div>'),document.querySelector("#page")?.appendChild(H);$.title="",$.addEventListener("mouseout",()=>{$.title=h,H.style.display="none"}),H.innerText=h,H.style.display="",Object.assign(H.style,{top:`${L.y-H.offsetHeight}px`,left:`${L.x}px`,zIndex:`${B()}`})}class n extends f{static hydrate($){b("Link",$.querySelectorAll("a"),this)}constructor($){super($);if($.dataset.useTooltip)$.addEventListener("mouseover",()=>J($));if(!$.href)return;let L=$.getAttribute("href"),h=!$.target&&L&&(L.startsWith("/")||L.startsWith("?"));if(L?.startsWith("javascript"))return;if(h){let M=$.onclick;$.onclick=null,$.addEventListener("click",(u)=>{if(u.preventDefault(),!M||M.call($,u)!==!1)RUN.stream.location(L)});return}$.target="_blank"}}class I${title="Title";wait=!0;content="Content";open=!1;minimizable=!0;resize;className="";pos="center";zIndex;windowContainer;id;onclose;animate=!0;oldpos="";constructor($={}){this.zIndex=B(),Object.assign(this,$)}render(){let $=_(`
      <div id="${this.id||""}" class="window ${this.className}">
        <div class="title">
          ${this.title}
          <div class="controls">
            ${this.minimizable?'<button data-action="minimize">-</button>':""}
            <button data-action="close" data-shortcut="Escape">X</button>
          </div>
        </div>
        <div class="content">${this.content}</div>
      </div>`);this.windowContainer=$,$.addEventListener("click",(M)=>{if(M.target instanceof HTMLElement){let u=M.target.dataset.action;if(u&&u in this)this[u]()}});let L=document.querySelector(".windows");if(!L)L=_('<div class="windows" style="z-index: 1"></div>'),document.body.appendChild(L);if(L.appendChild($),this.resize)this.renderResizeHandle(this.resize);let h=$.style;h.zIndex=`${this.zIndex+5}`;let{pos:H}=this;if(this.wait)U(Array.from($.querySelectorAll("img"))).then(()=>{this.setPosition(H)});else this.setPosition(H);return new z().autoZ().noChildActivation().boundingBox(0,0,document.documentElement.clientWidth-50,document.documentElement.clientHeight-50).apply($,$.querySelector(".title")||void 0),$}renderResizeHandle($){let{windowContainer:L}=this;if(!L)return;let h=L.querySelector($);if(!h)throw Error("Resize target not found");h.style.width=`${h.clientWidth}px`,h.style.height=`${h.clientHeight}px`;let H=_('<div class="resize"></div>');L.appendChild(H),H.style.left=`${L.clientWidth-16}px`,H.style.top=`${L.clientHeight-16}px`,new z().boundingBox(100,100,1/0,1/0).addListener({ondrag(M){let u=Number.parseFloat(h.style.width)+(M.dx??0),E=Number.parseFloat(h.style.height)+(M.dy??0);if(h.style.width=`${u}px`,u<L.clientWidth-20)h.style.width=`${L.clientWidth}px`;else H.style.left=`${L.clientWidth-16}px`;h.style.height=`${E}px`},ondrop(){H.style.left=`${L.clientWidth-16}px`}}).apply(H),h.style.width=`${L.clientWidth}px`,H.style.left=`${L.clientWidth-16}px`}close(){if(!this.windowContainer)return;if(this.windowContainer.remove(),this.windowContainer=void 0,this.onclose)this.onclose()}minimize(){let{windowContainer:$}=this;if(!$)return;let L=!$.classList.toggle("minimized");if($.querySelector(".controls [data-action=minimize]").innerHTML=L?"-":"\uD83D\uDDD6",L)$.removeAttribute("draggable");else $.setAttribute("draggable","false"),this.oldpos=this.getPosition();this.setPosition(L?this.oldpos:"",!1)}setPosition($,L=!0){let h=this.windowContainer;if(!h)return;let H=0,M=0,u=document.documentElement.clientHeight,E=document.documentElement.clientWidth;if($==="center")M=Math.floor((u-h.clientHeight)/2),H=Math.floor((E-h.clientWidth)/2);else{let T=/(\d+) (\d+)/.exec($);if(T)H=Number(T[1]),M=Number(T[2])}if(h.style.left=`${H}px`,this.animate&&L)N(h,[{top:`${M-100}px`},{top:`${M}px`}],300,"ease-out");else h.style.top=`${M}px`;this.pos=$}getPosition(){if(!this.windowContainer)return"";let $=this.windowContainer.style;return`${Number.parseFloat($.left)} ${Number.parseFloat($.top)}`}}var Q=I$;class e extends f{static hydrate($){b("MediaPlayer",$.querySelectorAll(".media"),this)}constructor($){super($);let L=$.querySelector("a.popout"),h=$.querySelector("a.inline"),H=$.querySelector(".movie");if(!H)return;L?.addEventListener("click",(M)=>{M.preventDefault(),new Q({title:L.href,content:H.innerHTML}).render()}),h?.addEventListener("click",(M)=>{M.preventDefault(),H.style.display="block"})}}class $$ extends f{static hydrate($){b("PageList",$.querySelectorAll(".pages"),this)}constructor($){super($);$.addEventListener("wheel",(L)=>this.wheel(L))}wheel($){$.preventDefault();let L=Math.sign($.deltaY),h=Array.from(this.element.querySelectorAll("a")),H=Number.parseInt(h[1].innerHTML,10),M=Number.parseInt(h.at(-1)?.innerHTML||"",10),u=h.length-2;if(L>0&&H+u<M||L<0&&H>2)for(let E=0;E<u;E+=1)h[E+1].href=h[E+1].href.replace(/\d+$/,`${E+H+L}`),h[E+1].innerHTML=`${H+E+L}`}}class h$ extends f{static hydrate($){b("Switch",$.querySelectorAll("input.switch"),this)}constructor($){super($);$.style.display="none";let L=Object.assign(document.createElement("button"),{type:"button",title:$.className,className:$.className}),h=()=>{L.style.backgroundPosition=$.checked?"top":"bottom"};h(),L.addEventListener("click",()=>{$.checked=!$.checked,h(),$.dispatchEvent(new Event("change"))}),$.after(L)}}var B$="active";class L$ extends f{static hydrate($){b("Tabs",$.querySelectorAll(".tabs"),this)}constructor($){super($);$.addEventListener("click",(L)=>this.click(L))}click($){let{tabSelector:L}=this.element.dataset,{target:h}=$;if(!h||!(h instanceof HTMLElement)||h.tagName.toLowerCase()!=="a")return;let H=h;if(L){let u=h.closest(L);if(u)H=u}let M=this.element.querySelector(`.${B$}`);if(M)M.classList.remove(B$);H.className=B$,H.blur()}}function P($){I(),[C,v,i,t,w,d,l,o,r,m,a,n,e,$$,h$,L$].forEach((L)=>{L.hydrate($)})}var c={loadscript($){document.body.appendChild(Object.assign(document.createElement("script"),{src:$}))},script($){(0,eval)($)},error($){K.error($)},success($){K.success($)},reload($=0){setTimeout(()=>globalThis.location.reload(),$)},refreshdata(){RUN.stream.pollData(!0)},addclass($,L){let h=document.querySelector($);if(h)h.classList.add(L)},title($){document.title=$},update($,L,h){let H=$,M=Array.from(document.querySelectorAll(".path"));if(H==="path"&&M.length>1){M.forEach((T)=>{T.innerHTML=L,P(T)});return}if(!/^\W/.test(H))H=`#${H}`;let u=document.querySelector(H);if(!u)return;u.innerHTML=L;let E=u.querySelector("[autofocus]");if(E)E.focus();if(h)x$(u);P(u)},removeel($){let L=document.querySelector($);if(L)L.remove()},back(){globalThis.history.back()},setstatus($){let L=document.querySelector("#status");if(L)L.className=$},appendrows($,L){let h=document.querySelector($);if(!h)return;let H=document.createElement("span");H.innerHTML=`<table>${L}</table>`;let M=H.getElementsByTagName("tbody")[0];P(M),h.appendChild(M)},location($){if(["?","/"].includes($.charAt(0))){RUN.stream.location($);return}document.location=$},enable($){let L=document.querySelector(`#${$}`);if(L)L.disabled=!1},addshout($){let L=Array.from(document.querySelectorAll("#shoutbox .shout")),h=document.createElement("span");h.innerHTML=$;let H=h.firstElementChild;if(!H)return;L[0].parentNode?.insertBefore(H,L[0]);while(L.length>globalSettings.shoutLimit-1)L.pop()?.remove();if(x$(H),globalSettings.soundShout)j.play("sbblip");P(H)},tick($){let L=document.querySelector("#ticker");if(!L)return;let h=document.createElement("div");h.innerHTML=$,h=h.firstElementChild,L.insertBefore(h,L.firstChild);let H=Array.from(L.querySelectorAll(".tick"));for(let M=100;M<H.length;M+=100)H[M].remove()},im($,L,h,H,M){y$({fromId:$,fromName:L,message:h,fromMe:H,timestamp:M})},imtoggleoffline($){document.querySelector(`#im_${$}`)?.classList.add("offline")},window($){if($.id&&document.getElementById($.id))return;let h=new Q($);P(h.render())},closewindow($){let L=document.querySelector($+" [data-action=close]");if(L)L.click()},onlinelist($){let L=document.querySelector("#statusers");if(!L)return;$.forEach((h)=>{let H=document.querySelector(`#statusers .user${h.uid}`);if(!H)H=document.createElement("a"),H.addEventListener("click",function(){if(this.href)RUN.stream.location(this.href)}),H.addEventListener("mouseover",function(){J(this)});if(h.profileURL)H.href=h.profileURL;if(H.innerHTML=h.name,H.className=[`user${h.uid}`,`mgroup${h.groupID}`,h.status,`lastAction${h.lastAction}`].join(" "),h.locationVerbose)H.title=h.locationVerbose;if(h.status==="idle"){b$(H);return}if(L.firstChild)L.insertBefore(H,L.firstChild);else L.appendChild(H)})},snow($){D($)},setoffline($){let L=document.querySelector("#statusers");$.split(",").forEach((H)=>{let M=document.querySelector(`#statusers .user${H}`);if(M&&L)M.remove()})},async scrollToPost($){let L=document.getElementById(`pid_${$}`);if(!L)return!1;await U(Array.from(document.querySelectorAll("#page img")));let h=G(L);return globalThis.scrollTo({top:h.y}),!0},updateqreply($){let h=document.querySelector("#qreply")?.querySelector("textarea");if(h)h.focus(),h.value+=$,h.dispatchEvent(new Event("input"))},newmessage($,L){let h=document.querySelector("#notification"),H=document.querySelector("#num-messages");if(H)H.innerHTML=`${Number.parseInt(H.innerHTML,10)+1}`;if(!h)h=document.createElement("div"),h.id="notification",document.body.appendChild(h);h.style.display="",h.className="newmessage",h.addEventListener("click",()=>{h.style.display="none",RUN.stream.location(`/ucp/inbox?view=${L}`,3)}),h.innerHTML=$},playsound($,L){j.loadAndPlay($,L)},listrating($,L){let h=document.querySelector(`#postrating_${$}`),H;if(h){if(h.style.display!=="none"){N(h,[{height:"200px"},{height:"0px"}],300).then((M)=>M.style.display="none");return}h.style.display="block"}else{h=document.createElement("div"),h.className="postrating_list",h.id=`postrating_${$}`;let M=document.querySelector(`#pid_${$} .postrating`);if(!M)return;H=G(M),h.style.top=`${H.yh}px`,h.style.left=`${H.x}px`,document.querySelector("#page")?.appendChild(h)}h.innerHTML=L,N(h,[{height:"0px"},{height:"200px"}],300)}};var X$,R="",J$="";function P$(){if(R)document.title=R;R="",clearInterval(X$)}function p$($){if(document.hasFocus())return;if(P$(),!R)R=document.title;J$=$,X$=setInterval(()=>{document.title=document.title===R?J$:R},1000)}function $h($,L){if(p$(`New message from ${$}!`),!document.hasFocus()&&globalThis.Notification&&Notification.permission==="granted"){let h=new Notification(`${$} says:`,{body:L});h.onclick=()=>{globalThis.focus(),h.close()}}}function hh({fromId:$,fromName:L,message:h}){let H=document.querySelector(`#im_${$} .ims`);if(H)return H;let u=new Q({title:`${L}`,content:`
        <div class='ims'></div>
        <div class='offline'>This user may be offline</div>
        <div>
            <form data-ajax-form='resetOnSubmit' method='post'>
                <input type='hidden' name='im_uid' value='${$}'>
                <input type='text' name='im_im' autocomplete='off'>
            </form>
        </div>
    `,className:"im",resize:".ims",animate:!0,id:`im_${$}`}).render();P(u);let E=()=>{u.querySelector('form input[name="im_im"]')?.focus()};u.addEventListener("click",E),E(),H=u.querySelector(".ims");let T=getComputedStyle(H);if(H.style.width=T.width,H.style.height=T.height,h&&globalSettings.soundIM)j.play("imnewwindow");return H}function A$($,L){if(!globalSettings.canIM){alert("You do not have permission to use this feature.");return}c.im($,L,"",1,Date.now())}function y$({fromId:$,fromName:L,message:h,fromMe:H,timestamp:M}){$h(L,h);let u=hh({fromId:$,fromName:L,message:h});if(!h)return;let E=h.startsWith("/me");if(!H)document.querySelector(`#im_${$}`)?.classList.remove("offline");let T=_(`
    <div class="${E?"action":""} ${H?"you":"them"}" data-timestamp="${M}">
      <a href="/profile/${H||$}" class="name">${E?"***"+L:L}</a>
      ${E?h.substring(3):": "+h}
    </div>
  `);if(u.appendChild(T),P(T),u.scrollTop>u.scrollHeight-u.clientHeight-50)u.scrollTop=u.scrollHeight;if(globalSettings.soundIM)j.play("imbeep")}function Lh($){let L=$?$.split(","):[],h=L.length===1?"":"s",H=L.length?" and <br>":"";return[L,h,H]}function Hh($){let L=$?$.split(","):[],H=(L?L.length:0)===1?"":"s";return[L,H]}class H${whichone=0;boundCheckLocation;pids=[];tids=[];modb;constructor(){this.boundCheckLocation=()=>this.checkLocation(),Object.assign(c,{modcontrols_clearbox:this.destroyModControls.bind(this),modcontrols_move:this.showMoveControls.bind(this),modcontrols_postsync:this.postSync.bind(this)})}checkLocation(){let{whichone:$}=this,h=($?/topic\/(\d+)/:/forum\/(\d+)/).exec(document.location.toString());if(h)this.moveTo(Number(h[1]));else this.showMoveControls($)}moveTo($){let{whichone:L}=this;this.renderModControls(`<form method="post" action="/modcontrols" data-ajax-form="true">
                move ${L?"posts":"topics"} here?
            <input type="hidden"
                name="${L?"dop":"dot"}"
                value="moveto">
            <input type="hidden" name="id" value="${$}">
            <input type="submit" value="Yes">
            <input type="submit" name="cancel" value="Cancel" onclick="this.form.submitButton=this">
            </form>`)}renderModControls($){if(this.modb=this.modb||document.querySelector("#modbox")||void 0,!this.modb)this.modb=document.createElement("div"),this.modb.id="modbox",document.body.appendChild(this.modb);this.modb.style.display="block",this.modb.innerHTML=$,P(this.modb)}destroyModControls(){if(globalThis.removeEventListener("pushstate",this.boundCheckLocation),this.modb)this.modb.innerHTML="",this.modb.style.display="none"}togbutton($){$.classList.toggle("selected")}postSync($,L){let[h,H,M]=Lh($),[u,E]=Hh(L);if(this.tids=u,this.pids=h,!u.length&&!h.length){this.destroyModControls();return}let T=u.length?`
            <select name="dot">
                <option value="delete">Delete</option>
                <option value="merge">Merge</option>
                <option value="move">Move</option>
                <option value="pin">Pin</option>
                <option value="unpin">Unpin</option>
                <option value="lock">Lock</option>
                <option value="unlock">Unlock</option>
            </select> &nbsp; &nbsp;
            <strong>${u.length}</strong> topic${E}${M}`:"",x=h.length?`
            <select name="dop">
                <option value="delete">Delete</option>
                <option value="move">Move</option>
            </select> &nbsp; &nbsp;
            <strong>${h.length}</strong> post${H}`:"",F=h.length&&u.length?"<br>":" &nbsp; &nbsp; ",A=`
        <form method="post" action="/modcontrols" data-ajax-form="true">
            ${T}
            ${x}
            ${F}
            <input type="submit" value="Go">
            <input
                name="cancel" type="submit"
                onclick="this.form.submitButton=this;" value="Cancel">
        </form>`;this.renderModControls(A)}showMoveControls($){this.whichone=$,globalThis.addEventListener("pushstate",this.boundCheckLocation),this.renderModControls(`Ok, now browse to the ${this.whichone?"topic":"forum"} you want to move the ${this.whichone?`${this.pids.length} posts`:`${this.tids.length} topics`} to...`)}}function Mh(){new Q({title:"Keyboard Shortcuts",id:"shortcuts",content:`
      <style>
        #shortcuts { width: 300px; }
        #shortcuts dt { float: left;margin-left: 5px;}
      </style>
      <h3>Navigation</h3>
      <dl>
        <dt>?</dt><dd>This help window</dd>
        <dt>h</dt><dd>Home / Board Index</dd>
        <dt>i</dt><dd>Inbox</dd>
        <dt>s</dt><dd>Settings</dd>
        `+(globalSettings.isAdmin?"<dt>a</dt><dd>Admin CP</dd>":"")+(globalSettings.isMod?"<dt>m</dt><dd>Moderator CP</dd>":"")+`</dl>

      <h3>Inbox</h3>
      <dl>
        <dt>c</dt><dd>Compose</dd>
        <dt>i</dt><dd>Inbox</dd>
        <dt>f</dt><dd>Flagged Messages</dd>
        <dt>r</dt><dd>Reply to Message</dd>
      </dl>

      <h3>Forum/Topic</h3>
      <dl>
        <dt>t</dt><dd>New Topic</dd>
        <dt>r</dt><dd>Reply</dd>
      </dl>
      `}).render()}function g$($){if($.target instanceof HTMLInputElement||$.target instanceof HTMLTextAreaElement||$.target instanceof HTMLSelectElement)return;if($.key==="?"){Mh();return}document.documentElement.querySelector(`[data-shortcut="${$.key}"]`)?.click()}var uh=5000;class M${commands;lastURL;timeout;constructor(){this.lastURL=`${document.location.pathname}${document.location.search}`,this.commands=c}handleRequestData($,L,h=1){let H=!1;if(L.forEach(([M,...u])=>{if(M==="preventNavigation")H=!0;else if(M in this.commands)this.commands[M].apply(null,u)}),h>=2){if(!H)globalThis.history.pushState({lastURL:$},"",$),globalThis.dispatchEvent(new Event("pushstate")),this.lastURL=$}this.pollData()}location($,L=2){this.load($,{requestType:L})}async load($,{body:L,method:h="POST",requestType:H=1}={}){try{let M=await fetch($,{method:h,body:L,headers:{"X-JSACCESS":`${H}`,"Content-Type":"application/x-www-form-urlencoded"}});if(M.ok){let u=await M.json();this.handleRequestData($,u,H);return}K.error("An unrecoverable error has occurred.<br>Please try again later.")}catch(M){if(!navigator.onLine)K.error("You appear to be offline.");else K.error("Network fetch failed: timeout")}}pollData($=!1){if($)this.load(this.lastURL);if(clearTimeout(this.timeout),document.cookie.includes(`actw=${window.name}`))this.timeout=setTimeout(()=>this.load(this.lastURL),uh)}updatePage($){if($!==this.lastURL)this.location($,3)}}var Eh=2;class r${stream=new M$;onAppReady(){if(Eh)P(document.body);let $=new Date;if($.getMonth()===11&&[23,24,25].includes($.getDate()))D();I(),setInterval(I,30000),this.stream.pollData(),globalThis.addEventListener("popstate",({state:h})=>{if(h){let{lastURL:H}=h;this.stream.updatePage(H)}else this.stream.updatePage(document.location.toString())}),j.load("sbblip","/Sounds/blip.mp3",!1),j.load("imbeep","/Sounds/receive.mp3",!1),j.load("imnewwindow","/Sounds/receive.mp3",!1)}handleQuoting($){let L=new URLSearchParams($.search),h=L.get("quote");if(h){let H=document.querySelector(`#pid_${h} .post_content`),M=window.getSelection();if(H&&M&&H.contains(M.anchorNode)&&H.contains(M.focusNode))L.set("quotedText",M.toString())}L.set("qreply",document.querySelector("#qreply")?"1":"0"),this.stream.load(`${$.pathname}?${L.toString()}`)}setWindowActive(){document.cookie=`actw=${window.name}; SameSite:Lax`,P$(),this.stream.pollData()}}var u$=new r$;y(()=>{u$.onAppReady()});y(()=>{window.name=`${Math.random()}`,u$.setWindowActive(),globalThis.addEventListener("focus",()=>{u$.setWindowActive()})});y(function(){if(!Z$())document.documentElement.classList.add("no-emoji");document.documentElement.classList.add("js-enabled")});y(()=>{globalThis.addEventListener("keyup",g$)});var C$=u$;Object.assign(globalThis,{RUN:C$,IMWindow:A$,ModControls:new H$});

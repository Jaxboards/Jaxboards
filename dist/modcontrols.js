"use strict";(()=>{function vt(r){return r+(Math.round(r/10)===1?"th":["","st","nd","rd"][r%10]||"th")}function _(r){let t=r.getHours()||12,e=`${r.getMinutes()}`.padStart(2,"0");return`${t%12||12}:${e}${t>12?"pm":"am"}`}function z(r){return`${r.getMonth()}/${r.getDate()}/${r.getFullYear()}`}function U(r){return new Date(r*1e3)}var Ct=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],nt=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],rt=["January","February","March","April","May","June","July","August","September","October","November","December"];function lt(r){let t=new Date,e=new Date;e.setTime(+e-1e3*60*60*24);let s=U(r),o=(+t-+s)/1e3;return o<90?"a minute ago":o<3600?`${Math.round(o/60)} minutes ago`:z(t)===z(s)?`Today @ ${_(s)}`:z(e)===z(s)?`Yesterday @ ${_(s)}`:`${Ct[s.getMonth()]} ${vt(s.getDate())}, ${s.getFullYear()} @ ${_(s)}`}function O(r){let t=U(r),e=t.getHours(),s=e>=12?"pm":"am";e%=12,e=e||12;let o=`${t.getMinutes()}`.padStart(2,"0"),n=t.getMonth()+1,l=`${t.getDate()}`.padStart(2,"0"),i=t.getFullYear();return`${e}:${o}${s}, ${n}/${l}/${i}`}function Et(r){let t=U(r);return String.fromCharCode(55357,56656+((t.getHours()%12||12)-1)+(t.getMinutes()>29?12:0))}function at(r){let t=Array.from(r.classList).find(e=>e.startsWith("lastAction"));t!==void 0&&(r.prepend(Et(parseInt(t.slice(10),10))),r.classList.remove(t))}function Lt(r){let t=document.body,e=document.documentElement;switch(r.keyCode){case 13:r.ENTER=!0;break;case 37:r.LEFT=!0;break;case 38:r.UP=!0;break;case .39:r.RIGHT=!0;break;case 40:r.DOWN=!0;break;default:break}return typeof r.srcElement>"u"&&(r.srcElement=r.target),typeof r.pageY>"u"&&(r.pageY=r.clientY+(parseInt(e.scrollTop||t.scrollTop,10)||0),r.pageX=r.clientX+(parseInt(e.scrollLeft||t.scrollLeft,10)||0)),r.cancel=()=>(r.returnValue=!1,r.preventDefault&&r.preventDefault(),r),r.stopBubbling=()=>(r.stopPropagation&&r.stopPropagation(),r.cancelBubble=!0,r),r}var L=Lt;function b(r,t){return r?r.currentStyle?r.currentStyle:window.getComputedStyle?window.getComputedStyle(r,t):!1:!1}function y(r){let{x:t,y:e,height:s,width:o}=r.getBoundingClientRect(),n=t+window.scrollX,l=e+window.scrollY;return{x:n,y:l,yh:l+s,xw:n+o,w:o,h:s}}function ct(r,t){return t.contains(r)}function q(r,t){r.parentNode&&r.parentNode.removeChild(r),t.parentNode.insertBefore(r,t)}function F(r,t){r.parentNode&&r.parentNode.removeChild(r),t.parentNode.insertBefore(r,t.nextSibling)}function g(){return Array.from(document.getElementsByTagName("*")).reduce((e,s)=>s.style.zIndex&&Number(s.style.zIndex)>e?Number(s.style.zIndex):e,0)+1}var dt="999999px";function kt(r,t,e,s,o){o.style.maxWidth=dt,o.style.maxHeight=dt,o.madeResized=!0;let n=document.createElement("a");n.target="newwin",n.href=o.src,n.style.display="block",n.style.overflow="hidden",n.style.width=`${r}px`,n.style.height=`${e}px`,n.nw=t,n.nh=s,n.onmousemove=l=>{let i=y(n),a=L(l);n.scrollLeft=(a.pageX-i.x)/i.w*(n.nw-i.w)||0,n.scrollTop=(a.pageY-i.y)/i.h*(n.nh-i.h)||0},n.onmouseover=()=>{o.style.width=`${n.nw}px`,o.style.height=`${n.nh}px`},n.onmouseout=()=>{n.scrollLeft&&(n.scrollLeft=0,n.scrollTop=0),o.style.width=`${r}px`,o.style.height=`${e}px`},n.onmouseout(),q(n,o),n.appendChild(o)}function ht(r){let t,e,s;!r||!r.length||Array.from(r).filter(o=>!o.madeResized).forEach(o=>{let n=1,l=1,{naturalWidth:i,naturalHeight:a}=o,d=i,c=a;s=b(o),t=parseInt(s.width,10)||parseInt(s.maxWidth,10),e=parseInt(s.height,10)||parseInt(s.maxHeight,10),t&&d>t&&(n=t/d),e&&c>e&&(l=e/c),n=n&&l?Math.min(n,l):l||n,n<1&&(d*=n,c*=n,kt(d,i,c,a,o))})}function Y(r){let t=document.getElementById("tooltip_thingy"),e=y(r),s=r.getAttribute("title");if(s){if(r.title="",!t){t=document.createElement("table");let o=t.insertRow(0),n=t.insertRow(1),l=t.insertRow(2),i;t.id="tooltip_thingy",t.className="tooltip",o.className="top",n.className="content",l.className="bottom",i=o.insertCell(0),i.className="left",i.colSpan=2,i=o.insertCell(1),i.className="right",i=n.insertCell(0),i.className="left",i=n.insertCell(1),i.innerHTML="default text",i=n.insertCell(2),i.className="right",i=l.insertCell(0),i.className="left",i.colSpan=2,i=l.insertCell(1),i.className="right",document.querySelector("#page").appendChild(t)}t.rows[1].cells[1].innerText=s,t.style.display="",t.style.top=`${e.y-t.clientHeight}px`,t.style.left=`${e.x}px`,t.style.zIndex=g(),r.onmouseout=()=>{r.title=s,document.querySelector("#tooltip_thingy").style.display="none"}}}function ut(r){if(document.selection){let t=document.body.createTextRange();t.moveToElementText(r),t.select()}else if(window.getSelection){let t=document.createRange();t.selectNode(r);let e=window.getSelection();e.rangeCount&&e.removeAllRanges(),e.addRange(t)}}function pt(r,t){let e=r.scrollTop;if(document.selection)r.focus(),document.selection.createRange().text=t;else{let s=r.selectionStart,o=r.selectionEnd;r.value=r.value.substring(0,s)+t+r.value.substr(o),r.selectionStart=s+t.length,r.selectionEnd=s+t.length}r.focus(),r.scrollTop=e}function mt(r,t){return r?t?r.map((e,s)=>`${encodeURIComponent(e)}=${encodeURIComponent(t[s]||"")}`).join("&"):Object.keys(r).map(e=>`${encodeURIComponent(e)}=${encodeURIComponent(r[e]||"")}`).join("&"):""}var j=class{constructor(t){this.setup={readyState:4,callback(){},method:"POST",...t}}load(t,{callback:e,data:s,method:o=this.setup.method,requestType:n=1}={}){let l=null;s&&Array.isArray(s)&&Array.isArray(s[0])&&s[0].length===s[1].length?l=mt(s[0],s[1]):typeof s!="string"&&(l=mt(s));let i=new XMLHttpRequest;return e&&(this.setup.callback=e),i.onreadystatechange=()=>{i.readyState===this.setup.readyState&&this.setup.callback(i)},i.open(o,t,!0),i.url=t,i.type=n,o&&i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),i.setRequestHeader("X-JSACCESS",n),i.send(l),i}},W=j;var m=class{static get selector(){throw new Error("No Selector defined")}constructor(t){this.element=t,t.hydrated=!0}};function f(r,t){return Object.assign(r,t)}function C(r,...t){return r&&typeof r=="function"?r(...t):null}function P(r,t=2e3){return new Promise(e=>{let s=new Set,o=Array.from(r).filter(l=>!l.complete);if(!o.length){e();return}function n(){s.delete(this.src),s.size===0&&e()}o.forEach(l=>{s.has(l.src)||(s.add(l.src),l.addEventListener("error",n),l.addEventListener("load",n))}),t&&setTimeout(e,t)})}function ft(){let r=document.querySelectorAll(".autodate"),t=Array.from(document.querySelectorAll("[data-timestamp]"));r&&(r.forEach(e=>{let s=parseInt(e.title,10),o=e.classList.contains("smalldate")?O(s):lt(s);o!==e.innerHTML&&(e.innerHTML=o)}),t.forEach(e=>{e.title||(e.title=O(e.dataset.timestamp))}))}function X(r){let t=document.documentElement,e=document.getElementById("overlay");if(e)f(e.style,{zIndex:g(),top:0,height:`${t.clientHeight}px`,width:`${t.clientWidth}px`,display:r?"":"none"});else{if(!r)return;e=document.createElement("div"),e.id="overlay",f(e.style,{height:`${t.clientHeight}0px`,width:`${t.clientWidth}0px`}),t.appendChild(e)}}function gt(r){document.readyState==="complete"?r():document.addEventListener("DOMContentLoaded",r)}var yt="valid",St="invalid",k=class extends m{static get selector(){return"input[data-autocomplete-action]"}constructor(t){super(t),t.autocomplete="off",this.action=t.dataset.autocompleteAction;let e=t.dataset.autocompleteOutput,s=t.dataset.autocompleteIndicator;if(this.outputElement=e&&document.querySelector(e),this.indicatorElement=s&&document.querySelector(s),!this.outputElement)throw new Error("Expected element to have data-autocomplete-output");t.addEventListener("keyup",o=>this.keyUp(o)),t.addEventListener("keydown",o=>{o.key==="Enter"&&o.preventDefault()})}getResultsContainer(){let t=y(this.element),e=document.querySelector("#autocomplete");return e||(e=f(document.createElement("div"),{id:"autocomplete"}),f(e.style,{zIndex:g()}),document.body.appendChild(e)),f(e.style,{top:`${t.yh}px`,left:`${t.x}px`,width:`${t.w}px`}),e}keyUp(t){let e=this.getResultsContainer(),s=Array.from(e.querySelectorAll("div")),o=s.findIndex(a=>a.classList.contains("selected"));if(s)switch(t.key){case"ArrowUp":o>=0&&(s[o].classList.remove("selected"),s[o-1].classList.add("selected"));return;case"ArrowDown":o===-1?s[0].classList.add("selected"):o<s.length-1&&(s[o].classList.remove("selected"),s[o+1].classList.add("selected"));return;case"Enter":o>=0&&s[o].onclick();return;default:this.indicatorElement&&(this.indicatorElement.classList.remove(yt),this.indicatorElement.classList.add(St));break}let n=document.location.toString().match("/ACP/")?"../":"",l=encodeURIComponent(this.element.value),i=`act=${this.action}&term=${l}`;new W().load(`${n}api/?${i}`,{callback:a=>{let d=JSON.parse(a.responseText);if(e.innerHTML="",!d.length)e.style.display="none";else{e.style.display="";let[c,u]=d;c.forEach((p,h)=>{let w=u[h],x=document.createElement("div");x.innerHTML=w,x.onclick=()=>{e.style.display="none",this.indicatorElement&&this.indicatorElement.classList.add(yt),this.outputElement.value=p,this.outputElement.dispatchEvent(new Event("change")),this.element.value=w},e.appendChild(x)})}}})}};var Z=class{constructor(t){let e=t;if(typeof e=="object")this.rgb=e;else if(typeof e=="string"){let s=e.match(/^rgb\((\d+),\s?(\d+),\s?(\d+)\)/i),o=e.match(/#?[^\da-fA-F]/);if(s)s[1]=parseFloat(s[1]),s[2]=parseFloat(s[2]),s[3]=parseFloat(s[3]),s.shift(),this.rgb=s;else if(o)if(e.charAt(0)==="#"&&(e=e.substr(1)),e.length===3&&(e=e.charAt(0)+e.charAt(0)+e.charAt(1)+e.charAt(1)+e.charAt(2)+e.charAt(2)),e.length!==6)this.rgb=[0,0,0];else{this.rgb=[];for(let n=0;n<3;n+=1)this.rgb[n]=parseInt(e.substr(n*2,2),16)}}else this.rgb=[0,0,0]}invert(){return this.rgb=[255-this.rgb[0],255-this.rgb[1],255-this.rgb[2]],this}toRGB(){return this.rgb}toHex(){if(!this.rgb)return!1;let t,e="",s,o="0123456789ABCDEF";for(s=0;s<3;s+=1)t=this.rgb[s],e+=o.charAt(Math.floor(t/16))+o.charAt(Math.floor(t%16));return e}},E=Z;var J=class{constructor(t,e,s,o){this.el=t,this.steps=e||30,this.delay=s||20,this.curLineup=0,this.stepCount=0,this.loop=o||0,this.lineup=[[]]}play(){return this.interval=setInterval(()=>this.step(),this.delay),this}morph(t,e,s){return Array.isArray(t)&&t.length===s.length?t.map((o,n)=>Math.round(this.morph(o,e,s[n]))):(s-t)*e+t}step(){let t=this.lineup[this.curLineup];this.stepCount+=1;let e=this.stepCount;typeof t[0]=="function"?(t[0](this.el),e=this.steps):t.forEach(s=>{let o=this.morph(s[1],e/this.steps,s[2]);s[0].match(/color/i)?o=`#${new E(o).toHex()}`:s[0]!=="opacity"&&(o=Math.round(o)),this.el.style[s[0]]=s[3]+o+s[4]}),e===this.steps&&(this.lineup.length-1>this.curLineup?(this.stepCount=0,this.curLineup+=1):this.loop===1?(this.stepCount=0,this.curLineup=0):clearInterval(this.interval))}add(t,e,s){let o=["","",""],n;return t.match(/color/i)?(n=new E(e).toRGB(),o[1]=new E(s).toRGB()):(o=s.match(/(\D*)(-?\d+)(\D*)/),o.shift(),n=parseFloat(e.match(/-?\d+/))),this.lineup[this.lineup.length-1].push([t,n,o[1],o[0],o[2]]),this}dehighlight(){this.el.style.backgroundColor="";let t=b(this.el).backgroundColor.toString(),e;return this.el.classList.add("highlight"),e=b(this.el).backgroundColor.toString(),e===t&&(e="FF0"),this.el.classList.add("highlight"),this.add("backgroundColor",e,t).then(()=>{this.el.style.backgroundColor=t})}then(t,e,s,o){return this.lineup.push([]),o&&(this.steps=o),typeof t=="function"?this.lineup[this.lineup.length-1].push(t):this.add(t,e,s),this}},S=J;var M=class extends m{static get selector(){return".collapse-box"}constructor(t){super(t),t.querySelector(".collapse-button").addEventListener("click",()=>this.click())}click(){let t=this.element.querySelector(".collapse-content"),e=t.style,s=t.dataset.fullHeight,o=t.parentNode;e.overflow="hidden",e.height==="0px"?new S(t,5,10,0).add("height","0px",s).then(()=>{o.classList.remove("collapsed")}).play():(s||(s=`${t.clientHeight||t.offsetHeight}px`,t.dataset.fullHeight=s),new S(t,5,10,0).add("height",s,"0px").then(()=>{o.classList.add("collapsed")}).play())}};var A=class extends m{static get selector(){return"input.date"}constructor(t){super(t),this.picker=this.getPicker(),t.autocomplete="off",t.addEventListener("focus",()=>this.openPicker()),t.addEventListener("keydown",()=>this.closePicker())}getPicker(){if(this.picker)return this.picker;let t=document.querySelector("#datepicker");return t||(t=f(document.createElement("table"),{id:"datepicker"}),document.body.appendChild(t),t.style.display="none"),t}openPicker(){let t=y(this.element);f(this.picker.style,{display:"",zIndex:g(),position:"absolute",top:`${t.yh}px`,left:`${t.x}px`});let[e,s,o]=this.element.value.split("/").map(n=>parseInt(n,10));e&&s&&o?this.selectedDate=[o,e-1,s]:this.selectedDate=void 0,this.generate(o,e,s)}closePicker(){this.picker.style.display="none"}generate(t,e,s){let o=new Date,n=document.querySelector("#datepicker"),l,i,[a,d,c]=[t,e,s];a===void 0&&(a=o.getFullYear(),d=o.getMonth(),c=o.getDate(),this.selectedDate=[a,d,c]),d===-1&&(a-=1,d=11),d===12&&(a+=1,d=0),this.lastDate=[a,d,c];let u=new Date(a,d+1,0).getDate(),p=new Date(a,d,1).getDay();o=new Date(a,d,c),n.innerHTML="",l=n.insertRow(0),i=l.insertCell(0),i.innerHTML="&lt;",i.className="control",i.onclick=()=>this.lastYear(),i=l.insertCell(1),i.colSpan="5",i.className="year",i.innerHTML=a,i=l.insertCell(2),i.innerHTML=">",i.className="control",i.onclick=()=>this.nextYear(),l=n.insertRow(1),i=l.insertCell(0),i.innerHTML="<",i.className="control",i.onclick=()=>this.lastMonth(),i=l.insertCell(1),i.colSpan="5",i.innerHTML=rt[d],i.className="month",i=l.insertCell(2),i.innerHTML=">",i.className="control",i.onclick=()=>this.nextMonth(),l=n.insertRow(2),l.className="weekdays";for(let h=0;h<7;h+=1)l.insertCell(h).innerHTML=nt[h];l=n.insertRow(3);for(let h=0;h<u;h+=1){if(!h)for(let x=0;x<p;x+=1)l.insertCell(x);(p+h)%7===0&&(l=n.insertRow(n.rows.length)),i=l.insertCell((p+h)%7),i.onclick=this.insert.bind(this,i);let w=a===this.selectedDate[0]&&d===this.selectedDate[1]&&h+1===this.selectedDate[2];i.className=`day${w?" selected":""}`,i.innerHTML=h+1}}lastYear(){let t=this.lastDate;this.generate(t[0]-1,t[1],t[2])}nextYear(){let t=this.lastDate;this.generate(t[0]+1,t[1],t[2])}lastMonth(){let t=this.lastDate;this.generate(t[0],t[1]-1,t[2])}nextMonth(){let t=this.lastDate;this.generate(t[0],t[1]+1,t[2])}insert(t){let e=this.lastDate;this.element.value=`${e[1]+1}/${t.innerHTML}/${e[0]}`,this.closePicker()}};var I=class extends m{static get selector(){return".image_gallery"}constructor(t){super(t);let e=document.createElement("div"),s=document.createElement("button"),o=document.createElement("button");this.index=0,this.images=t.querySelectorAll("img"),this.max=Math.max(this.images.length,1),s.innerHTML="Next &raquo;",s.addEventListener("click",()=>{this.showNext()}),o.innerHTML="Prev &laquo;",o.addEventListener("click",()=>{this.showPrev()}),this.update(),e.appendChild(o),e.appendChild(document.createTextNode(" ")),e.appendChild(s),t.appendChild(e)}showNext(){this.index<this.max-1&&(this.index+=1),this.update()}showPrev(){this.index>0&&(this.index-=1),this.update()}update(){this.images.forEach((t,e)=>{let s;t.madeResized?s=t.parentNode:s=t,s.style.display=e!==this.index?"none":"block"})}};var T=class extends m{static get selector(){return".pages"}constructor(t){super(t),t.addEventListener("wheel",e=>this.wheel(e))}wheel(t){t.preventDefault();let e=Math.sign(t.deltaY),s=Array.from(this.element.querySelectorAll("a")),o=parseInt(s[1].innerHTML,10),n=parseInt(s[s.length-1].innerHTML,10),l=s.length-2;if(e>0&&o+l<n||e<0&&o>2)for(let i=0;i<l;i+=1)s[i+1].href=s[i+1].href.replace(/\d+$/,i+o+e),s[i+1].innerHTML=o+i+e}};var N=class extends m{static get selector(){return"input.switch"}constructor(t){super(t),t.style.display="none";let e=f(document.createElement("button"),{type:"button",title:t.className,className:t.className}),s=()=>{e.style.backgroundPosition=t.checked?"top":"bottom"};s(),e.addEventListener("click",()=>{t.checked=!t.checked,s(),t.dispatchEvent(new Event("change"))}),F(e,t)}};var G="active",H=class extends m{static get selector(){return".tabs"}constructor(t){super(t),t.addEventListener("click",e=>this.click(e))}click(t){let{tabSelector:e}=this.element.dataset,{target:s}=t;if(s.tagName.toLowerCase()!=="a")return;e&&(s=s.closest(e));let o=this.element.querySelector(`.${G}`);o&&o.classList.remove(G),s.className=G,s.blur()}};var{userAgent:v}=navigator,$={chrome:/chrome/i.test(v),ie:/msie/i.test(v),iphone:/iphone/i.test(v),mobile:/mobile/i.test(v),n3ds:/nintendo 3ds/.test(v),firefox:/firefox/i.test(v),safari:/safari/i.test(v)};var Mt=["SCRIPT","STYLE","HR"];function V(r){let t=r,e=/<(\w+)([^>]*)>([^]*?)<\/\1>/gi;return t=t.replace(/[\r\n]+/g,""),t=t.replace(/<(hr|br|meta)[^>]*>/gi,`
`),t=t.replace(/<img.*?src=["']?([^'"]+)["'](?: alt=["']?([^"']+)["'])?[^>]*\/?>/g,(s,o,n)=>n||`[img]${o}[/img]`),t=t.replace(e,(s,o,n,l)=>{let i=e.test(l)?V(l):l,a={};n.replace(/(color|size|style|href|src)=(['"]?)(.*?)\2/gi,(Ht,wt,Dt,$t)=>{a[wt]=$t});let{style:d=""}=a,c=o.toLowerCase();if(Mt.includes(c))return"";let u=d.match(/text-align: ?(right|center|left)/i),p=d.match(/background(-color)?:[^;]+(rgb\([^)]+\)|#\s+)/i),h=d.match(/font-style: ?italic/i),w=d.match(/text-decoration:[^;]*underline/i),x=d.match(/text-decoration:[^;]*line-through/i),st=d.match(/font-size: ?([^;]+)/i),it=d.match(/color: ?([^;]+)/i),xt=d.match(/font-weight: ?bold/i);return p&&(i=`[bgcolor=#${new E(p[2]).toHex()}]${i}[/bgcolor]`),u&&(i=`[align=${u[1]}]${i}[/align]`),(h||c==="i"||c==="em")&&(i=`[I]${i}[/I]`),(w||c==="u")&&(i=`[U]${i}[/U]`),(x||c==="s"||c==="strike")&&(i=`[S]${i}[/S]`),(xt||c==="strong"||c==="b")&&(i=`[B]${i}[/B]`),(a.size||st)&&(i=`[size=${a.size||st[1]}]${i}[/size]`),(a.color||it)&&(i=`[color=${a.color||it[1]}]${i}[/color]`),c==="a"&&a.href&&(i=`[url=${a.href}]${i}[/url]`),c==="ol"&&(i=`[ol]${i}[/ol]`),c==="ul"&&(i=`[ul]${i}[/ul]`),c.match(/h\d/i)&&(i=`[${c}]${i}[/${c}]`),c==="li"&&(i=`*${i.replace(/[\n\r]+/,"")}
`),c==="p"&&(i=`
${i==="&nbsp"?"":i}
`),c==="div"&&(i=`
${i}`),i}),t.replace(/&amp;/g,"&").replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&nbsp;/g," ")}function Q(r){let t=r.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/(\s) /g,"$1&nbsp;");return t=t.replace(/\[b\]([^]*?)\[\/b\]/gi,"<b>$1</b>"),t=t.replace(/\[i\]([^]*?)\[\/i\]/gi,"<i>$1</i>"),t=t.replace(/\[u\]([^]*?)\[\/u\]/gi,"<u>$1</u>"),t=t.replace(/\[s\]([^]*?)\[\/s\]/gi,"<s>$1</s>"),t=t.replace(/\[img\]([^'"[]+)\[\/img\]/gi,'<img src="$1">'),t=t.replace(/\[color=([^\]]+)\](.*?)\[\/color\]/gi,'<span style="color:$1">$2</span>'),t=t.replace(/\[size=([^\]]+)\](.*?)\[\/size\]/gi,'<span style="font-size:$1">$2</span>'),t=t.replace(/\[url=([^\]]+)\](.*?)\[\/url\]/gi,'<a href="$1">$2</a>'),t=t.replace(/\[bgcolor=([^\]]+)\](.*?)\[\/bgcolor\]/gi,'<span style="backgroun-color:$1">$2</span>'),t=t.replace(/\[h(\d)\](.*?)\[\/h\1\]/g,"<h$1>$2</h$1>"),t=t.replace(/\[align=(left|right|center)\](.*?)\[\/align\]/g,'<div style="text-align:$1">$2</div>'),t=t.replace(/\[(ul|ol)\]([^]*?)\[\/\1\]/gi,(e,s,o)=>{let l=o.split(/(^|[\r\n]+)\*/).filter(i=>i.trim()).map(i=>`<li>${i}</li>`).join("");return`<${s}>${l}</${s}>`}),t=t.replace(/\n/g,"<br />"),t}var At=/^(ht|f)tps?:\/\/[\w.\-%&?=/]+$/,It=r=>At.test(r),D=class extends m{static get selector(){return"textarea.bbcode-editor"}constructor(t){super(t),this.iframe=document.createElement("iframe"),this.iframe.addEventListener("load",()=>this.iframeLoaded()),this.iframe.style.display="none",F(this.iframe,t),t.closest("form").addEventListener("submit",()=>{this.submit()})}iframeLoaded(){let{iframe:t,element:e}=this;t.className="editorframe",this.mode=$.mobile||$.n3ds?0:globalsettings.wysiwyg,this.mode=this.mode||0,this.window=t.contentWindow,this.doc=t.contentWindow.document;let s=b(e),o=this.doc.getElementsByTagName("body")[0];o&&s&&(o.style.backgroundColor=s.backgroundColor,o.style.color=s.color,o.style.borderColor="#FFF"),this.doc.designMode="on",this.editbar=document.createElement("div"),this.buildEditBar(),t.style.height=`${e.clientHeight}px`,q(this.editbar,e),this.setSource("<div></div>"),setTimeout(()=>{this.setSource(Q(e.value)),this.switchMode(this.mode)},100)}buildEditBar(){this.editbar.className="editbar";let t=["bold","italic","underline","strikethrough","forecolor","backcolor","insertimage","createlink","c_email","justifyleft","justifycenter","justifyright","c_youtube","c_code","c_quote","c_spoiler","insertorderedlist","insertunorderedlist","c_smileys","c_switcheditmode"],e=["Bold","Italic","Underline","Strike-Through","Foreground Color","Background Color","Insert Image","Insert Link","Insert email","Align left","Center","Align right","Insert video from any of your favorite video services!","Insert code","Insert Quote","Insert Spoiler","Create Ordered List","Create Unordered List","Insert Emoticon","Switch editor mode"];t.forEach((s,o)=>{let n=document.createElement("a");n.className=s,n.title=e[o],n.href="javascript:void(0)",n.unselectable="on",n.onclick=l=>this.editbarCommand(l,s),this.editbar.appendChild(n)})}editbarCommand(t,e){switch(t.preventDefault(),e){case"forecolor":case"backcolor":this.showColors(t.pageX,t.pageY,e);break;case"c_smileys":this.showEmotes(t.pageX,t.pageY);break;case"c_switcheditmode":this.switchMode(Math.abs(this.mode-1));break;default:this.cmd(e);break}}showEmotes(t,e){let s=this.emoteWindow;if(!s){new W().load("/api/?act=emotes",{callback:o=>this.createEmoteWindow(o,{x:t,y:e})});return}s.style.display==="none"?(s.style.display="",s.style.top=`${e}px`,s.style.left=`${t}px`):this.hideEmotes()}hideEmotes(){this.emoteWindow&&(this.emoteWindow.style.display="none")}createEmoteWindow(t,e){let[s,o]=JSON.parse(t.responseText),n=document.createElement("div");n.className="emotewin",s.forEach((l,i)=>{let a=o[i],d=document.createElement("a");d.href="javascript:void(0)",d.onclick=()=>{this.cmd("inserthtml",a),this.hideEmotes()},d.innerHTML=`${a} ${l}`,n.appendChild(d)}),n.style.position="absolute",n.style.display="none",this.emoteWindow=n,document.querySelector("#page").appendChild(n),this.showEmotes(e.x,e.y)}colorHandler(t,e){this.cmd(t,e),this.hideColors()}showColors(t,e,s){this.hideColors();let o=["#FFFFFF","#AAAAAA","#000000","#FF0000","#00FF00","#0000FF","#FFFF00","#00FFFF","#FF00FF"],n=o.length,l=Math.ceil(Math.sqrt(n)),i=document.createElement("table");f(i.style,{borderCollapse:"collapse",position:"absolute",top:`${e}px`,left:`${t}px`});for(let a=0;a<l;a+=1){let d=i.insertRow(a);for(let c=0;c<l;c+=1){let u=d.insertCell(c),p=o[c+a*l];if(!p)continue;u.style.border="1px solid #000",u.style.padding=0;let h=document.createElement("a");h.href="javascript:void(0)",h.onclick=()=>this.colorHandler(s,p),u.appendChild(h),f(h.style,{display:"block",backgroundColor:p,height:"20px",width:"20px",margin:0})}}return this.colorWindow=i,document.querySelector("#page").appendChild(i),null}hideColors(){this.colorWindow&&(this.colorWindow.parentNode.removeChild(this.colorWindow),this.colorWindow=void 0)}cmd(t,e){let s,o=this.getSelection(),n,l=t,i=e;switch(t.toLowerCase()){case"bold":n=`[b]${o}[/b]`;break;case"italic":n=`[i]${o}[/i]`;break;case"underline":n=`[u]${o}[/u]`;break;case"strikethrough":n=`[s]${o}[/s]`;break;case"justifyright":n=`[align=right]${o}[/align]`;break;case"justifycenter":n=`[align=center]${o}[/align]`;break;case"justifyleft":n=`[align=left]${o}[/align]`;break;case"insertimage":if(i=prompt("Image URL:"),!i)return;if(!It(i)){alert("Please enter a valid URL.");return}n=`[img]${i}[/img]`;break;case"insertorderedlist":this.mode||(n=`[ol]${o.replace(/(.+([\r\n]+|$))/gi,"*$1")}[/ol]`);break;case"insertunorderedlist":this.mode||(n=`[ul]${o.replace(/(.+([\r\n]+|$))/gi,"*$1")}[/ul]`);break;case"createlink":if(i=prompt("Link:"),!i)return;i.match(/^(https?|ftp|mailto):/)||(i=`https://${i}`),n=`[url=${i}]${o}[/url]`;break;case"c_email":if(i=prompt("Email:"),!i)return;l="createlink",i=`mailto:${i}`,n=`[url=${i}]${o}[/url]`;break;case"backcolor":($.firefox||$.safari)&&(l="hilitecolor"),n=`[bgcolor=${i}]${o}[/bgcolor]`;break;case"forecolor":n=`[color=${i}]${o}[/color]`;break;case"c_code":l="inserthtml",i=`[code]${o}[/code]`,n=i;break;case"c_quote":l="inserthtml",i=prompt("Who said this?"),i=`[quote${i?`=${i}`:""}]${o}[/quote]`,n=i;break;case"c_spoiler":l="inserthtml",i=`[spoiler]${o}[/spoiler]`,n=i;break;case"c_youtube":if(l="inserthtml",i=prompt("Video URL?"),!i)return;i=`[video]${i}[/video]`,n=i;break;case"inserthtml":n=i;break;default:throw new Error(`Unsupported editor command ${t}`)}this.mode?l==="inserthtml"&&$.ie?(s=this.doc.selection.createRange(),s.text.length?(s.pasteHTML(i),s.collapse(!1),s.select()):this.doc.body.innerHTML+=i):(this.doc.execCommand(l,!1,i||!1),this.iframe.contentWindow.focus&&this.iframe.contentWindow.focus()):pt(this.element,n)}getSelection(){return this.mode?$.ie?this.doc.selection.createRange().text:this.window.getSelection():$.ie?(this.element.focus(),document.selection.createRange().text):this.element.value.substring(this.element.selectionStart,this.element.selectionEnd)}getSource(){return this.doc.body.innerHTML}setSource(t){this.doc&&this.doc.body&&(this.doc.body.innerHTML=t)}switchMode(t){let{element:e,iframe:s}=this;t?(this.setSource(Q(e.value)),e.style.display="none",s.style.display=""):(e.value=V(this.getSource()),e.style.display="",s.style.display="none"),this.mode=t}submit(){this.mode&&(this.switchMode(0),this.switchMode(1))}};var K=class{constructor(){this.droppables=[]}start(t,e,s){let o=new L(t).cancel().stopBubbling(),n=e||t.target,l=b(n),i=g();this.noChild&&(o.srcElement||o.target)!==(s||n)||n.getAttribute("draggable")!=="false"&&(this.sess={el:n,mx:parseInt(o.pageX,10),my:parseInt(o.pageY,10),ex:parseInt(l.left,10)||0,ey:parseInt(l.top,10)||0,info:{},bc:y(n),zIndex:n.style.zIndex},(!this.sess.zIndex||Number(this.sess.zIndex)<i-1)&&(n.style.zIndex=i),C(this.onstart,{...this.sess,droptarget:this.testDrops(this.sess.mx,this.sess.my)}),this.boundEvents={drag:a=>this.drag(a),drop:a=>this.drop(a)},document.addEventListener("mousemove",this.boundEvents.drag),document.addEventListener("mouseup",this.boundEvents.drop),this.drag(o))}drag(t){let e=new L(t).cancel(),s=this.sess.el.style,o,n=!1,l=parseInt(e.pageX,10),i=parseInt(e.pageY,10),a=l,d=i,c,u=this.sess.ex+a-this.sess.mx,p=this.sess.ey+d-this.sess.my,h=this.bounds;h&&(u<h[0]?(a=a-u+h[0],[u]=h):u>h[0]+h[2]&&(u=h[0]+h[2]),p<h[1]?(d=d-p+h[1],[p]=h):p>h[1]+h[3]&&(p=h[1]+h[3])),s.left=`${u}px`,s.top=`${p}px`,n=(o=this.sess.info).droptarget,o={left:u,top:p,e,el:this.sess.el,mx:a,my:d,droptarget:this.testDrops(l,i),dx:a-(o.mx||a),dy:d-(o.my||d),sx:this.sess.ex,sy:this.sess.ey},this.sess.info=o,C(this.ondrag,o),o.droptarget&&n!==o.droptarget&&C(this.ondragover,o),n&&o.droptarget!==n&&(c=o.droptarget,o.droptarget=n,C(this.ondragout,o),o.droptarget=c)}boundingBox(t,e,s,o){return this.bounds=[t,e,s,o],this}drop(){return document.removeEventListener("mouseup",this.boundEvents.drop),document.removeEventListener("mousemove",this.boundEvents.drag),C(this.ondrop,this.sess.info),this.autoZ||(this.sess.el.style.zIndex=this.sess.zIndex),!0}testDrops(t,e){let{droppables:s}=this,o,n=!1,l=[9999,9999];return s.length&&s.forEach(i=>{i===this.sess.el||ct(i,this.sess.el)||(o=y(i),l[0]>o.w&&l[1]>o.h&&t>=o.x&&e>=o.y&&t<=o.xw&&e<=o.yh&&(l=[o.w,o.h],n=i))}),n}drops(t){return this.droppables=t,this}addDrops(t){return this.droppables?(this.droppables=this.droppables.concat(t),this):this.drops(t)}addListener(t){return f(this,t),this}apply(t,e){if(Array.isArray(t))return t.forEach(o=>this.apply(o)),this;let s=b(t,"");return s=s.position,(!s||s==="static")&&(t.style.position="relative"),(e||t).onmousedown=e?o=>this.start(o,t,e):o=>this.start(o,t),this}autoZ(){return this.autoZ=!0,this}noChildActivation(){return this.noChild=!0,this}reset(t=this.sess.el){return t.style.top=0,t.style.left=0,this}},tt=K;var B=class{constructor(t={}){f(this,{title:"Title",wait:!0,content:"Content",open:!1,useoverlay:!1,minimizable:!0,resize:!1,className:"",pos:"center",zIndex:g(),...t})}create(){if(this.windowContainer)return null;let t=document.createElement("div"),e=document.createElement("div"),s=document.createElement("div"),o=document.createElement("div"),n=document.createElement("div"),l=document.createElement("div"),{pos:i}=this;this.windowContainer=t,this.id&&(t.id=this.id),this.contentcontainer=s,this.useOverlay&&X(!0,this.zIndex),t.className=`window${this.className?` ${this.className}`:""}`,e.className="title",s.className="content",this.minimizable&&(n.innerHTML="-",n.onclick=()=>this.minimize()),l.innerHTML="X",l.onclick=()=>this.close(),o.appendChild(n),o.appendChild(l),o.className="controls",e.innerHTML=this.title,s.innerHTML=this.content,e.appendChild(o),t.appendChild(e),t.appendChild(s);let a=()=>this.close();if(t.querySelectorAll("[data-window-close]").forEach(c=>{c.addEventListener("click",a)}),document.body.appendChild(t),this.resize){let c=t.querySelector(this.resize);if(!c)throw new Error("Resize target not found");c.style.width=`${c.clientWidth}px`,c.style.height=`${c.clientHeight}px`;let u=document.createElement("div");u.className="resize",t.appendChild(u),u.style.left=`${t.clientWidth-16}px`,u.style.top=`${t.clientHeight-16}px`,new tt().boundingBox(100,100,1/0,1/0).addListener({ondrag(p){let h=parseFloat(c.style.width)+p.dx,w=parseFloat(c.style.height)+p.dy;c.style.width=`${h}px`,h<t.clientWidth-20?c.style.width=`${t.clientWidth}px`:u.style.left=`${t.clientWidth-16}px`,c.style.height=`${w}px`},ondrop(){u.style.left=`${t.clientWidth-16}px`}}).apply(u),c.style.width=`${t.clientWidth}px`,u.style.left=`${t.clientWidth-16}px`}let d=t.style;return d.zIndex=this.zIndex+5,this.wait?P(t.querySelectorAll("img")).then(()=>{this.setPosition(i)}):this.setPosition(i),this.drag=new tt().autoZ().noChildActivation().boundingBox(0,0,document.documentElement.clientWidth-50,document.documentElement.clientHeight-50).apply(t,e),t.close=()=>this.close(),t.minimize=this.minimize,t}close(){this.windowContainer&&(document.body.removeChild(this.windowContainer),this.windowContainer=null,this.onclose&&this.onclose(),this.useOverlay&&X(!1))}minimize(){let t=this.windowContainer,e=t.classList.contains("minimized");if(t.classList.toggle("minimized"),e)t.removeAttribute("draggable"),this.setPosition(this.oldpos,0);else{t.setAttribute("draggable","false");let o=Array.from(document.querySelectorAll(".window")).reduce((n,l)=>l.classList.contains("minimized")?n+Number(l.clientWidth):n,0);this.oldpos=this.getPosition(),this.setPosition(`bl ${o} 0`,!1)}}setPosition(t,e){let s=this.windowContainer,o=0,n=0,l=document.documentElement.clientHeight,i=document.documentElement.clientWidth,a=t.match(/(\d+) (\d+)/);switch(a&&(o=Number(a[1]),n=Number(a[2])),o=Math.floor(o),n=Math.floor(n),t.charAt(1)==="r"&&(o=i-o-s.clientWidth),t.charAt(0)){case"b":n=l-n-s.clientHeight;break;case"c":n=(l-s.clientHeight)/2,o=(i-s.clientWidth)/2;break;default:}o=Math.floor(o),n=Math.floor(n),o<0&&(o=0),n<0&&(n=0),s.style.left=`${o}px`,this.animate||e?new S(s,10).add("top",`${n-100}px`,`${n}px`).play():s.style.top=`${n}px`,this.pos=t}getPosition(){let t=this.windowContainer.style;return`tl ${parseFloat(t.left)} ${parseFloat(t.top)}`}};B.close=function(t){let e=t;do{if(e.close){e.close();break}e=e.offsetParent}while(e)};var bt=B;var R=class extends m{static get selector(){return".media"}constructor(t){super(t);let e=t.querySelector("a.popout"),s=t.querySelector("a.inline"),o=t.querySelector(".movie");e.addEventListener("click",n=>{n.preventDefault(),new bt({title:e.href,content:o.innerHTML}).create()}),s.addEventListener("click",n=>{n.preventDefault(),o.style.display="block"})}};function et(r){ft(),r.querySelectorAll("a").forEach(o=>{if(o.dataset.useTooltip&&o.addEventListener("mouseover",()=>Y(o)),o.href){let n=o.getAttribute("href"),{host:l,pathname:i}=window.location;if(!o.target&&o.host===l&&o.pathname===i){let d=o.onclick;o.onclick=null,o.addEventListener("click",c=>{c.preventDefault(),(!d||d.call(o)!==!1)&&RUN.stream.location(n)})}else o.target="_BLANK"}});let e=Array.from(r.querySelectorAll(".bbcodeimg"));e.length&&P(e).then(()=>{ht(e)}),r.querySelectorAll(".bbcode.code").forEach(o=>{o.addEventListener("click",()=>ut(o))}),[k,M,A,D,I,R,T,N,H].forEach(o=>{r.querySelectorAll(o.selector).forEach(n=>new o(n))}),r.querySelectorAll("form[data-ajax-form]").forEach(o=>{let n=o.dataset.ajaxForm==="resetOnSubmit";o.addEventListener("submit",l=>{l.preventDefault(),RUN.submitForm(o,n)})}),Array.from(document.querySelectorAll(".idle")).forEach(o=>at(o))}var Tt=function(t){let e=t?t.split(","):[],s=e?e.length:0,o=e.length===1?"":"s";return[e,s,o,s?" and <br />":""]},Nt=function(t){let e=t?t.split(","):[],s=e?e.length:0;return[e,s,s===1?"":"s"]},ot=class{constructor(t){f(t,{modcontrols_createModControls:e=>{this.busy=!0,this.createModControls(e)},modcontrols_postsync:([e,s])=>{let[o,n,l,i]=Tt(e),[a,d,c]=Nt(s),u=`<form method='post' data-ajax-form='true'><input type='hidden' name='act' value='modcontrols' />${d?`<select name='dot'><option value='delete'>Delete</option><option value='merge'>Merge</option><option value='move'>Move</option><option value='pin'>Pin</option><option value='unpin'>Unpin</option><option value='lock'>Lock</option><option value='unlock'>Unlock</option></select>&nbsp; &nbsp; <strong>${d}</strong> topic${c}${i}`:""}${n?`<select name='dop'><option value='delete'>Delete</option><option value='move'>Move</option></select> &nbsp; &nbsp; <strong>${n}</strong> post${l}`:""}${n&&d?"<br />":" &nbsp; &nbsp; "}<input type='submit' value='Go' /> <input name='cancel' type='submit' onclick='this.form.submitButton=this;' value='Cancel' /></form>`;f(this,{tids:a,tidl:d,pids:o,pidl:n}),d||n?this.createModControls(u):this.destroyModControls()},modcontrols_move:e=>{let s=parseInt(e&&e[0]||this.whichone,10);this.whichone=s,window.addEventListener("pushstate",this.boundCheckLocation),this.createModControls(`Ok, now browse to the ${s?"topic":"forum"} you want to move the ${s?`${this.pidl} posts`:`${this.tidl} topics`} to...`)},modcontrols_clearbox:()=>{this.destroyModControls(),this.busy=!1}}),this.boundCheckLocation=()=>this.checkLocation()}checkLocation(){let{whichone:t}=this,e=t?/act=vt(\d+)/:/act=vf(\d+)/,s=document.location.toString().match(e);s?this.moveto(s[1]):RUN.stream.commands.modcontrols_move()}moveto(t){let{whichone:e}=this;this.createModControls(`<form method="post" data-ajax-form="true">move ${e?"posts":"topics"} here? <input type="hidden" name="act" value="modcontrols" /><input type="hidden" name="${e?"dop":"dot"}" value="moveto" /><input type="hidden" name="id" value="${t}" /><input type="submit" value="Yes" /><input type="submit" name="cancel" value="Cancel" onclick="this.form.submitButton=this" /></form>`)}createModControls(t){let e=this.modb||document.querySelector("#modbox");this.modb||(e=document.createElement("div"),e.id="modbox",document.body.appendChild(e)),e.style.display="block",e.innerHTML=t,et(e),this.modb=e}destroyModControls(){window.removeEventListener("pushstate",this.boundCheckLocation),this.modb&&(this.modb.innerHTML="",this.modb.style.display="none")}togbutton(t){t.classList.toggle("selected")}};gt(()=>{RUN.modcontrols=new ot(RUN.stream.commands)});})();

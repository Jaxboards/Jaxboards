"use strict";(()=>{function ee(r,e){if(!r)return"";if(Array.isArray(r)){if(!e)throw new Error("Invalid arguments for buildQueryString. Received array and undefined");return r.map((t,s)=>`${encodeURIComponent(t)}=${encodeURIComponent(e[s]||"")}`).join("&")}return Object.keys(r).map(t=>`${encodeURIComponent(t)}=${encodeURIComponent(r[t]||"")}`).join("&")}var z=class{setup={readyState:4,method:"POST"};constructor(e={}){Object.assign(this.setup,e)}load(e,{callback:t,data:s,method:n="POST",requestType:i=1}={method:"POST",requestType:1}){let l=null;s&&Array.isArray(s)?l=ee(s[0],s[1]):s&&typeof s!="string"&&(l=ee(s));let o=new XMLHttpRequest;return t&&(this.setup.callback=t),o.onreadystatechange=()=>{o.readyState===this.setup.readyState&&this.setup.callback?.(o)},o.open(n,e,!0),Object.assign(o,{url:e,requestType:i}),n&&o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.setRequestHeader("X-JSACCESS",`${i}`),o.send(l),o}},I=z;function p(r){return window.getComputedStyle(r)}function f(r){let{x:e,y:t,height:s,width:n}=r.getBoundingClientRect(),i=e+window.scrollX,l=t+window.scrollY;return{x:i,y:l,yh:l+s,xw:i+n,w:n,h:s}}function te(r,e){return e.contains(r)}function D(r,e){r.parentNode&&r.parentNode.removeChild(r),e.parentNode?.insertBefore(r,e)}function N(r,e){r.parentNode&&r.parentNode.removeChild(r),e.parentNode?.insertBefore(r,e.nextSibling)}function g(){return Array.from(document.querySelectorAll("*")).reduce((t,s)=>s.style.zIndex&&Number(s.style.zIndex)>t?Number(s.style.zIndex):t,0)+1}var ne="valid",ye="invalid",v=class{element;action;outputElement;indicatorElement;static selector(e){return e.querySelectorAll("input[data-autocomplete-action]").forEach(t=>new this(t))}constructor(e){this.element=e,e.autocomplete="off",this.action=e.dataset.autocompleteAction;let t=e.dataset.autocompleteOutput,s=e.dataset.autocompleteIndicator,n=t?document.querySelector(t):void 0;if(!n)throw new Error("Expected element to have data-autocomplete-output");this.outputElement=n||document.createElement("input"),this.indicatorElement=s?document.querySelector(s):void 0,e.addEventListener("keyup",i=>this.keyUp(i)),e.addEventListener("keydown",i=>{i.key==="Enter"&&i.preventDefault()})}getResultsContainer(){let e=f(this.element),t=document.querySelector("#autocomplete");return t||(t=Object.assign(document.createElement("div"),{id:"autocomplete"}),Object.assign(t.style,{zIndex:g()}),document.body.appendChild(t)),Object.assign(t.style,{top:`${e.yh}px`,left:`${e.x}px`,width:`${e.w}px`}),t}keyUp(e){let t=this.getResultsContainer(),s=Array.from(t.querySelectorAll("div")),n=s.findIndex(c=>c.classList.contains("selected"));if(s)switch(e.key){case"ArrowUp":n>=0&&(s[n].classList.remove("selected"),s[n-1].classList.add("selected"));return;case"ArrowDown":n===-1?s[0].classList.add("selected"):n<s.length-1&&(s[n].classList.remove("selected"),s[n+1].classList.add("selected"));return;case"Enter":n>=0&&s[n].dispatchEvent(new Event("click"));return;default:this.indicatorElement&&(this.indicatorElement.classList.remove(ne),this.indicatorElement.classList.add(ye));break}let i=document.location.toString().match("/ACP/")?"../":"",l=encodeURIComponent(this.element.value),o=`act=${this.action}&term=${l}`;new I().load(`${i}api/?${o}`,{callback:c=>{let d=JSON.parse(c.responseText);if(t.innerHTML="",!d.length)t.style.display="none";else{t.style.display="";let[a,u]=d;a.forEach((m,h)=>{let y=u[h],b=document.createElement("div");b.innerHTML=y,b.onclick=()=>{t.style.display="none",this.indicatorElement&&this.indicatorElement.classList.add(ne),this.outputElement.value=`${m}`,this.outputElement.dispatchEvent(new Event("change")),this.element.value=y},t.appendChild(b)})}}})}};var j=class{rgb;constructor(e){let t=e;if(typeof t=="object"){this.rgb=t;return}if(typeof t=="string"){let s=t.match(/^rgb\((\d+),\s?(\d+),\s?(\d+)\)/i),n=t.match(/#?[^\da-fA-F]/);if(s){s.shift(),this.rgb=[parseFloat(s[1]),parseFloat(s[2]),parseFloat(s[3])];return}if(n){if(t.charAt(0)==="#"&&(t=t.slice(1)),t.length===3&&(t=t.charAt(0)+t.charAt(0)+t.charAt(1)+t.charAt(1)+t.charAt(2)+t.charAt(2)),t.length!==6){this.rgb=[0,0,0];return}this.rgb=[];for(let i=0;i<3;i+=1)this.rgb[i]=parseInt(t.slice(i*2,(i+1)*2),16)}}this.rgb=[0,0,0]}invert(){return this.rgb=[255-this.rgb[0],255-this.rgb[1],255-this.rgb[2]],this}toRGB(){return this.rgb}toHex(){return this.rgb.map(e=>e.toString(16).padStart(2,"0")).join("")}},x=j;var P=class{el;delay;steps;interval;curLineup;stepCount;loop;lineup;constructor(e,t=30,s=20,n=0){this.el=e,this.steps=t,this.delay=s,this.curLineup=0,this.stepCount=0,this.loop=n,this.lineup=[[]]}play(){return this.interval=setInterval(()=>this.step(),this.delay),this}morph(e,t,s){return Array.isArray(e)&&e.length===s.length?e.map((n,i)=>Math.round(this.morph(n,t,s[i]))):(s-e)*t+e}step(){let e=this.lineup[this.curLineup];this.stepCount+=1;let t=this.stepCount;typeof e[0]=="function"?(e[0](this.el),t=this.steps):e.forEach(s=>{let n=this.morph(s[1],t/this.steps,s[2]);s[0].match(/color/i)?n=`#${new x(n).toHex()}`:s[0]!=="opacity"&&(n=Math.round(n)),this.el.style[s[0]]=s[3]+n+s[4]}),t===this.steps&&(this.lineup.length-1>this.curLineup?(this.stepCount=0,this.curLineup+=1):this.loop===1?(this.stepCount=0,this.curLineup=0):clearInterval(this.interval))}add(e,t,s){let n=["","",""],i;return e.match(/color/i)?(i=new x(t).toRGB(),n[1]=new x(s).toRGB()):(n=s.match(/(\D*)(-?\d+)(\D*)/),n.shift(),i=parseFloat(t.match(/-?\d+/)?.[0]??"")),this.lineup[this.lineup.length-1].push([e,i,n[1],n[0],n[2]]),this}dehighlight(){this.el.style.backgroundColor="";let e=p(this.el).backgroundColor;this.el.classList.add("highlight");let t=p(this.el).backgroundColor;return t===e&&(t="FF0"),this.el.classList.add("highlight"),!t||!e?this:this.add("backgroundColor",t,e).then(()=>{this.el.style.backgroundColor=e})}then(e,t=void 0,s=void 0,n=void 0){return this.lineup.push([]),n&&(this.steps=n),typeof e=="function"?this.lineup[this.lineup.length-1].push(e):t!==void 0&&s!==void 0&&this.add(e,t,s),this}},w=P;var M=class{element;static selector(e){return e.querySelectorAll(".collapse-box").forEach(t=>new this(t))}constructor(e){this.element=e,e.querySelector(".collapse-button")?.addEventListener("click",()=>this.click())}click(){let e=this.element.querySelector(".collapse-content");if(!e)return;let{style:t}=e,{fullHeight:s}=e.dataset,n=this.element;t.overflow="hidden",t.height==="0px"&&s?new w(e,5,10,0).add("height","0px",s).then(()=>{n.classList.remove("collapsed")}).play():(s||(s=`${e.clientHeight||e.offsetHeight}px`,e.dataset.fullHeight=s),new w(e,5,10,0).add("height",s,"0px").then(()=>{n.classList.add("collapsed")}).play())}};function Ee(r){let e=r.getHours()||12,t=`${r.getMinutes()}`.padStart(2,"0");return`${e%12||12}:${t}${e>12?"pm":"am"}`}function F(r){return new Date(r*1e3)}var se=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],ie=["January","February","March","April","May","June","July","August","September","October","November","December"];function xe(r){return r[0].toUpperCase()+r.slice(1)}function R(r){let e=new Date,t=new Intl.RelativeTimeFormat(void 0,{numeric:"auto",style:"long"}),s=new Date;s.setTime(+s-1e3*60*60*24),s.setHours(0),s.setMinutes(0),s.setSeconds(0);let n=F(r),i=Math.round((+n-+e)/1e3);if(i>-60)return t.format(i,"second");if(i>-3600)return t.format(Math.round(i/60),"minute");if(n>s){let l=new Date;return l.setHours(0),l.setMinutes(0),l.setSeconds(0),xe(t.format(n>l?0:-1,"day"))+` @ ${Ee(n)}`}return Intl.DateTimeFormat(void 0,{month:"short",year:"numeric",day:"numeric",hour:"numeric",hour12:!0,minute:"numeric"}).format(n)}function W(r){let e=F(r),t=e.getHours(),s=t>=12?"pm":"am";t%=12,t=t||12;let n=`${e.getMinutes()}`.padStart(2,"0"),i=e.getMonth()+1,l=`${e.getDate()}`.padStart(2,"0"),o=e.getFullYear();return`${t}:${n}${s}, ${i}/${l}/${o}`}function O(r){let e=F(r);return String.fromCharCode(55357,56656+((e.getHours()%12||12)-1)+(e.getMinutes()>29?12:0))}function oe(r){let e=Array.from(r.classList).find(t=>t.startsWith("lastAction"));e!==void 0&&(r.prepend(O(parseInt(e.slice(10),10))),r.classList.remove(e))}function q(r,e=2e3){return new Promise(t=>{let s=new Set,n=Array.from(r).filter(l=>!l.complete);if(!n.length){t();return}function i(){s.delete(this.src),s.size===0&&t()}n.forEach(l=>{s.has(l.src)||(s.add(l.src),l.addEventListener("error",i),l.addEventListener("load",i))}),e&&setTimeout(t,e)})}function re(){let r=document.querySelectorAll(".autodate"),e=Array.from(document.querySelectorAll("[data-timestamp]"));r&&(r.forEach(t=>{let s=parseInt(t.getAttribute("title")??"",10),n=t.classList.contains("smalldate")?W(s):R(s);n!==t.innerHTML&&(t.innerHTML=n)}),e.forEach(t=>{t.title||(t.title=W(parseInt(t.dataset.timestamp??"",10)))}))}function le(r){document.readyState==="complete"?r():document.addEventListener("DOMContentLoaded",r)}function ae(){let r=document.createElement("input");return r.setAttribute("type","date"),r.type==="date"}var T=class{picker;element;selectedDate;lastDate;static selector(e){if(!ae())return e.querySelectorAll("input[type=date]").forEach(t=>new this(t))}constructor(e){this.element=e,this.picker=this.getPicker(),e.autocomplete="off",e.addEventListener("focus",()=>this.openPicker()),e.addEventListener("keydown",()=>this.closePicker())}getPicker(){if(this.picker)return this.picker;let e=document.querySelector("#datepicker");return e||(e=Object.assign(document.createElement("table"),{id:"datepicker"}),document.body.appendChild(e),e.style.display="none"),e}openPicker(){let e=f(this.element);Object.assign(this.picker.style,{display:"",zIndex:g(),position:"absolute",top:`${e.yh}px`,left:`${e.x}px`});let[t,s,n]=this.element.value.split("/").map(i=>parseInt(i,10));t&&s&&n?this.selectedDate=[n,t-1,s]:this.selectedDate=void 0,this.generate(n,t,s)}closePicker(){this.picker.style.display="none"}generate(e,t,s){let n=new Date,i=this.getPicker(),l,o,[c,d,a]=[e,t,s];c===void 0&&(c=n.getFullYear(),d=n.getMonth(),a=n.getDate(),this.selectedDate=[c,d,a]),d===-1&&(c-=1,d=11),d===12&&(c+=1,d=0),this.lastDate=[c,d,a];let u=new Date(c,d+1,0).getDate(),m=new Date(c,d,1).getDay();n=new Date(c,d,a),i.innerHTML="",l=i.insertRow(0),o=l.insertCell(0),o.innerHTML="&lt;",o.className="control",o.onclick=()=>this.lastYear(),o=l.insertCell(1),o.colSpan=5,o.className="year",o.innerHTML=`${c}`,o=l.insertCell(2),o.innerHTML=">",o.className="control",o.onclick=()=>this.nextYear(),l=i.insertRow(1),o=l.insertCell(0),o.innerHTML="<",o.className="control",o.onclick=()=>this.lastMonth(),o=l.insertCell(1),o.colSpan=5,o.innerHTML=ie[d],o.className="month",o=l.insertCell(2),o.innerHTML=">",o.className="control",o.onclick=()=>this.nextMonth(),l=i.insertRow(2),l.className="weekdays";for(let h=0;h<7;h+=1)l.insertCell(h).innerHTML=se[h];l=i.insertRow(3);for(let h=0;h<u;h+=1){if(!h)for(let b=0;b<m;b+=1)l.insertCell(b);(m+h)%7===0&&(l=i.insertRow(i.rows.length)),o=l.insertCell((m+h)%7),o.onclick=this.insert.bind(this,o);let y=!!this.selectedDate&&c===this.selectedDate[0]&&d===this.selectedDate[1]&&h+1===this.selectedDate[2];o.className=`day${y?" selected":""}`,o.innerHTML=`${h+1}`}}lastYear(){let e=this.lastDate;e&&this.generate(e[0]-1,e[1],e[2])}nextYear(){let e=this.lastDate;e&&this.generate(e[0]+1,e[1],e[2])}lastMonth(){let e=this.lastDate;e&&this.generate(e[0],e[1]-1,e[2])}nextMonth(){let e=this.lastDate;e&&this.generate(e[0],e[1]+1,e[2])}insert(e){let t=this.lastDate;t&&(this.element.value=`${t[1]+1}/${e.innerHTML}/${t[0]}`),this.closePicker()}};var Le=["SCRIPT","STYLE","HR"],ve=/text-align: ?(right|center|left)/i,we=/background(-color)?:[^;]+(rgb\([^)]+\)|#\s+)/i,Me=/font-style: ?italic/i,Te=/text-decoration:[^;]*underline/i,$e=/text-decoration:[^;]*line-through/i,He=/font-size: ?([^;]+)/i,Ce=/color: ?([^;]+)/i,Se=/font-weight: ?bold/i;function B(r){let e=r,t=/<(\w+)([^>]*)>([^]*?)<\/\1>/gi;return e=e.replace(/[\r\n]+/g,""),e=e.replace(/<(hr|br|meta)[^>]*>/gi,`
`),e=e.replace(/<img.*?src=["']?([^'"]+)["'](?: alt=["']?([^"']+)["'])?[^>]*\/?>/g,(s,n,i)=>i||`[img]${n}[/img]`),e=e.replace(t,(s,n,i,l)=>{let o=t.test(l)?B(l):l,c={};i.replace(/(color|size|style|href|src)=(['"]?)(.*?)\2/gi,(qe,ge,ze,be)=>(c[ge]=be,""));let{style:d=""}=c,a=n.toLowerCase();if(Le.includes(a))return"";let u=ve.exec(d),m=we.exec(d),h=Me.exec(d),y=Te.exec(d),b=$e.exec(d),Q=He.exec(d),K=Ce.exec(d),fe=Se.exec(d);return m&&(o=`[bgcolor=#${new x(m[2]).toHex()}]${o}[/bgcolor]`),u&&(o=`[align=${u[1]}]${o}[/align]`),(h||a==="i"||a==="em")&&(o=`[I]${o}[/I]`),(y||a==="u")&&(o=`[U]${o}[/U]`),(b||a==="s"||a==="strike")&&(o=`[S]${o}[/S]`),(fe||a==="strong"||a==="b")&&(o=`[B]${o}[/B]`),(c.size||Q)&&(o=`[size=${c.size||Q?.[1]}]${o}[/size]`),(c.color||K)&&(o=`[color=${c.color||K?.[1]}]${o}[/color]`),a==="a"&&c.href&&(o=`[url=${c.href}]${o}[/url]`),a==="ol"&&(o=`[ol]${o}[/ol]`),a==="ul"&&(o=`[ul]${o}[/ul]`),/h\d/i.test(a)&&(o=`[${a}]${o}[/${a}]`),a==="li"&&(o=`*${o.replace(/[\n\r]+/,"")}
`),a==="p"&&(o=`
${o==="&nbsp"?"":o}
`),a==="div"&&(o=`
${o}`),o}),e.replace(/&amp;/g,"&").replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&nbsp;/g," ")}function _(r){let e=r.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/(\s) /g,"$1&nbsp;");return e=e.replace(/\[b\]([^]*?)\[\/b\]/gi,"<b>$1</b>"),e=e.replace(/\[i\]([^]*?)\[\/i\]/gi,"<i>$1</i>"),e=e.replace(/\[u\]([^]*?)\[\/u\]/gi,"<u>$1</u>"),e=e.replace(/\[s\]([^]*?)\[\/s\]/gi,"<s>$1</s>"),e=e.replace(/\[img\]([^'"[]+)\[\/img\]/gi,'<img src="$1">'),e=e.replace(/\[color=([^\]]+)\](.*?)\[\/color\]/gi,'<span style="color:$1">$2</span>'),e=e.replace(/\[size=([^\]]+)\](.*?)\[\/size\]/gi,'<span style="font-size:$1">$2</span>'),e=e.replace(/\[url=([^\]]+)\](.*?)\[\/url\]/gi,'<a href="$1">$2</a>'),e=e.replace(/\[bgcolor=([^\]]+)\](.*?)\[\/bgcolor\]/gi,'<span style="backgroun-color:$1">$2</span>'),e=e.replace(/\[h(\d)\](.*?)\[\/h\1\]/g,"<h$1>$2</h$1>"),e=e.replace(/\[align=(left|right|center)\](.*?)\[\/align\]/g,'<div style="text-align:$1">$2</div>'),e=e.replace(/\[(ul|ol)\]([^]*?)\[\/\1\]/gi,(t,s,n)=>{let l=n.split(/(^|[\r\n]+)\*/).filter(o=>o.trim()).map(o=>`<li>${o}</li>`).join("");return`<${s}>${l}</${s}>`}),e=e.replace(/\n/g,"<br />"),e}var{userAgent:E}=navigator,L={chrome:/chrome/i.test(E),ie:/msie/i.test(E),iphone:/iphone/i.test(E),mobile:/mobile/i.test(E),n3ds:/nintendo 3ds/.test(E),firefox:/firefox/i.test(E),safari:/safari/i.test(E)};function ce(r){if(!window.getSelection)return;let e=document.createRange();e.selectNode(r);let t=window.getSelection();t&&(t.rangeCount&&t.removeAllRanges(),t.addRange(e))}function de(r,e){let t=r.scrollTop,s=r.selectionStart??0,n=r.selectionEnd??0;r.value=r.value.substring(0,s)+e+r.value.slice(n),r.selectionStart=s+e.length,r.selectionEnd=s+e.length,r.focus(),r.scrollTop=t}var ke=/^(ht|f)tps?:\/\/[\w.\-%&?=/]+$/,Ae=r=>ke.test(r),$=class{iframe;element;static selector(e){return e.querySelectorAll("textarea.bbcode-editor").forEach(t=>new this(t))}constructor(e){this.element=e,this.iframe=document.createElement("iframe"),this.iframe.addEventListener("load",()=>this.iframeLoaded()),this.iframe.style.display="none",N(this.iframe,e),e.closest("form")?.addEventListener("submit",()=>{this.submit()})}iframeLoaded(){let{iframe:e,element:t}=this;e.className="editorframe",this.mode=L.mobile||L.n3ds?0:globalsettings.wysiwyg,this.mode=this.mode||0,this.window=e.contentWindow,this.doc=e.contentWindow.document;let s=p(t),n=this.doc.getElementsByTagName("body")[0];n&&s&&(n.style.backgroundColor=s.backgroundColor,n.style.color=s.color,n.style.borderColor="#FFF"),this.doc.designMode="on",this.editbar=document.createElement("div"),this.buildEditBar(),e.style.height=`${t.clientHeight}px`,D(this.editbar,t),this.setSource("<div></div>"),setTimeout(()=>{this.setSource(_(t.value)),this.switchMode(this.mode)},100)}buildEditBar(){this.editbar.className="editbar";let e=["bold","italic","underline","strikethrough","forecolor","backcolor","insertimage","createlink","c_email","justifyleft","justifycenter","justifyright","c_youtube","c_code","c_quote","c_spoiler","insertorderedlist","insertunorderedlist","c_smileys","c_switcheditmode"],t=["Bold","Italic","Underline","Strike-Through","Foreground Color","Background Color","Insert Image","Insert Link","Insert email","Align left","Center","Align right","Insert video from any of your favorite video services!","Insert code","Insert Quote","Insert Spoiler","Create Ordered List","Create Unordered List","Insert Emoticon","Switch editor mode"];e.forEach((s,n)=>{let i=document.createElement("a");i.className=s,i.title=t[n],i.href="javascript:void(0)",i.unselectable="on",i.onclick=l=>this.editbarCommand(l,s),this.editbar.appendChild(i)})}editbarCommand(e,t){switch(e.preventDefault(),t){case"forecolor":case"backcolor":this.showColors(e.pageX,e.pageY,t);break;case"c_smileys":this.showEmotes(e.pageX,e.pageY);break;case"c_switcheditmode":this.switchMode(Math.abs(this.mode-1));break;default:this.cmd(t);break}}showEmotes(e,t){let s=this.emoteWindow;if(!s){new I().load("/api/?act=emotes",{callback:n=>this.createEmoteWindow(n,{x:e,y:t})});return}s.style.display==="none"?(s.style.display="",s.style.top=`${t}px`,s.style.left=`${e}px`):this.hideEmotes()}hideEmotes(){this.emoteWindow&&(this.emoteWindow.style.display="none")}createEmoteWindow(e,t){let[s,n]=JSON.parse(e.responseText),i=document.createElement("div");i.className="emotewin",s.forEach((l,o)=>{let c=n[o],d=document.createElement("a");d.href="javascript:void(0)",d.onclick=()=>{this.cmd("inserthtml",c),this.hideEmotes()},d.innerHTML=`${c} ${l}`,i.appendChild(d)}),i.style.position="absolute",i.style.display="none",this.emoteWindow=i,document.querySelector("#page").appendChild(i),this.showEmotes(t.x,t.y)}colorHandler(e,t){this.cmd(e,t),this.hideColors()}showColors(e,t,s){this.hideColors();let n=["#FFFFFF","#AAAAAA","#000000","#FF0000","#00FF00","#0000FF","#FFFF00","#00FFFF","#FF00FF"],i=n.length,l=Math.ceil(Math.sqrt(i)),o=document.createElement("table");Object.assign(o.style,{borderCollapse:"collapse",position:"absolute",top:`${t}px`,left:`${e}px`});for(let c=0;c<l;c+=1){let d=o.insertRow(c);for(let a=0;a<l;a+=1){let u=d.insertCell(a),m=n[a+c*l];if(!m)continue;u.style.border="1px solid #000",u.style.padding=0;let h=document.createElement("a");h.href="javascript:void(0)",h.onclick=()=>this.colorHandler(s,m),u.appendChild(h),Object.assign(h.style,{display:"block",backgroundColor:m,height:"20px",width:"20px",margin:0})}}return this.colorWindow=o,document.querySelector("#page").appendChild(o),null}hideColors(){this.colorWindow&&(this.colorWindow.parentNode.removeChild(this.colorWindow),this.colorWindow=void 0)}cmd(e,t){let s,n=this.getSelection(),i,l=e,o=t;switch(e.toLowerCase()){case"bold":i=`[b]${n}[/b]`;break;case"italic":i=`[i]${n}[/i]`;break;case"underline":i=`[u]${n}[/u]`;break;case"strikethrough":i=`[s]${n}[/s]`;break;case"justifyright":i=`[align=right]${n}[/align]`;break;case"justifycenter":i=`[align=center]${n}[/align]`;break;case"justifyleft":i=`[align=left]${n}[/align]`;break;case"insertimage":if(o=prompt("Image URL:"),!o)return;if(!Ae(o)){alert("Please enter a valid URL.");return}i=`[img]${o}[/img]`;break;case"insertorderedlist":this.mode||(i=`[ol]${n.replace(/(.+([\r\n]+|$))/gi,"*$1")}[/ol]`);break;case"insertunorderedlist":this.mode||(i=`[ul]${n.replace(/(.+([\r\n]+|$))/gi,"*$1")}[/ul]`);break;case"createlink":if(o=prompt("Link:"),!o)return;o.match(/^(https?|ftp|mailto):/)||(o=`https://${o}`),i=`[url=${o}]${n}[/url]`;break;case"c_email":if(o=prompt("Email:"),!o)return;l="createlink",o=`mailto:${o}`,i=`[url=${o}]${n}[/url]`;break;case"backcolor":(L.firefox||L.safari)&&(l="hilitecolor"),i=`[bgcolor=${o}]${n}[/bgcolor]`;break;case"forecolor":i=`[color=${o}]${n}[/color]`;break;case"c_code":l="inserthtml",o=`[code]${n}[/code]`,i=o;break;case"c_quote":l="inserthtml",o=prompt("Who said this?"),o=`[quote${o?`=${o}`:""}]${n}[/quote]`,i=o;break;case"c_spoiler":l="inserthtml",o=`[spoiler]${n}[/spoiler]`,i=o;break;case"c_youtube":if(l="inserthtml",o=prompt("Video URL?"),!o)return;o=`[video]${o}[/video]`,i=o;break;case"inserthtml":i=o;break;default:throw new Error(`Unsupported editor command ${e}`)}this.mode?l==="inserthtml"&&L.ie?(s=this.doc.selection.createRange(),s.text.length?(s.pasteHTML(o),s.collapse(!1),s.select()):this.doc.body.innerHTML+=o):(this.doc.execCommand(l,!1,o||!1),this.iframe.contentWindow.focus&&this.iframe.contentWindow.focus()):de(this.element,i)}getSelection(){return this.mode?this.window.getSelection():this.element.value.substring(this.element.selectionStart,this.element.selectionEnd)}getSource(){return this.doc.body.innerHTML}setSource(e){this.doc&&this.doc.body&&(this.doc.body.innerHTML=e)}switchMode(e){let{element:t,iframe:s}=this;e?(this.setSource(_(t.value)),t.style.display="none",s.style.display=""):(t.value=B(this.getSource()),t.style.display="",s.style.display="none"),this.mode=e}submit(){this.mode&&(this.switchMode(0),this.switchMode(1))}};var H=class{element;index;images;max;static selector(e){return e.querySelectorAll(".image_gallery").forEach(t=>new this(t))}constructor(e){this.element=e;let t=document.createElement("div"),s=document.createElement("button"),n=document.createElement("button");this.index=0,this.images=e.querySelectorAll("img"),this.max=Math.max(this.images.length,1),s.innerHTML="Next &raquo;",s.addEventListener("click",()=>{this.showNext()}),n.innerHTML="Prev &laquo;",n.addEventListener("click",()=>{this.showPrev()}),this.update(),t.appendChild(n),t.appendChild(document.createTextNode(" ")),t.appendChild(s),e.appendChild(t)}showNext(){this.index<this.max-1&&(this.index+=1),this.update()}showPrev(){this.index>0&&(this.index-=1),this.update()}update(){this.images.forEach((e,t)=>{let s=e.dataset.madeResized?e.parentNode:e;s&&(s.style.display=t!==this.index?"none":"block")})}};var U=class{sess;boundEvents;droppables;noChild=!1;bounds;onstart;ondragover;ondrag;ondragout;ondrop;autoZIndex=!0;constructor(){this.droppables=[],this.sess={el:document.body,mx:0,my:0},this.boundEvents={drag:e=>this.drag(e),drop:()=>this.drop()}}start(e,t,s){e.stopPropagation();let n=t||e.target,i=p(n),l=g();this.noChild&&e.target!==(s||n)||n.getAttribute("draggable")!=="false"&&(this.sess={el:n,mx:e.pageX,my:e.pageY,ex:parseInt(i.left,10)||0,ey:parseInt(i.top,10)||0,info:{el:n,mx:0,my:0},zIndex:n.style.zIndex},(!this.sess.zIndex||Number(this.sess.zIndex)<l-1)&&(n.style.zIndex=`${l}`),this.onstart?.({...this.sess,droptarget:this.testDrops(this.sess.mx,this.sess.my)}),document.addEventListener("mousemove",this.boundEvents.drag),document.addEventListener("mouseup",this.boundEvents.drop),this.drag(e))}drag(e){e.stopPropagation();let t=this.sess.el.style,s=e.pageX,n=e.pageY,i=s,l=n,o,c=(this.sess.ex??0)+i-this.sess.mx,d=(this.sess.ey??0)+l-this.sess.my,a=this.bounds;a&&(c<a[0]?(i=i-c+a[0],[c]=a):c>a[0]+a[2]&&(c=a[0]+a[2]),d<a[1]?(l=l-d+a[1],[d]=a):d>a[1]+a[3]&&(d=a[1]+a[3])),t.left=`${c}px`,t.top=`${d}px`;let u=this.sess.info,m=u?.droptarget,h={left:c,top:d,el:this.sess.el,mx:i,my:l,dx:i-(u?.mx||i),dy:l-(u?.my||l),droptarget:this.testDrops(s,n)};this.sess.info=h,this.ondrag?.(h),h.droptarget&&m!==h.droptarget&&this.ondragover?.(h),m&&h.droptarget!==m&&(o=h.droptarget,h.droptarget=m,this.ondragout?.(h),h.droptarget=o)}boundingBox(e,t,s,n){return this.bounds=[e,t,s,n],this}drop(){return this.boundEvents&&(document.removeEventListener("mouseup",this.boundEvents.drop),document.removeEventListener("mousemove",this.boundEvents.drag)),this.ondrop?.(this.sess.info),this.autoZIndex&&(this.sess.el.style.zIndex=this.sess.zIndex??""),!0}testDrops(e,t){let{droppables:s}=this,n,i=[9999,9999];if(s.length)return s.findLast(l=>{if(!(l===this.sess.el||te(l,this.sess.el))&&(n=f(l),i[0]>n.w&&i[1]>n.h&&e>=n.x&&t>=n.y&&e<=n.xw&&t<=n.yh))return i=[n.w,n.h],l})}drops(e){return this.droppables=e,this}addDrops(e){return this.droppables?(this.droppables=this.droppables.concat(e),this):this.drops(e)}addListener(e){return Object.assign(this,e),this}apply(e,t){if(Array.isArray(e))return e.forEach(i=>this.apply(i)),this;let n=p(e)?.position;return(!n||n==="static")&&(e.style.position="relative"),(t||e).onmousedown=t?i=>this.start(i,e,t):i=>this.start(i,e),this}autoZ(){return this.autoZIndex=!1,this}noChildActivation(){return this.noChild=!0,this}reset(e=this.sess.el){return e.style.top="0",e.style.left="0",this}},Y=U;var X=class{title;wait;content;open;minimizable;resize;className;pos;zIndex;windowContainer;id;onclose;animate;oldpos;constructor(e={}){this.title="Title",this.wait=!0,this.title="Title",this.wait=!0,this.content="Content",this.open=!1,this.minimizable=!0,this.resize=void 0,this.className="",this.pos="center",this.zIndex=g(),this.animate=!1,Object.assign(this,e)}static close=function(t){let s=t;do{if("close"in s&&typeof s.close=="function"){s.close();break}s=s.parentElement}while(s)};create(){if(this.windowContainer)return this.windowContainer;let e=document.createElement("div"),t=document.createElement("div"),s=document.createElement("div"),n=document.createElement("div"),i=document.createElement("div"),l=document.createElement("div"),{pos:o}=this;this.windowContainer=e,this.id&&(e.id=this.id),e.className=`window${this.className?` ${this.className}`:""}`,t.className="title",s.className="content",this.minimizable&&(i.innerHTML="-",i.onclick=()=>this.minimize()),l.innerHTML="X",l.onclick=()=>this.close(),n.appendChild(i),n.appendChild(l),n.className="controls",t.innerHTML=this.title,s.innerHTML=this.content,t.appendChild(n),e.appendChild(t),e.appendChild(s);let c=()=>this.close();if(e.querySelectorAll("[data-window-close]").forEach(a=>{a.addEventListener("click",c)}),document.body.appendChild(e),this.resize){let a=e.querySelector(this.resize);if(!a)throw new Error("Resize target not found");a.style.width=`${a.clientWidth}px`,a.style.height=`${a.clientHeight}px`;let u=document.createElement("div");u.className="resize",e.appendChild(u),u.style.left=`${e.clientWidth-16}px`,u.style.top=`${e.clientHeight-16}px`,new Y().boundingBox(100,100,1/0,1/0).addListener({ondrag(m){let h=parseFloat(a.style.width)+(m.dx??0),y=parseFloat(a.style.height)+(m.dy??0);a.style.width=`${h}px`,h<e.clientWidth-20?a.style.width=`${e.clientWidth}px`:u.style.left=`${e.clientWidth-16}px`,a.style.height=`${y}px`},ondrop(){u.style.left=`${e.clientWidth-16}px`}}).apply(u),a.style.width=`${e.clientWidth}px`,u.style.left=`${e.clientWidth-16}px`}let d=e.style;return d.zIndex=`${this.zIndex+5}`,this.wait?q(Array.from(e.querySelectorAll("img"))).then(()=>{this.setPosition(o)}):this.setPosition(o),new Y().autoZ().noChildActivation().boundingBox(0,0,document.documentElement.clientWidth-50,document.documentElement.clientHeight-50).apply(e,t),Object.assign(e,{close:()=>this.close(),minimize:this.minimize})}close(){this.windowContainer&&(document.body.removeChild(this.windowContainer),this.windowContainer=void 0,this.onclose&&this.onclose())}minimize(){let e=this.windowContainer;if(!e)return;let t=e.classList.contains("minimized");if(e.classList.toggle("minimized"),t)e.removeAttribute("draggable"),this.setPosition(this.oldpos??"");else{e.setAttribute("draggable","false");let n=Array.from(document.querySelectorAll(".window")).reduce((i,l)=>l.classList.contains("minimized")?i+Number(l.clientWidth):i,0);this.oldpos=this.getPosition(),this.setPosition(`bl ${n} 0`,!1)}}setPosition(e,t=!1){let s=this.windowContainer;if(!s)return;let n=0,i=0,l=document.documentElement.clientHeight,o=document.documentElement.clientWidth,c=e.match(/(\d+) (\d+)/);switch(c&&(n=Number(c[1]),i=Number(c[2])),n=Math.floor(n),i=Math.floor(i),e.charAt(1)==="r"&&(n=o-n-s.clientWidth),e.charAt(0)){case"b":i=l-i-s.clientHeight;break;case"c":i=(l-s.clientHeight)/2,n=(o-s.clientWidth)/2;break;default:}n=Math.floor(n),i=Math.floor(i),n<0&&(n=0),i<0&&(i=0),s.style.left=`${n}px`,this.animate||t?new w(s,10).add("top",`${i-100}px`,`${i}px`).play():s.style.top=`${i}px`,this.pos=e}getPosition(){if(!this.windowContainer)return"";let e=this.windowContainer.style;return`tl ${parseFloat(e.left)} ${parseFloat(e.top)}`}},he=X;var C=class{element;static selector(e){return e.querySelectorAll(".media").forEach(t=>new this(t))}constructor(e){this.element=e;let t=e.querySelector("a.popout"),s=e.querySelector("a.inline"),n=e.querySelector(".movie");n&&(t?.addEventListener("click",i=>{i.preventDefault(),new he({title:t.href,content:n.innerHTML}).create()}),s?.addEventListener("click",i=>{i.preventDefault(),n.style.display="block"}))}};var S=class{element;static selector(e){return e.querySelectorAll(".pages").forEach(t=>new this(t))}constructor(e){this.element=e,e.addEventListener("wheel",t=>this.wheel(t))}wheel(e){e.preventDefault();let t=Math.sign(e.deltaY),s=Array.from(this.element.querySelectorAll("a")),n=parseInt(s[1].innerHTML,10),i=parseInt(s[s.length-1].innerHTML,10),l=s.length-2;if(t>0&&n+l<i||t<0&&n>2)for(let o=0;o<l;o+=1)s[o+1].href=s[o+1].href.replace(/\d+$/,`${o+n+t}`),s[o+1].innerHTML=`${n+o+t}`}};var k=class{element;static selector(e){return e.querySelectorAll("input.switch").forEach(t=>new this(t))}constructor(e){this.element=e,e.style.display="none";let t=Object.assign(document.createElement("button"),{type:"button",title:e.className,className:e.className}),s=()=>{t.style.backgroundPosition=e.checked?"top":"bottom"};s(),t.addEventListener("click",()=>{e.checked=!e.checked,s(),e.dispatchEvent(new Event("change"))}),N(t,e)}};var Z="active",A=class{element;static selector(e){return e.querySelectorAll(".tabs").forEach(t=>new this(t))}constructor(e){this.element=e,e.addEventListener("click",t=>this.click(t))}click(e){let{tabSelector:t}=this.element.dataset,{target:s}=e;if(!s||!(s instanceof HTMLElement)||s.tagName.toLowerCase()!=="a")return;let n=s;if(t){let l=s.closest(t);l&&(n=l)}let i=this.element.querySelector(`.${Z}`);i&&i.classList.remove(Z),n.className=Z,n.blur()}};function Ie(r){let e=document.body,t=document.documentElement;switch(r.keyCode){case 13:r.ENTER=!0;break;case 37:r.LEFT=!0;break;case 38:r.UP=!0;break;case .39:r.RIGHT=!0;break;case 40:r.DOWN=!0;break;default:break}return typeof r.srcElement>"u"&&(r.srcElement=r.target),typeof r.pageY>"u"&&(r.pageY=r.clientY+(parseInt(t.scrollTop||e.scrollTop,10)||0),r.pageX=r.clientX+(parseInt(t.scrollLeft||e.scrollLeft,10)||0)),r.cancel=()=>(r.returnValue=!1,r.preventDefault&&r.preventDefault(),r),r.stopBubbling=()=>(r.stopPropagation&&r.stopPropagation(),r.cancelBubble=!0,r),r}var ue=Ie;var me="999999px";function De(r,e,t,s,n){n.style.maxWidth=me,n.style.maxHeight=me,n.dataset.madeResized="true";let i=document.createElement("a");i.target="newwin",i.href=n.src,i.style.display="block",i.style.overflow="hidden",i.style.width=`${r}px`,i.style.height=`${t}px`,i.dataset.nw=`${e}`,i.dataset.nh=`${s}`,i.onmousemove=o=>{let c=f(i),d=ue(o);i.scrollLeft=(d.pageX-c.x)/c.w*(+(i.dataset.nw||0)-c.w)||0,i.scrollTop=(d.pageY-c.y)/c.h*(+(i.dataset.nh||0)-c.h)||0},i.onmouseover=()=>{n.style.width=`${i.dataset.nw}px`,n.style.height=`${i.dataset.nh}px`};let l=()=>{i.scrollLeft&&(i.scrollLeft=0,i.scrollTop=0),n.style.width=`${r}px`,n.style.height=`${t}px`};i.onmouseout=l,l(),D(i,n),i.appendChild(n)}function pe(r){r.length&&Array.from(r).filter(e=>!e.dataset.madeResized).forEach(e=>{let t=1,s=1,{naturalWidth:n,naturalHeight:i}=e,l=n,o=i,c=p(e),d=parseInt(c.width,10)||parseInt(c.maxWidth,10),a=parseInt(c.height,10)||parseInt(c.maxHeight,10);d&&l>d&&(t=d/l),a&&o>a&&(s=a/o),t=t&&s?Math.min(t,s):s||t,t<1&&(l*=t,o*=t,De(l,n,o,i,e))})}function J(r){let e=document.querySelector("#tooltip_thingy"),t=f(r),s=r.getAttribute("title");if(r.dataset.lastOnline){let n=parseInt(r.dataset.lastOnline??"",10);s=`Last Online: ${R(n)} ${O(n)}`}if(s){if(r.title="",!e){e=document.createElement("table");let n=e.insertRow(0),i=e.insertRow(1),l=e.insertRow(2),o;e.id="tooltip_thingy",e.className="tooltip",n.className="top",i.className="content",l.className="bottom",o=n.insertCell(0),o.className="left",o.colSpan=2,o=n.insertCell(1),o.className="right",o=i.insertCell(0),o.className="left",o=i.insertCell(1),o.innerHTML="default text",o=i.insertCell(2),o.className="right",o=l.insertCell(0),o.className="left",o.colSpan=2,o=l.insertCell(1),o.className="right",document.querySelector("#page")?.appendChild(e)}e.rows[1].cells[1].innerText=s,e.style.display="",e.style.top=`${t.y-e.clientHeight}px`,e.style.left=`${t.x}px`,e.style.zIndex=`${g()}`,r.onmouseout=()=>{r.title=s,e.style.display="none"}}}function G(r){re(),r.querySelectorAll("a").forEach(n=>{if(n.dataset.useTooltip&&n.addEventListener("mouseover",()=>J(n)),n.href){let i=n.getAttribute("href"),{host:l,pathname:o}=window.location;if(!n.target&&n.host===l&&n.pathname===o){let d=n.onclick;n.onclick=null,n.addEventListener("click",a=>{a.preventDefault(),(!d||d.call(n,a)!==!1)&&RUN.stream.location(i)})}else n.target="_BLANK"}});let t=Array.from(r.querySelectorAll(".bbcodeimg"));t.length&&q(t).then(()=>{pe(t)}),r.querySelectorAll(".bbcode.code").forEach(n=>{n.addEventListener("click",()=>ce(n))}),[v,M,T,$,H,C,S,k,A].forEach(n=>{n.selector(r)}),r.querySelectorAll("form[data-ajax-form]").forEach(n=>{let i=n.dataset.ajaxForm==="resetOnSubmit";n.addEventListener("submit",l=>{l.preventDefault(),RUN.submitForm(n,i)})}),Array.from(document.querySelectorAll(".idle")).forEach(n=>oe(n))}var Ne=function(e){let t=e?e.split(","):[],s=t?t.length:0,n=t.length===1?"":"s";return[t,s,n,s?" and <br />":""]},Re=function(e){let t=e?e.split(","):[],s=t?t.length:0;return[t,s,s===1?"":"s"]},V=class{constructor(e){Object.assign(e,{modcontrols_postsync:(t,s)=>{let[n,i,l,o]=Ne(t),[c,d,a]=Re(s),u=`<form method='post' data-ajax-form='true'><input type='hidden' name='act' value='modcontrols' />${d?`<select name='dot'><option value='delete'>Delete</option><option value='merge'>Merge</option><option value='move'>Move</option><option value='pin'>Pin</option><option value='unpin'>Unpin</option><option value='lock'>Lock</option><option value='unlock'>Unlock</option></select>&nbsp; &nbsp; <strong>${d}</strong> topic${a}${o}`:""}${i?`<select name='dop'><option value='delete'>Delete</option><option value='move'>Move</option></select> &nbsp; &nbsp; <strong>${i}</strong> post${l}`:""}${i&&d?"<br />":" &nbsp; &nbsp; "}<input type='submit' value='Go' /> <input name='cancel' type='submit' onclick='this.form.submitButton=this;' value='Cancel' /></form>`;Object.assign(this,{tids:c,tidl:d,pids:n,pidl:i}),d||i?this.createModControls(u):this.destroyModControls()},modcontrols_move:t=>{let s=parseInt(t||this.whichone,10);this.whichone=s,window.addEventListener("pushstate",this.boundCheckLocation),this.createModControls(`Ok, now browse to the ${s?"topic":"forum"} you want to move the ${s?`${this.pidl} posts`:`${this.tidl} topics`} to...`)},modcontrols_clearbox:()=>{this.destroyModControls(),this.busy=!1}}),this.boundCheckLocation=()=>this.checkLocation()}checkLocation(){let{whichone:e}=this,t=e?/act=vt(\d+)/:/act=vf(\d+)/,s=document.location.toString().match(t);s?this.moveto(s[1]):RUN.stream.commands.modcontrols_move()}moveto(e){let{whichone:t}=this;this.createModControls(`<form method="post" data-ajax-form="true">move ${t?"posts":"topics"} here? <input type="hidden" name="act" value="modcontrols" /><input type="hidden" name="${t?"dop":"dot"}" value="moveto" /><input type="hidden" name="id" value="${e}" /><input type="submit" value="Yes" /><input type="submit" name="cancel" value="Cancel" onclick="this.form.submitButton=this" /></form>`)}createModControls(e){let t=this.modb||document.querySelector("#modbox");this.modb||(t=document.createElement("div"),t.id="modbox",document.body.appendChild(t)),t.style.display="block",t.innerHTML=e,G(t),this.modb=t}destroyModControls(){window.removeEventListener("pushstate",this.boundCheckLocation),this.modb&&(this.modb.innerHTML="",this.modb.style.display="none")}togbutton(e){e.classList.toggle("selected")}};le(()=>{RUN.modcontrols=new V(RUN.stream.commands)});})();

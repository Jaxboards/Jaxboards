"use strict";(()=>{function we(r){return r+(Math.round(r/10)===1?"th":["","st","nd","rd"][r%10]||"th")}function W(r){let e=r.getHours()||12,t=`${r.getMinutes()}`.padStart(2,"0");return`${e%12||12}:${t}${e>12?"pm":"am"}`}function N(r){return`${r.getMonth()}/${r.getDate()}/${r.getFullYear()}`}function j(r){return new Date(r*1e3)}var Ee=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],oe=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],ne=["January","February","March","April","May","June","July","August","September","October","November","December"];function D(r){let e=new Date,t=new Date;t.setTime(+t-1e3*60*60*24);let o=j(r),s=(+e-+o)/1e3;return s<90?"a minute ago":s<3600?`${Math.round(s/60)} minutes ago`:N(e)===N(o)?`Today @ ${W(o)}`:N(t)===N(o)?`Yesterday @ ${W(o)}`:`${Ee[o.getMonth()]} ${we(o.getDate())}, ${o.getFullYear()} @ ${W(o)}`}function B(r){let e=j(r),t=e.getHours(),o=t>=12?"pm":"am";t%=12,t=t||12;let s=`${e.getMinutes()}`.padStart(2,"0"),n=e.getMonth()+1,l=`${e.getDate()}`.padStart(2,"0"),i=e.getFullYear();return`${t}:${s}${o}, ${n}/${l}/${i}`}function O(r){let e=j(r);return String.fromCharCode(55357,56656+((e.getHours()%12||12)-1)+(e.getMinutes()>29?12:0))}function ie(r){let e=Array.from(r.classList).find(t=>t.startsWith("lastAction"));e!==void 0&&(r.prepend(O(parseInt(e.slice(10),10))),r.classList.remove(e))}function g(r){return window.getComputedStyle(r)}function b(r){let{x:e,y:t,height:o,width:s}=r.getBoundingClientRect(),n=e+window.scrollX,l=t+window.scrollY;return{x:n,y:l,yh:l+o,xw:n+s,w:s,h:o}}function re(r,e){return e.contains(r)}function z(r,e){r.parentNode&&r.parentNode.removeChild(r),e.parentNode?.insertBefore(r,e)}function R(r,e){r.parentNode&&r.parentNode.removeChild(r),e.parentNode?.insertBefore(r,e.nextSibling)}function y(){return Array.from(document.querySelectorAll("*")).reduce((t,o)=>o.style.zIndex&&Number(o.style.zIndex)>t?Number(o.style.zIndex):t,0)+1}function Le(r){let e=document.body,t=document.documentElement;switch(r.keyCode){case 13:r.ENTER=!0;break;case 37:r.LEFT=!0;break;case 38:r.UP=!0;break;case .39:r.RIGHT=!0;break;case 40:r.DOWN=!0;break;default:break}return typeof r.srcElement>"u"&&(r.srcElement=r.target),typeof r.pageY>"u"&&(r.pageY=r.clientY+(parseInt(t.scrollTop||e.scrollTop,10)||0),r.pageX=r.clientX+(parseInt(t.scrollLeft||e.scrollLeft,10)||0)),r.cancel=()=>(r.returnValue=!1,r.preventDefault&&r.preventDefault(),r),r.stopBubbling=()=>(r.stopPropagation&&r.stopPropagation(),r.cancelBubble=!0,r),r}var le=Le;var ae="999999px";function ve(r,e,t,o,s){s.style.maxWidth=ae,s.style.maxHeight=ae,s.dataset.madeResized="true";let n=document.createElement("a");n.target="newwin",n.href=s.src,n.style.display="block",n.style.overflow="hidden",n.style.width=`${r}px`,n.style.height=`${t}px`,n.dataset.nw=`${e}`,n.dataset.nh=`${o}`,n.onmousemove=i=>{let a=b(n),c=le(i);n.scrollLeft=(c.pageX-a.x)/a.w*(+(n.dataset.nw||0)-a.w)||0,n.scrollTop=(c.pageY-a.y)/a.h*(+(n.dataset.nh||0)-a.h)||0},n.onmouseover=()=>{s.style.width=`${n.dataset.nw}px`,s.style.height=`${n.dataset.nh}px`};let l=()=>{n.scrollLeft&&(n.scrollLeft=0,n.scrollTop=0),s.style.width=`${r}px`,s.style.height=`${t}px`};n.onmouseout=l,l(),z(n,s),n.appendChild(s)}function ce(r){!r||!r.length||Array.from(r).filter(e=>!e.dataset.madeResized).forEach(e=>{let t=1,o=1,{naturalWidth:s,naturalHeight:n}=e,l=s,i=n,a=g(e),c=parseInt(a.width,10)||parseInt(a.maxWidth,10),d=parseInt(a.height,10)||parseInt(a.maxHeight,10);c&&l>c&&(t=c/l),d&&i>d&&(o=d/i),t=t&&o?Math.min(t,o):o||t,t<1&&(l*=t,i*=t,ve(l,s,i,n,e))})}function _(r){let e=document.getElementById("tooltip_thingy"),t=b(r),o=r.getAttribute("title");if(r.hasAttribute("data-last-online")){let s=r.getAttribute("data-last-online");o=`Last Online: ${D(s)} ${O(s)}`}if(o){if(r.title="",!e){e=document.createElement("table");let s=e.insertRow(0),n=e.insertRow(1),l=e.insertRow(2),i;e.id="tooltip_thingy",e.className="tooltip",s.className="top",n.className="content",l.className="bottom",i=s.insertCell(0),i.className="left",i.colSpan=2,i=s.insertCell(1),i.className="right",i=n.insertCell(0),i.className="left",i=n.insertCell(1),i.innerHTML="default text",i=n.insertCell(2),i.className="right",i=l.insertCell(0),i.className="left",i.colSpan=2,i=l.insertCell(1),i.className="right",document.querySelector("#page").appendChild(e)}e.rows[1].cells[1].innerText=o,e.style.display="",e.style.top=`${t.y-e.clientHeight}px`,e.style.left=`${t.x}px`,e.style.zIndex=y(),r.onmouseout=()=>{r.title=o,document.querySelector("#tooltip_thingy").style.display="none"}}}function de(r){if(!window.getSelection)return;let e=document.createRange();e.selectNode(r);let t=window.getSelection();t&&(t.rangeCount&&t.removeAllRanges(),t.addRange(e))}function he(r,e){let t=r.scrollTop,o=r.selectionStart??0,s=r.selectionEnd??0;r.value=r.value.substring(0,o)+e+r.value.slice(s),r.selectionStart=o+e.length,r.selectionEnd=o+e.length,r.focus(),r.scrollTop=t}function ue(r,e){return r?e?r.map((t,o)=>`${encodeURIComponent(t)}=${encodeURIComponent(e[o]||"")}`).join("&"):Object.keys(r).map(t=>`${encodeURIComponent(t)}=${encodeURIComponent(r[t]||"")}`).join("&"):""}var U=class{constructor(e){this.setup={readyState:4,callback(){},method:"POST",...e}}load(e,{callback:t,data:o,method:s=this.setup.method,requestType:n=1}={}){let l=null;o&&Array.isArray(o)&&Array.isArray(o[0])&&o[0].length===o[1].length?l=ue(o[0],o[1]):typeof o!="string"&&(l=ue(o));let i=new XMLHttpRequest;return t&&(this.setup.callback=t),i.onreadystatechange=()=>{i.readyState===this.setup.readyState&&this.setup.callback(i)},i.open(s,e,!0),i.url=e,i.type=n,s&&i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),i.setRequestHeader("X-JSACCESS",n),i.send(l),i}},P=U;var p=class{element;static get selector(){throw new Error("No Selector defined")}constructor(e){this.element=e}};var me="valid",$e="invalid",v=class extends p{static get selector(){return"input[data-autocomplete-action]"}constructor(e){super(e),e.autocomplete="off",this.action=e.dataset.autocompleteAction;let t=e.dataset.autocompleteOutput,o=e.dataset.autocompleteIndicator;if(this.outputElement=t&&document.querySelector(t),this.indicatorElement=o&&document.querySelector(o),!this.outputElement)throw new Error("Expected element to have data-autocomplete-output");e.addEventListener("keyup",s=>this.keyUp(s)),e.addEventListener("keydown",s=>{s.key==="Enter"&&s.preventDefault()})}getResultsContainer(){let e=b(this.element),t=document.querySelector("#autocomplete");return t||(t=Object.assign(document.createElement("div"),{id:"autocomplete"}),Object.assign(t.style,{zIndex:y()}),document.body.appendChild(t)),Object.assign(t.style,{top:`${e.yh}px`,left:`${e.x}px`,width:`${e.w}px`}),t}keyUp(e){let t=this.getResultsContainer(),o=Array.from(t.querySelectorAll("div")),s=o.findIndex(a=>a.classList.contains("selected"));if(o)switch(e.key){case"ArrowUp":s>=0&&(o[s].classList.remove("selected"),o[s-1].classList.add("selected"));return;case"ArrowDown":s===-1?o[0].classList.add("selected"):s<o.length-1&&(o[s].classList.remove("selected"),o[s+1].classList.add("selected"));return;case"Enter":s>=0&&o[s].onclick();return;default:this.indicatorElement&&(this.indicatorElement.classList.remove(me),this.indicatorElement.classList.add($e));break}let n=document.location.toString().match("/ACP/")?"../":"",l=encodeURIComponent(this.element.value),i=`act=${this.action}&term=${l}`;new P().load(`${n}api/?${i}`,{callback:a=>{let c=JSON.parse(a.responseText);if(t.innerHTML="",!c.length)t.style.display="none";else{t.style.display="";let[d,u]=c;d.forEach((m,h)=>{let x=u[h],f=document.createElement("div");f.innerHTML=x,f.onclick=()=>{t.style.display="none",this.indicatorElement&&this.indicatorElement.classList.add(me),this.outputElement.value=m,this.outputElement.dispatchEvent(new Event("change")),this.element.value=x},t.appendChild(f)})}}})}};var Y=class{rgb;constructor(e){let t=e;if(typeof t=="object"){this.rgb=t;return}if(typeof t=="string"){let o=t.match(/^rgb\((\d+),\s?(\d+),\s?(\d+)\)/i),s=t.match(/#?[^\da-fA-F]/);if(o){o.shift(),this.rgb=[parseFloat(o[1]),parseFloat(o[2]),parseFloat(o[3])];return}if(s){if(t.charAt(0)==="#"&&(t=t.slice(1)),t.length===3&&(t=t.charAt(0)+t.charAt(0)+t.charAt(1)+t.charAt(1)+t.charAt(2)+t.charAt(2)),t.length!==6){this.rgb=[0,0,0];return}this.rgb=[];for(let n=0;n<3;n+=1)this.rgb[n]=parseInt(t.slice(n*2,(n+1)*2),16)}}this.rgb=[0,0,0]}invert(){return this.rgb=[255-this.rgb[0],255-this.rgb[1],255-this.rgb[2]],this}toRGB(){return this.rgb}toHex(){return this.rgb.map(e=>e.toString(16).padStart(2,"0")).join("")}},E=Y;var X=class{el;delay;steps;interval;curLineup;stepCount;loop;lineup;constructor(e,t=30,o=20,s=0){this.el=e,this.steps=t,this.delay=o,this.curLineup=0,this.stepCount=0,this.loop=s,this.lineup=[[]]}play(){return this.interval=setInterval(()=>this.step(),this.delay),this}morph(e,t,o){return Array.isArray(e)&&e.length===o.length?e.map((s,n)=>Math.round(this.morph(s,t,o[n]))):(o-e)*t+e}step(){let e=this.lineup[this.curLineup];this.stepCount+=1;let t=this.stepCount;typeof e[0]=="function"?(e[0](this.el),t=this.steps):e.forEach(o=>{let s=this.morph(o[1],t/this.steps,o[2]);o[0].match(/color/i)?s=`#${new E(s).toHex()}`:o[0]!=="opacity"&&(s=Math.round(s)),this.el.style[o[0]]=o[3]+s+o[4]}),t===this.steps&&(this.lineup.length-1>this.curLineup?(this.stepCount=0,this.curLineup+=1):this.loop===1?(this.stepCount=0,this.curLineup=0):clearInterval(this.interval))}add(e,t,o){let s=["","",""],n;return e.match(/color/i)?(n=new E(t).toRGB(),s[1]=new E(o).toRGB()):(s=o.match(/(\D*)(-?\d+)(\D*)/),s.shift(),n=parseFloat(t.match(/-?\d+/)?.[0]??"")),this.lineup[this.lineup.length-1].push([e,n,s[1],s[0],s[2]]),this}dehighlight(){this.el.style.backgroundColor="";let e=g(this.el).backgroundColor;this.el.classList.add("highlight");let t=g(this.el).backgroundColor;return t===e&&(t="FF0"),this.el.classList.add("highlight"),!t||!e?this:this.add("backgroundColor",t,e).then(()=>{this.el.style.backgroundColor=e})}then(e,t=void 0,o=void 0,s=void 0){return this.lineup.push([]),s&&(this.steps=s),typeof e=="function"?this.lineup[this.lineup.length-1].push(e):t!==void 0&&o!==void 0&&this.add(e,t,o),this}},$=X;var C=class extends p{static get selector(){return".collapse-box"}constructor(e){super(e),e.querySelector(".collapse-button")?.addEventListener("click",()=>this.click())}click(){let e=this.element.querySelector(".collapse-content");if(!e)return;let{style:t}=e,{fullHeight:o}=e.dataset,s=this.element;t.overflow="hidden",t.height==="0px"&&o?new $(e,5,10,0).add("height","0px",o).then(()=>{s.classList.remove("collapsed")}).play():(o||(o=`${e.clientHeight||e.offsetHeight}px`,e.dataset.fullHeight=o),new $(e,5,10,0).add("height",o,"0px").then(()=>{s.classList.add("collapsed")}).play())}};var M=class extends p{picker;element;selectedDate;lastDate;static get selector(){return"input.date"}constructor(e){super(e),this.element=e,this.picker=this.getPicker(),e.autocomplete="off",e.addEventListener("focus",()=>this.openPicker()),e.addEventListener("keydown",()=>this.closePicker())}getPicker(){if(this.picker)return this.picker;let e=document.querySelector("#datepicker");return e||(e=Object.assign(document.createElement("table"),{id:"datepicker"}),document.body.appendChild(e),e.style.display="none"),e}openPicker(){let e=b(this.element);Object.assign(this.picker.style,{display:"",zIndex:y(),position:"absolute",top:`${e.yh}px`,left:`${e.x}px`});let[t,o,s]=this.element.value.split("/").map(n=>parseInt(n,10));t&&o&&s?this.selectedDate=[s,t-1,o]:this.selectedDate=void 0,this.generate(s,t,o)}closePicker(){this.picker.style.display="none"}generate(e,t,o){let s=new Date,n=this.getPicker(),l,i,[a,c,d]=[e,t,o];a===void 0&&(a=s.getFullYear(),c=s.getMonth(),d=s.getDate(),this.selectedDate=[a,c,d]),c===-1&&(a-=1,c=11),c===12&&(a+=1,c=0),this.lastDate=[a,c,d];let u=new Date(a,c+1,0).getDate(),m=new Date(a,c,1).getDay();s=new Date(a,c,d),n.innerHTML="",l=n.insertRow(0),i=l.insertCell(0),i.innerHTML="&lt;",i.className="control",i.onclick=()=>this.lastYear(),i=l.insertCell(1),i.colSpan=5,i.className="year",i.innerHTML=`${a}`,i=l.insertCell(2),i.innerHTML=">",i.className="control",i.onclick=()=>this.nextYear(),l=n.insertRow(1),i=l.insertCell(0),i.innerHTML="<",i.className="control",i.onclick=()=>this.lastMonth(),i=l.insertCell(1),i.colSpan=5,i.innerHTML=ne[c],i.className="month",i=l.insertCell(2),i.innerHTML=">",i.className="control",i.onclick=()=>this.nextMonth(),l=n.insertRow(2),l.className="weekdays";for(let h=0;h<7;h+=1)l.insertCell(h).innerHTML=oe[h];l=n.insertRow(3);for(let h=0;h<u;h+=1){if(!h)for(let f=0;f<m;f+=1)l.insertCell(f);(m+h)%7===0&&(l=n.insertRow(n.rows.length)),i=l.insertCell((m+h)%7),i.onclick=this.insert.bind(this,i);let x=!!this.selectedDate&&a===this.selectedDate[0]&&c===this.selectedDate[1]&&h+1===this.selectedDate[2];i.className=`day${x?" selected":""}`,i.innerHTML=`${h+1}`}}lastYear(){let e=this.lastDate;e&&this.generate(e[0]-1,e[1],e[2])}nextYear(){let e=this.lastDate;e&&this.generate(e[0]+1,e[1],e[2])}lastMonth(){let e=this.lastDate;e&&this.generate(e[0],e[1]-1,e[2])}nextMonth(){let e=this.lastDate;e&&this.generate(e[0],e[1]+1,e[2])}insert(e){let t=this.lastDate;t&&(this.element.value=`${t[1]+1}/${e.innerHTML}/${t[0]}`),this.closePicker()}};var T=class extends p{index;images;max;static get selector(){return".image_gallery"}constructor(e){super(e);let t=document.createElement("div"),o=document.createElement("button"),s=document.createElement("button");this.index=0,this.images=e.querySelectorAll("img"),this.max=Math.max(this.images.length,1),o.innerHTML="Next &raquo;",o.addEventListener("click",()=>{this.showNext()}),s.innerHTML="Prev &laquo;",s.addEventListener("click",()=>{this.showPrev()}),this.update(),t.appendChild(s),t.appendChild(document.createTextNode(" ")),t.appendChild(o),e.appendChild(t)}showNext(){this.index<this.max-1&&(this.index+=1),this.update()}showPrev(){this.index>0&&(this.index-=1),this.update()}update(){this.images.forEach((e,t)=>{let o=e.dataset.madeResized?e.parentNode:e;o&&(o.style.display=t!==this.index?"none":"block")})}};var H=class extends p{static get selector(){return".pages"}constructor(e){super(e),e.addEventListener("wheel",t=>this.wheel(t))}wheel(e){e.preventDefault();let t=Math.sign(e.deltaY),o=Array.from(this.element.querySelectorAll("a")),s=parseInt(o[1].innerHTML,10),n=parseInt(o[o.length-1].innerHTML,10),l=o.length-2;if(t>0&&s+l<n||t<0&&s>2)for(let i=0;i<l;i+=1)o[i+1].href=o[i+1].href.replace(/\d+$/,`${i+s+t}`),o[i+1].innerHTML=`${s+i+t}`}};var k=class extends p{static get selector(){return"input.switch"}constructor(e){super(e),e.style.display="none";let t=Object.assign(document.createElement("button"),{type:"button",title:e.className,className:e.className}),o=()=>{t.style.backgroundPosition=e.checked?"top":"bottom"};o(),t.addEventListener("click",()=>{e.checked=!e.checked,o(),e.dispatchEvent(new Event("change"))}),R(t,e)}};var Z="active",S=class extends p{static get selector(){return".tabs"}constructor(e){super(e),e.addEventListener("click",t=>this.click(t))}click(e){let{tabSelector:t}=this.element.dataset,{target:o}=e;if(!o||!(o instanceof HTMLElement)||o.tagName.toLowerCase()!=="a")return;let s=o;if(t){let l=o.closest(t);l&&(s=l)}let n=this.element.querySelector(`.${Z}`);n&&n.classList.remove(Z),s.className=Z,s.blur()}};function q(r,e=2e3){return new Promise(t=>{let o=new Set,s=Array.from(r).filter(l=>!l.complete);if(!s.length){t();return}function n(){o.delete(this.src),o.size===0&&t()}s.forEach(l=>{o.has(l.src)||(o.add(l.src),l.addEventListener("error",n),l.addEventListener("load",n))}),e&&setTimeout(t,e)})}function pe(){let r=document.querySelectorAll(".autodate"),e=Array.from(document.querySelectorAll("[data-timestamp]"));r&&(r.forEach(t=>{let o=parseInt(t.getAttribute("title")??"",10),s=t.classList.contains("smalldate")?B(o):D(o);s!==t.innerHTML&&(t.innerHTML=s)}),e.forEach(t=>{t.title||(t.title=B(parseInt(t.dataset.timestamp??"",10)))}))}function fe(r){document.readyState==="complete"?r():document.addEventListener("DOMContentLoaded",r)}var Ce=["SCRIPT","STYLE","HR"];function J(r){let e=r,t=/<(\w+)([^>]*)>([^]*?)<\/\1>/gi;return e=e.replace(/[\r\n]+/g,""),e=e.replace(/<(hr|br|meta)[^>]*>/gi,`
`),e=e.replace(/<img.*?src=["']?([^'"]+)["'](?: alt=["']?([^"']+)["'])?[^>]*\/?>/g,(o,s,n)=>n||`[img]${s}[/img]`),e=e.replace(t,(o,s,n,l)=>{let i=t.test(l)?J(l):l,a={};n.replace(/(color|size|style|href|src)=(['"]?)(.*?)\2/gi,(Se,ye,Ae,xe)=>{a[ye]=xe});let{style:c=""}=a,d=s.toLowerCase();if(Ce.includes(d))return"";let u=c.match(/text-align: ?(right|center|left)/i),m=c.match(/background(-color)?:[^;]+(rgb\([^)]+\)|#\s+)/i),h=c.match(/font-style: ?italic/i),x=c.match(/text-decoration:[^;]*underline/i),f=c.match(/text-decoration:[^;]*line-through/i),te=c.match(/font-size: ?([^;]+)/i),se=c.match(/color: ?([^;]+)/i),be=c.match(/font-weight: ?bold/i);return m&&(i=`[bgcolor=#${new E(m[2]).toHex()}]${i}[/bgcolor]`),u&&(i=`[align=${u[1]}]${i}[/align]`),(h||d==="i"||d==="em")&&(i=`[I]${i}[/I]`),(x||d==="u")&&(i=`[U]${i}[/U]`),(f||d==="s"||d==="strike")&&(i=`[S]${i}[/S]`),(be||d==="strong"||d==="b")&&(i=`[B]${i}[/B]`),(a.size||te)&&(i=`[size=${a.size||te[1]}]${i}[/size]`),(a.color||se)&&(i=`[color=${a.color||se[1]}]${i}[/color]`),d==="a"&&a.href&&(i=`[url=${a.href}]${i}[/url]`),d==="ol"&&(i=`[ol]${i}[/ol]`),d==="ul"&&(i=`[ul]${i}[/ul]`),d.match(/h\d/i)&&(i=`[${d}]${i}[/${d}]`),d==="li"&&(i=`*${i.replace(/[\n\r]+/,"")}
`),d==="p"&&(i=`
${i==="&nbsp"?"":i}
`),d==="div"&&(i=`
${i}`),i}),e.replace(/&amp;/g,"&").replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&nbsp;/g," ")}function G(r){let e=r.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/(\s) /g,"$1&nbsp;");return e=e.replace(/\[b\]([^]*?)\[\/b\]/gi,"<b>$1</b>"),e=e.replace(/\[i\]([^]*?)\[\/i\]/gi,"<i>$1</i>"),e=e.replace(/\[u\]([^]*?)\[\/u\]/gi,"<u>$1</u>"),e=e.replace(/\[s\]([^]*?)\[\/s\]/gi,"<s>$1</s>"),e=e.replace(/\[img\]([^'"[]+)\[\/img\]/gi,'<img src="$1">'),e=e.replace(/\[color=([^\]]+)\](.*?)\[\/color\]/gi,'<span style="color:$1">$2</span>'),e=e.replace(/\[size=([^\]]+)\](.*?)\[\/size\]/gi,'<span style="font-size:$1">$2</span>'),e=e.replace(/\[url=([^\]]+)\](.*?)\[\/url\]/gi,'<a href="$1">$2</a>'),e=e.replace(/\[bgcolor=([^\]]+)\](.*?)\[\/bgcolor\]/gi,'<span style="backgroun-color:$1">$2</span>'),e=e.replace(/\[h(\d)\](.*?)\[\/h\1\]/g,"<h$1>$2</h$1>"),e=e.replace(/\[align=(left|right|center)\](.*?)\[\/align\]/g,'<div style="text-align:$1">$2</div>'),e=e.replace(/\[(ul|ol)\]([^]*?)\[\/\1\]/gi,(t,o,s)=>{let l=s.split(/(^|[\r\n]+)\*/).filter(i=>i.trim()).map(i=>`<li>${i}</li>`).join("");return`<${o}>${l}</${o}>`}),e=e.replace(/\n/g,"<br />"),e}var{userAgent:w}=navigator,L={chrome:/chrome/i.test(w),ie:/msie/i.test(w),iphone:/iphone/i.test(w),mobile:/mobile/i.test(w),n3ds:/nintendo 3ds/.test(w),firefox:/firefox/i.test(w),safari:/safari/i.test(w)};var Me=/^(ht|f)tps?:\/\/[\w.\-%&?=/]+$/,Te=r=>Me.test(r),A=class extends p{iframe;element;static get selector(){return"textarea.bbcode-editor"}constructor(e){super(e),this.element=e,this.iframe=document.createElement("iframe"),this.iframe.addEventListener("load",()=>this.iframeLoaded()),this.iframe.style.display="none",R(this.iframe,e),e.closest("form")?.addEventListener("submit",()=>{this.submit()})}iframeLoaded(){let{iframe:e,element:t}=this;e.className="editorframe",this.mode=L.mobile||L.n3ds?0:globalsettings.wysiwyg,this.mode=this.mode||0,this.window=e.contentWindow,this.doc=e.contentWindow.document;let o=g(t),s=this.doc.getElementsByTagName("body")[0];s&&o&&(s.style.backgroundColor=o.backgroundColor,s.style.color=o.color,s.style.borderColor="#FFF"),this.doc.designMode="on",this.editbar=document.createElement("div"),this.buildEditBar(),e.style.height=`${t.clientHeight}px`,z(this.editbar,t),this.setSource("<div></div>"),setTimeout(()=>{this.setSource(G(t.value)),this.switchMode(this.mode)},100)}buildEditBar(){this.editbar.className="editbar";let e=["bold","italic","underline","strikethrough","forecolor","backcolor","insertimage","createlink","c_email","justifyleft","justifycenter","justifyright","c_youtube","c_code","c_quote","c_spoiler","insertorderedlist","insertunorderedlist","c_smileys","c_switcheditmode"],t=["Bold","Italic","Underline","Strike-Through","Foreground Color","Background Color","Insert Image","Insert Link","Insert email","Align left","Center","Align right","Insert video from any of your favorite video services!","Insert code","Insert Quote","Insert Spoiler","Create Ordered List","Create Unordered List","Insert Emoticon","Switch editor mode"];e.forEach((o,s)=>{let n=document.createElement("a");n.className=o,n.title=t[s],n.href="javascript:void(0)",n.unselectable="on",n.onclick=l=>this.editbarCommand(l,o),this.editbar.appendChild(n)})}editbarCommand(e,t){switch(e.preventDefault(),t){case"forecolor":case"backcolor":this.showColors(e.pageX,e.pageY,t);break;case"c_smileys":this.showEmotes(e.pageX,e.pageY);break;case"c_switcheditmode":this.switchMode(Math.abs(this.mode-1));break;default:this.cmd(t);break}}showEmotes(e,t){let o=this.emoteWindow;if(!o){new P().load("/api/?act=emotes",{callback:s=>this.createEmoteWindow(s,{x:e,y:t})});return}o.style.display==="none"?(o.style.display="",o.style.top=`${t}px`,o.style.left=`${e}px`):this.hideEmotes()}hideEmotes(){this.emoteWindow&&(this.emoteWindow.style.display="none")}createEmoteWindow(e,t){let[o,s]=JSON.parse(e.responseText),n=document.createElement("div");n.className="emotewin",o.forEach((l,i)=>{let a=s[i],c=document.createElement("a");c.href="javascript:void(0)",c.onclick=()=>{this.cmd("inserthtml",a),this.hideEmotes()},c.innerHTML=`${a} ${l}`,n.appendChild(c)}),n.style.position="absolute",n.style.display="none",this.emoteWindow=n,document.querySelector("#page").appendChild(n),this.showEmotes(t.x,t.y)}colorHandler(e,t){this.cmd(e,t),this.hideColors()}showColors(e,t,o){this.hideColors();let s=["#FFFFFF","#AAAAAA","#000000","#FF0000","#00FF00","#0000FF","#FFFF00","#00FFFF","#FF00FF"],n=s.length,l=Math.ceil(Math.sqrt(n)),i=document.createElement("table");Object.assign(i.style,{borderCollapse:"collapse",position:"absolute",top:`${t}px`,left:`${e}px`});for(let a=0;a<l;a+=1){let c=i.insertRow(a);for(let d=0;d<l;d+=1){let u=c.insertCell(d),m=s[d+a*l];if(!m)continue;u.style.border="1px solid #000",u.style.padding=0;let h=document.createElement("a");h.href="javascript:void(0)",h.onclick=()=>this.colorHandler(o,m),u.appendChild(h),Object.assign(h.style,{display:"block",backgroundColor:m,height:"20px",width:"20px",margin:0})}}return this.colorWindow=i,document.querySelector("#page").appendChild(i),null}hideColors(){this.colorWindow&&(this.colorWindow.parentNode.removeChild(this.colorWindow),this.colorWindow=void 0)}cmd(e,t){let o,s=this.getSelection(),n,l=e,i=t;switch(e.toLowerCase()){case"bold":n=`[b]${s}[/b]`;break;case"italic":n=`[i]${s}[/i]`;break;case"underline":n=`[u]${s}[/u]`;break;case"strikethrough":n=`[s]${s}[/s]`;break;case"justifyright":n=`[align=right]${s}[/align]`;break;case"justifycenter":n=`[align=center]${s}[/align]`;break;case"justifyleft":n=`[align=left]${s}[/align]`;break;case"insertimage":if(i=prompt("Image URL:"),!i)return;if(!Te(i)){alert("Please enter a valid URL.");return}n=`[img]${i}[/img]`;break;case"insertorderedlist":this.mode||(n=`[ol]${s.replace(/(.+([\r\n]+|$))/gi,"*$1")}[/ol]`);break;case"insertunorderedlist":this.mode||(n=`[ul]${s.replace(/(.+([\r\n]+|$))/gi,"*$1")}[/ul]`);break;case"createlink":if(i=prompt("Link:"),!i)return;i.match(/^(https?|ftp|mailto):/)||(i=`https://${i}`),n=`[url=${i}]${s}[/url]`;break;case"c_email":if(i=prompt("Email:"),!i)return;l="createlink",i=`mailto:${i}`,n=`[url=${i}]${s}[/url]`;break;case"backcolor":(L.firefox||L.safari)&&(l="hilitecolor"),n=`[bgcolor=${i}]${s}[/bgcolor]`;break;case"forecolor":n=`[color=${i}]${s}[/color]`;break;case"c_code":l="inserthtml",i=`[code]${s}[/code]`,n=i;break;case"c_quote":l="inserthtml",i=prompt("Who said this?"),i=`[quote${i?`=${i}`:""}]${s}[/quote]`,n=i;break;case"c_spoiler":l="inserthtml",i=`[spoiler]${s}[/spoiler]`,n=i;break;case"c_youtube":if(l="inserthtml",i=prompt("Video URL?"),!i)return;i=`[video]${i}[/video]`,n=i;break;case"inserthtml":n=i;break;default:throw new Error(`Unsupported editor command ${e}`)}this.mode?l==="inserthtml"&&L.ie?(o=this.doc.selection.createRange(),o.text.length?(o.pasteHTML(i),o.collapse(!1),o.select()):this.doc.body.innerHTML+=i):(this.doc.execCommand(l,!1,i||!1),this.iframe.contentWindow.focus&&this.iframe.contentWindow.focus()):he(this.element,n)}getSelection(){return this.mode?this.window.getSelection():this.element.value.substring(this.element.selectionStart,this.element.selectionEnd)}getSource(){return this.doc.body.innerHTML}setSource(e){this.doc&&this.doc.body&&(this.doc.body.innerHTML=e)}switchMode(e){let{element:t,iframe:o}=this;e?(this.setSource(G(t.value)),t.style.display="none",o.style.display=""):(t.value=J(this.getSource()),t.style.display="",o.style.display="none"),this.mode=e}submit(){this.mode&&(this.switchMode(0),this.switchMode(1))}};var V=class{sess;boundEvents;droppables;noChild=!1;bounds;onstart;ondragover;ondrag;ondragout;ondrop;autoZIndex=!0;constructor(){this.droppables=[],this.sess={el:document.body,mx:0,my:0},this.boundEvents={drag:e=>this.drag(e),drop:()=>this.drop()}}start(e,t,o){e.stopPropagation();let s=t||e.target,n=g(s),l=y();this.noChild&&e.target!==(o||s)||s.getAttribute("draggable")!=="false"&&(this.sess={el:s,mx:e.pageX,my:e.pageY,ex:parseInt(n.left,10)||0,ey:parseInt(n.top,10)||0,info:{el:s,mx:0,my:0},zIndex:s.style.zIndex},(!this.sess.zIndex||Number(this.sess.zIndex)<l-1)&&(s.style.zIndex=`${l}`),this.onstart?.({...this.sess,droptarget:this.testDrops(this.sess.mx,this.sess.my)}),document.addEventListener("mousemove",this.boundEvents.drag),document.addEventListener("mouseup",this.boundEvents.drop),this.drag(e))}drag(e){e.stopPropagation();let t=this.sess.el.style,o=e.pageX,s=e.pageY,n=o,l=s,i,a=(this.sess.ex??0)+n-this.sess.mx,c=(this.sess.ey??0)+l-this.sess.my,d=this.bounds;d&&(a<d[0]?(n=n-a+d[0],[a]=d):a>d[0]+d[2]&&(a=d[0]+d[2]),c<d[1]?(l=l-c+d[1],[c]=d):c>d[1]+d[3]&&(c=d[1]+d[3])),t.left=`${a}px`,t.top=`${c}px`;let m=this.sess.info?.droptarget,h={left:a,top:c,el:this.sess.el,mx:n,my:l,droptarget:this.testDrops(o,s)};this.sess.info=h,this.ondrag?.(h),h.droptarget&&m!==h.droptarget&&this.ondragover?.(h),m&&h.droptarget!==m&&(i=h.droptarget,h.droptarget=m,this.ondragout?.(h),h.droptarget=i)}boundingBox(e,t,o,s){return this.bounds=[e,t,o,s],this}drop(){return this.boundEvents&&(document.removeEventListener("mouseup",this.boundEvents.drop),document.removeEventListener("mousemove",this.boundEvents.drag)),this.ondrop?.(this.sess.info),this.autoZIndex&&(this.sess.el.style.zIndex=this.sess.zIndex??""),!0}testDrops(e,t){let{droppables:o}=this,s,n=[9999,9999];if(o.length)return o.findLast(l=>{if(!(l===this.sess.el||re(l,this.sess.el))&&(s=b(l),n[0]>s.w&&n[1]>s.h&&e>=s.x&&t>=s.y&&e<=s.xw&&t<=s.yh))return n=[s.w,s.h],l})}drops(e){return this.droppables=e,this}addDrops(e){return this.droppables?(this.droppables=this.droppables.concat(e),this):this.drops(e)}addListener(e){return Object.assign(this,e),this}apply(e,t){if(Array.isArray(e))return e.forEach(n=>this.apply(n)),this;let s=g(e)?.position;return(!s||s==="static")&&(e.style.position="relative"),(t||e).onmousedown=t?n=>this.start(n,e,t):n=>this.start(n,e),this}autoZ(){return this.autoZIndex=!1,this}noChildActivation(){return this.noChild=!0,this}reset(e=this.sess.el){return e.style.top="0",e.style.left="0",this}},Q=V;var F=class{title;wait;content;open;minimizable;resize;className;pos;zIndex;windowContainer;id;onclose;animate;oldpos;static close;constructor(e={}){this.title="Title",this.wait=!0,this.title="Title",this.wait=!0,this.content="Content",this.open=!1,this.minimizable=!0,this.resize=void 0,this.className="",this.pos="center",this.zIndex=y(),Object.assign(this,e)}create(){if(this.windowContainer)return this.windowContainer;let e=document.createElement("div"),t=document.createElement("div"),o=document.createElement("div"),s=document.createElement("div"),n=document.createElement("div"),l=document.createElement("div"),{pos:i}=this;this.windowContainer=e,this.id&&(e.id=this.id),e.className=`window${this.className?` ${this.className}`:""}`,t.className="title",o.className="content",this.minimizable&&(n.innerHTML="-",n.onclick=()=>this.minimize()),l.innerHTML="X",l.onclick=()=>this.close(),s.appendChild(n),s.appendChild(l),s.className="controls",t.innerHTML=this.title,o.innerHTML=this.content,t.appendChild(s),e.appendChild(t),e.appendChild(o);let a=()=>this.close();if(e.querySelectorAll("[data-window-close]").forEach(u=>{u.addEventListener("click",a)}),document.body.appendChild(e),this.resize){let u=e.querySelector(this.resize);if(!u)throw new Error("Resize target not found");u.style.width=`${u.clientWidth}px`,u.style.height=`${u.clientHeight}px`;let m=document.createElement("div");m.className="resize",e.appendChild(m),m.style.left=`${e.clientWidth-16}px`,m.style.top=`${e.clientHeight-16}px`,new Q().boundingBox(100,100,1/0,1/0).addListener({ondrag(h){let x=parseFloat(u.style.width),f=parseFloat(u.style.height);u.style.width=`${x}px`,x<e.clientWidth-20?u.style.width=`${e.clientWidth}px`:m.style.left=`${e.clientWidth-16}px`,u.style.height=`${f}px`},ondrop(){m.style.left=`${e.clientWidth-16}px`}}).apply(m),u.style.width=`${e.clientWidth}px`,m.style.left=`${e.clientWidth-16}px`}let c=e.style;c.zIndex=`${this.zIndex+5}`,this.wait?q(Array.from(e.querySelectorAll("img"))).then(()=>{this.setPosition(i)}):this.setPosition(i);let d=new Q().autoZ().noChildActivation().boundingBox(0,0,document.documentElement.clientWidth-50,document.documentElement.clientHeight-50).apply(e,t);return e.close=()=>this.close(),e.minimize=this.minimize,e}close(){this.windowContainer&&(document.body.removeChild(this.windowContainer),this.windowContainer=void 0,this.onclose&&this.onclose())}minimize(){let e=this.windowContainer;if(!e)return;let t=e.classList.contains("minimized");if(e.classList.toggle("minimized"),t)e.removeAttribute("draggable"),this.setPosition(this.oldpos??"");else{e.setAttribute("draggable","false");let s=Array.from(document.querySelectorAll(".window")).reduce((n,l)=>l.classList.contains("minimized")?n+Number(l.clientWidth):n,0);this.oldpos=this.getPosition(),this.setPosition(`bl ${s} 0`,!1)}}setPosition(e,t=!1){let o=this.windowContainer;if(!o)return;let s=0,n=0,l=document.documentElement.clientHeight,i=document.documentElement.clientWidth,a=e.match(/(\d+) (\d+)/);switch(a&&(s=Number(a[1]),n=Number(a[2])),s=Math.floor(s),n=Math.floor(n),e.charAt(1)==="r"&&(s=i-s-o.clientWidth),e.charAt(0)){case"b":n=l-n-o.clientHeight;break;case"c":n=(l-o.clientHeight)/2,s=(i-o.clientWidth)/2;break;default:}s=Math.floor(s),n=Math.floor(n),s<0&&(s=0),n<0&&(n=0),o.style.left=`${s}px`,this.animate||t?new $(o,10).add("top",`${n-100}px`,`${n}px`).play():o.style.top=`${n}px`,this.pos=e}getPosition(){if(!this.windowContainer)return;let e=this.windowContainer.style;return`tl ${parseFloat(e.left)} ${parseFloat(e.top)}`}};F.close=function(e){let t=e;do{if(t.close){t.close();break}t=t.offsetParent}while(t)};var ge=F;var I=class extends p{static get selector(){return".media"}constructor(e){super(e);let t=e.querySelector("a.popout"),o=e.querySelector("a.inline"),s=e.querySelector(".movie");s&&(t?.addEventListener("click",n=>{n.preventDefault(),new ge({title:t.href,content:s.innerHTML}).create()}),o?.addEventListener("click",n=>{n.preventDefault(),s.style.display="block"}))}};function K(r){pe(),r.querySelectorAll("a").forEach(s=>{if(s.dataset.useTooltip&&s.addEventListener("mouseover",()=>_(s)),s.href){let n=s.getAttribute("href"),{host:l,pathname:i}=window.location;if(!s.target&&s.host===l&&s.pathname===i){let c=s.onclick;s.onclick=null,s.addEventListener("click",d=>{d.preventDefault(),(!c||c.call(s)!==!1)&&RUN.stream.location(n)})}else s.target="_BLANK"}});let t=Array.from(r.querySelectorAll(".bbcodeimg"));t.length&&q(t).then(()=>{ce(t)}),r.querySelectorAll(".bbcode.code").forEach(s=>{s.addEventListener("click",()=>de(s))}),[v,C,M,A,T,I,H,k,S].forEach(s=>{r.querySelectorAll(s.selector).forEach(n=>new s(n))}),r.querySelectorAll("form[data-ajax-form]").forEach(s=>{let n=s.dataset.ajaxForm==="resetOnSubmit";s.addEventListener("submit",l=>{l.preventDefault(),RUN.submitForm(s,n)})}),Array.from(document.querySelectorAll(".idle")).forEach(s=>ie(s))}var He=function(e){let t=e?e.split(","):[],o=t?t.length:0,s=t.length===1?"":"s";return[t,o,s,o?" and <br />":""]},ke=function(e){let t=e?e.split(","):[],o=t?t.length:0;return[t,o,o===1?"":"s"]},ee=class{constructor(e){Object.assign(e,{modcontrols_postsync:(t,o)=>{let[s,n,l,i]=He(t),[a,c,d]=ke(o),u=`<form method='post' data-ajax-form='true'><input type='hidden' name='act' value='modcontrols' />${c?`<select name='dot'><option value='delete'>Delete</option><option value='merge'>Merge</option><option value='move'>Move</option><option value='pin'>Pin</option><option value='unpin'>Unpin</option><option value='lock'>Lock</option><option value='unlock'>Unlock</option></select>&nbsp; &nbsp; <strong>${c}</strong> topic${d}${i}`:""}${n?`<select name='dop'><option value='delete'>Delete</option><option value='move'>Move</option></select> &nbsp; &nbsp; <strong>${n}</strong> post${l}`:""}${n&&c?"<br />":" &nbsp; &nbsp; "}<input type='submit' value='Go' /> <input name='cancel' type='submit' onclick='this.form.submitButton=this;' value='Cancel' /></form>`;Object.assign(this,{tids:a,tidl:c,pids:s,pidl:n}),c||n?this.createModControls(u):this.destroyModControls()},modcontrols_move:t=>{let o=parseInt(t||this.whichone,10);this.whichone=o,window.addEventListener("pushstate",this.boundCheckLocation),this.createModControls(`Ok, now browse to the ${o?"topic":"forum"} you want to move the ${o?`${this.pidl} posts`:`${this.tidl} topics`} to...`)},modcontrols_clearbox:()=>{this.destroyModControls(),this.busy=!1}}),this.boundCheckLocation=()=>this.checkLocation()}checkLocation(){let{whichone:e}=this,t=e?/act=vt(\d+)/:/act=vf(\d+)/,o=document.location.toString().match(t);o?this.moveto(o[1]):RUN.stream.commands.modcontrols_move()}moveto(e){let{whichone:t}=this;this.createModControls(`<form method="post" data-ajax-form="true">move ${t?"posts":"topics"} here? <input type="hidden" name="act" value="modcontrols" /><input type="hidden" name="${t?"dop":"dot"}" value="moveto" /><input type="hidden" name="id" value="${e}" /><input type="submit" value="Yes" /><input type="submit" name="cancel" value="Cancel" onclick="this.form.submitButton=this" /></form>`)}createModControls(e){let t=this.modb||document.querySelector("#modbox");this.modb||(t=document.createElement("div"),t.id="modbox",document.body.appendChild(t)),t.style.display="block",t.innerHTML=e,K(t),this.modb=t}destroyModControls(){window.removeEventListener("pushstate",this.boundCheckLocation),this.modb&&(this.modb.innerHTML="",this.modb.style.display="none")}togbutton(e){e.classList.toggle("selected")}};fe(()=>{RUN.modcontrols=new ee(RUN.stream.commands)});})();

function O(j){return globalThis.getComputedStyle(j)}function Y(j){let{x:q,y:G,height:K,width:Q}=j.getBoundingClientRect(),$=q+globalThis.scrollX,W=G+globalThis.scrollY;return{x:$,y:W,yh:W+K,xw:$+Q,w:Q,h:K}}function k(j,q){return q.contains(j)}function D(j,q){q.before(j)}function J(j,q){q.after(j)}function X(){return Array.from(document.querySelectorAll("*")).reduce((G,K)=>{if(K.style.zIndex&&Number(K.style.zIndex)>G)return Number(K.style.zIndex);return G},0)+1}function o(j){if(!globalThis.getSelection)return;let q=document.createRange();q.selectNode(j);let G=globalThis.getSelection();if(!G)return;if(G.rangeCount)G.removeAllRanges();G.addRange(q)}function I(j,q){let G=j.scrollTop,K=j.selectionStart??0,Q=j.selectionEnd??0;j.value=j.value.substring(0,K)+q+j.value.slice(Q),j.selectionStart=K+q.length,j.selectionEnd=K+q.length,j.focus(),j.scrollTop=G}var{userAgent:V}=navigator;function Z(){return"ontouchstart"in window}var a={chrome:/chrome/i.test(V),ie:/msie/i.test(V),iphone:/iphone/i.test(V),mobile:/mobile/i.test(V),n3ds:/nintendo 3ds/.test(V),firefox:/firefox/i.test(V),safari:/safari/i.test(V)};class T{sess;boundEvents;droppables;noChild=!1;bounds;onstart;ondragover;ondrag;ondragout;ondrop;autoZIndex=!0;constructor(){this.droppables=[],this.sess={el:document.body,mx:0,my:0,reset:()=>{return}},this.boundEvents={drag:(j)=>this.drag(j),drop:()=>this.drop()}}start(j,q,G){j.preventDefault(),j.stopPropagation();let K=q||j.target,Q=O(K),$=X();if(this.noChild&&j.target!==(G||K))return;if(K.getAttribute("draggable")==="false")return;if(this.sess={el:K,mx:j instanceof MouseEvent?j.pageX:j.targetTouches[0].pageX,my:j instanceof MouseEvent?j.pageY:j.targetTouches[0].pageY,ex:Number.parseInt(Q.left,10)||0,ey:Number.parseInt(Q.top,10)||0,info:{el:K,mx:0,my:0,reset:()=>{return}},reset:()=>this.reset(),zIndex:K.style.zIndex},!this.sess.zIndex||Number(this.sess.zIndex)<$-1)K.style.zIndex=`${$}`;this.onstart?.({...this.sess,droptarget:this.testDrops(this.sess.mx,this.sess.my)}),document.addEventListener(Z()?"touchmove":"mousemove",this.boundEvents.drag),document.addEventListener(Z()?"touchend":"mouseup",this.boundEvents.drop),this.drag(j)}drag(j){j.stopPropagation();let q=this.sess.el.style,G=j instanceof MouseEvent?j.pageX:j.targetTouches[0].pageX,K=j instanceof MouseEvent?j.pageY:j.targetTouches[0].pageY,Q=G,$=K,W,F=(this.sess.ex??0)+Q-this.sess.mx,H=(this.sess.ey??0)+$-this.sess.my,B=this.bounds;if(B){if(F<B[0])Q=Q-F+B[0],[F]=B;else if(F>B[0]+B[2])F=B[0]+B[2];if(H<B[1])$=$-H+B[1],[H]=B;else if(H>B[1]+B[3])H=B[1]+B[3]}q.left=`${F}px`,q.top=`${H}px`;let _=this.sess.info,R=_?.droptarget,P={...this.sess,left:F,top:H,mx:Q,my:$,dx:Q-(_?.mx||Q),dy:$-(_?.my||$),droptarget:this.testDrops(G,K)};if(this.sess.info=P,this.ondrag?.(P),P.droptarget&&R!==P.droptarget)this.ondragover?.(P);if(R&&P.droptarget!==R)W=P.droptarget,P.droptarget=R,this.ondragout?.(P),P.droptarget=W}boundingBox(j,q,G,K){return this.bounds=[j,q,G,K],this}drop(){if(this.boundEvents)document.removeEventListener(Z()?"touchend":"mouseup",this.boundEvents.drop),document.removeEventListener(Z()?"touchmove":"mousemove",this.boundEvents.drag);if(this.ondrop?.(this.sess.info??{}),this.autoZIndex)this.sess.el.style.zIndex=this.sess.zIndex??"";return!0}testDrops(j,q){let{droppables:G}=this,K,Q=[9999,9999];if(!G.length)return;return G.findLast(($)=>{if($===this.sess.el||k($,this.sess.el))return;if(K=Y($),Q[0]>K.w&&Q[1]>K.h&&j>=K.x&&q>=K.y&&j<=K.xw&&q<=K.yh)return Q=[K.w,K.h],$;return})}drops(j){return this.droppables=j,this}addDrops(j){if(!this.droppables)return this.drops(j);return this.droppables=this.droppables.concat(j),this}addListener(j){return Object.assign(this,j),this}apply(j,q){if(Array.isArray(j))return j.forEach((Q)=>this.apply(Q)),this;let K=O(j)?.position;if(!K||K==="static")j.style.position="relative";return(q||j).addEventListener(Z()?"touchstart":"mousedown",q?(Q)=>this.start(Q,j,q):(Q)=>this.start(Q,j)),this}autoZ(){return this.autoZIndex=!1,this}noChildActivation(){return this.noChild=!0,this}reset(j=this.sess.el){return j.style.top="0",j.style.left="0",this}}var A=T;function C(j,q){let G=Array.from(j.querySelectorAll("li")),K={},Q=0;return G.forEach(($)=>{if($.className!=="seperator"&&$.parentNode===j){Q=1;let[W]=$.getElementsByTagName("ul");K[`_${$.id.slice(q.length)}`]=W?C(W,q):1}}),Q?K:1}function g(j){if(!j.droptarget)return;let q=j.el.classList.contains("parentlock"),G=j.el.classList.contains("nofirstlevel");if(q&&j.droptarget.parentNode!==j.el.parentNode){j.reset();return}if(G&&j.droptarget.parentNode?.className==="tree"){j.reset();return}if(k(j.droptarget,j.el)||j.el===j.droptarget.nextSibling){j.reset();return}let K=j.droptarget.nextSibling;if(K.className==="spacer")K.remove();if(K.className==="spacer")j.el.previousSibling?.remove();else J(j.el.previousSibling,j.droptarget);J(j.el,j.droptarget)}function S(j,q,G){let K=Array.from(j.querySelectorAll("li")),Q=[],$=[];Q.push(...K.filter((F)=>F.className!=="title")),Q.forEach((F)=>{let H=document.createElement("li");H.className="seperator",$.push(H),D(H,F)});let W=new A().noChildActivation();W.drops([...Q,...$]).addListener({ondragover(F){if(F.droptarget)F.droptarget.style.border="1px solid #000"},ondragout(F){if(F.droptarget)F.droptarget.style.border="none"},ondrop(F){let H,B=F.el.classList.contains("parentlock");if(W.reset(F.el),!F.droptarget)return;if(F.droptarget.style.border="none",F.droptarget.className==="seperator")g(F);else if(!B&&F.droptarget.tagName==="LI"){if([H]=F.droptarget.getElementsByTagName("ul"),!H)H=document.createElement("ul"),F.droptarget.appendChild(H);H.appendChild(F.el.previousSibling),H.appendChild(F.el),F.droptarget.appendChild(H)}if(G)G.value=JSON.stringify(C(j,q))}}),W.apply(Q)}function c(j){let q=j.getHours()||12,G=`${j.getMinutes()}`.padStart(2,"0");return`${q%12||12}:${G}${q>12?"pm":"am"}`}function x(j){return new Date(j*1000)}var Gj=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],Kj=["January","February","March","April","May","June","July","August","September","October","November","December"];function u(j){return j[0].toUpperCase()+j.slice(1)}function f(j){let q=new Date,G=new Intl.RelativeTimeFormat(void 0,{numeric:"auto",style:"long"}),K=new Date;K.setTime(+K-86400000),K.setHours(0),K.setMinutes(0),K.setSeconds(0);let Q=x(j),$=Math.round((+Q-+q)/1000);if($>-60)return G.format($,"second");if($>-3600)return G.format(Math.round($/60),"minute");if(Q>K){let W=new Date;return W.setHours(0),W.setMinutes(0),W.setSeconds(0),`${u(G.format(Q>W?0:-1,"day"))} @ ${c(Q)}`}return Intl.DateTimeFormat(void 0,{month:"short",year:"numeric",day:"numeric",hour:"numeric",hour12:!0,minute:"numeric"}).format(Q)}function L(j){let q=x(j),G=q.getHours(),K=G>=12?"pm":"am";G%=12,G=G||12;let Q=`${q.getMinutes()}`.padStart(2,"0"),$=q.getMonth()+1,W=`${q.getDate()}`.padStart(2,"0"),F=q.getFullYear();return`${G}:${Q}${K}, ${$}/${W}/${F}`}function Fj(j,q=1000){return new Promise((G)=>{let K=new Set,Q=Array.from(j).filter((W)=>!W.complete);if(!Q.length){G();return}function $(){if(K.delete(this.src),K.size===0)G()}if(Q.forEach((W)=>{if(!K.has(W.src))K.add(W.src),W.addEventListener("error",$),W.addEventListener("load",$)}),q)setTimeout(G,q)})}function Wj(){let j=document.querySelectorAll(".autodate"),q=Array.from(document.querySelectorAll("[data-timestamp]"));if(!j)return;j.forEach((G)=>{let K=Number.parseInt(G.getAttribute("title")??"",10),Q=G.classList.contains("smalldate")?L(K):f(K);if(Q!==G.innerHTML)G.innerHTML=Q}),q.forEach((G)=>{if(!G.title)G.title=L(Number.parseInt(G.dataset.timestamp??"",10))})}function y(j){if(document.readyState==="complete")j();else document.addEventListener("DOMContentLoaded",j)}function Hj(){let j=document.createElement("input");return j.setAttribute("type","date"),j.type==="date"}function Bj(){let j=[String.fromCodePoint(9757,127999),String.fromCodePoint(9757)].map((q)=>{let G=document.body.appendChild(document.createElement("span"));G.appendChild(document.createTextNode(q));let K=G.offsetWidth;return G.remove(),K});return j[0]===j[1]}var z=new Map;class M{element;constructor(j){this.element=j}}function U(j,q,G){if(!z.has(j))z.set(j,new WeakMap);q.forEach(function(Q){if(z.get(j)?.has(Q))return;z.get(j)?.set(Q,new G(Q))})}var b="valid",h="invalid";class E extends M{method;outputElement;indicatorElement;static hydrate(j){U("AutoComplete",j.querySelectorAll("input[data-autocomplete-action]"),this)}constructor(j){super(j);j.autocomplete="off",this.method=j.dataset.autocompleteAction;let q=j.dataset.autocompleteOutput,G=j.dataset.autocompleteIndicator,K=q?document.querySelector(q):void 0;if(!K)throw Error("Expected element to have data-autocomplete-output");this.outputElement=K||document.createElement("input"),this.indicatorElement=G?document.querySelector(G):void 0,j.addEventListener("keyup",(Q)=>this.keyUp(Q)),j.addEventListener("keydown",(Q)=>{if(Q.key==="Enter")Q.preventDefault()})}getResultsContainer(){let j=Y(this.element),q=document.querySelector("#autocomplete");if(!q)q=Object.assign(document.createElement("div"),{id:"autocomplete"}),Object.assign(q.style,{zIndex:X()}),document.body.appendChild(q);return Object.assign(q.style,{top:`${j.yh}px`,left:`${j.x}px`,width:`${j.w}px`}),q}keyUp(j){let q=this.getResultsContainer(),G=Array.from(q.querySelectorAll("div")),K=G.findIndex((Q)=>Q.classList.contains("selected"));switch(j.key){case"ArrowUp":case"ArrowDown":G.at(K)?.classList.remove("selected"),G.at((K+(j.key==="ArrowDown"?1:-1))%G.length)?.classList.add("selected");return;case"Enter":if(K>=0)G.at(K)?.dispatchEvent(new Event("click"));return;default:if(this.indicatorElement)this.indicatorElement.classList.remove(b),this.indicatorElement.classList.add(h);if(this.clearResults(),this.element.value)this.doSearch();break}}clearResults(){let j=this.getResultsContainer();j.style.display="none",j.innerHTML=""}async doSearch(){let j=this.getResultsContainer(),q=/ACP/.test(document.location.toString())?"../":"",K=`term=${encodeURIComponent(this.element.value)}`,Q=await fetch(`${q}/api/${this.method}?${K}`);if(!Q.ok)return;let $=await Q.json();if(j.innerHTML="",$.length){j.style.display="";let[W,F]=$;W.forEach((H,B)=>{let _=F[B],R=document.createElement("div");R.innerHTML=_,R.addEventListener("click",()=>{if(j.style.display="none",this.indicatorElement)this.indicatorElement.classList.add(b),this.indicatorElement.classList.remove(h);this.outputElement.value=`${H}`,this.outputElement.dispatchEvent(new Event("change")),this.element.value=_}),j.appendChild(R)});return}j.style.display="none"}}class N extends HTMLElement{static formAssociated=!0;shadow;internals;results;search;leaveHandler;optionKeyboardHandler;hiddenFormField;value;static hydrate(){customElements.define("better-select",N),customElements.define("better-option",class extends HTMLElement{})}constructor(){super();this.value=this.getAttribute("value")??"",this.shadow=this.attachShadow({mode:"open"}),this.internals=this.attachInternals(),this.search=document.createElement("input"),this.results=document.createElement("div"),this.hiddenFormField=Object.assign(document.createElement("input"),{type:"hidden",name:this.getAttribute("name")}),this.leaveHandler=(j)=>{this.results.classList.toggle("open",j.relatedTarget instanceof HTMLElement&&this.results.contains(j.relatedTarget))},this.optionKeyboardHandler=function(q){switch(q.key){case"ArrowUp":this.previousElementSibling?.focus();break;case"ArrowDown":this.nextElementSibling.focus();break;default:break}}}connectedCallback(){let{shadow:j,results:q,search:G}=this;q.className="results",G.autocomplete="off",G.addEventListener("focus",()=>q.classList.toggle("open",!0)),G.addEventListener("input",()=>{this.renderOptions(G.value)}),G.addEventListener("keydown",(Q)=>{switch(Q.key){case"ArrowUp":this.shadow.querySelector(".results button:last-child")?.focus();break;case"ArrowDown":this.shadow.querySelector(".results button:first-child")?.focus();break;default:break}}),G.addEventListener("blur",this.leaveHandler),j.appendChild(G),j.appendChild(this.hiddenFormField),j.appendChild(q),this.renderOptions(),j.adoptedStyleSheets=[this.stylesheet()],G.setAttribute("role","combobox"),G.setAttribute("aria-activedescendant",""),q.setAttribute("role","listbox");let K=`id-${Math.random()}`;q.setAttribute("id",K),G.setAttribute("aria-controls",K)}close(){this.results.classList.remove("open")}clear(){[...Array.from(this.querySelectorAll("better-option[selected]")),...Array.from(this.results.querySelectorAll(".selected"))].forEach((j)=>{j.removeAttribute("selected"),j.classList.remove("selected")})}renderOptions(j=""){this.results.innerHTML="",this.getOptions(j).forEach((q)=>this.results.appendChild(q))}getOptions(j=""){return Array.from(this.querySelectorAll("better-option")).filter((q)=>q.innerText.toLowerCase().includes(j.toLowerCase())).map((q)=>{let G=document.createElement("button");G.addEventListener("click",()=>{if(!this.hasAttribute("multiple"))this.clear(),this.close();G.classList.toggle("selected"),q.toggleAttribute("selected",G.classList.contains("selected")),this.updateValue()}),G.addEventListener("keydown",this.optionKeyboardHandler),G.classList.toggle("selected",q.hasAttribute("selected"));let K=q.getAttribute("image");if(K){let $=new Image;$.src=K,G.appendChild($)}let Q=document.createTextNode(` ${q.innerText}`);return G.appendChild(Q),G.addEventListener("blur",this.leaveHandler),G}).filter(Boolean)}updateValue(){let j=Array.from(this.querySelectorAll("better-option[selected]"));this.value=j.map((q)=>q.getAttribute("value")).join(","),this.search.value=j.at(-1)?.innerText??"",this.internals.setFormValue(this.value),this.dispatchEvent(new Event("change"))}stylesheet(){let j=new CSSStyleSheet;return j.replaceSync(`
            button { display: block; width: 100%; text-align: left; }
            button.selected { background: #1f1f83; color: #FFF; }
            button:hover { background: #9cdcfe; }
            button img { vertical-align: middle; }
            .results { position: absolute; display: none; max-height: 400px; overflow: auto; }
            .results.open { display: block; }
        `),j}}class w extends M{static hydrate(j){U("Switch",j.querySelectorAll("input.switch"),this)}constructor(j){super(j);j.style.display="none";let q=Object.assign(document.createElement("button"),{type:"button",title:j.className,className:j.className}),G=()=>{q.style.backgroundPosition=j.checked?"top":"bottom"};G(),q.addEventListener("click",()=>{j.checked=!j.checked,G(),j.dispatchEvent(new Event("change"))}),J(q,j)}}function v(j){let q=j.target;if(!(q instanceof HTMLElement))return;if(q?.tagName.toLowerCase()==="a"){let G=document.querySelector(`#menu_${q.classList[0]}`);if(!G)return;q.classList.add("active");let K=G.style;K.display="block";let Q=Y(q);K.top=`${Q.y+q.clientHeight}px`,K.left=`${Q.x}px`,q.addEventListener("mouseout",($)=>{if($.relatedTarget instanceof HTMLElement&&$.relatedTarget!==G&&$.relatedTarget.offsetParent!==G)q.classList.remove("active"),G.style.display="none"}),G?.addEventListener("mouseout",($)=>{if($.relatedTarget instanceof HTMLElement&&$.relatedTarget!==q&&$.relatedTarget.offsetParent!==G&&$.relatedTarget!==G)q.classList.remove("active"),G.style.display="none"})}}async function p(j){let q=new FormData(j,j.submitButton),G=Array.from(q.entries()).filter((K)=>typeof K[1]==="string");await fetch(document.location.search,{method:"POST",body:new URLSearchParams(G),headers:{"X-JSACCESS":"1","Content-Type":"application/x-www-form-urlencoded"}}),alert("Saved. Ajax-submitted so you don't lose your place")}function d(){document.querySelector("#nav")?.addEventListener("mouseover",v),Array.from(document.querySelectorAll("form")).forEach((K)=>{if(!K.dataset.useAjaxSubmit)return;K.addEventListener("submit",(Q)=>{Q.preventDefault(),p(K)})}),E.hydrate(document.body),w.hydrate(document.body),N.hydrate();let j=document.querySelector(".editor");if(j)j.addEventListener("keydown",(K)=>{if(K.key==="Tab")I(j,"    "),K.preventDefault()});let q=document.querySelector(".tree"),G=document.querySelector("#ordered");if(q&&G)S(q,"forum_",G)}y(d);

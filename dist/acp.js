"use strict";(()=>{function A(t,e){return t?t.currentStyle?t.currentStyle:window.getComputedStyle?window.getComputedStyle(t,e):!1:!1}function h(t){let{x:e,y:s,height:o,width:r}=t.getBoundingClientRect(),i=e+window.scrollX,a=s+window.scrollY;return{x:i,y:a,yh:a+o,xw:i+r,w:r,h:o}}function S(t,e){return e.contains(t)}function k(t,e){t.parentNode&&t.parentNode.removeChild(t),e.parentNode.insertBefore(t,e)}function E(t,e){t.parentNode&&t.parentNode.removeChild(t),e.parentNode.insertBefore(t,e.nextSibling)}function b(){return Array.from(document.getElementsByTagName("*")).reduce((s,o)=>o.style.zIndex&&Number(o.style.zIndex)>s?Number(o.style.zIndex):s,0)+1}function m(t,e){return Object.assign(t,e)}function y(t,...e){return t&&typeof t=="function"?t(...e):null}function D(t){document.readyState==="complete"?t():document.addEventListener("DOMContentLoaded",t)}function M(t,e){return t?e?t.map((s,o)=>`${encodeURIComponent(s)}=${encodeURIComponent(e[o]||"")}`).join("&"):Object.keys(t).map(s=>`${encodeURIComponent(s)}=${encodeURIComponent(t[s]||"")}`).join("&"):""}var L=class{constructor(e){this.setup={readyState:4,callback(){},method:"POST",...e}}load(e,{callback:s,data:o,method:r=this.setup.method,requestType:i=1}={}){let a=null;o&&Array.isArray(o)&&Array.isArray(o[0])&&o[0].length===o[1].length?a=M(o[0],o[1]):typeof o!="string"&&(a=M(o));let n=new XMLHttpRequest;return s&&(this.setup.callback=s),n.onreadystatechange=()=>{n.readyState===this.setup.readyState&&this.setup.callback(n)},n.open(r,e,!0),n.url=e,n.type=i,r&&n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.setRequestHeader("X-JSACCESS",i),n.send(a),n}},w=L;function q(t,e){let s=t.scrollTop;if(document.selection)t.focus(),document.selection.createRange().text=e;else{let o=t.selectionStart,r=t.selectionEnd;t.value=t.value.substring(0,o)+e+t.value.substr(r),t.selectionStart=o+e.length,t.selectionEnd=o+e.length}t.focus(),t.scrollTop=s}function z(t){let e=document.body,s=document.documentElement;switch(t.keyCode){case 13:t.ENTER=!0;break;case 37:t.LEFT=!0;break;case 38:t.UP=!0;break;case .39:t.RIGHT=!0;break;case 40:t.DOWN=!0;break;default:break}return typeof t.srcElement>"u"&&(t.srcElement=t.target),typeof t.pageY>"u"&&(t.pageY=t.clientY+(parseInt(s.scrollTop||e.scrollTop,10)||0),t.pageX=t.clientX+(parseInt(s.scrollLeft||e.scrollLeft,10)||0)),t.cancel=()=>(t.returnValue=!1,t.preventDefault&&t.preventDefault(),t),t.stopBubbling=()=>(t.stopPropagation&&t.stopPropagation(),t.cancelBubble=!0,t),t}var I=z;var N=class{constructor(){this.droppables=[]}start(e,s,o){let r=new I(e).cancel().stopBubbling(),i=s||e.target,a=A(i),n=b();this.noChild&&(r.srcElement||r.target)!==(o||i)||i.getAttribute("draggable")!=="false"&&(this.sess={el:i,mx:parseInt(r.pageX,10),my:parseInt(r.pageY,10),ex:parseInt(a.left,10)||0,ey:parseInt(a.top,10)||0,info:{},bc:h(i),zIndex:i.style.zIndex},(!this.sess.zIndex||Number(this.sess.zIndex)<n-1)&&(i.style.zIndex=n),y(this.onstart,{...this.sess,droptarget:this.testDrops(this.sess.mx,this.sess.my)}),this.boundEvents={drag:c=>this.drag(c),drop:c=>this.drop(c)},document.addEventListener("mousemove",this.boundEvents.drag),document.addEventListener("mouseup",this.boundEvents.drop),this.drag(r))}drag(e){let s=new I(e).cancel(),o=this.sess.el.style,r,i=!1,a=parseInt(s.pageX,10),n=parseInt(s.pageY,10),c=a,l=n,f,u=this.sess.ex+c-this.sess.mx,p=this.sess.ey+l-this.sess.my,d=this.bounds;d&&(u<d[0]?(c=c-u+d[0],[u]=d):u>d[0]+d[2]&&(u=d[0]+d[2]),p<d[1]?(l=l-p+d[1],[p]=d):p>d[1]+d[3]&&(p=d[1]+d[3])),o.left=`${u}px`,o.top=`${p}px`,i=(r=this.sess.info).droptarget,r={left:u,top:p,e:s,el:this.sess.el,mx:c,my:l,droptarget:this.testDrops(a,n),dx:c-(r.mx||c),dy:l-(r.my||l),sx:this.sess.ex,sy:this.sess.ey},this.sess.info=r,y(this.ondrag,r),r.droptarget&&i!==r.droptarget&&y(this.ondragover,r),i&&r.droptarget!==i&&(f=r.droptarget,r.droptarget=i,y(this.ondragout,r),r.droptarget=f)}boundingBox(e,s,o,r){return this.bounds=[e,s,o,r],this}drop(){return document.removeEventListener("mouseup",this.boundEvents.drop),document.removeEventListener("mousemove",this.boundEvents.drag),y(this.ondrop,this.sess.info),this.autoZ||(this.sess.el.style.zIndex=this.sess.zIndex),!0}testDrops(e,s){let{droppables:o}=this,r,i=!1,a=[9999,9999];return o.length&&o.forEach(n=>{n===this.sess.el||S(n,this.sess.el)||(r=h(n),a[0]>r.w&&a[1]>r.h&&e>=r.x&&s>=r.y&&e<=r.xw&&s<=r.yh&&(a=[r.w,r.h],i=n))}),i}drops(e){return this.droppables=e,this}addDrops(e){return this.droppables?(this.droppables=this.droppables.concat(e),this):this.drops(e)}addListener(e){return m(this,e),this}apply(e,s){if(Array.isArray(e))return e.forEach(r=>this.apply(r)),this;let o=A(e,"");return o=o.position,(!o||o==="static")&&(e.style.position="relative"),(s||e).onmousedown=s?r=>this.start(r,e,s):r=>this.start(r,e),this}autoZ(){return this.autoZ=!0,this}noChildActivation(){return this.noChild=!0,this}reset(e=this.sess.el){return e.style.top=0,e.style.left=0,this}},R=N;function H(t,e){let s=Array.from(t.querySelectorAll("li")),o={},r=0;return s.forEach(i=>{if(i.className!=="seperator"&&i.parentNode===t){r=1;let[a]=i.getElementsByTagName("ul");o[`_${i.id.substr(e.length)}`]=a!==void 0?H(a,e):1}}),r?o:1}function $(t,e,s){let o=Array.from(t.querySelectorAll("li")),r=[],i=[];r.push(...o.filter(n=>n.className!=="title")),r.forEach(n=>{let c=document.createElement("li");c.className="seperator",i.push(c),k(c,n)});let a=new R().noChildActivation();a.drops(i.concat(r)).addListener({ondragover(n){n.droptarget.style.border="1px solid #000"},ondragout(n){n.droptarget.style.border="none"},ondrop(n){let c=n.droptarget.nextSibling,l,f=n.el.className==="parentlock",u=n.el.className==="nofirstlevel";if(n.droptarget&&(n.droptarget.style.border="none"),n.droptarget.className==="seperator"){if(f&&n.droptarget.parentNode!==n.el.parentNode||u&&n.droptarget.parentNode.className==="tree"||S(n.droptarget,n.el)||n.el===c)return a.reset(n.el);c.className==="spacer"&&c.parentNode.removeChild(c),c.className!=="spacer"?E(n.el.previousSibling,n.droptarget):n.el.previousSibling.parentNode.removeChild(n.el.previousSibling),E(n.el,n.droptarget)}else!f&&n.droptarget.tagName==="LI"&&([l]=n.droptarget.getElementsByTagName("ul"),l||(l=document.createElement("ul"),n.droptarget.appendChild(l)),l.appendChild(n.el.previousSibling),l.appendChild(n.el),n.droptarget.appendChild(l));return a.reset(n.el),s&&(s.value=JSON.stringify(H(t,e))),null}}),r.forEach(n=>a.apply(n))}var g=class{static get selector(){throw new Error("No Selector defined")}constructor(e){this.element=e,e.hydrated=!0}};var O="valid",B="invalid",x=class extends g{static get selector(){return"input[data-autocomplete-action]"}constructor(e){super(e),e.autocomplete="off",this.action=e.dataset.autocompleteAction;let s=e.dataset.autocompleteOutput,o=e.dataset.autocompleteIndicator;if(this.outputElement=s&&document.querySelector(s),this.indicatorElement=o&&document.querySelector(o),!this.outputElement)throw new Error("Expected element to have data-autocomplete-output");e.addEventListener("keyup",r=>this.keyUp(r)),e.addEventListener("keydown",r=>{r.key==="Enter"&&r.preventDefault()})}getResultsContainer(){let e=h(this.element),s=document.querySelector("#autocomplete");return s||(s=m(document.createElement("div"),{id:"autocomplete"}),m(s.style,{zIndex:b()}),document.body.appendChild(s)),m(s.style,{top:`${e.yh}px`,left:`${e.x}px`,width:`${e.w}px`}),s}keyUp(e){let s=this.getResultsContainer(),o=Array.from(s.querySelectorAll("div")),r=o.findIndex(c=>c.classList.contains("selected"));if(o)switch(e.key){case"ArrowUp":r>=0&&(o[r].classList.remove("selected"),o[r-1].classList.add("selected"));return;case"ArrowDown":r===-1?o[0].classList.add("selected"):r<o.length-1&&(o[r].classList.remove("selected"),o[r+1].classList.add("selected"));return;case"Enter":r>=0&&o[r].onclick();return;default:this.indicatorElement&&(this.indicatorElement.classList.remove(O),this.indicatorElement.classList.add(B));break}let i=document.location.toString().match("/ACP/")?"../":"",a=encodeURIComponent(this.element.value),n=`act=${this.action}&term=${a}`;new w().load(`${i}api/?${n}`,{callback:c=>{let l=JSON.parse(c.responseText);if(s.innerHTML="",!l.length)s.style.display="none";else{s.style.display="";let[f,u]=l;f.forEach((p,d)=>{let T=u[d],C=document.createElement("div");C.innerHTML=T,C.onclick=()=>{s.style.display="none",this.indicatorElement&&this.indicatorElement.classList.add(O),this.outputElement.value=p,this.outputElement.dispatchEvent(new Event("change")),this.element.value=T},s.appendChild(C)})}}})}};var v=class extends g{static get selector(){return"input.switch"}constructor(e){super(e),e.style.display="none";let s=m(document.createElement("button"),{type:"button",title:e.className,className:e.className}),o=()=>{s.style.backgroundPosition=e.checked?"top":"bottom"};o(),s.addEventListener("click",()=>{e.checked=!e.checked,o(),e.dispatchEvent(new Event("change"))}),E(s,e)}};function P(t){let e=t.target;if(e.tagName.toLowerCase()==="a"){let s=document.querySelector(`#menu_${e.classList[0]}`);e.classList.add("active");let o=s.style;o.display="block";let r=h(e);o.top=`${r.y+e.clientHeight}px`,o.left=`${r.x}px`,e.onmouseout=i=>{!i.relatedTarget&&i.toElement&&(i.relatedTarget=i.toElement),i.relatedTarget!==s&&i.relatedTarget.offsetParent!==s&&(e.classList.remove("active"),s.style.display="none")},s.onmouseout=i=>{!i.relatedTarget&&i.toElement&&(i.relatedTarget=i.toElement),i.relatedTarget!==e&&i.relatedTarget.offsetParent!==s&&i.relatedTarget!==s&&(e.classList.remove("active"),s.style.display="none")}}}function Y(t){let e=[],s=[],o=Array.from(t.elements),r=t.submitButton;o.forEach(i=>{!i.name||i.type==="submit"||(i.type==="checkbox"||i.type==="radio")&&!i.checked||(e.push(i.name),s.push(i.value))}),r&&(e.push(r.name),s.push(r.value)),new w().load(document.location.search,{data:[e,s]}),alert("Saved. Ajax-submitted so you don't lose your place")}function F(){document.querySelector("#nav").addEventListener("mouseover",P),Array.from(document.querySelectorAll("form[data-use-ajax-submit]")).forEach(o=>{o.addEventListener("submit",r=>{r.preventDefault(),Y(o)})}),document.querySelectorAll(v.selector).forEach(o=>new v(o));let t=document.querySelector(".editor");t&&t.addEventListener("keydown",o=>{o.keyCode===9&&(q(t,"    "),o.preventDefault())}),document.querySelectorAll(x.selector).forEach(o=>new x(o));let s=document.querySelector(".tree");s&&$(s,"forum_",document.querySelector("#ordered"))}D(F);})();

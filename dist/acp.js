"use strict";(()=>{function w(n){document.readyState==="complete"?n():document.addEventListener("DOMContentLoaded",n)}function S(n){return n&&window.getComputedStyle?window.getComputedStyle(n):null}function h(n){let{x:e,y:t,height:o,width:r}=n.getBoundingClientRect(),i=e+window.scrollX,a=t+window.scrollY;return{x:i,y:a,yh:a+o,xw:i+r,w:r,h:o}}function x(n,e){return e.contains(n)}function N(n,e){n.parentNode&&n.parentNode.removeChild(n),e.parentNode?.insertBefore(n,e)}function E(n,e){n.parentNode&&n.parentNode.removeChild(n),e.parentNode?.insertBefore(n,e.nextSibling)}function b(){return Array.from(document.querySelectorAll("*")).reduce((t,o)=>o.style.zIndex&&Number(o.style.zIndex)>t?Number(o.style.zIndex):t,0)+1}function I(n,e){return n?e?n.map((t,o)=>`${encodeURIComponent(t)}=${encodeURIComponent(e[o]||"")}`).join("&"):Object.keys(n).map(t=>`${encodeURIComponent(t)}=${encodeURIComponent(n[t]||"")}`).join("&"):""}var T=class{constructor(e){this.setup={readyState:4,callback(){},method:"POST",...e}}load(e,{callback:t,data:o,method:r=this.setup.method,requestType:i=1}={}){let a=null;o&&Array.isArray(o)&&Array.isArray(o[0])&&o[0].length===o[1].length?a=I(o[0],o[1]):typeof o!="string"&&(a=I(o));let s=new XMLHttpRequest;return t&&(this.setup.callback=t),s.onreadystatechange=()=>{s.readyState===this.setup.readyState&&this.setup.callback(s)},s.open(r,e,!0),s.url=e,s.type=i,r&&s.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),s.setRequestHeader("X-JSACCESS",i),s.send(a),s}},v=T;function H(n,e){let t=n.scrollTop;if(document.selection)n.focus(),document.selection.createRange().text=e;else{let o=n.selectionStart,r=n.selectionEnd;n.value=n.value.substring(0,o)+e+n.value.substr(r),n.selectionStart=o+e.length,n.selectionEnd=o+e.length}n.focus(),n.scrollTop=t}var C=class{sess;boundEvents;droppables;noChild=!1;bounds;onstart;ondragover;ondrag;ondragout;ondrop;autoZIndex=!0;constructor(){this.droppables=[],this.sess={el:document.body,mx:0,my:0},this.boundEvents={drag:e=>this.drag(e),drop:()=>this.drop()}}start(e,t,o){e.stopPropagation();let r=t||e.target,i=S(r),a=b();this.noChild&&e.target!==(o||r)||r.getAttribute("draggable")!=="false"&&(this.sess={el:r,mx:e.pageX,my:e.pageY,ex:parseInt(i?.left??"",10)||0,ey:parseInt(i?.top??"",10)||0,info:{el:r,mx:0,my:0},zIndex:r.style.zIndex},(!this.sess.zIndex||Number(this.sess.zIndex)<a-1)&&(r.style.zIndex=`${a}`),this.onstart?.({...this.sess,droptarget:this.testDrops(this.sess.mx,this.sess.my)}),document.addEventListener("mousemove",this.boundEvents.drag),document.addEventListener("mouseup",this.boundEvents.drop),this.drag(e))}drag(e){e.stopPropagation();let t=this.sess.el.style,o=e.pageX,r=e.pageY,i=o,a=r,s,d=(this.sess.ex??0)+i-this.sess.mx,c=(this.sess.ey??0)+a-this.sess.my,l=this.bounds;l&&(d<l[0]?(i=i-d+l[0],[d]=l):d>l[0]+l[2]&&(d=l[0]+l[2]),c<l[1]?(a=a-c+l[1],[c]=l):c>l[1]+l[3]&&(c=l[1]+l[3])),t.left=`${d}px`,t.top=`${c}px`;let f=this.sess.info?.droptarget,u={left:d,top:c,el:this.sess.el,mx:i,my:a,droptarget:this.testDrops(o,r)};this.sess.info=u,this.ondrag?.(u),u.droptarget&&f!==u.droptarget&&this.ondragover?.(u),f&&u.droptarget!==f&&(s=u.droptarget,u.droptarget=f,this.ondragout?.(u),u.droptarget=s)}boundingBox(e,t,o,r){return this.bounds=[e,t,o,r],this}drop(){return this.boundEvents&&(document.removeEventListener("mouseup",this.boundEvents.drop),document.removeEventListener("mousemove",this.boundEvents.drag)),this.ondrop?.(this.sess.info),this.autoZIndex&&(this.sess.el.style.zIndex=this.sess.zIndex??""),!0}testDrops(e,t){let{droppables:o}=this,r,i=[9999,9999];if(o.length)return o.findLast(a=>{if(!(a===this.sess.el||x(a,this.sess.el))&&(r=h(a),i[0]>r.w&&i[1]>r.h&&e>=r.x&&t>=r.y&&e<=r.xw&&t<=r.yh))return i=[r.w,r.h],a})}drops(e){return this.droppables=e,this}addDrops(e){return this.droppables?(this.droppables=this.droppables.concat(e),this):this.drops(e)}addListener(e){return Object.assign(this,e),this}apply(e,t){if(Array.isArray(e))return e.forEach(i=>this.apply(i)),this;let r=S(e)?.position;return(!r||r==="static")&&(e.style.position="relative"),(t||e).onmousedown=t?i=>this.start(i,e,t):i=>this.start(i,e),this}autoZ(){return this.autoZIndex=!1,this}noChildActivation(){return this.noChild=!0,this}reset(e=this.sess.el){return e.style.top="0",e.style.left="0",this}},$=C;function D(n,e){let t=Array.from(n.querySelectorAll("li")),o={},r=0;return t.forEach(i=>{if(i.className!=="seperator"&&i.parentNode===n){r=1;let[a]=i.getElementsByTagName("ul");o[`_${i.id.slice(e.length)}`]=a!==void 0?D(a,e):1}}),r?o:1}function M(n,e,t){let o=Array.from(n.querySelectorAll("li")),r=[],i=[];r.push(...o.filter(s=>s.className!=="title")),r.forEach(s=>{let d=document.createElement("li");d.className="seperator",i.push(d),N(d,s)});let a=new $().noChildActivation();a.drops([...r,...i]).addListener({ondragover(s){s.droptarget&&(s.droptarget.style.border="1px solid #000")},ondragout(s){s.droptarget&&(s.droptarget.style.border="none")},ondrop(s){let d,c=s.el.className==="parentlock",l=s.el.className==="nofirstlevel";if(a.reset(s.el),!!s.droptarget){if(s.droptarget.style.border="none",s.droptarget.className==="seperator"){if(c&&s.droptarget.parentNode!==s.el.parentNode){a.reset(s.el);return}if(l&&s.droptarget.parentNode?.className==="tree"){a.reset(s.el);return}if(x(s.droptarget,s.el)||s.el===s.droptarget.nextSibling){a.reset(s.el);return}let p=s.droptarget.nextSibling;p.className==="spacer"&&p.parentNode?.removeChild(p),p.className!=="spacer"?E(s.el.previousSibling,s.droptarget):s.el.previousSibling?.parentNode?.removeChild(s.el.previousSibling),E(s.el,s.droptarget)}else!c&&s.droptarget.tagName==="LI"&&([d]=s.droptarget.getElementsByTagName("ul"),d||(d=document.createElement("ul"),s.droptarget.appendChild(d)),d.appendChild(s.el.previousSibling),d.appendChild(s.el),s.droptarget.appendChild(d));t&&(t.value=JSON.stringify(D(n,e)))}}}),r.forEach(s=>a.apply(s))}var m=class{static get selector(){throw new Error("No Selector defined")}constructor(e){this.element=e,e.hydrated=!0}};var k="valid",q="invalid",g=class extends m{static get selector(){return"input[data-autocomplete-action]"}constructor(e){super(e),e.autocomplete="off",this.action=e.dataset.autocompleteAction;let t=e.dataset.autocompleteOutput,o=e.dataset.autocompleteIndicator;if(this.outputElement=t&&document.querySelector(t),this.indicatorElement=o&&document.querySelector(o),!this.outputElement)throw new Error("Expected element to have data-autocomplete-output");e.addEventListener("keyup",r=>this.keyUp(r)),e.addEventListener("keydown",r=>{r.key==="Enter"&&r.preventDefault()})}getResultsContainer(){let e=h(this.element),t=document.querySelector("#autocomplete");return t||(t=Object.assign(document.createElement("div"),{id:"autocomplete"}),Object.assign(t.style,{zIndex:b()}),document.body.appendChild(t)),Object.assign(t.style,{top:`${e.yh}px`,left:`${e.x}px`,width:`${e.w}px`}),t}keyUp(e){let t=this.getResultsContainer(),o=Array.from(t.querySelectorAll("div")),r=o.findIndex(d=>d.classList.contains("selected"));if(o)switch(e.key){case"ArrowUp":r>=0&&(o[r].classList.remove("selected"),o[r-1].classList.add("selected"));return;case"ArrowDown":r===-1?o[0].classList.add("selected"):r<o.length-1&&(o[r].classList.remove("selected"),o[r+1].classList.add("selected"));return;case"Enter":r>=0&&o[r].onclick();return;default:this.indicatorElement&&(this.indicatorElement.classList.remove(k),this.indicatorElement.classList.add(q));break}let i=document.location.toString().match("/ACP/")?"../":"",a=encodeURIComponent(this.element.value),s=`act=${this.action}&term=${a}`;new v().load(`${i}api/?${s}`,{callback:d=>{let c=JSON.parse(d.responseText);if(t.innerHTML="",!c.length)t.style.display="none";else{t.style.display="";let[l,p]=c;l.forEach((f,u)=>{let A=p[u],L=document.createElement("div");L.innerHTML=A,L.onclick=()=>{t.style.display="none",this.indicatorElement&&this.indicatorElement.classList.add(k),this.outputElement.value=f,this.outputElement.dispatchEvent(new Event("change")),this.element.value=A},t.appendChild(L)})}}})}};var y=class extends m{static get selector(){return"input.switch"}constructor(e){super(e),e.style.display="none";let t=Object.assign(document.createElement("button"),{type:"button",title:e.className,className:e.className}),o=()=>{t.style.backgroundPosition=e.checked?"top":"bottom"};o(),t.addEventListener("click",()=>{e.checked=!e.checked,o(),e.dispatchEvent(new Event("change"))}),E(t,e)}};function j(n){let e=n.target;if(e?.tagName.toLowerCase()==="a"){let t=document.querySelector(`#menu_${e.classList[0]}`);e.classList.add("active");let o=t.style;o.display="block";let r=h(e);o.top=`${r.y+e.clientHeight}px`,o.left=`${r.x}px`,e.onmouseout=i=>{!i.relatedTarget&&i.toElement&&(i.relatedTarget=i.toElement),i.relatedTarget!==t&&i.relatedTarget.offsetParent!==t&&(e.classList.remove("active"),t.style.display="none")},t.onmouseout=i=>{!i.relatedTarget&&i.toElement&&(i.relatedTarget=i.toElement),i.relatedTarget!==e&&i.relatedTarget.offsetParent!==t&&i.relatedTarget!==t&&(e.classList.remove("active"),t.style.display="none")}}}function O(n){let e=[],t=[],o=Array.from(n.elements),r=n.submitButton;o.forEach(i=>{!i.name||i.type==="submit"||(i.type==="checkbox"||i.type==="radio")&&!i.checked||(e.push(i.name),t.push(i.value))}),r&&(e.push(r.name),t.push(r.value)),new v().load(document.location.search,{data:[e,t]}),alert("Saved. Ajax-submitted so you don't lose your place")}function R(){document.querySelector("#nav").addEventListener("mouseover",j),Array.from(document.querySelectorAll("form[data-use-ajax-submit]")).forEach(o=>{o.addEventListener("submit",r=>{r.preventDefault(),O(o)})}),document.querySelectorAll(y.selector).forEach(o=>new y(o));let n=document.querySelector(".editor");n&&n.addEventListener("keydown",o=>{o.keyCode===9&&(H(n,"    "),o.preventDefault())}),document.querySelectorAll(g.selector).forEach(o=>new g(o));let t=document.querySelector(".tree");t&&M(t,"forum_",document.querySelector("#ordered"))}w(R);})();

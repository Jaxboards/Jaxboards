!function(){"use strict";function e(e,t){return!!e&&(e.currentStyle?e.currentStyle:!!window.getComputedStyle&&window.getComputedStyle(e,t))}function t(e){let{x:t,y:s,height:n,width:o}=e.getBoundingClientRect();return t+=window.scrollX,s+=window.scrollY,{x:t,y:s,yh:s+n,xw:t+o,w:o,h:n}}function s(e,t){return t.contains(e)}function n(e,t){e.parentNode&&e.parentNode.removeChild(e),t.parentNode.insertBefore(e,t.nextSibling)}function o(){return Array.from(document.getElementsByTagName("*")).reduce(((e,t)=>t.style.zIndex&&Number(t.style.zIndex)>e?Number(t.style.zIndex):e),0)+1}function r(e,t){return Object.assign(e,t)}function a(e,...t){return e&&"function"==typeof e?e(...t):null}function l(e,t){return e?t?e.map(((e,s)=>`${encodeURIComponent(e)}=${encodeURIComponent(t[s]||"")}`)).join("&"):Object.keys(e).map((t=>`${encodeURIComponent(t)}=${encodeURIComponent(e[t]||"")}`)).join("&"):""}class i{constructor(e){this.setup={readyState:4,callback(){},method:"POST",...e}}load(e,{callback:t,data:s,method:n=this.setup.method,requestType:o=1}={}){let r=null;s&&Array.isArray(s)&&Array.isArray(s[0])&&s[0].length===s[1].length?r=l(s[0],s[1]):"string"!=typeof s&&(r=l(s));const a=new XMLHttpRequest;return t&&(this.setup.callback=t),a.onreadystatechange=()=>{a.readyState===this.setup.readyState&&this.setup.callback(a)},a.open(n,e,!0),a.url=e,a.type=o,n&&a.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),a.setRequestHeader("X-JSACCESS",o),a.send(r),a}}function c(e){const t=document.body,s=document.documentElement;switch(e.keyCode){case 13:e.ENTER=!0;break;case 37:e.LEFT=!0;break;case 38:e.UP=!0;break;case.39:e.RIGHT=!0;break;case 40:e.DOWN=!0}return void 0===e.srcElement&&(e.srcElement=e.target),void 0===e.pageY&&(e.pageY=e.clientY+(parseInt(s.scrollTop||t.scrollTop,10)||0),e.pageX=e.clientX+(parseInt(s.scrollLeft||t.scrollLeft,10)||0)),e.cancel=()=>(e.returnValue=!1,e.preventDefault&&e.preventDefault(),e),e.stopBubbling=()=>(e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0,e),e}class d{constructor(){this.droppables=[]}start(s,n,r){const l=new c(s).cancel().stopBubbling(),i=n||s.target,d=e(i),u=o();this.noChild&&(l.srcElement||l.target)!==(r||i)||"false"!==i.getAttribute("draggable")&&(this.sess={el:i,mx:parseInt(l.pageX,10),my:parseInt(l.pageY,10),ex:parseInt(d.left,10)||0,ey:parseInt(d.top,10)||0,info:{},bc:t(i),zIndex:i.style.zIndex},(!this.sess.zIndex||Number(this.sess.zIndex)<u-1)&&(i.style.zIndex=u),a(this.onstart,{...this.sess,droptarget:this.testDrops(this.sess.mx,this.sess.my)}),this.boundEvents={drag:e=>this.drag(e),drop:e=>this.drop(e)},document.addEventListener("mousemove",this.boundEvents.drag),document.addEventListener("mouseup",this.boundEvents.drop),this.drag(l))}drag(e){const t=new c(e).cancel(),s=this.sess.el.style;let n,o=!1;const r=parseInt(t.pageX,10),l=parseInt(t.pageY,10);let i,d=r,u=l,p=this.sess.ex+d-this.sess.mx,h=this.sess.ey+u-this.sess.my;const m=this.bounds;m&&(p<m[0]?(d=d-p+m[0],[p]=m):p>m[0]+m[2]&&(p=m[0]+m[2]),h<m[1]?(u=u-h+m[1],[h]=m):h>m[1]+m[3]&&(h=m[1]+m[3])),s.left=`${p}px`,s.top=`${h}px`,o=(n=this.sess.info).droptarget,n={left:p,top:h,e:t,el:this.sess.el,mx:d,my:u,droptarget:this.testDrops(r,l),dx:d-(n.mx||d),dy:u-(n.my||u),sx:this.sess.ex,sy:this.sess.ey},this.sess.info=n,a(this.ondrag,n),n.droptarget&&o!==n.droptarget&&a(this.ondragover,n),o&&n.droptarget!==o&&(i=n.droptarget,n.droptarget=o,a(this.ondragout,n),n.droptarget=i)}boundingBox(e,t,s,n){return this.bounds=[e,t,s,n],this}drop(){return document.removeEventListener("mouseup",this.boundEvents.drop),document.removeEventListener("mousemove",this.boundEvents.drag),a(this.ondrop,this.sess.info),this.autoZ||(this.sess.el.style.zIndex=this.sess.zIndex),!0}testDrops(e,n){const{droppables:o}=this;let r,a=!1,l=[9999,9999];return o.length?(o.forEach((o=>{o===this.sess.el||s(o,this.sess.el)||(r=t(o),l[0]>r.w&&l[1]>r.h&&e>=r.x&&n>=r.y&&e<=r.xw&&n<=r.yh&&(l=[r.w,r.h],a=o))})),a):a}drops(e){return this.droppables=e,this}addDrops(e){return this.droppables?(this.droppables=this.droppables.concat(e),this):this.drops(e)}addListener(e){return r(this,e),this}apply(t,s){if(Array.isArray(t))return t.forEach((e=>this.apply(e))),this;let n=e(t,"");return n=n.position,n&&"static"!==n||(t.style.position="relative"),(s||t).onmousedown=s?e=>this.start(e,t,s):e=>this.start(e,t),this}autoZ(){return this.autoZ=!0,this}noChildActivation(){return this.noChild=!0,this}reset(e=this.sess.el){return e.style.top=0,e.style.left=0,this}}function u(e,t){const s=Array.from(e.querySelectorAll("li")),n={};let o=0;return s.forEach((s=>{if("seperator"!==s.className&&s.parentNode===e){o=1;const[e]=s.getElementsByTagName("ul");n[`_${s.id.substr(t.length)}`]=void 0!==e?u(e,t):1}})),o?n:1}function p(e,t,o){const r=Array.from(e.querySelectorAll("li")),a=[],l=[];a.push(...r.filter((e=>"title"!==e.className))),a.forEach((e=>{const t=document.createElement("li");var s,n;t.className="seperator",l.push(t),n=e,(s=t).parentNode&&s.parentNode.removeChild(s),n.parentNode.insertBefore(s,n)}));const i=(new d).noChildActivation();i.drops(l.concat(a)).addListener({ondragover(e){e.droptarget.style.border="1px solid #000"},ondragout(e){e.droptarget.style.border="none"},ondrop(r){const a=r.droptarget.nextSibling;let l;const c="parentlock"===r.el.className,d="nofirstlevel"===r.el.className;if(r.droptarget&&(r.droptarget.style.border="none"),"seperator"===r.droptarget.className){if(c&&r.droptarget.parentNode!==r.el.parentNode)return i.reset(r.el);if(d&&"tree"===r.droptarget.parentNode.className)return i.reset(r.el);if(s(r.droptarget,r.el)||r.el===a)return i.reset(r.el);"spacer"===a.className&&a.parentNode.removeChild(a),"spacer"!==a.className?n(r.el.previousSibling,r.droptarget):r.el.previousSibling.parentNode.removeChild(r.el.previousSibling),n(r.el,r.droptarget)}else c||"LI"!==r.droptarget.tagName||([l]=r.droptarget.getElementsByTagName("ul"),l||(l=document.createElement("ul"),r.droptarget.appendChild(l)),l.appendChild(r.el.previousSibling),l.appendChild(r.el),r.droptarget.appendChild(l));return i.reset(r.el),o&&(o.value=JSON.stringify(u(e,t))),null}}),a.forEach((e=>i.apply(e)))}class h{static get selector(){throw new Error("No Selector defined")}constructor(e){this.element=e,e.hydrated=!0}}const m="valid";class y extends h{static get selector(){return"input[data-autocomplete-action]"}constructor(e){super(e),e.autocomplete="off",this.action=e.dataset.autocompleteAction;const t=e.dataset.autocompleteOutput,s=e.dataset.autocompleteIndicator;if(this.outputElement=t&&document.querySelector(t),this.indicatorElement=s&&document.querySelector(s),!this.outputElement)throw new Error("Expected element to have data-autocomplete-output");e.addEventListener("keyup",(e=>this.keyUp(e))),e.addEventListener("keydown",(e=>{"Enter"===e.key&&e.preventDefault()}))}getResultsContainer(){const e=t(this.element);let s=document.querySelector("#autocomplete");return s||(s=r(document.createElement("div"),{id:"autocomplete"}),r(s.style,{zIndex:o()}),document.body.appendChild(s)),r(s.style,{top:`${e.yh}px`,left:`${e.x}px`,width:`${e.w}px`}),s}keyUp(e){const t=this.getResultsContainer(),s=Array.from(t.querySelectorAll("div")),n=s.findIndex((e=>e.classList.contains("selected")));if(s)switch(e.key){case"ArrowUp":return void(n>=0&&(s[n].classList.remove("selected"),s[n-1].classList.add("selected")));case"ArrowDown":return void(-1===n?s[0].classList.add("selected"):n<s.length-1&&(s[n].classList.remove("selected"),s[n+1].classList.add("selected")));case"Enter":return void(n>=0&&s[n].onclick());default:this.indicatorElement&&(this.indicatorElement.classList.remove(m),this.indicatorElement.classList.add("invalid"))}const o=document.location.toString().match("/ACP/")?"../":"",r=encodeURIComponent(this.element.value),a=`act=${this.action}&term=${r}`;(new i).load(`${o}api/?${a}`,{callback:e=>{const s=JSON.parse(e.responseText);if(t.innerHTML="",s.length){t.style.display="";const[e,n]=s;e.forEach(((e,s)=>{const o=n[s],r=document.createElement("div");r.innerHTML=o,r.onclick=()=>{t.style.display="none",this.indicatorElement&&this.indicatorElement.classList.add(m),this.outputElement.value=e,this.outputElement.dispatchEvent(new Event("change")),this.element.value=o},t.appendChild(r)}))}else t.style.display="none"}})}}class g extends h{static get selector(){return"input.switch"}constructor(e){super(e),e.style.display="none";const t=r(document.createElement("button"),{type:"button",title:e.className,className:e.className}),s=()=>{t.style.backgroundPosition=e.checked?"top":"bottom"};s(),t.addEventListener("click",(()=>{e.checked=!e.checked,s(),e.dispatchEvent(new Event("change"))})),n(t,e)}}function f(e){const s=e.target;if("a"===s.tagName.toLowerCase()){const e=document.querySelector(`#menu_${s.classList[0]}`);s.classList.add("active");const n=e.style;n.display="block";const o=t(s);n.top=`${o.y+s.clientHeight}px`,n.left=`${o.x}px`,s.onmouseout=t=>{!t.relatedTarget&&t.toElement&&(t.relatedTarget=t.toElement),t.relatedTarget!==e&&t.relatedTarget.offsetParent!==e&&(s.classList.remove("active"),e.style.display="none")},e.onmouseout=t=>{!t.relatedTarget&&t.toElement&&(t.relatedTarget=t.toElement),t.relatedTarget!==s&&t.relatedTarget.offsetParent!==e&&t.relatedTarget!==e&&(s.classList.remove("active"),e.style.display="none")}}}var v;v=function(){document.querySelector("#nav").addEventListener("mouseover",f),Array.from(document.querySelectorAll("form[data-use-ajax-submit]")).forEach((e=>{e.addEventListener("submit",(t=>{t.preventDefault(),function(e){const t=[],s=[],n=Array.from(e.elements),o=e.submitButton;n.forEach((e=>{e.name&&"submit"!==e.type&&("checkbox"!==e.type&&"radio"!==e.type||e.checked)&&(t.push(e.name),s.push(e.value))})),o&&(t.push(o.name),s.push(o.value)),(new i).load(document.location.search,{data:[t,s]}),alert("Saved. Ajax-submitted so you don't lose your place")}(e)}))})),document.querySelectorAll(g.selector).forEach((e=>new g(e)));const e=document.querySelector(".editor");e&&e.addEventListener("keydown",(t=>{9===t.keyCode&&(function(e,t){const s=e.scrollTop;if(document.selection)e.focus(),document.selection.createRange().text=t;else{const s=e.selectionStart,n=e.selectionEnd;e.value=e.value.substring(0,s)+t+e.value.substr(n),e.selectionStart=s+t.length,e.selectionEnd=s+t.length}e.focus(),e.scrollTop=s}(e,"    "),t.preventDefault())})),document.querySelectorAll(y.selector).forEach((e=>new y(e)));const t=document.querySelector(".tree");t&&p(t,"forum_",document.querySelector("#ordered"))},"complete"===document.readyState?v():document.addEventListener("DOMContentLoaded",v)}();

"use strict";(()=>{function g(t,...e){return t&&typeof t=="function"?t(...e):null}function $(t){document.readyState==="complete"?t():document.addEventListener("DOMContentLoaded",t)}function C(t){return t&&window.getComputedStyle?window.getComputedStyle(t):null}function f(t){let{x:e,y:o,height:s,width:r}=t.getBoundingClientRect(),i=e+window.scrollX,a=o+window.scrollY;return{x:i,y:a,yh:a+s,xw:i+r,w:r,h:s}}function v(t,e){return e.contains(t)}function M(t,e){t.parentNode&&t.parentNode.removeChild(t),e.parentNode?.insertBefore(t,e)}function E(t,e){t.parentNode&&t.parentNode.removeChild(t),e.parentNode?.insertBefore(t,e.nextSibling)}function b(){return Array.from(document.querySelectorAll("*")).reduce((o,s)=>s.style.zIndex&&Number(s.style.zIndex)>o?Number(s.style.zIndex):o,0)+1}function k(t,e){return t?e?t.map((o,s)=>`${encodeURIComponent(o)}=${encodeURIComponent(e[s]||"")}`).join("&"):Object.keys(t).map(o=>`${encodeURIComponent(o)}=${encodeURIComponent(t[o]||"")}`).join("&"):""}var w=class{constructor(e){this.setup={readyState:4,callback(){},method:"POST",...e}}load(e,{callback:o,data:s,method:r=this.setup.method,requestType:i=1}={}){let a=null;s&&Array.isArray(s)&&Array.isArray(s[0])&&s[0].length===s[1].length?a=k(s[0],s[1]):typeof s!="string"&&(a=k(s));let n=new XMLHttpRequest;return o&&(this.setup.callback=o),n.onreadystatechange=()=>{n.readyState===this.setup.readyState&&this.setup.callback(n)},n.open(r,e,!0),n.url=e,n.type=i,r&&n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.setRequestHeader("X-JSACCESS",i),n.send(a),n}},S=w;function D(t,e){let o=t.scrollTop;if(document.selection)t.focus(),document.selection.createRange().text=e;else{let s=t.selectionStart,r=t.selectionEnd;t.value=t.value.substring(0,s)+e+t.value.substr(r),t.selectionStart=s+e.length,t.selectionEnd=s+e.length}t.focus(),t.scrollTop=o}function R(t){let e=document.body,o=document.documentElement;switch(t.keyCode){case 13:t.ENTER=!0;break;case 37:t.LEFT=!0;break;case 38:t.UP=!0;break;case .39:t.RIGHT=!0;break;case 40:t.DOWN=!0;break;default:break}return typeof t.srcElement>"u"&&(t.srcElement=t.target),typeof t.pageY>"u"&&(t.pageY=t.clientY+(parseInt(o.scrollTop||e.scrollTop,10)||0),t.pageX=t.clientX+(parseInt(o.scrollLeft||e.scrollLeft,10)||0)),t.cancel=()=>(t.returnValue=!1,t.preventDefault&&t.preventDefault(),t),t.stopBubbling=()=>(t.stopPropagation&&t.stopPropagation(),t.cancelBubble=!0,t),t}var A=R;var T=class{constructor(){this.droppables=[]}start(e,o,s){let r=new A(e).cancel().stopBubbling(),i=o||e.target,a=C(i),n=b();this.noChild&&(r.srcElement||r.target)!==(s||i)||i.getAttribute("draggable")!=="false"&&(this.sess={el:i,mx:parseInt(r.pageX,10),my:parseInt(r.pageY,10),ex:parseInt(a.left,10)||0,ey:parseInt(a.top,10)||0,info:{},bc:f(i),zIndex:i.style.zIndex},(!this.sess.zIndex||Number(this.sess.zIndex)<n-1)&&(i.style.zIndex=n),g(this.onstart,{...this.sess,droptarget:this.testDrops(this.sess.mx,this.sess.my)}),this.boundEvents={drag:c=>this.drag(c),drop:c=>this.drop(c)},document.addEventListener("mousemove",this.boundEvents.drag),document.addEventListener("mouseup",this.boundEvents.drop),this.drag(r))}drag(e){let o=new A(e).cancel(),s=this.sess.el.style,r,i=!1,a=parseInt(o.pageX,10),n=parseInt(o.pageY,10),c=a,l=n,m,u=this.sess.ex+c-this.sess.mx,p=this.sess.ey+l-this.sess.my,d=this.bounds;d&&(u<d[0]?(c=c-u+d[0],[u]=d):u>d[0]+d[2]&&(u=d[0]+d[2]),p<d[1]?(l=l-p+d[1],[p]=d):p>d[1]+d[3]&&(p=d[1]+d[3])),s.left=`${u}px`,s.top=`${p}px`,i=(r=this.sess.info).droptarget,r={left:u,top:p,e:o,el:this.sess.el,mx:c,my:l,droptarget:this.testDrops(a,n),dx:c-(r.mx||c),dy:l-(r.my||l),sx:this.sess.ex,sy:this.sess.ey},this.sess.info=r,g(this.ondrag,r),r.droptarget&&i!==r.droptarget&&g(this.ondragover,r),i&&r.droptarget!==i&&(m=r.droptarget,r.droptarget=i,g(this.ondragout,r),r.droptarget=m)}boundingBox(e,o,s,r){return this.bounds=[e,o,s,r],this}drop(){return document.removeEventListener("mouseup",this.boundEvents.drop),document.removeEventListener("mousemove",this.boundEvents.drag),g(this.ondrop,this.sess.info),this.autoZ||(this.sess.el.style.zIndex=this.sess.zIndex),!0}testDrops(e,o){let{droppables:s}=this,r,i=!1,a=[9999,9999];return s.length&&s.forEach(n=>{n===this.sess.el||v(n,this.sess.el)||(r=f(n),a[0]>r.w&&a[1]>r.h&&e>=r.x&&o>=r.y&&e<=r.xw&&o<=r.yh&&(a=[r.w,r.h],i=n))}),i}drops(e){return this.droppables=e,this}addDrops(e){return this.droppables?(this.droppables=this.droppables.concat(e),this):this.drops(e)}addListener(e){return Object.assign(this,e),this}apply(e,o){if(Array.isArray(e))return e.forEach(r=>this.apply(r)),this;let s=C(e,"");return s=s.position,(!s||s==="static")&&(e.style.position="relative"),(o||e).onmousedown=o?r=>this.start(r,e,o):r=>this.start(r,e),this}autoZ(){return this.autoZ=!0,this}noChildActivation(){return this.noChild=!0,this}reset(e=this.sess.el){return e.style.top=0,e.style.left=0,this}},H=T;function q(t,e){let o=Array.from(t.querySelectorAll("li")),s={},r=0;return o.forEach(i=>{if(i.className!=="seperator"&&i.parentNode===t){r=1;let[a]=i.getElementsByTagName("ul");s[`_${i.id.substr(e.length)}`]=a!==void 0?q(a,e):1}}),r?s:1}function N(t,e,o){let s=Array.from(t.querySelectorAll("li")),r=[],i=[];r.push(...s.filter(n=>n.className!=="title")),r.forEach(n=>{let c=document.createElement("li");c.className="seperator",i.push(c),M(c,n)});let a=new H().noChildActivation();a.drops(i.concat(r)).addListener({ondragover(n){n.droptarget.style.border="1px solid #000"},ondragout(n){n.droptarget.style.border="none"},ondrop(n){let c=n.droptarget.nextSibling,l,m=n.el.className==="parentlock",u=n.el.className==="nofirstlevel";if(n.droptarget&&(n.droptarget.style.border="none"),n.droptarget.className==="seperator"){if(m&&n.droptarget.parentNode!==n.el.parentNode||u&&n.droptarget.parentNode.className==="tree"||v(n.droptarget,n.el)||n.el===c)return a.reset(n.el);c.className==="spacer"&&c.parentNode.removeChild(c),c.className!=="spacer"?E(n.el.previousSibling,n.droptarget):n.el.previousSibling.parentNode.removeChild(n.el.previousSibling),E(n.el,n.droptarget)}else!m&&n.droptarget.tagName==="LI"&&([l]=n.droptarget.getElementsByTagName("ul"),l||(l=document.createElement("ul"),n.droptarget.appendChild(l)),l.appendChild(n.el.previousSibling),l.appendChild(n.el),n.droptarget.appendChild(l));return a.reset(n.el),o&&(o.value=JSON.stringify(q(t,e))),null}}),r.forEach(n=>a.apply(n))}var h=class{static get selector(){throw new Error("No Selector defined")}constructor(e){this.element=e,e.hydrated=!0}};var O="valid",P="invalid",y=class extends h{static get selector(){return"input[data-autocomplete-action]"}constructor(e){super(e),e.autocomplete="off",this.action=e.dataset.autocompleteAction;let o=e.dataset.autocompleteOutput,s=e.dataset.autocompleteIndicator;if(this.outputElement=o&&document.querySelector(o),this.indicatorElement=s&&document.querySelector(s),!this.outputElement)throw new Error("Expected element to have data-autocomplete-output");e.addEventListener("keyup",r=>this.keyUp(r)),e.addEventListener("keydown",r=>{r.key==="Enter"&&r.preventDefault()})}getResultsContainer(){let e=f(this.element),o=document.querySelector("#autocomplete");return o||(o=Object.assign(document.createElement("div"),{id:"autocomplete"}),Object.assign(o.style,{zIndex:b()}),document.body.appendChild(o)),Object.assign(o.style,{top:`${e.yh}px`,left:`${e.x}px`,width:`${e.w}px`}),o}keyUp(e){let o=this.getResultsContainer(),s=Array.from(o.querySelectorAll("div")),r=s.findIndex(c=>c.classList.contains("selected"));if(s)switch(e.key){case"ArrowUp":r>=0&&(s[r].classList.remove("selected"),s[r-1].classList.add("selected"));return;case"ArrowDown":r===-1?s[0].classList.add("selected"):r<s.length-1&&(s[r].classList.remove("selected"),s[r+1].classList.add("selected"));return;case"Enter":r>=0&&s[r].onclick();return;default:this.indicatorElement&&(this.indicatorElement.classList.remove(O),this.indicatorElement.classList.add(P));break}let i=document.location.toString().match("/ACP/")?"../":"",a=encodeURIComponent(this.element.value),n=`act=${this.action}&term=${a}`;new S().load(`${i}api/?${n}`,{callback:c=>{let l=JSON.parse(c.responseText);if(o.innerHTML="",!l.length)o.style.display="none";else{o.style.display="";let[m,u]=l;m.forEach((p,d)=>{let I=u[d],L=document.createElement("div");L.innerHTML=I,L.onclick=()=>{o.style.display="none",this.indicatorElement&&this.indicatorElement.classList.add(O),this.outputElement.value=p,this.outputElement.dispatchEvent(new Event("change")),this.element.value=I},o.appendChild(L)})}}})}};var x=class extends h{static get selector(){return"input.switch"}constructor(e){super(e),e.style.display="none";let o=Object.assign(document.createElement("button"),{type:"button",title:e.className,className:e.className}),s=()=>{o.style.backgroundPosition=e.checked?"top":"bottom"};s(),o.addEventListener("click",()=>{e.checked=!e.checked,s(),e.dispatchEvent(new Event("change"))}),E(o,e)}};function z(t){let e=t.target;if(e?.tagName.toLowerCase()==="a"){let o=document.querySelector(`#menu_${e.classList[0]}`);e.classList.add("active");let s=o.style;s.display="block";let r=f(e);s.top=`${r.y+e.clientHeight}px`,s.left=`${r.x}px`,e.onmouseout=i=>{!i.relatedTarget&&i.toElement&&(i.relatedTarget=i.toElement),i.relatedTarget!==o&&i.relatedTarget.offsetParent!==o&&(e.classList.remove("active"),o.style.display="none")},o.onmouseout=i=>{!i.relatedTarget&&i.toElement&&(i.relatedTarget=i.toElement),i.relatedTarget!==e&&i.relatedTarget.offsetParent!==o&&i.relatedTarget!==o&&(e.classList.remove("active"),o.style.display="none")}}}function j(t){let e=[],o=[],s=Array.from(t.elements),r=t.submitButton;s.forEach(i=>{!i.name||i.type==="submit"||(i.type==="checkbox"||i.type==="radio")&&!i.checked||(e.push(i.name),o.push(i.value))}),r&&(e.push(r.name),o.push(r.value)),new S().load(document.location.search,{data:[e,o]}),alert("Saved. Ajax-submitted so you don't lose your place")}function B(){document.querySelector("#nav").addEventListener("mouseover",z),Array.from(document.querySelectorAll("form[data-use-ajax-submit]")).forEach(s=>{s.addEventListener("submit",r=>{r.preventDefault(),j(s)})}),document.querySelectorAll(x.selector).forEach(s=>new x(s));let t=document.querySelector(".editor");t&&t.addEventListener("keydown",s=>{s.keyCode===9&&(D(t,"    "),s.preventDefault())}),document.querySelectorAll(y.selector).forEach(s=>new y(s));let o=document.querySelector(".tree");o&&N(o,"forum_",document.querySelector("#ordered"))}$(B);})();

!function(){"use strict";function e(e,t){return!!e&&(e.currentStyle?e.currentStyle:!!window.getComputedStyle&&window.getComputedStyle(e,t))}function t(e){let t=0,s=0;const o=parseInt(e.offsetHeight,10)||0,n=parseInt(e.offsetWidth,10)||0;let r=e;do{t+=parseInt(r.offsetLeft,10)||0,s+=parseInt(r.offsetTop,10)||0,r=r.offsetParent}while(r);return{x:t,y:s,yh:s+o,xw:t+n,w:n,h:o}}function s(e,t){return t.contains(e)}function o(e,t){e.parentNode&&e.parentNode.removeChild(e),t.parentNode.insertBefore(e,t.nextSibling)}function n(){return Array.from(document.getElementsByTagName("*")).reduce(((e,t)=>t.style.zIndex&&Number(t.style.zIndex)>e?Number(t.style.zIndex):e),0)+1}function r(e,t){return Object.assign(e,t)}function a(e,...t){return e&&"function"==typeof e?e(...t):null}function l(e,t){return e?t?e.map(((e,s)=>`${encodeURIComponent(e)}=${encodeURIComponent(t[s]||"")}`)).join("&"):Object.keys(e).map((t=>`${encodeURIComponent(t)}=${encodeURIComponent(e[t]||"")}`)).join("&"):""}class i{constructor(e){this.setup={readyState:4,callback(){},method:"POST",...e}}load(e,{callback:t,data:s,method:o=this.setup.method,requestType:n=1}={}){let r=null;s&&Array.isArray(s)&&Array.isArray(s[0])&&s[0].length===s[1].length?r=l(s[0],s[1]):"string"!=typeof s&&(r=l(s));const a=new XMLHttpRequest;return t&&(this.setup.callback=t),a.onreadystatechange=()=>{a.readyState===this.setup.readyState&&this.setup.callback(a)},a.open(o,e,!0),a.url=e,a.type=n,o&&a.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),a.setRequestHeader("X-JSACCESS",n),a.send(r),a}}function c(e){const t=document.body,s=document.documentElement;switch(e.keyCode){case 13:e.ENTER=!0;break;case 37:e.LEFT=!0;break;case 38:e.UP=!0;break;case.39:e.RIGHT=!0;break;case 40:e.DOWN=!0}return void 0===e.srcElement&&(e.srcElement=e.target),void 0===e.pageY&&(e.pageY=e.clientY+(parseInt(s.scrollTop||t.scrollTop,10)||0),e.pageX=e.clientX+(parseInt(s.scrollLeft||t.scrollLeft,10)||0)),e.cancel=()=>(e.returnValue=!1,e.preventDefault&&e.preventDefault(),e),e.stopBubbling=()=>(e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0,e),e}class d{constructor(){this.droppables=[]}start(s,o,r){const l=new c(s).cancel().stopBubbling(),i=o||s.target,d=e(i),u=n();this.noChild&&(l.srcElement||l.target)!==(r||i)||"false"!==i.getAttribute("draggable")&&(this.sess={el:i,mx:parseInt(l.pageX,10),my:parseInt(l.pageY,10),ex:parseInt(d.left,10)||0,ey:parseInt(d.top,10)||0,info:{},bc:t(i),zIndex:i.style.zIndex},(!this.sess.zIndex||Number(this.sess.zIndex)<u-1)&&(i.style.zIndex=u),a(this.onstart,{...this.sess,droptarget:this.testDrops(this.sess.mx,this.sess.my)}),this.boundEvents={drag:e=>this.drag(e),drop:e=>this.drop(e)},document.addEventListener("mousemove",this.boundEvents.drag),document.addEventListener("mouseup",this.boundEvents.drop),this.drag(l))}drag(e){const t=new c(e).cancel(),s=this.sess.el.style;let o,n=!1;const r=parseInt(t.pageX,10),l=parseInt(t.pageY,10);let i,d=r,u=l,p=this.sess.ex+d-this.sess.mx,h=this.sess.ey+u-this.sess.my;const m=this.bounds;m&&(p<m[0]?(d=d-p+m[0],[p]=m):p>m[0]+m[2]&&(p=m[0]+m[2]),h<m[1]?(u=u-h+m[1],[h]=m):h>m[1]+m[3]&&(h=m[1]+m[3])),s.left=`${p}px`,s.top=`${h}px`,n=(o=this.sess.info).droptarget,o={left:p,top:h,e:t,el:this.sess.el,mx:d,my:u,droptarget:this.testDrops(r,l),dx:d-(o.mx||d),dy:u-(o.my||u),sx:this.sess.ex,sy:this.sess.ey},this.sess.info=o,a(this.ondrag,o),o.droptarget&&n!==o.droptarget&&a(this.ondragover,o),n&&o.droptarget!==n&&(i=o.droptarget,o.droptarget=n,a(this.ondragout,o),o.droptarget=i)}boundingBox(e,t,s,o){return this.bounds=[e,t,s,o],this}drop(){return document.removeEventListener("mouseup",this.boundEvents.drop),document.removeEventListener("mousemove",this.boundEvents.drag),a(this.ondrop,this.sess.info),this.autoZ||(this.sess.el.style.zIndex=this.sess.zIndex),!0}testDrops(e,o){const{droppables:n}=this;let r,a=!1,l=[9999,9999];return n.length?(n.forEach((n=>{n===this.sess.el||s(n,this.sess.el)||(r=t(n),l[0]>r.w&&l[1]>r.h&&e>=r.x&&o>=r.y&&e<=r.xw&&o<=r.yh&&(l=[r.w,r.h],a=n))})),a):a}drops(e){return this.droppables=e,this}addDrops(e){return this.droppables?(this.droppables=this.droppables.concat(e),this):this.drops(e)}addListener(e){return r(this,e),this}apply(t,s){if(Array.isArray(t))return t.forEach((e=>this.apply(e))),this;let o=e(t,"");return o=o.position,o&&"static"!==o||(t.style.position="relative"),(s||t).onmousedown=s?e=>this.start(e,t,s):e=>this.start(e,t),this}autoZ(){return this.autoZ=!0,this}noChildActivation(){return this.noChild=!0,this}reset(e=this.sess.el){return e.style.top=0,e.style.left=0,this}}function u(e,t){const s=Array.from(e.querySelectorAll("li")),o={};let n=0;return s.forEach((s=>{if("seperator"!==s.className&&s.parentNode===e){n=1;const[e]=s.getElementsByTagName("ul");o[`_${s.id.substr(t.length)}`]=void 0!==e?u(e,t):1}})),n?o:1}function p(e,t,n){const r=Array.from(e.querySelectorAll("li")),a=[],l=[];a.push(...r.filter((e=>"title"!==e.className))),a.forEach((e=>{const t=document.createElement("li");var s,o;t.className="seperator",l.push(t),o=e,(s=t).parentNode&&s.parentNode.removeChild(s),o.parentNode.insertBefore(s,o)}));const i=(new d).noChildActivation();i.drops(l.concat(a)).addListener({ondragover(e){e.droptarget.style.border="1px solid #000"},ondragout(e){e.droptarget.style.border="none"},ondrop(r){const a=r.droptarget.nextSibling;let l;const c="parentlock"===r.el.className,d="nofirstlevel"===r.el.className;if(r.droptarget&&(r.droptarget.style.border="none"),"seperator"===r.droptarget.className){if(c&&r.droptarget.parentNode!==r.el.parentNode)return i.reset(r.el);if(d&&"tree"===r.droptarget.parentNode.className)return i.reset(r.el);if(s(r.droptarget,r.el)||r.el===a)return i.reset(r.el);"spacer"===a.className&&a.parentNode.removeChild(a),"spacer"!==a.className?o(r.el.previousSibling,r.droptarget):r.el.previousSibling.parentNode.removeChild(r.el.previousSibling),o(r.el,r.droptarget)}else c||"LI"!==r.droptarget.tagName||([l]=r.droptarget.getElementsByTagName("ul"),l||(l=document.createElement("ul"),r.droptarget.appendChild(l)),l.appendChild(r.el.previousSibling),l.appendChild(r.el),r.droptarget.appendChild(l));return i.reset(r.el),n&&(n.value=JSON.stringify(u(e,t))),null}}),a.forEach((e=>i.apply(e)))}class h{static get selector(){throw new Error("No Selector defined")}constructor(e){this.element=e,e.hydrated=!0}}const m="valid";class y extends h{static get selector(){return"input[data-autocomplete-action]"}constructor(e){super(e),e.autocomplete="off",this.action=e.dataset.autocompleteAction;const t=e.dataset.autocompleteOutput,s=e.dataset.autocompleteIndicator;if(this.outputElement=t&&document.querySelector(t),this.indicatorElement=s&&document.querySelector(s),!this.outputElement)throw new Error("Expected element to have data-autocomplete-output");e.addEventListener("keyup",(e=>this.keyUp(e))),e.addEventListener("keydown",(e=>{"Enter"===e.key&&e.preventDefault()}))}getResultsContainer(){const e=t(this.element);let s=document.querySelector("#autocomplete");return s||(s=r(document.createElement("div"),{id:"autocomplete"}),r(s.style,{zIndex:n()}),document.body.appendChild(s)),r(s.style,{top:`${e.yh}px`,left:`${e.x}px`,width:`${e.w}px`}),s}keyUp(e){const t=this.getResultsContainer(),s=Array.from(t.querySelectorAll("div")),o=s.findIndex((e=>e.classList.contains("selected")));if(s)switch(e.key){case"ArrowUp":return void(o>=0&&(s[o].classList.remove("selected"),s[o-1].classList.add("selected")));case"ArrowDown":return void(-1===o?s[0].classList.add("selected"):o<s.length-1&&(s[o].classList.remove("selected"),s[o+1].classList.add("selected")));case"Enter":return void(o>=0&&s[o].onclick());default:this.indicatorElement&&(this.indicatorElement.classList.remove(m),this.indicatorElement.classList.add("invalid"))}const n=document.location.toString().match("/ACP/")?"../":"",r=encodeURIComponent(this.element.value),a=`act=${this.action}&term=${r}`;(new i).load(`${n}api/?${a}`,{callback:e=>{const s=JSON.parse(e.responseText);if(t.innerHTML="",s.length){t.style.display="";const[e,o]=s;e.forEach(((e,s)=>{const n=o[s],r=document.createElement("div");r.innerHTML=n,r.onclick=()=>{t.style.display="none",this.indicatorElement&&this.indicatorElement.classList.add(m),this.outputElement.value=e,this.outputElement.dispatchEvent(new Event("change")),this.element.value=n},t.appendChild(r)}))}else t.style.display="none"}})}}class g extends h{static get selector(){return"input.switch"}constructor(e){super(e),e.style.display="none";const t=r(document.createElement("button"),{type:"button",title:e.className,className:e.className}),s=()=>{t.style.backgroundPosition=e.checked?"top":"bottom"};s(),t.addEventListener("click",(()=>{e.checked=!e.checked,s(),e.dispatchEvent(new Event("change"))})),o(t,e)}}function f(e){const s=e.target;if("a"===s.tagName.toLowerCase()){const e=document.querySelector(`#menu_${s.classList[0]}`);s.classList.add("active");const o=e.style;o.display="block";const n=t(s);o.top=`${n.y+s.clientHeight}px`,o.left=`${n.x}px`,s.onmouseout=t=>{!t.relatedTarget&&t.toElement&&(t.relatedTarget=t.toElement),t.relatedTarget!==e&&t.relatedTarget.offsetParent!==e&&(s.classList.remove("active"),e.style.display="none")},e.onmouseout=t=>{!t.relatedTarget&&t.toElement&&(t.relatedTarget=t.toElement),t.relatedTarget!==s&&t.relatedTarget.offsetParent!==e&&t.relatedTarget!==e&&(s.classList.remove("active"),e.style.display="none")}}}var v;v=function(){document.querySelector("#nav").addEventListener("mouseover",f),Array.from(document.querySelectorAll("form[data-use-ajax-submit]")).forEach((e=>{e.addEventListener("submit",(t=>{t.preventDefault(),function(e){const t=[],s=[],o=Array.from(e.elements),n=e.submitButton;o.forEach((e=>{e.name&&"submit"!==e.type&&("checkbox"!==e.type&&"radio"!==e.type||e.checked)&&(t.push(e.name),s.push(e.value))})),n&&(t.push(n.name),s.push(n.value)),(new i).load(document.location.search,{data:[t,s]}),alert("Saved. Ajax-submitted so you don't lose your place")}(e)}))})),document.querySelectorAll(g.selector).forEach((e=>new g(e)));const e=document.querySelector(".editor");e&&e.addEventListener("keydown",(t=>{9===t.keyCode&&(function(e,t){const s=e.scrollTop;if(document.selection)e.focus(),document.selection.createRange().text=t;else{const s=e.selectionStart,o=e.selectionEnd;e.value=e.value.substring(0,s)+t+e.value.substr(o),e.selectionStart=s+t.length,e.selectionEnd=s+t.length}e.focus(),e.scrollTop=s}(e,"    "),t.preventDefault())})),document.querySelectorAll(y.selector).forEach((e=>new y(e)));const t=document.querySelector(".tree");t&&p(t,"forum_",document.querySelector("#ordered"))},"complete"===document.readyState?v():document.addEventListener("DOMContentLoaded",v)}();

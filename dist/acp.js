function v(E){let q=document.createElement("div");return q.innerHTML=E,q.firstElementChild}function p(E){return[E?.closest("tr")?.rowIndex??0,E?.cellIndex??0]}function z(E){return globalThis.getComputedStyle(E)}function _(E){let{x:q,y:j,height:G,width:K}=E.getBoundingClientRect(),Q=q+globalThis.scrollX,F=j+globalThis.scrollY;return{x:Q,y:F,yh:F+G,xw:Q+K,w:K,h:G}}function U(){return Array.from(document.querySelectorAll("*")).reduce((j,G)=>{if(G.style.zIndex&&Number(G.style.zIndex)>j)return Number(G.style.zIndex);return j},0)+1}function i(E){if(!globalThis.getSelection)return;let q=document.createRange();q.selectNode(E);let j=globalThis.getSelection();if(!j)return;if(j.rangeCount)j.removeAllRanges();j.addRange(q)}function S(E,q){let j=E.scrollTop,G=E.selectionStart??0,K=E.selectionEnd??0;E.value=E.value.substring(0,G)+q+E.value.slice(K),E.selectionStart=G+q.length,E.selectionEnd=G+q.length,E.focus(),E.scrollTop=j}var{userAgent:R}=navigator;function Y(){return"ontouchstart"in window}var o={chrome:/chrome/i.test(R),ie:/msie/i.test(R),iphone:/iphone/i.test(R),mobile:/mobile/i.test(R),n3ds:/nintendo 3ds/.test(R),firefox:/firefox/i.test(R),safari:/safari/i.test(R)};class L{sess;boundEvents;droppables;noChild=!1;bounds;onstart;ondragover;ondrag;ondragout;ondrop;autoZIndex=!0;constructor(){this.droppables=[],this.sess={el:document.body,mx:0,my:0,reset:()=>{return}},this.boundEvents={drag:(E)=>this.drag(E),drop:()=>this.drop()}}start(E,q,j){E.preventDefault(),E.stopPropagation();let G=q||E.target,K=z(G),Q=U();if(this.noChild&&E.target!==(j||G))return;if(G.getAttribute("draggable")==="false")return;if(this.sess={el:G,mx:E instanceof MouseEvent?E.pageX:E.targetTouches[0].pageX,my:E instanceof MouseEvent?E.pageY:E.targetTouches[0].pageY,ex:Number.parseInt(K.left,10)||0,ey:Number.parseInt(K.top,10)||0,info:{el:G,mx:0,my:0,reset:()=>{return}},reset:()=>this.reset(),zIndex:G.style.zIndex},!this.sess.zIndex||Number(this.sess.zIndex)<Q-1)G.style.zIndex=`${Q}`;this.onstart?.({...this.sess,droptarget:this.testDrops(this.sess.mx,this.sess.my)}),document.addEventListener(Y()?"touchmove":"mousemove",this.boundEvents.drag),document.addEventListener(Y()?"touchend":"mouseup",this.boundEvents.drop),this.drag(E)}drag(E){E.stopPropagation();let q=this.sess.el.style,j=E instanceof MouseEvent?E.pageX:E.targetTouches[0].pageX,G=E instanceof MouseEvent?E.pageY:E.targetTouches[0].pageY,K=j,Q=G,F,$=(this.sess.ex??0)+K-this.sess.mx,W=(this.sess.ey??0)+Q-this.sess.my,B=this.bounds;if(B){if($<B[0])K=K-$+B[0],[$]=B;else if($>B[0]+B[2])$=B[0]+B[2];if(W<B[1])Q=Q-W+B[1],[W]=B;else if(W>B[1]+B[3])W=B[1]+B[3]}q.left=`${$}px`,q.top=`${W}px`;let V=this.sess.info,P=V?.droptarget,H={...this.sess,left:$,top:W,mx:K,my:Q,dx:K-(V?.mx||K),dy:Q-(V?.my||Q),droptarget:this.testDrops(j,G)};if(this.sess.info=H,this.ondrag?.(H),H.droptarget&&P!==H.droptarget)this.ondragover?.(H);if(P&&H.droptarget!==P)F=H.droptarget,H.droptarget=P,this.ondragout?.(H),H.droptarget=F}boundingBox(E,q,j,G){return this.bounds=[E,q,j,G],this}drop(){if(this.boundEvents)document.removeEventListener(Y()?"touchend":"mouseup",this.boundEvents.drop),document.removeEventListener(Y()?"touchmove":"mousemove",this.boundEvents.drag);if(this.ondrop?.(this.sess.info??{}),this.autoZIndex)this.sess.el.style.zIndex=this.sess.zIndex??"";return!0}testDrops(E,q){let{droppables:j}=this,G,K=[9999,9999];if(!j.length)return;return j.findLast((Q)=>{if(Q===this.sess.el||this.sess.el.contains(Q))return;if(G=_(Q),K[0]>G.w&&K[1]>G.h&&E>=G.x&&q>=G.y&&E<=G.xw&&q<=G.yh)return K=[G.w,G.h],Q;return})}drops(E){return this.droppables=E,this}addDrops(E){if(!this.droppables)return this.drops(E);return this.droppables=this.droppables.concat(E),this}addListener(E){return Object.assign(this,E),this}apply(E,q){if(Array.isArray(E))return E.forEach((K)=>this.apply(K)),this;let G=z(E)?.position;if(!G||G==="static")E.style.position="relative";return(q||E).addEventListener(Y()?"touchstart":"mousedown",q?(K)=>this.start(K,E,q):(K)=>this.start(K,E)),this}autoZ(){return this.autoZIndex=!1,this}noChildActivation(){return this.noChild=!0,this}reset(E=this.sess.el){return E.style.top="0",E.style.left="0",this}}var D=L;function I(E,q){let j=Array.from(E.querySelectorAll("li")),G={},K=0;return j.forEach((Q)=>{if(Q.className!=="seperator"&&Q.parentNode===E){K=1;let[F]=Q.getElementsByTagName("ul");G[`_${Q.id.slice(q.length)}`]=F?I(F,q):1}}),K?G:1}function y(E){if(!E.droptarget)return;let q=E.el.classList.contains("parentlock"),j=E.el.classList.contains("nofirstlevel");if(q&&E.droptarget.parentNode!==E.el.parentNode){E.reset();return}if(j&&E.droptarget.parentNode?.className==="tree"){E.reset();return}if(E.el.contains(E.droptarget)||E.el===E.droptarget.nextSibling){E.reset();return}let G=E.droptarget.nextElementSibling;if(G?.className==="spacer")G.remove();if(G?.className==="spacer")E.el.previousSibling?.remove();else if(E.el.previousElementSibling)E.droptarget.after(E.el.previousElementSibling);E.droptarget.after(E.el)}function O(E,q,j){let G=Array.from(E.querySelectorAll("li")),K=[],Q=[];K.push(...G.filter(($)=>$.className!=="title")),K.forEach(($)=>{let W=document.createElement("li");W.className="seperator",Q.push(W),$.before(W)});let F=new D().noChildActivation();F.drops([...K,...Q]).addListener({ondragover($){if($.droptarget)$.droptarget.style.border="1px solid #000"},ondragout($){if($.droptarget)$.droptarget.style.border="none"},ondrop($){let W,B=$.el.classList.contains("parentlock");if(F.reset($.el),!$.droptarget)return;if($.droptarget.style.border="none",$.droptarget.className==="seperator")y($);else if(!B&&$.droptarget.tagName==="LI"){if([W]=$.droptarget.getElementsByTagName("ul"),!W)W=document.createElement("ul"),$.droptarget.appendChild(W);W.appendChild($.el.previousSibling),W.appendChild($.el),$.droptarget.appendChild(W)}if(j)j.value=JSON.stringify(I(E,q))}}),F.apply(K)}function b(E){let q=E.getHours()||12,j=`${E.getMinutes()}`.padStart(2,"0");return`${q%12||12}:${j}${q>12?"pm":"am"}`}function T(E){return new Date(E*1000)}var EE=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],jE=["January","February","March","April","May","June","July","August","September","October","November","December"];function h(E){return E[0].toUpperCase()+E.slice(1)}function A(E){let q=new Date,j=new Intl.RelativeTimeFormat(void 0,{numeric:"auto",style:"long"}),G=new Date;G.setTime(+G-86400000),G.setHours(0),G.setMinutes(0),G.setSeconds(0);let K=T(E),Q=Math.round((+K-+q)/1000);if(Q>-60)return j.format(Q,"second");if(Q>-3600)return j.format(Math.round(Q/60),"minute");if(K>G){let F=new Date;return F.setHours(0),F.setMinutes(0),F.setSeconds(0),`${h(j.format(K>F?0:-1,"day"))} @ ${b(K)}`}return Intl.DateTimeFormat(void 0,{month:"short",year:"numeric",day:"numeric",hour:"numeric",hour12:!0,minute:"numeric"}).format(K)}function w(E){let q=T(E),j=q.getHours(),G=j>=12?"pm":"am";j%=12,j=j||12;let K=`${q.getMinutes()}`.padStart(2,"0"),Q=q.getMonth()+1,F=`${q.getDate()}`.padStart(2,"0"),$=q.getFullYear();return`${j}:${K}${G}, ${Q}/${F}/${$}`}function KE(E,q=1000){return new Promise((j)=>{let G=new Set,K=Array.from(E).filter((F)=>!F.complete);if(!K.length){j();return}function Q(){if(G.delete(this.src),G.size===0)j()}if(K.forEach((F)=>{if(!G.has(F.src))G.add(F.src),F.addEventListener("error",Q),F.addEventListener("load",Q)}),q)setTimeout(j,q)})}function QE(){let E=document.querySelectorAll(".autodate"),q=Array.from(document.querySelectorAll("[data-timestamp]"));if(!E)return;E.forEach((j)=>{let G=Number.parseInt(j.getAttribute("title")??"",10),K=j.classList.contains("smalldate")?w(G):A(G);if(K!==j.innerHTML)j.innerHTML=K}),q.forEach((j)=>{if(!j.title)j.title=w(Number.parseInt(j.dataset.timestamp??"",10))})}function C(E){if(document.readyState==="complete")E();else document.addEventListener("DOMContentLoaded",E)}function $E(){let E=document.createElement("input");return E.setAttribute("type","date"),E.type==="date"}function FE(){let E=[String.fromCodePoint(9757,127999),String.fromCodePoint(9757)].map((q)=>{let j=document.body.appendChild(document.createElement("span"));j.appendChild(document.createTextNode(q));let G=j.offsetWidth;return j.remove(),G});return E[0]===E[1]}var N=new Map;class Z{element;constructor(E){this.element=E}}function J(E,q,j){if(!N.has(E))N.set(E,new WeakMap);q.forEach(function(K){if(N.get(E)?.has(K))return;N.get(E)?.set(K,new j(K))})}var x="valid",f="invalid";class k extends Z{method;outputElement;indicatorElement;static hydrate(E){J("AutoComplete",E.querySelectorAll("input[data-autocomplete-action]"),this)}constructor(E){super(E);E.autocomplete="off",this.method=E.dataset.autocompleteAction;let q=E.dataset.autocompleteOutput,j=E.dataset.autocompleteIndicator,G=q?document.querySelector(q):void 0;if(!G)throw Error("Expected element to have data-autocomplete-output");this.outputElement=G||document.createElement("input"),this.indicatorElement=j?document.querySelector(j):void 0,E.addEventListener("keyup",(K)=>this.keyUp(K)),E.addEventListener("keydown",(K)=>{if(K.key==="Enter")K.preventDefault()})}getResultsContainer(){let E=_(this.element),q=document.querySelector("#autocomplete");if(!q)q=Object.assign(document.createElement("div"),{id:"autocomplete"}),Object.assign(q.style,{zIndex:U()}),document.body.appendChild(q);return Object.assign(q.style,{top:`${E.yh}px`,left:`${E.x}px`,width:`${E.w}px`}),q}keyUp(E){let q=this.getResultsContainer(),j=Array.from(q.querySelectorAll("div")),G=j.findIndex((K)=>K.classList.contains("selected"));switch(E.key){case"ArrowUp":case"ArrowDown":j.at(G)?.classList.remove("selected"),j.at((G+(E.key==="ArrowDown"?1:-1))%j.length)?.classList.add("selected");return;case"Enter":if(G>=0)j.at(G)?.dispatchEvent(new Event("click"));return;default:if(this.indicatorElement)this.indicatorElement.classList.remove(x),this.indicatorElement.classList.add(f);if(this.clearResults(),this.element.value)this.doSearch();break}}clearResults(){let E=this.getResultsContainer();E.style.display="none",E.innerHTML=""}async doSearch(){let E=this.getResultsContainer(),q=/ACP/.test(document.location.toString())?"../":"",G=`term=${encodeURIComponent(this.element.value)}`,K=await fetch(`${q}/api/${this.method}?${G}`);if(!K.ok)return;let Q=await K.json();if(E.innerHTML="",Q.length){E.style.display="";let[F,$]=Q;F.forEach((W,B)=>{let V=$[B],P=document.createElement("div");P.innerHTML=V,P.addEventListener("click",()=>{if(E.style.display="none",this.indicatorElement)this.indicatorElement.classList.add(x),this.indicatorElement.classList.remove(f);this.outputElement.value=`${W}`,this.outputElement.dispatchEvent(new Event("change")),this.element.value=V}),E.appendChild(P)});return}E.style.display="none"}}class M extends HTMLElement{static formAssociated=!0;shadow;internals;results;search;leaveHandler;optionKeyboardHandler;hiddenFormField;value;static hydrate(){customElements.define("better-select",M),customElements.define("better-option",class extends HTMLElement{})}constructor(){super();this.value=this.getAttribute("value")??"",this.shadow=this.attachShadow({mode:"open"}),this.internals=this.attachInternals(),this.search=document.createElement("input"),this.results=document.createElement("div"),this.hiddenFormField=Object.assign(document.createElement("input"),{type:"hidden",name:this.getAttribute("name")}),this.leaveHandler=(E)=>{this.results.classList.toggle("open",E.relatedTarget instanceof HTMLElement&&this.results.contains(E.relatedTarget))},this.optionKeyboardHandler=function(q){switch(q.key){case"ArrowUp":this.previousElementSibling?.focus();break;case"ArrowDown":this.nextElementSibling.focus();break;default:break}}}connectedCallback(){let{shadow:E,results:q,search:j}=this;q.className="results",j.autocomplete="off",j.addEventListener("focus",()=>q.classList.toggle("open",!0)),j.addEventListener("input",()=>{this.renderOptions(j.value)}),j.addEventListener("keydown",(K)=>{switch(K.key){case"ArrowUp":this.shadow.querySelector(".results button:last-child")?.focus();break;case"ArrowDown":this.shadow.querySelector(".results button:first-child")?.focus();break;default:break}}),j.addEventListener("blur",this.leaveHandler),E.appendChild(j),E.appendChild(this.hiddenFormField),E.appendChild(q),this.renderOptions(),E.adoptedStyleSheets=[this.stylesheet()],j.setAttribute("role","combobox"),j.setAttribute("aria-activedescendant",""),q.setAttribute("role","listbox");let G=`id-${Math.random()}`;q.setAttribute("id",G),j.setAttribute("aria-controls",G)}close(){this.results.classList.remove("open")}clear(){[...Array.from(this.querySelectorAll("better-option[selected]")),...Array.from(this.results.querySelectorAll(".selected"))].forEach((E)=>{E.removeAttribute("selected"),E.classList.remove("selected")})}renderOptions(E=""){this.results.innerHTML="",this.getOptions(E).forEach((q)=>this.results.appendChild(q))}getOptions(E=""){return Array.from(this.querySelectorAll("better-option")).filter((q)=>q.innerText.toLowerCase().includes(E.toLowerCase())).map((q)=>{let j=document.createElement("button");j.addEventListener("click",()=>{if(!this.hasAttribute("multiple"))this.clear(),this.close();j.classList.toggle("selected"),q.toggleAttribute("selected",j.classList.contains("selected")),this.updateValue()}),j.addEventListener("keydown",this.optionKeyboardHandler),j.classList.toggle("selected",q.hasAttribute("selected"));let G=q.getAttribute("image");if(G){let Q=new Image;Q.src=G,j.appendChild(Q)}let K=document.createTextNode(` ${q.innerText}`);return j.appendChild(K),j.addEventListener("blur",this.leaveHandler),j}).filter(Boolean)}updateValue(){let E=Array.from(this.querySelectorAll("better-option[selected]"));this.value=E.map((q)=>q.getAttribute("value")).join(","),this.search.value=E.at(-1)?.innerText??"",this.internals.setFormValue(this.value),this.dispatchEvent(new Event("change"))}stylesheet(){let E=new CSSStyleSheet;return E.replaceSync(`
            button { display: block; width: 100%; text-align: left; }
            button.selected { background: #1f1f83; color: #FFF; }
            button:hover { background: #9cdcfe; }
            button img { vertical-align: middle; }
            .results { position: absolute; display: none; max-height: 400px; overflow: auto; }
            .results.open { display: block; }
        `),E}}class X extends Z{static hydrate(E){J("Switch",E.querySelectorAll("input.switch"),this)}constructor(E){super(E);E.style.display="none";let q=Object.assign(document.createElement("button"),{type:"button",title:E.className,className:E.className}),j=()=>{q.style.backgroundPosition=E.checked?"top":"bottom"};j(),q.addEventListener("click",()=>{E.checked=!E.checked,j(),E.dispatchEvent(new Event("change"))}),E.after(q)}}function g(E){let q=E.target;if(!(q instanceof HTMLElement))return;if(q?.tagName.toLowerCase()==="a"){let j=document.querySelector(`#menu_${q.classList[0]}`);if(!j)return;q.classList.add("active");let G=j.style;G.display="block";let K=_(q);G.top=`${K.y+q.clientHeight}px`,G.left=`${K.x}px`,q.addEventListener("mouseout",(Q)=>{if(Q.relatedTarget instanceof HTMLElement&&Q.relatedTarget!==j&&Q.relatedTarget.offsetParent!==j)q.classList.remove("active"),j.style.display="none"}),j?.addEventListener("mouseout",(Q)=>{if(Q.relatedTarget instanceof HTMLElement&&Q.relatedTarget!==q&&Q.relatedTarget.offsetParent!==j&&Q.relatedTarget!==j)q.classList.remove("active"),j.style.display="none"})}}async function c(E){let q=new FormData(E,E.submitButton),j=Array.from(q.entries()).filter((G)=>typeof G[1]==="string");await fetch(document.location.search,{method:"POST",body:new URLSearchParams(j),headers:{"X-JSACCESS":"1","Content-Type":"application/x-www-form-urlencoded"}}),alert("Saved. Ajax-submitted so you don't lose your place")}function u(){document.querySelector("#nav")?.addEventListener("mouseover",g),Array.from(document.querySelectorAll("form")).forEach((G)=>{if(!G.dataset.useAjaxSubmit)return;G.addEventListener("submit",(K)=>{K.preventDefault(),c(G)})}),k.hydrate(document.body),X.hydrate(document.body),M.hydrate();let E=document.querySelector(".editor");if(E)E.addEventListener("keydown",(G)=>{if(G.key==="Tab")S(E,"    "),G.preventDefault()});let q=document.querySelector(".tree"),j=document.querySelector("#ordered");if(q&&j)O(q,"forum_",j)}C(u);

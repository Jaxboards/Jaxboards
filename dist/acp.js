"use strict";(()=>{function A(t){return t&&window.getComputedStyle?window.getComputedStyle(t):null}function h(t){let{x:e,y:o,height:s,width:r}=t.getBoundingClientRect(),i=e+window.scrollX,a=o+window.scrollY;return{x:i,y:a,yh:a+s,xw:i+r,w:r,h:s}}function S(t,e){return e.contains(t)}function M(t,e){t.parentNode&&t.parentNode.removeChild(t),e.parentNode?.insertBefore(t,e)}function v(t,e){t.parentNode&&t.parentNode.removeChild(t),e.parentNode?.insertBefore(t,e.nextSibling)}function b(){return Array.from(document.querySelectorAll("*")).reduce((o,s)=>s.style.zIndex&&Number(s.style.zIndex)>o?Number(s.style.zIndex):o,0)+1}function m(t,e){return Object.assign(t,e)}function y(t,...e){return t&&typeof t=="function"?t(...e):null}function k(t){document.readyState==="complete"?t():document.addEventListener("DOMContentLoaded",t)}function D(t,e){return t?e?t.map((o,s)=>`${encodeURIComponent(o)}=${encodeURIComponent(e[s]||"")}`).join("&"):Object.keys(t).map(o=>`${encodeURIComponent(o)}=${encodeURIComponent(t[o]||"")}`).join("&"):""}var C=class{constructor(e){this.setup={readyState:4,callback(){},method:"POST",...e}}load(e,{callback:o,data:s,method:r=this.setup.method,requestType:i=1}={}){let a=null;s&&Array.isArray(s)&&Array.isArray(s[0])&&s[0].length===s[1].length?a=D(s[0],s[1]):typeof s!="string"&&(a=D(s));let n=new XMLHttpRequest;return o&&(this.setup.callback=o),n.onreadystatechange=()=>{n.readyState===this.setup.readyState&&this.setup.callback(n)},n.open(r,e,!0),n.url=e,n.type=i,r&&n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.setRequestHeader("X-JSACCESS",i),n.send(a),n}},L=C;function H(t,e){let o=t.scrollTop;if(document.selection)t.focus(),document.selection.createRange().text=e;else{let s=t.selectionStart,r=t.selectionEnd;t.value=t.value.substring(0,s)+e+t.value.substr(r),t.selectionStart=s+e.length,t.selectionEnd=s+e.length}t.focus(),t.scrollTop=o}function z(t){let e=document.body,o=document.documentElement;switch(t.keyCode){case 13:t.ENTER=!0;break;case 37:t.LEFT=!0;break;case 38:t.UP=!0;break;case .39:t.RIGHT=!0;break;case 40:t.DOWN=!0;break;default:break}return typeof t.srcElement>"u"&&(t.srcElement=t.target),typeof t.pageY>"u"&&(t.pageY=t.clientY+(parseInt(o.scrollTop||e.scrollTop,10)||0),t.pageX=t.clientX+(parseInt(o.scrollLeft||e.scrollLeft,10)||0)),t.cancel=()=>(t.returnValue=!1,t.preventDefault&&t.preventDefault(),t),t.stopBubbling=()=>(t.stopPropagation&&t.stopPropagation(),t.cancelBubble=!0,t),t}var T=z;var I=class{constructor(){this.droppables=[]}start(e,o,s){let r=new T(e).cancel().stopBubbling(),i=o||e.target,a=A(i),n=b();this.noChild&&(r.srcElement||r.target)!==(s||i)||i.getAttribute("draggable")!=="false"&&(this.sess={el:i,mx:parseInt(r.pageX,10),my:parseInt(r.pageY,10),ex:parseInt(a.left,10)||0,ey:parseInt(a.top,10)||0,info:{},bc:h(i),zIndex:i.style.zIndex},(!this.sess.zIndex||Number(this.sess.zIndex)<n-1)&&(i.style.zIndex=n),y(this.onstart,{...this.sess,droptarget:this.testDrops(this.sess.mx,this.sess.my)}),this.boundEvents={drag:l=>this.drag(l),drop:l=>this.drop(l)},document.addEventListener("mousemove",this.boundEvents.drag),document.addEventListener("mouseup",this.boundEvents.drop),this.drag(r))}drag(e){let o=new T(e).cancel(),s=this.sess.el.style,r,i=!1,a=parseInt(o.pageX,10),n=parseInt(o.pageY,10),l=a,c=n,f,u=this.sess.ex+l-this.sess.mx,p=this.sess.ey+c-this.sess.my,d=this.bounds;d&&(u<d[0]?(l=l-u+d[0],[u]=d):u>d[0]+d[2]&&(u=d[0]+d[2]),p<d[1]?(c=c-p+d[1],[p]=d):p>d[1]+d[3]&&(p=d[1]+d[3])),s.left=`${u}px`,s.top=`${p}px`,i=(r=this.sess.info).droptarget,r={left:u,top:p,e:o,el:this.sess.el,mx:l,my:c,droptarget:this.testDrops(a,n),dx:l-(r.mx||l),dy:c-(r.my||c),sx:this.sess.ex,sy:this.sess.ey},this.sess.info=r,y(this.ondrag,r),r.droptarget&&i!==r.droptarget&&y(this.ondragover,r),i&&r.droptarget!==i&&(f=r.droptarget,r.droptarget=i,y(this.ondragout,r),r.droptarget=f)}boundingBox(e,o,s,r){return this.bounds=[e,o,s,r],this}drop(){return document.removeEventListener("mouseup",this.boundEvents.drop),document.removeEventListener("mousemove",this.boundEvents.drag),y(this.ondrop,this.sess.info),this.autoZ||(this.sess.el.style.zIndex=this.sess.zIndex),!0}testDrops(e,o){let{droppables:s}=this,r,i=!1,a=[9999,9999];return s.length&&s.forEach(n=>{n===this.sess.el||S(n,this.sess.el)||(r=h(n),a[0]>r.w&&a[1]>r.h&&e>=r.x&&o>=r.y&&e<=r.xw&&o<=r.yh&&(a=[r.w,r.h],i=n))}),i}drops(e){return this.droppables=e,this}addDrops(e){return this.droppables?(this.droppables=this.droppables.concat(e),this):this.drops(e)}addListener(e){return m(this,e),this}apply(e,o){if(Array.isArray(e))return e.forEach(r=>this.apply(r)),this;let s=A(e,"");return s=s.position,(!s||s==="static")&&(e.style.position="relative"),(o||e).onmousedown=o?r=>this.start(r,e,o):r=>this.start(r,e),this}autoZ(){return this.autoZ=!0,this}noChildActivation(){return this.noChild=!0,this}reset(e=this.sess.el){return e.style.top=0,e.style.left=0,this}},q=I;function R(t,e){let o=Array.from(t.querySelectorAll("li")),s={},r=0;return o.forEach(i=>{if(i.className!=="seperator"&&i.parentNode===t){r=1;let[a]=i.getElementsByTagName("ul");s[`_${i.id.substr(e.length)}`]=a!==void 0?R(a,e):1}}),r?s:1}function N(t,e,o){let s=Array.from(t.querySelectorAll("li")),r=[],i=[];r.push(...s.filter(n=>n.className!=="title")),r.forEach(n=>{let l=document.createElement("li");l.className="seperator",i.push(l),M(l,n)});let a=new q().noChildActivation();a.drops(i.concat(r)).addListener({ondragover(n){n.droptarget.style.border="1px solid #000"},ondragout(n){n.droptarget.style.border="none"},ondrop(n){let l=n.droptarget.nextSibling,c,f=n.el.className==="parentlock",u=n.el.className==="nofirstlevel";if(n.droptarget&&(n.droptarget.style.border="none"),n.droptarget.className==="seperator"){if(f&&n.droptarget.parentNode!==n.el.parentNode||u&&n.droptarget.parentNode.className==="tree"||S(n.droptarget,n.el)||n.el===l)return a.reset(n.el);l.className==="spacer"&&l.parentNode.removeChild(l),l.className!=="spacer"?v(n.el.previousSibling,n.droptarget):n.el.previousSibling.parentNode.removeChild(n.el.previousSibling),v(n.el,n.droptarget)}else!f&&n.droptarget.tagName==="LI"&&([c]=n.droptarget.getElementsByTagName("ul"),c||(c=document.createElement("ul"),n.droptarget.appendChild(c)),c.appendChild(n.el.previousSibling),c.appendChild(n.el),n.droptarget.appendChild(c));return a.reset(n.el),o&&(o.value=JSON.stringify(R(t,e))),null}}),r.forEach(n=>a.apply(n))}var g=class{static get selector(){throw new Error("No Selector defined")}constructor(e){this.element=e,e.hydrated=!0}};var O="valid",B="invalid",x=class extends g{static get selector(){return"input[data-autocomplete-action]"}constructor(e){super(e),e.autocomplete="off",this.action=e.dataset.autocompleteAction;let o=e.dataset.autocompleteOutput,s=e.dataset.autocompleteIndicator;if(this.outputElement=o&&document.querySelector(o),this.indicatorElement=s&&document.querySelector(s),!this.outputElement)throw new Error("Expected element to have data-autocomplete-output");e.addEventListener("keyup",r=>this.keyUp(r)),e.addEventListener("keydown",r=>{r.key==="Enter"&&r.preventDefault()})}getResultsContainer(){let e=h(this.element),o=document.querySelector("#autocomplete");return o||(o=m(document.createElement("div"),{id:"autocomplete"}),m(o.style,{zIndex:b()}),document.body.appendChild(o)),m(o.style,{top:`${e.yh}px`,left:`${e.x}px`,width:`${e.w}px`}),o}keyUp(e){let o=this.getResultsContainer(),s=Array.from(o.querySelectorAll("div")),r=s.findIndex(l=>l.classList.contains("selected"));if(s)switch(e.key){case"ArrowUp":r>=0&&(s[r].classList.remove("selected"),s[r-1].classList.add("selected"));return;case"ArrowDown":r===-1?s[0].classList.add("selected"):r<s.length-1&&(s[r].classList.remove("selected"),s[r+1].classList.add("selected"));return;case"Enter":r>=0&&s[r].onclick();return;default:this.indicatorElement&&(this.indicatorElement.classList.remove(O),this.indicatorElement.classList.add(B));break}let i=document.location.toString().match("/ACP/")?"../":"",a=encodeURIComponent(this.element.value),n=`act=${this.action}&term=${a}`;new L().load(`${i}api/?${n}`,{callback:l=>{let c=JSON.parse(l.responseText);if(o.innerHTML="",!c.length)o.style.display="none";else{o.style.display="";let[f,u]=c;f.forEach((p,d)=>{let $=u[d],w=document.createElement("div");w.innerHTML=$,w.onclick=()=>{o.style.display="none",this.indicatorElement&&this.indicatorElement.classList.add(O),this.outputElement.value=p,this.outputElement.dispatchEvent(new Event("change")),this.element.value=$},o.appendChild(w)})}}})}};var E=class extends g{static get selector(){return"input.switch"}constructor(e){super(e),e.style.display="none";let o=m(document.createElement("button"),{type:"button",title:e.className,className:e.className}),s=()=>{o.style.backgroundPosition=e.checked?"top":"bottom"};s(),o.addEventListener("click",()=>{e.checked=!e.checked,s(),e.dispatchEvent(new Event("change"))}),v(o,e)}};function P(t){let e=t.target;if(e?.tagName.toLowerCase()==="a"){let o=document.querySelector(`#menu_${e.classList[0]}`);e.classList.add("active");let s=o.style;s.display="block";let r=h(e);s.top=`${r.y+e.clientHeight}px`,s.left=`${r.x}px`,e.onmouseout=i=>{!i.relatedTarget&&i.toElement&&(i.relatedTarget=i.toElement),i.relatedTarget!==o&&i.relatedTarget.offsetParent!==o&&(e.classList.remove("active"),o.style.display="none")},o.onmouseout=i=>{!i.relatedTarget&&i.toElement&&(i.relatedTarget=i.toElement),i.relatedTarget!==e&&i.relatedTarget.offsetParent!==o&&i.relatedTarget!==o&&(e.classList.remove("active"),o.style.display="none")}}}function Y(t){let e=[],o=[],s=Array.from(t.elements),r=t.submitButton;s.forEach(i=>{!i.name||i.type==="submit"||(i.type==="checkbox"||i.type==="radio")&&!i.checked||(e.push(i.name),o.push(i.value))}),r&&(e.push(r.name),o.push(r.value)),new L().load(document.location.search,{data:[e,o]}),alert("Saved. Ajax-submitted so you don't lose your place")}function F(){document.querySelector("#nav").addEventListener("mouseover",P),Array.from(document.querySelectorAll("form[data-use-ajax-submit]")).forEach(s=>{s.addEventListener("submit",r=>{r.preventDefault(),Y(s)})}),document.querySelectorAll(E.selector).forEach(s=>new E(s));let t=document.querySelector(".editor");t&&t.addEventListener("keydown",s=>{s.keyCode===9&&(H(t,"    "),s.preventDefault())}),document.querySelectorAll(x.selector).forEach(s=>new x(s));let o=document.querySelector(".tree");o&&N(o,"forum_",document.querySelector("#ordered"))}k(F);})();

"use strict";(()=>{function w(s){document.readyState==="complete"?s():document.addEventListener("DOMContentLoaded",s)}function L(s){return s&&window.getComputedStyle?window.getComputedStyle(s):null}function f(s){let{x:e,y:o,height:t,width:r}=s.getBoundingClientRect(),i=e+window.scrollX,a=o+window.scrollY;return{x:i,y:a,yh:a+t,xw:i+r,w:r,h:t}}function E(s,e){return e.contains(s)}function N(s,e){s.parentNode&&s.parentNode.removeChild(s),e.parentNode?.insertBefore(s,e)}function y(s,e){s.parentNode&&s.parentNode.removeChild(s),e.parentNode?.insertBefore(s,e.nextSibling)}function x(){return Array.from(document.querySelectorAll("*")).reduce((o,t)=>t.style.zIndex&&Number(t.style.zIndex)>o?Number(t.style.zIndex):o,0)+1}function I(s,e){return s?e?s.map((o,t)=>`${encodeURIComponent(o)}=${encodeURIComponent(e[t]||"")}`).join("&"):Object.keys(s).map(o=>`${encodeURIComponent(o)}=${encodeURIComponent(s[o]||"")}`).join("&"):""}var S=class{constructor(e){this.setup={readyState:4,callback(){},method:"POST",...e}}load(e,{callback:o,data:t,method:r=this.setup.method,requestType:i=1}={}){let a=null;t&&Array.isArray(t)&&Array.isArray(t[0])&&t[0].length===t[1].length?a=I(t[0],t[1]):typeof t!="string"&&(a=I(t));let n=new XMLHttpRequest;return o&&(this.setup.callback=o),n.onreadystatechange=()=>{n.readyState===this.setup.readyState&&this.setup.callback(n)},n.open(r,e,!0),n.url=e,n.type=i,r&&n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.setRequestHeader("X-JSACCESS",i),n.send(a),n}},b=S;function H(s,e){let o=s.scrollTop;if(document.selection)s.focus(),document.selection.createRange().text=e;else{let t=s.selectionStart,r=s.selectionEnd;s.value=s.value.substring(0,t)+e+s.value.substr(r),s.selectionStart=t+e.length,s.selectionEnd=t+e.length}s.focus(),s.scrollTop=o}var T=class{sess;boundEvents;droppables;noChild=!1;bounds;onstart;ondragover;ondrag;ondragout;ondrop;autoZIndex=!0;constructor(){this.droppables=[],this.sess={el:document.body,mx:0,my:0},this.boundEvents={drag:e=>this.drag(e),drop:()=>this.drop()}}start(e,o,t){e.stopPropagation();let r=o||e.target,i=L(r),a=x();this.noChild&&e.target!==(t||r)||r.getAttribute("draggable")!=="false"&&(this.sess={el:r,mx:e.pageX,my:e.pageY,ex:parseInt(i?.left??"",10)||0,ey:parseInt(i?.top??"",10)||0,info:{el:r,mx:0,my:0},zIndex:r.style.zIndex},(!this.sess.zIndex||Number(this.sess.zIndex)<a-1)&&(r.style.zIndex=`${a}`),this.onstart?.({...this.sess,droptarget:this.testDrops(this.sess.mx,this.sess.my)}),document.addEventListener("mousemove",this.boundEvents.drag),document.addEventListener("mouseup",this.boundEvents.drop),this.drag(e))}drag(e){e.stopPropagation();let o=this.sess.el.style,t,r=e.pageX,i=e.pageY,a=r,n=i,l,c=(this.sess.ex??0)+a-this.sess.mx,p=(this.sess.ey??0)+n-this.sess.my,d=this.bounds;d&&(c<d[0]?(a=a-c+d[0],[c]=d):c>d[0]+d[2]&&(c=d[0]+d[2]),p<d[1]?(n=n-p+d[1],[p]=d):p>d[1]+d[3]&&(p=d[1]+d[3])),o.left=`${c}px`,o.top=`${p}px`,t=this.sess.info?.droptarget;let u={left:c,top:p,el:this.sess.el,mx:a,my:n,droptarget:this.testDrops(r,i)};this.sess.info=u,this.ondrag?.(u),u.droptarget&&t!==u.droptarget&&this.ondragover?.(u),t&&u.droptarget!==t&&(l=u.droptarget,u.droptarget=t,this.ondragout?.(u),u.droptarget=l)}boundingBox(e,o,t,r){return this.bounds=[e,o,t,r],this}drop(){return this.boundEvents&&(document.removeEventListener("mouseup",this.boundEvents.drop),document.removeEventListener("mousemove",this.boundEvents.drag)),this.ondrop?.(this.sess.info),this.autoZIndex&&(this.sess.el.style.zIndex=this.sess.zIndex??""),!0}testDrops(e,o){let{droppables:t}=this,r,i=[9999,9999];if(t.length)return t.findLast(a=>{if(!(a===this.sess.el||E(a,this.sess.el))&&(r=f(a),i[0]>r.w&&i[1]>r.h&&e>=r.x&&o>=r.y&&e<=r.xw&&o<=r.yh))return i=[r.w,r.h],a})}drops(e){return this.droppables=e,this}addDrops(e){return this.droppables?(this.droppables=this.droppables.concat(e),this):this.drops(e)}addListener(e){return Object.assign(this,e),this}apply(e,o){if(Array.isArray(e))return e.forEach(i=>this.apply(i)),this;let r=L(e)?.position;return(!r||r==="static")&&(e.style.position="relative"),(o||e).onmousedown=o?i=>this.start(i,e,o):i=>this.start(i,e),this}autoZ(){return this.autoZIndex=!1,this}noChildActivation(){return this.noChild=!0,this}reset(e=this.sess.el){return e.style.top="0",e.style.left="0",this}},$=T;function D(s,e){let o=Array.from(s.querySelectorAll("li")),t={},r=0;return o.forEach(i=>{if(i.className!=="seperator"&&i.parentNode===s){r=1;let[a]=i.getElementsByTagName("ul");t[`_${i.id.slice(e.length)}`]=a!==void 0?D(a,e):1}}),r?t:1}function C(s,e,o){let t=Array.from(s.querySelectorAll("li")),r=[],i=[];r.push(...t.filter(n=>n.className!=="title")),r.forEach(n=>{let l=document.createElement("li");l.className="seperator",i.push(l),N(l,n)});let a=new $().noChildActivation();a.drops([...r,...i]).addListener({ondragover(n){n.droptarget&&(n.droptarget.style.border="1px solid #000")},ondragout(n){n.droptarget&&(n.droptarget.style.border="none")},ondrop(n){let l,c=n.el.className==="parentlock",p=n.el.className==="nofirstlevel";if(a.reset(n.el),!!n.droptarget){if(n.droptarget.style.border="none",n.droptarget.className==="seperator"){if(c&&n.droptarget.parentNode!==n.el.parentNode||p&&n.droptarget.parentNode?.className==="tree"||E(n.droptarget,n.el)||n.el===n.droptarget.nextSibling)return a.reset(n.el);let d=n.droptarget.nextSibling;d.className==="spacer"&&d.parentNode?.removeChild(d),d.className!=="spacer"?y(n.el.previousSibling,n.droptarget):n.el.previousSibling?.parentNode?.removeChild(n.el.previousSibling),y(n.el,n.droptarget)}else!c&&n.droptarget.tagName==="LI"&&([l]=n.droptarget.getElementsByTagName("ul"),l||(l=document.createElement("ul"),n.droptarget.appendChild(l)),l.appendChild(n.el.previousSibling),l.appendChild(n.el),n.droptarget.appendChild(l));return o&&(o.value=JSON.stringify(D(s,e))),null}}}),r.forEach(n=>a.apply(n))}var m=class{static get selector(){throw new Error("No Selector defined")}constructor(e){this.element=e,e.hydrated=!0}};var k="valid",q="invalid",h=class extends m{static get selector(){return"input[data-autocomplete-action]"}constructor(e){super(e),e.autocomplete="off",this.action=e.dataset.autocompleteAction;let o=e.dataset.autocompleteOutput,t=e.dataset.autocompleteIndicator;if(this.outputElement=o&&document.querySelector(o),this.indicatorElement=t&&document.querySelector(t),!this.outputElement)throw new Error("Expected element to have data-autocomplete-output");e.addEventListener("keyup",r=>this.keyUp(r)),e.addEventListener("keydown",r=>{r.key==="Enter"&&r.preventDefault()})}getResultsContainer(){let e=f(this.element),o=document.querySelector("#autocomplete");return o||(o=Object.assign(document.createElement("div"),{id:"autocomplete"}),Object.assign(o.style,{zIndex:x()}),document.body.appendChild(o)),Object.assign(o.style,{top:`${e.yh}px`,left:`${e.x}px`,width:`${e.w}px`}),o}keyUp(e){let o=this.getResultsContainer(),t=Array.from(o.querySelectorAll("div")),r=t.findIndex(l=>l.classList.contains("selected"));if(t)switch(e.key){case"ArrowUp":r>=0&&(t[r].classList.remove("selected"),t[r-1].classList.add("selected"));return;case"ArrowDown":r===-1?t[0].classList.add("selected"):r<t.length-1&&(t[r].classList.remove("selected"),t[r+1].classList.add("selected"));return;case"Enter":r>=0&&t[r].onclick();return;default:this.indicatorElement&&(this.indicatorElement.classList.remove(k),this.indicatorElement.classList.add(q));break}let i=document.location.toString().match("/ACP/")?"../":"",a=encodeURIComponent(this.element.value),n=`act=${this.action}&term=${a}`;new b().load(`${i}api/?${n}`,{callback:l=>{let c=JSON.parse(l.responseText);if(o.innerHTML="",!c.length)o.style.display="none";else{o.style.display="";let[p,d]=c;p.forEach((M,u)=>{let A=d[u],v=document.createElement("div");v.innerHTML=A,v.onclick=()=>{o.style.display="none",this.indicatorElement&&this.indicatorElement.classList.add(k),this.outputElement.value=M,this.outputElement.dispatchEvent(new Event("change")),this.element.value=A},o.appendChild(v)})}}})}};var g=class extends m{static get selector(){return"input.switch"}constructor(e){super(e),e.style.display="none";let o=Object.assign(document.createElement("button"),{type:"button",title:e.className,className:e.className}),t=()=>{o.style.backgroundPosition=e.checked?"top":"bottom"};t(),o.addEventListener("click",()=>{e.checked=!e.checked,t(),e.dispatchEvent(new Event("change"))}),y(o,e)}};function j(s){let e=s.target;if(e?.tagName.toLowerCase()==="a"){let o=document.querySelector(`#menu_${e.classList[0]}`);e.classList.add("active");let t=o.style;t.display="block";let r=f(e);t.top=`${r.y+e.clientHeight}px`,t.left=`${r.x}px`,e.onmouseout=i=>{!i.relatedTarget&&i.toElement&&(i.relatedTarget=i.toElement),i.relatedTarget!==o&&i.relatedTarget.offsetParent!==o&&(e.classList.remove("active"),o.style.display="none")},o.onmouseout=i=>{!i.relatedTarget&&i.toElement&&(i.relatedTarget=i.toElement),i.relatedTarget!==e&&i.relatedTarget.offsetParent!==o&&i.relatedTarget!==o&&(e.classList.remove("active"),o.style.display="none")}}}function O(s){let e=[],o=[],t=Array.from(s.elements),r=s.submitButton;t.forEach(i=>{!i.name||i.type==="submit"||(i.type==="checkbox"||i.type==="radio")&&!i.checked||(e.push(i.name),o.push(i.value))}),r&&(e.push(r.name),o.push(r.value)),new b().load(document.location.search,{data:[e,o]}),alert("Saved. Ajax-submitted so you don't lose your place")}function R(){document.querySelector("#nav").addEventListener("mouseover",j),Array.from(document.querySelectorAll("form[data-use-ajax-submit]")).forEach(t=>{t.addEventListener("submit",r=>{r.preventDefault(),O(t)})}),document.querySelectorAll(g.selector).forEach(t=>new g(t));let s=document.querySelector(".editor");s&&s.addEventListener("keydown",t=>{t.keyCode===9&&(H(s,"    "),t.preventDefault())}),document.querySelectorAll(h.selector).forEach(t=>new h(t));let o=document.querySelector(".tree");o&&C(o,"forum_",document.querySelector("#ordered"))}w(R);})();
